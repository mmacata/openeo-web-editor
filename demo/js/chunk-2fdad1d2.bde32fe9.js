(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fdad1d2"],{"3d5e":function(e,r,t){"use strict";t.r(r);var s=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("Modal",{ref:"modal",attrs:{minWidth:"70%"},scopedSlots:e._u([{key:"main",fn:function(){return[t("div",{staticClass:"content"},[t("TextEditor",{ref:"editor",staticClass:"editor",attrs:{id:"input",language:"math",placeholder:"e.g. x * 2.5 / (x - y)"},on:{drop:function(r){return e.onDrop(r)},dragover:function(r){return e.allowDrop(r)}},model:{value:e.input,callback:function(r){e.input=r},expression:"input"}}),t("div",{staticClass:"description"},[t("p",[t("i",{staticClass:"fas fa-info-circle"}),e._v(" Above you can insert a mathematical formula and it will be converted to openEO code for you.")]),t("p",[t("strong",[e._v("Operators")]),e._v(":"),t("br"),e._l(e.operators,(function(r){return t("kbd",{key:r.op,staticClass:"click",attrs:{title:r.title,draggable:"true"},on:{click:function(t){return e.emit("showProcess",r.processId)},dragstart:function(t){return e.onDrag(t,"operators",r.op)}}},[e._v(e._s(r.op))])}))],2),t("p",[e._v("Supported "),t("strong",[e._v("mathematical functions")]),e._v(": "),e.mathProcesses.length?[t("br"),e._l(e.mathProcesses,(function(r){return t("kbd",{key:r.id,staticClass:"click",attrs:{title:r.summary,draggable:"true"},on:{click:function(t){return e.emit("showProcess",r.id)},dragstart:function(t){return e.onDrag(t,"functions",r)}}},[e._v(e._s(r.id))])}))]:[e._v("None")]],2),t("p",[e._v("Available "),t("strong",[e._v("output from processes")]),e._v(": "),e.results.length?[t("br"),e._l(e.results,(function(r){return t("kbd",{key:r,attrs:{draggable:"true"},on:{dragstart:function(t){return e.onDrag(t,"results",r)}}},[e._v("#"+e._s(r))])}))]:[e._v("None")]],2),t("p",[t("strong",[e._v("Parameters")]),e._v(": If a variable is found in the formula which can't be resolved to a pre-defined parameter, a new parameter will be created for it. Available pre-defined parameters: "),e.pgParameters.length?[t("br"),e._l(e.pgParameters,(function(r){return t("kbd",{key:r.id,staticClass:"click",attrs:{draggable:"true"},on:{click:function(t){return e.emit("showSchema",r.id,r.spec.schema)},dragstart:function(t){return e.onDrag(t,"pgParameters",r.id)}}},[e._v(e._s(r.id))])}))]:[e._v("None")]],2),e.supportsArrayElement?t("p",[e._v("If the first pre-defined parameter is a (labeled) "),t("strong",[e._v("array")]),e._v(", the value for a specific index or label can be accessed by typing the numeric index or textual label with a "),t("kbd",[e._v("$")]),e._v(" in front, for example "),t("kbd",[e._v("$B1")]),e._v(" for the label B1 or "),t("kbd",[e._v("$0")]),e._v(" for the first element in the array. Numeric labels are not supported.")]):e._e()])],1)]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticClass:"footer"},[t("button",{attrs:{type:"button"},on:{click:e.createResult}},[e._v("Insert")])])]},proxy:!0}])})},a=[],i=t("2930"),n=t("025e"),o=t("0f29"),p=t("3115"),l=t("79e5"),u=t("a76e"),c=t("2b70"),d={name:"ExpressionModal",mixins:[p["a"]],components:{Modal:i["a"],TextEditor:o["a"]},data(){return{input:"",pgParameters:[],arrayElements:{},processGraph:{},result:{},replace:!1}},computed:{...n["a"].mapState("userProcesses",["operatorMapping","arrayOperatorMapping"]),...n["a"].mapGetters(["processRegistry"]),...n["a"].mapGetters("userProcesses",["mathProcesses","isMathProcess","reverseOperatorMapping"]),operators(){var e=[];for(var r in this.operatorMapping){let t=this.operatorMapping[r],s=this.processRegistry.get(t).summary;e.push({op:r,processId:t,title:s})}return e},results(){let e=[];for(var r in this.processGraph){var t=this.processGraph[r],s=this.processRegistry.get(t.process_id);l["a"].isMathProcess(s)&&e.push(r)}return e},supportsArrayElement(){if(0===this.pgParameters.length)return!1;let e=this.processRegistry.get("array_element");return!!e}},methods:{show(e={},r=[]){this.$refs.modal.show("Insert Formula"),this.result={},this.input="",this.replace=!1,this.pgParameters=r,this.processGraph=n["a"].isObject(e)&&n["a"].isObject(e.process_graph)?e.process_graph:{};try{this.importFormula(e)}catch(t){console.info(t)}if(this.arrayElements={},!this.replace)for(let s in this.processGraph){let e=this.processGraph[s];"array_element"===e.process_id&&n["a"].isObject(e.arguments)&&e.arguments.label&&(this.arrayElements[e.arguments.label]={from_node:e.id})}},onDrag(e,r,t){switch(r){case"functions":let e=(t.parameters||[]).map(e=>e.name);t=t.id+"("+e.join(", ")+")";break;case"results":t="#"+t;break}e.dataTransfer.setData("text/plain",t)},allowDrop(e){e.preventDefault()},onDrop(e){var r=e.dataTransfer.getData("text/plain");r&&(e.preventDefault(),this.$refs.editor.insert(r,!1))},importFormula(e){if(!this.isMathProcess(e))return;var r=new u["ProcessGraph"](e,this.processRegistry);r.parse();let t=this.nodeToFormula(r.getResultNode());t&&(this.input=t,this.replace=!0)},nodeToFormula(e,r=null){if("array_element"===e.process_id)return"$"+(e.getArgument("label")||e.getArgument("index"));let t=this.reverseOperatorMapping[e.process_id],s=this.processRegistry.get(e.process_id),a="undefined"!==typeof this.arrayOperatorMapping[e.process_id],i=r=>{if(n["a"].isObject(r))if(r.from_node){let s=e.getProcessGraph().getNode(r.from_node);r=s?this.nodeToFormula(s,t):"#"+r.from_node}else{if(!r.from_parameter)throw new Error("Objects not allowed");r=r.from_parameter}return r},o=[];Array.isArray(s.parameters)&&s.parameters;for(let n of s.parameters){let r=i(e.getRawArgument(n.name));if(a&&Array.isArray(r)&&"data"===n.name){o=r.map(e=>i(e));break}if("undefined"!==typeof r)o.push(r);else{if("undefined"===typeof n.default)throw new Error('Argument for parameter "'+n.name+'" missing');o.push(n.default)}}if(a&&(o=o.filter(e=>null!==e)),t){let e=["/","*"],s=["-","+"],a=o.map(e=>e<0?"("+e+")":e).join(t);return!r||s.includes(r)&&s.includes(t)||e.includes(r)&&e.includes(t)||"^"===t||s.includes(r)&&e.includes(t)?a:"("+a+")"}return e.process_id+"("+o.join(", ")+")"},createResult(){if(0!==this.input.length)try{this.result={};let e=new c["Formula"](this.input),r=this.parseTree(e.tree);if(!n["a"].isObject(r)||!r.from_node)throw new Error("Invalid formula specified.");this.result[r.from_node].result=!0,this.$emit("save",this.result,this.replace),this.$refs.modal.close()}catch(e){n["a"].exception(this,e)}else this.$refs.modal.close()},parseTree(e){let r=Object.keys(e)[0];switch(r){case"Number":return parseFloat(e.Number);case"Identifier":return this.getRef(e.Identifier);case"Expression":return this.parseTree(e.Expression);case"FunctionCall":let t=[];for(let r in e.FunctionCall.args)t.push(this.parseTree(e.FunctionCall.args[r]));return this.addProcess(e.FunctionCall.name,t);case"Binary":return this.addOperatorProcess(e.Binary.operator,this.parseTree(e.Binary.left),this.parseTree(e.Binary.right));case"Unary":let s=this.parseTree(e.Unary.expression);return"-"===e.Unary.operator?"number"===typeof s?-s:this.addOperatorProcess("*",-1,s):s;default:throw new Error("Operation "+r+" not supported.")}},getRef(e){if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if("string"===typeof e&&e.startsWith("#")){let r=e.substring(1);if(this.results.includes(r))return{from_node:r}}if(this.supportsArrayElement&&"string"===typeof e&&e.startsWith("$")){let r=e.substring(1);if(!(r in this.arrayElements)){let e={data:{from_parameter:this.pgParameters[0].id}};r.match(/^\d+$/)?e.index=parseInt(r,10):e.label=r,this.arrayElements[r]=this.addProcess("array_element",e)}return this.arrayElements[r]}return this.pgParameters.filter(r=>r.id===e).length,{from_parameter:e}},addOperatorProcess(e,r,t){if("undefined"!==typeof this.operatorMapping[e]){let s=this.processRegistry.get(this.operatorMapping[e]),a={};if(!s||!Array.isArray(s.parameters)||s.parameters.length<2)throw new Error("Process for operator "+e+" must have at least two parameters");return a[s.parameters[0].name||"x"]=r,a[s.parameters[1].name||"y"]=t,this.addProcess(s,a)}throw new Error("Operator "+e+" not supported.")},addProcess(e,r){if("string"===typeof e&&(e=this.processRegistry.get(e)),!e)throw new Error("Process not available: "+name);if(r.length>n["a"].size(e.parameters))throw new Error("Number of given arguments exceeds number of process parameters for process '"+name+"'.");if(Array.isArray(r)){let t={};for(let s in r){let a=e.parameters[s];t[a.name]=r[s]}r=t}let t=n["a"].getUniqueId(),s={process_id:e.id,arguments:r};return this.result[t]=s,{from_node:t}}}},f=d,h=(t("5eef"),t("2877")),m=Object(h["a"])(f,s,a,!1,null,"417e93a8",null);r["default"]=m.exports},"5eef":function(e,r,t){"use strict";t("b0d1")},b0d1:function(e,r,t){}}]);
//# sourceMappingURL=chunk-2fdad1d2.bde32fe9.js.map