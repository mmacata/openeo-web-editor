{"version":3,"sources":["webpack:///./node_modules/ol-ext/control/LayerSwitcher.js","webpack:///./node_modules/ol/MapBrowserEventType.js","webpack:///./node_modules/ol/CollectionEventType.js","webpack:///./node_modules/ol/Kinetic.js","webpack:///./node_modules/ol/Observable.js","webpack:///./node_modules/ol/ViewHint.js","webpack:///./node_modules/ol/Feature.js","webpack:///./node_modules/ol/MapBrowserEvent.js","webpack:///./node_modules/ol/MapEventType.js","webpack:///./node_modules/ol/LayerType.js","webpack:///./node_modules/ol/Tile.js","webpack:///./node_modules/ol/MapBrowserEventHandler.js","webpack:///./node_modules/ol/MapProperty.js","webpack:///./node_modules/ol/TileQueue.js","webpack:///./node_modules/ol/PluggableMap.js","webpack:///./node_modules/ol/Map.js","webpack:///./node_modules/ol-ext/util/element.js","webpack:///./node_modules/ol/MapEvent.js","webpack:///./node_modules/ol/ObjectEventType.js","webpack:///./node_modules/ol/ImageTile.js","webpack:///./node_modules/ol/AssertionError.js","webpack:///./node_modules/ol/ImageState.js","webpack:///./node_modules/ol/TileCache.js","webpack:///./node_modules/ol/ViewProperty.js","webpack:///./node_modules/ol/View.js","webpack:///./node_modules/ol/TileState.js","webpack:///./node_modules/ol-ext/util/ext.js","webpack:///./node_modules/ol-ext/control/Toggle.js","webpack:///./node_modules/ol-ext/control/TextButton.js","webpack:///./node_modules/ol-ext/interaction/Delete.js","webpack:///./node_modules/ol-ext/geom/GeomUtils.js","webpack:///./node_modules/ol-ext/style/defaultStyle.js","webpack:///./node_modules/ol-ext/interaction/Offset.js","webpack:///./node_modules/ol-ext/geom/LineStringSplitAt.js","webpack:///./node_modules/ol-ext/interaction/Split.js","webpack:///./node_modules/ol-ext/interaction/Transform.js","webpack:///./node_modules/ol-ext/interaction/ModifyFeature.js","webpack:///./node_modules/ol-ext/interaction/DrawRegular.js","webpack:///./node_modules/ol-ext/interaction/DrawHole.js","webpack:///./node_modules/ol-ext/control/EditBar.js","webpack:///./node_modules/ol-ext/control/Swipe.js","webpack:///./node_modules/ol-ext/source/Vector.js","webpack:///./node_modules/ol-ext/interaction/UndoRedo.js","webpack:///./node_modules/ol/Disposable.js","webpack:///./node_modules/ol/TileRange.js","webpack:///./node_modules/ol/MapBrowserPointerEvent.js","webpack:///./node_modules/ol/Object.js","webpack:///./node_modules/ol/Collection.js","webpack:///./node_modules/ol-ext/control/Button.js","webpack:///./node_modules/ol/ImageBase.js","webpack:///./node_modules/ol/ImageCanvas.js","webpack:///./node_modules/ol-ext/control/Bar.js"],"names":["ol_control_LayerSwitcher","options","element","self","this","dcount","show_progress","oninfo","onextent","hasextent","extent","hastrash","trash","reordering","_layers","_layerGroup","layerGroup","getLayers","displayInLayerSwitcher","target","create","className","switcherClass","collapsed","classList","add","button","type","parent","addEventListener","e","toggle","dispatchEvent","contains","preventDefault","overflow","mouseover","remove","topv","click","botv","panel_","addListener","Math","max","min","wheelDelta","detail","stopPropagation","header_","call","set","drawDelay","prototype","tip","up","down","info","plus","layer","get","setMap","map","drawPanel","_listener","change","moveend","size","on","viewChange","bind","getLayerGroup","show","hide","isOpen","setHeader","html","setHTML","dir","hidden","setStyle","height","h","outerHeight","hp","dh","offsetTop","top","lh","getStyle","querySelectorAll","round","_setLayerForLI","li","listeners","push","setLayerOpacity","setLayerVisibility","key","i","querySelector","style","left","getOpacity","checked","getVisible","_clearLayerForLI","forEach","l","_getLayerForLI","testLayerVisibility","getMap","setTimeout","drawPanel_","dragging_","drawList","switchLayerVisibility","layers","setVisible","res","getView","getResolution","getMaxResolution","getMinResolution","ex0","getExtent","ex","calculateExtent","getSize","dragOrdering_","pageY","dragElt","group","elt","currentTarget","parentNode","start","panel","pageY0","touches","length","changedTouches","stop","drop","collection","getArray","removeAt","j","insertAt","removeListener","document","move","abs","innerHTML","position","offsetLeft","opacity","width","outerWidth","offsetRect","scrollTop","elementFromPoint","clientX","clientY","tagName","dragOpacity_","x","pageX","delta","nextElementSibling","setOpacity","ul","setVisibility","onInfo","zoomExtent","fit","removeLayer","getLength","layer_buttons","d","title","unselectable","userSelect","nb","p","setprogress_","layerswitcher_progress","op","offsetX","ul2","loaded","loading","draw","toFixed","getSource","SINGLECLICK","CLICK","DBLCLICK","POINTERDRAG","POINTERMOVE","POINTERDOWN","POINTERUP","POINTEROVER","POINTEROUT","POINTERENTER","POINTERLEAVE","POINTERCANCEL","ADD","REMOVE","Kinetic","decay","minVelocity","delay","decay_","minVelocity_","delay_","points_","angle_","initialVelocity_","begin","update","y","Date","now","end","lastIndex","firstIndex","duration","dx","dy","atan2","sqrt","getDistance","getAngle","Observable","EventTarget","revision_","__proto__","Object","constructor","changed","CHANGE","getRevision","listener","Array","isArray","len","keys","once","un","ii","unByKey","ANIMATING","INTERACTING","Feature","BaseObject","opt_geometryOrProperties","id_","undefined","geometryName_","style_","styleFunction_","geometryChangeKey_","handleGeometryChanged_","getSimplifiedGeometry","geometry","setGeometry","properties","setProperties","clone","getProperties","setGeometryName","getGeometryName","getGeometry","getId","getStyleFunction","handleGeometryChange_","createStyleFunction","setId","id","name","obj","styles","getZIndex","MapBrowserEvent","MapEvent","browserEvent","opt_dragging","opt_frameState","originalEvent","pixel","getEventPixel","coordinate","getCoordinateFromPixel","dragging","POSTRENDER","MOVESTART","MOVEEND","IMAGE","TILE","VECTOR_TILE","VECTOR","Tile","tileCoord","state","opt_options","interimTile","transition_","transition","transitionStarts_","getKey","getInterimTile","tile","getState","LOADED","refreshInterimChain","prev","LOADING","IDLE","getTileCoord","setState","load","getAlpha","time","inTransition","endTransition","MapBrowserEventHandler","moveTolerance","map_","clickTimeoutId_","dragListenerKeys_","moveTolerance_","down_","getViewport","activePointers_","trackedTouches_","pointerEventHandler_","PointerEventHandler","documentPointerEventHandler_","pointerdownListenerKey_","handlePointerDown_","relayedListenerKey_","relayEvent_","emulateClick_","pointerEvent","newEvent","MapBrowserPointerEvent","MapBrowserEventType","clearTimeout","updateActivePointers_","event","pointerId","handlePointerUp_","propagationStopped","isMouseActionButton_","dispose","handlePointerMove_","isMoving_","disposeInternal","LAYERGROUP","SIZE","TARGET","VIEW","PriorityQueue","TileQueue","tilePriorityFunction","tileChangeCallback","apply","tileChangeCallback_","tilesLoading_","tilesLoadingKeys_","enqueue","added","handleTileChange","getTilesLoading","TileState","ERROR","EMPTY","ABORT","tileKey","loadMoreTiles","maxTotalLoading","maxNewLoads","newLoads","abortedTiles","getCount","dequeue","PluggableMap","optionsInternal","createOptionsInternal","maxTilesLoading_","maxTilesLoading","loadTilesWhileAnimating_","loadTilesWhileAnimating","loadTilesWhileInteracting_","loadTilesWhileInteracting","pixelRatio_","pixelRatio","animationDelayKey_","animationDelay_","renderFrame_","coordinateToPixelTransform_","pixelToCoordinateTransform_","frameIndex_","frameState_","previousExtent_","viewPropertyListenerKey_","viewChangeListenerKey_","layerGroupPropertyListenerKeys_","viewport_","createElement","msTouchAction","touchAction","overlayContainer_","appendChild","overlayContainerStopEvent_","overlayEvents","MOUSEDOWN","TOUCHSTART","MSPOINTERDOWN","MOUSEWHEEL","WHEEL","mapBrowserEventHandler_","handleMapBrowserEvent","keyboardEventTarget_","keyboardEventTarget","keyHandlerKeys_","CONTEXTMENU","handleBrowserEvent","controls","Collection","interactions","overlays_","overlays","overlayIdIndex_","renderer_","createRenderer","handleResize_","focus_","postRenderFunctions_","tileQueue_","getTilePriority","handleTileChange_","skippedFeatureUids_","MapProperty","handleLayerGroupChanged_","handleViewChanged_","handleSizeChanged_","handleTargetChanged_","values","control","CollectionEventType","interaction","addOverlayInternal_","overlay","toString","Error","addControl","getControls","addInteraction","getInteractions","addLayer","addOverlay","getOverlays","removeEventListener","RESIZE","cancelAnimationFrame","setTarget","forEachFeatureAtPixel","callback","hitTolerance","layerFilter","forEachFeatureAtCoordinate","getFeaturesAtPixel","features","feature","forEachLayerAtPixel","hasFeatureAtPixel","hasFeatureAtCoordinate","getEventCoordinate","viewportPosition","getBoundingClientRect","eventPosition","getTarget","getTargetElement","getElementById","frameState","pixelToCoordinateTransform","slice","getOverlayById","getPixelFromCoordinate","coordinateToPixelTransform","getRenderer","getOverlayContainer","getOverlayContainerStopEvent","tileSourceKey","tileCenter","tileResolution","wantedTiles","deltaX","focus","deltaY","log","opt_type","mapBrowserEvent","interactionsArray","getActive","cont","handleEvent","handlePostRender","tileQueue","isEmpty","hints","viewHints","ViewHint","reprioritize","hasListener","RENDERCOMPLETE","animate","getLoading","dispatchRenderEvent","postRenderFunctions","render","targetElement","KEYDOWN","KEYPRESS","updateSize","window","removeLayerRenderers","handleViewPropertyChanged_","view","setAttribute","ObjectEventType","PROPERTYCHANGE","isRendered","renderSync","requestAnimationFrame","removeControl","removeInteraction","removeOverlay","viewState","previousFrameState","isDef","getHints","layerStatesArray","getLayerStatesArray","layerStates","center","index","skippedFeatureUids","usedTiles","resolution","rotation","renderFrame","moveStart","MapEventType","idle","setLayerGroup","setSize","setView","skipFeature","computedStyle","getComputedStyle","offsetWidth","parseFloat","offsetHeight","unskipFeature","View","source","Map","renderer","registerLayerRenderers","ol_ext_element","createTextNode","attr","test","trim","Element","label","input","after","value","val","text","eventType","fn","useCapture","split","display","el","st","s","styleProp","defaultView","ownerDocument","replace","toLowerCase","getPropertyValue","currentStyle","str","letter","toUpperCase","oldLeft","oldRsLeft","runtimeStyle","pixelLeft","parseInt","rect","pageYOffset","documentElement","body","pageXOffset","scrollLeft","bottom","right","pos","speed","dt","onmove","page","vertical","scroll","moving","ondragstart","to","step","mousewheel","eventName","CustomEvent","createEvent","initCustomEvent","Event","ImageTile","src","crossOrigin","tileLoadFunction","crossOrigin_","src_","image_","Image","imageListenerKeys_","tileLoadFunction_","unlistenImage_","getBlankImage","getImage","handleImageError_","handleImageLoad_","image","naturalWidth","naturalHeight","LOAD","ctx","fillStyle","fillRect","canvas","AssertionError","code","path","message","TileCache","LRUCache","opt_highWaterMark","expireCache","canExpireCache","peekLast","zKey","pop","pruneExceptNewestZ","peekFirstKey","z","CENTER","RESOLUTION","ROTATION","DEFAULT_MIN_ZOOM","hints_","animations_","updateAnimationKey_","updateAnimations_","projection_","projection","applyOptions_","ViewProperty","resolutionConstraintInfo","createResolutionConstraint","maxResolution_","maxResolution","minResolution_","minResolution","zoomFactor_","zoomFactor","resolutions_","resolutions","minZoom_","minZoom","centerConstraint","createCenterConstraint","resolutionConstraint","constraint","rotationConstraint","createRotationConstraint","constraints_","zoom","constrainResolution","Number","options_","getUpdatedOptions_","newOptions","getZoom","getCenter","getRotation","var_args","arguments$1","arguments","animationCount","setCenter","setZoom","setRotation","animationCallback","series","animation","complete","anchor","easing","sourceCenter","targetCenter","sourceResolution","targetResolution","sourceRotation","PI","targetRotation","isNoopAnimation","setHint","getAnimating","getInteracting","cancelAnimations","more","seriesComplete","jj","elapsed","fraction","progress","x0","y0","x1","y1","calculateCenterZoom","calculateCenterRotate","filter","Boolean","currentCenter","currentResolution","getSizeFromViewport_","selector","metrics","constrainCenter","opt_delta","opt_direction","direction","constrainRotation","getConstraints","opt_hints","opt_size","getMaxZoom","getZoomForResolution","setMaxZoom","maxZoom","getMinZoom","setMinZoom","getProjection","getResolutions","getResolutionForExtent","xResolution","yResolution","getResolutionForValueFunction","opt_power","power","pow","getValueForResolutionFunction","pixelResolution","offset","nearest","getResolutionForZoom","geometryOrExtent","getType","GeometryType","CIRCLE","rotate","padding","coords","getFlatCoordinates","cosAngle","cos","sinAngle","sin","minRotX","Infinity","minRotY","maxRotX","maxRotY","stride","getStride","rotX","rotY","isNaN","constrainedResolution","centerRotX","centerRotY","centerX","centerY","setResolution","centerOn","opt_anchor","hint","returnValue","defaultMaxZoom","defaultZoomFactor","Units","DEGREES","getMetersPerUnit","defaultMaxResolution","defaultMinResolution","floor","enableRotation","ol","ext","ol_ext_inherits","child","inherits","NodeList","removeChild","ol_control_Toggle","interaction_","setActive","active","toggleFn","onToggle","handleClick","autoActivate","bar","setSubBar","setDisable","disable","subbar_","getSubBar","getDisable","disabled","b","oldValue","setInteraction","getInteraction","ol_control_TextButton","ol_interaction_Delete","getFeatures","clear","delete","selected","_getSources","sources","concat","delFeatures","f","removeFeature","ol_extent_intersection","ol_coordinate_dist2d","p1","p2","ol_coordinate_equal","ol_coordinate_offsetCoords","mi","mi1","li1","ri","ri1","si","si1","Xi1","Yi1","p0","N","isClosed","ol_coordinate_findSegment","pt","segment","d0","v0","d1","v1","splitX","pts","splice","splitY","polygon","poly","geom","getCoordinates","g","c","ol_coordinate_sampleAt","dl","sampleAt","result","mpoly","a","intersection","ol_extent","getRadius","simplify","r","hasout","ring","console","warn","ol_style_Style_defaultStyle","white","blue","defaultEditStyle","stroke","color","radius","fill","edit","fillColor","ol_interaction_Offset","handleDownEvent","handleDownEvent_","handleDragEvent","handleDragEvent_","handleMoveEvent","handleMoveEvent_","handleUpEvent","handleUpEvent_","features_","layers_","duplicate","source_","_style","previousCursor_","getFeatureAtPixel_","current","typeGeom","getClosestPoint","hit","coordinates","geomType","current_","currentStyle_","ctrlKey","addFeature","_modifystart","seg","v2","cursor","splitAt","tol","k","getFirstCoordinate","getLastCoordinate","c0","ci","d2","ol_interaction_Split","snapDistance_","snapDistance","tolerance_","tolerance","cursor_","sources_","filterSplit_","sketchStyle","featureStyle","overlayLayer_","useSpatialIndex","_sketch_","getClosestFeature","fi","getClosestFeatureToCoordinate","gi","di","coord","getNearestCoord","link","dm","MAX_VALUE","evt","tosplit","original","linkGeometry","ol_interaction_Transform","selection_","handles_","wrapX","_filter","_handleEvent","condition","addFn_","addCondition","translateFeature","translate","translateBBox","stretch","scale","keepAspectRatio","shiftKey","modifyCenter","metaKey","noFlip","selection","enableRotatedTransform","drawSketch_","setDefaultStyle","Cursors","oldMap","select","isTouch","pointStroke","strokedash","lineDash","fill0","pointFill","circle","points","getAnchor","bigpt","angle","smallpt","createStyle","img","olstyle","im","setScale","tx","getText","setOffsetX","found","bbox_","handle","option","some","getGeometryRotateToZero_","origGeom","viewRotation","rotGeom","item","extendExt","ispt_","center_","iscircle_","addFeatures","indexOf","watchFeatures_","setSelection","_featureListeners","isUpdating_","sel","mode_","opt_","constraint_","coordinate_","pixel_","geoms_","rotatedGeoms_","rotExtent","extent_","rotatedExtent_","rotate0","pt0","ispt","setCenterAndRadius","extentCoordinates","downCoordinate","dragCoordinate","downPoint","dragPoint","scx","scy","centerPoint","applyTransform","g1","g2","dim","default","oldgeom","oldgeoms","ol_interaction_ModifyFeature","modifying","_deleteCondition","pixelTolerance","_condition","deleteCondition","_insertVertexCondition","insertVertexCondition","currentFeature","deselected","dist","lstring","getLineStrings","lring","getLinearRings","getPolygons","getGeometries","getArcs","arcs","coord1","coord2","node","shift","c1","nbpt","closed","typeg","error","getFeaturesInExtent","_modifiedFeatures","_removePoint","getModifiedFeatures","removePoint","_getModification","geoms","setGeometries","setCoordinates","setArcCoordinates","getCurrentFeature","ol_interaction_DrawRegular","squaredClickTolerance_","clickTolerance","maxCircleCoordinates_","maxCircleCoordinates","squareFn_","squareCondition","centeredFn_","centerCondition","canRotate_","canRotate","geometryName","setSides","sides","defaultStyle","sketch_","handleEvent_","reset","started_","sides_","getSides","startAngle","3","4","getGeom_","coord_","dmax","centerPx","square_","centered_","coordPx_","hasrotation","sc","sign","t","feature_","drawPoint_","noclear","_eventTime","downPx_","start_","_longTouch","lastEvent","end_","upPx_","finishDrawing","startCoordinate","square","centered","ol_interaction_DrawHole","_select","geometryFn","geomFn","geometryFunction","_geometryFn","_features","_startDrawing","_finishDrawing","removeLastPoint","_feature","getPolygon","_polygon","_current","intersectsCoordinate","_polygonIndex","hole","pi","newGeom","appendLinearRing","appendPolygon","lastOKCoord","ol_control_EditBar","toggleOne","_source","_interactions","_setSelectInteraction","edition","_setEditInteraction","_setModifyInteraction","Delete","ModifySelect","_getTitle","selectCtrl","sbar","del","Info","Select","DrawPoint","pedit","DrawLine","nbpts","ledit","UndoDraw","FinishDraw","DrawPolygon","_setDrawPolygon","DrawHole","DrawRegular","regular","div","textContent","ctrl","fedit","Transform","transform","Split","Offset","ol_control_Swipe","precomposeRight_","precomposeRight","precomposeLeft_","precomposeLeft","postcompose_","postcompose","rightLayers","orientation","isLayer_","isMoving","clientLeft","clientTop","_drawRect","tr","inversePixelTransform","context","lineTo","moveTo","ratio","save","beginPath","clip","getClassName","restore","opt_fast","ol_interaction_UndoRedo","_undoStack","_redoStack","_undo","_redo","level","_level","action","_reduce","_doShift","_doClear","_block","_record","_defs","define","undoFn","redoFn","undo","redo","setMaxLength","setMaxSize","getStack","prop","custom","_mapListener","blockStart","blockEnd","_watchSources","_watchInteractions","getVectorLayers","init","_sourceListener","vectors","_onAddRemove","_interactionListener","_onInteraction","setattributestart","newp","assign","oldp","newProperties","oldProperties","rotatestart","translatestart","scalestart","modifystart","m","oldGeom","beforesplit","deletestart","aftersplit","deleteend","_handleDo","unset","hasUndo","hasRedo","Disposable","disposed_","TileRange","minX","maxX","minY","maxY","createOrUpdate","tileRange","containsXY","containsTileRange","equals","extend","getHeight","getWidth","intersects","ObjectEvent","opt_values","values_","hasOwnProperty","getKeys","notify","getChangeEventType","opt_silent","changeEventTypeCache","Property","LENGTH","CollectionEvent","opt_element","opt_array","unique_","unique","array_","assertUnique_","updateLength_","arr","array","elem","n","setAt","opt_except","ol_control_Button","bt","button_","evtFunction","firstElementChild","setTitle","setHtml","getButtonElement","ImageBase","EventType","getPixelRatio","ImageCanvas","opt_loader","ImageState","loader_","canvas_","error_","getError","handleLoad_","err","ol_control_Bar","classes","autoDeactivate","controls_","setPosition","onActivateControl_","deactivateControls","except","getActiveControls","sb","ctrls","getControlsByName"],"mappings":"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","file":"js/chunk-2b644eba.a3684e11.js","sourcesContent":["/*\tCopyright (c) 2015 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport ol_control_Control from 'ol/control/Control'\r\nimport ol_layer_Tile from 'ol/layer/Tile'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_layer_VectorTile from 'ol/layer/VectorTile'\r\nimport ol_layer_Image from 'ol/layer/Image'\r\nimport ol_layer_Heatmap from 'ol/layer/Heatmap'\r\nimport {intersects as ol_extent_intersects} from 'ol/extent'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** Layer Switcher Control.\r\n * @fires drawlist\r\n * @fires toggle\r\n * @fires reorder-start\r\n * @fires reorder-end\r\n * @fires layer:visible\r\n * @fires layer:opacity\r\n * \r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options\r\n *  @param {function} options.displayInLayerSwitcher function that takes a layer and return a boolean if the layer is displayed in the switcher, default test the displayInLayerSwitcher layer attribute\r\n *  @param {boolean} options.show_progress show a progress bar on tile layers, default false\r\n *  @param {boolean} options.mouseover show the panel on mouseover, default false\r\n *  @param {boolean} options.reordering allow layer reordering, default true\r\n *  @param {boolean} options.trash add a trash button to delete the layer, default false\r\n *  @param {function} options.oninfo callback on click on info button, if none no info button is shown DEPRECATED: use on(info) instead\r\n *  @param {boolean} options.extent add an extent button to zoom to the extent of the layer\r\n *  @param {function} options.onextent callback when click on extent, default fits view to extent\r\n *  @param {number} options.drawDelay delay in ms to redraw the layer (usefull to prevent flickering when manipulating the layers)\r\n *  @param {boolean} options.collapsed collapse the layerswitcher at beginning, default true\r\n *  @param {ol.layer.Group} options.layerGroup a layer group to display in the switcher, default display all layers of the map\r\n *\r\n * Layers attributes that control the switcher\r\n *\t- allwaysOnTop {boolean} true to force layer stay on top of the others while reordering, default false\r\n *\t- displayInLayerSwitcher {boolean} display the layer in switcher, default true\r\n *\t- noSwitcherDelete {boolean} to prevent layer deletion (w. trash option = true), default false\r\n */\r\nvar ol_control_LayerSwitcher = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n  this.dcount = 0;\r\n  this.show_progress = options.show_progress;\r\n  this.oninfo = (typeof (options.oninfo) == \"function\" ? options.oninfo: null);\r\n  this.onextent = (typeof (options.onextent) == \"function\" ? options.onextent: null);\r\n  this.hasextent = options.extent || options.onextent;\r\n  this.hastrash = options.trash;\r\n  this.reordering = (options.reordering!==false);\r\n  this._layers = [];\r\n  this._layerGroup = (options.layerGroup && options.layerGroup.getLayers) ? options.layerGroup : null;\r\n\r\n  // displayInLayerSwitcher\r\n  if (typeof(options.displayInLayerSwitcher) === 'function') {\r\n    this.displayInLayerSwitcher = options.displayInLayerSwitcher;\r\n  }\r\n\r\n  var element;\r\n  if (options.target) {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: options.switcherClass || \"ol-layerswitcher\"\r\n    });\r\n  } else {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: (options.switcherClass || \"ol-layerswitcher\") +' ol-unselectable ol-control'\r\n    });\r\n    if (options.collapsed !== false) element.classList.add('ol-collapsed'); \r\n    else element.classList.add('ol-forceopen'); \r\n  \r\n    this.button = ol_ext_element.create('BUTTON', {\r\n      type: 'button',\r\n      parent: element\r\n    });\r\n    this.button.addEventListener('touchstart', function(e){\r\n      element.classList.toggle('ol-collapsed');\r\n      self.dispatchEvent({ type: 'toggle', collapsed: element.classList.contains('ol-collapsed') });\r\n      e.preventDefault(); \r\n      self.overflow();\r\n    });\r\n    this.button.addEventListener('click', function(){\r\n      element.classList.toggle('ol-forceopen');\r\n      element.classList.add('ol-collapsed'); \r\n      self.dispatchEvent({ type: 'toggle', collapsed: !element.classList.contains('ol-forceopen') });\r\n      self.overflow();\r\n    });\r\n\r\n    if (options.mouseover) {\r\n      element.addEventListener ('mouseleave', function(){ \r\n        element.classList.add(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: true });\r\n      });\r\n      element.addEventListener ('mouseover', function(){ \r\n        element.classList.remove(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: false });\r\n      });\r\n    }\r\n\r\n    this.topv = ol_ext_element.create('DIV', {\r\n      className: 'ol-switchertopdiv',\r\n      parent: element,\r\n      click: function() {\r\n        self.overflow(\"+50%\");\r\n      }\r\n    });\r\n\r\n    this.botv = ol_ext_element.create('DIV', {\r\n      className: 'ol-switcherbottomdiv',\r\n      parent: element,\r\n      click: function() {\r\n        self.overflow(\"-50%\");\r\n      }\r\n    });\r\n  }\r\n\r\n  this.panel_ = ol_ext_element.create ('UL', {\r\n    className: 'panel',\r\n    parent: element\r\n  });\r\n  ol_ext_element.addListener (this.panel_, 'mousewheel DOMMouseScroll onmousewheel', function(e) {\r\n    if (self.overflow(Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail))))) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n  });\r\n\r\n  this.header_ = ol_ext_element.create('LI', {\r\n    className: 'ol-header',\r\n    parent: this.panel_\r\n  });\r\n\r\n  ol_control_Control.call (this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('drawDelay',options.drawDelay||0);\r\n};\r\nol_ext_inherits(ol_control_LayerSwitcher, ol_control_Control);\r\n\r\n/** List of tips for internationalization purposes\r\n*/\r\nol_control_LayerSwitcher.prototype.tip = {\r\n  up: \"up/down\",\r\n  down: \"down\",\r\n  info: \"informations...\",\r\n  extent: \"zoom to extent\",\r\n  trash: \"remove layer\",\r\n  plus: \"expand/shrink\"\r\n};\r\n\r\n/** Test if a layer should be displayed in the switcher\r\n * @param {ol.layer} layer\r\n * @return {boolean} true if the layer is displayed\r\n */\r\nol_control_LayerSwitcher.prototype.displayInLayerSwitcher = function(layer) {\r\n  return (layer.get('displayInLayerSwitcher')!==false);\r\n};\r\n\r\n/**\r\n * Set the map instance the control is associated with.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_LayerSwitcher.prototype.setMap = function(map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n  this.drawPanel();\r\n  \r\n  if (this._listener) {\r\n    if (this._listener) ol_Observable_unByKey(this._listener.change);\r\n    if (this._listener) ol_Observable_unByKey(this._listener.moveend);\r\n    if (this._listener) ol_Observable_unByKey(this._listener.size);\r\n  }\r\n  this._listener = null;\r\n\r\n  // Get change (new layer added or removed)\r\n  if (map) {\r\n    this._listener = {\r\n      moveend: map.on('moveend', this.viewChange.bind(this)),\r\n      size: map.on('change:size', this.overflow.bind(this))\r\n    }\r\n    // Listen to a layer group\r\n    if (this._layerGroup) {\r\n      this._listener.change = this._layerGroup.getLayers().on('change:length', this.drawPanel.bind(this));\r\n    } else  {\r\n      //Listen to all layers\r\n      this._listener.change = map.getLayerGroup().getLayers().on('change:length', this.drawPanel.bind(this));\r\n    }\r\n  }\r\n};\r\n\r\n/** Show control\r\n */\r\nol_control_LayerSwitcher.prototype.show = function() {\r\n  this.element.classList.add(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Hide control\r\n */\r\nol_control_LayerSwitcher.prototype.hide = function() {\r\n  this.element.classList.remove(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Toggle control\r\n */\r\nol_control_LayerSwitcher.prototype.toggle = function() {\r\n  this.element.classList.toggle(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Is control open\r\n * @return {boolean}\r\n */\r\nol_control_LayerSwitcher.prototype.isOpen = function() {\r\n  return this.element.classList.contains(\"ol-forceopen\");\r\n};\r\n\r\n/** Add a custom header\r\n * @param {Element|string} html content html\r\n */\r\nol_control_LayerSwitcher.prototype.setHeader = function(html) {\r\n  ol_ext_element.setHTML(this.header_, html);\r\n};\r\n\r\n/** Calculate overflow and add scrolls\r\n *\t@param {Number} dir scroll direction -1|0|1|'+50%'|'-50%'\r\n */\r\nol_control_LayerSwitcher.prototype.overflow = function(dir) {\t\r\n  if (this.button) {\r\n    // Nothing to show\r\n    if (ol_ext_element.hidden(this.panel_)) {\r\n      ol_ext_element.setStyle(this.element, { height: 'auto' });\r\n      return;\r\n    }\r\n    // Calculate offset\r\n    var h = ol_ext_element.outerHeight(this.element);\r\n    var hp = ol_ext_element.outerHeight(this.panel_);\r\n    var dh = this.button.offsetTop + ol_ext_element.outerHeight(this.button);\r\n    //var dh = this.button.position().top + this.button.outerHeight(true);\r\n\r\n    var top = this.panel_.offsetTop - dh;\r\n    if (hp > h-dh) {\r\n      // Bug IE: need to have an height defined\r\n      ol_ext_element.setStyle(this.element, { height: '100%' });\r\n      var lh = 2 * ol_ext_element.getStyle(this.panel_.querySelectorAll('li.visible .li-content')[0], 'height');\r\n      switch (dir) {\r\n        case 1: top += lh; break;\r\n        case -1: top -= lh; break;\r\n        case \"+50%\": top += Math.round(h/2); break;\r\n        case \"-50%\": top -= Math.round(h/2); break;\r\n        default: break;\r\n      }\r\n      // Scroll div\r\n      if (top+hp <= h-3*dh/2) {\r\n        top = h-3*dh/2-hp;\r\n        ol_ext_element.hide(this.botv);\r\n      } else {\r\n        ol_ext_element.show(this.botv);\r\n      }\r\n      if (top >= 0) {\r\n        top = 0;\r\n        ol_ext_element.hide(this.topv);\r\n      } else {\r\n        ol_ext_element.show(this.topv);\r\n      }\r\n      // Scroll ?\r\n      ol_ext_element.setStyle(this.panel_, { top: top+\"px\" });\r\n      return true;\r\n    } else {\r\n      ol_ext_element.setStyle(this.element, { height: \"auto\" });\r\n      ol_ext_element.setStyle(this.panel_, { top: 0 });\r\n      ol_ext_element.hide(this.botv);\r\n      ol_ext_element.hide(this.topv);\r\n      return false;\r\n    }\r\n  }\r\n  else return false;\r\n};\r\n\r\n/** Set the layer associated with a li\r\n * @param {Element} li\r\n * @param {ol.layer} layer\r\n */\r\nol_control_LayerSwitcher.prototype._setLayerForLI = function(li, layer) {\r\n  var listeners = [];\r\n  if (layer.getLayers) {\r\n    listeners.push(layer.getLayers().on('change:length', this.drawPanel.bind(this)));\r\n  }\r\n  if (li) {\r\n    // Handle opacity change\r\n    listeners.push(layer.on('change:opacity', (function() {\r\n      this.setLayerOpacity(layer, li);\r\n    }).bind(this)));\r\n    // Handle visibility chage\r\n    listeners.push(layer.on('change:visible', (function() {\r\n      this.setLayerVisibility(layer, li);\r\n    }).bind(this)));\r\n  }\r\n  // Other properties\r\n  listeners.push(layer.on('propertychange', (function(e) {\r\n    if (e.key === 'displayInLayerSwitcher'\r\n      || e.key === 'openInLayerSwitcher') {\r\n      this.drawPanel(e);\r\n    }\r\n  }).bind(this)));\r\n  this._layers.push({ li:li, layer:layer, listeners: listeners });\r\n};\r\n\r\n/** Set opacity for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerOpacity = function(layer, li) {\r\n  var i = li.querySelector('.layerswitcher-opacity-cursor')\r\n  if (i) i.style.left = (layer.getOpacity()*100)+\"%\"\r\n  this.dispatchEvent({ type: 'layer:opacity', layer: layer });\r\n};\r\n\r\n/** Set visibility for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerVisibility = function(layer, li) {\r\n  var i = li.querySelector('.ol-visibility');\r\n  if (i) i.checked = layer.getVisible();\r\n  if (layer.getVisible()) li.classList.add('ol-visible');\r\n  else li.classList.remove('ol-visible');\r\n  this.dispatchEvent({ type: 'layer:visible', layer: layer });\r\n};\r\n\r\n/** Clear layers associated with li\r\n */\r\nol_control_LayerSwitcher.prototype._clearLayerForLI = function() {\r\n  this._layers.forEach(function (li) {\r\n    li.listeners.forEach(function(l) {\r\n      ol_Observable_unByKey(l);\r\n    });\r\n  })\r\n  this._layers = [];\r\n};\r\n\r\n/** Get the layer associated with a li\r\n * @param {Element} li\r\n * @return {ol.layer}\r\n */\r\nol_control_LayerSwitcher.prototype._getLayerForLI = function(li) {\r\n  for (var i=0, l; l=this._layers[i]; i++) {\r\n    if (l.li===li) return l.layer;\r\n  }\r\n  return null;\r\n};\r\n\r\n/**\r\n * On view change hide layer depending on resolution / extent\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.viewChange = function() {\r\n  this.panel_.querySelectorAll('li').forEach( function(li) {\r\n    var l = this._getLayerForLI(li);\r\n    if (l) {\r\n      if (this.testLayerVisibility(l)) li.classList.remove('ol-layer-hidden');\r\n      else li.classList.add('ol-layer-hidden');\r\n    }\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n *\tDraw the panel control (prevent multiple draw due to layers manipulation on the map with a delay function)\r\n*/\r\nol_control_LayerSwitcher.prototype.drawPanel = function() {\r\n  if (!this.getMap()) return;\r\n  var self = this;\r\n  // Multiple event simultaneously / draw once => put drawing in the event queue\r\n  this.dcount++;\r\n  setTimeout (function(){ self.drawPanel_(); }, this.get('drawDelay') || 0);\r\n};\r\n\r\n/** Delayed draw panel control \r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.drawPanel_ = function() {\r\n  if (--this.dcount || this.dragging_) return;\r\n  // Remove existing layers\r\n  this._clearLayerForLI();\r\n  this.panel_.querySelectorAll('li').forEach (function(li) {\r\n    if (!li.classList.contains('ol-header')) li.remove();\r\n  }.bind(this));\r\n  // Draw list\r\n  this.drawList (this.panel_, this._layerGroup ?  this._layerGroup.getLayers() : this.getMap().getLayers());\r\n};\r\n\r\n/** Change layer visibility according to the baselayer option\r\n * @param {ol.layer}\r\n * @param {Array<ol.layer>} related layers\r\n */\r\nol_control_LayerSwitcher.prototype.switchLayerVisibility = function(l, layers) {\r\n  if (!l.get('baseLayer')) {\r\n    l.setVisible(!l.getVisible());\r\n  } else {\r\n    if (!l.getVisible()) l.setVisible(true);\r\n    layers.forEach(function(li) {\r\n      if (l!==li && li.get('baseLayer') && li.getVisible()) li.setVisible(false);\r\n    });\r\n  }\r\n};\r\n\r\n/** Check if layer is on the map (depending on zoom and extent)\r\n * @param {ol.layer}\r\n * @return {boolean}\r\n */\r\nol_control_LayerSwitcher.prototype.testLayerVisibility = function(layer) {\r\n  if (!this.getMap()) return true;\r\n  var res = this.getMap().getView().getResolution();\r\n  if (layer.getMaxResolution()<=res || layer.getMinResolution()>=res) {\r\n    return false;\r\n  } else {\r\n    var ex0 = layer.getExtent();\r\n    if (ex0) {\r\n      var ex = this.getMap().getView().calculateExtent(this.getMap().getSize());\r\n      return ol_extent_intersects(ex, ex0);\r\n    }\r\n    return true;\r\n  }\r\n};\r\n\r\n\r\n/** Start ordering the list\r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOrdering_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  // Get params\r\n  var self = this;\r\n  var elt = e.currentTarget.parentNode.parentNode;\r\n  var start = true;\r\n  var panel = this.panel_; \r\n  var pageY;\r\n  var pageY0 = e.pageY \r\n    || (e.touches && e.touches.length && e.touches[0].pageY) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n  var target, dragElt;\r\n  var layer, group;\r\n  elt.parentNode.classList.add('drag');\r\n\r\n  // Stop ordering\r\n  function stop() {\r\n    if (target) {\r\n      // Get drag on parent\r\n      var drop = layer;\r\n      if (drop && target) {\r\n        var collection ;\r\n        if (group) collection = group.getLayers();\r\n        else collection = self._layerGroup ?  self._layerGroup.getLayers() : self.getMap().getLayers();\r\n        var layers = collection.getArray();\r\n        // Switch layers\r\n        for (var i=0; i<layers.length; i++) {\r\n          if (layers[i]==drop) {\r\n            collection.removeAt (i);\r\n            break;\r\n          }\r\n        }\r\n        for (var j=0; j<layers.length; j++) {\r\n          if (layers[j]==target) {\r\n            if (i>j) collection.insertAt (j,drop);\r\n            else collection.insertAt (j+1,drop);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      self.dispatchEvent({ type: \"reorder-end\", layer: drop, group: group });\r\n    }\r\n    \r\n    elt.parentNode.querySelectorAll('li').forEach(function(li){\r\n      li.classList.remove('dropover');\r\n      li.classList.remove('dropover-after');\r\n      li.classList.remove('dropover-before');\r\n    });\r\n    elt.classList.remove(\"drag\");\r\n    elt.parentNode.classList.remove(\"drag\");\r\n    self.element.classList.remove('drag');\r\n    if (dragElt) dragElt.remove();\r\n\r\n    ol_ext_element.removeListener(document, 'mousemove touchmove', move);\r\n    ol_ext_element.removeListener(document, 'mouseup touchend touchcancel', stop);\r\n  }\r\n\r\n  // Ordering\r\n  function move(e) {\r\n    // First drag (more than 2 px) => show drag element (ghost)\r\n    pageY = e.pageY \r\n        || (e.touches && e.touches.length && e.touches[0].pageY) \r\n        || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n    if (start && Math.abs(pageY0 - pageY) > 2) {\r\n      start = false;\r\n      elt.classList.add(\"drag\");\r\n      layer = self._getLayerForLI(elt);\r\n      target = false;\r\n      group = self._getLayerForLI(elt.parentNode.parentNode);\r\n      // Ghost div\r\n      dragElt = ol_ext_element.create('LI', { \r\n        className: 'ol-dragover',\r\n        html: elt.innerHTML,\r\n        style: { \r\n          position: \"absolute\", \r\n          \"z-index\": 10000, \r\n          left: elt.offsetLeft, \r\n          opacity: 0.5,\r\n          width: ol_ext_element.outerWidth(elt),\r\n          height: ol_ext_element.getStyle(elt,'height'),\r\n        },\r\n        parent: panel \r\n      });\r\n      self.element.classList.add('drag');\r\n      self.dispatchEvent({ type: \"reorder-start\", layer: layer, group: group });\r\n    }\r\n    // Start a new drag sequence\r\n    if (!start) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      // Ghost div\r\n      ol_ext_element.setStyle(dragElt, { top: pageY - ol_ext_element.offsetRect(panel).top + panel.scrollTop +5 });\r\n      \r\n      var li;\r\n      if (!e.touches) {\r\n        li = e.target;\r\n      } else {\r\n        li = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);\r\n      }\r\n      if (li.classList.contains(\"ol-switcherbottomdiv\")) {\r\n        self.overflow(-1);\r\n      } else if (li.classList.contains(\"ol-switchertopdiv\")) {\r\n        self.overflow(1);\r\n      }\r\n      // Get associated li\r\n      while (li && li.tagName!=='LI') {\r\n        li = li.parentNode;\r\n      }\r\n      if (!li || !li.classList.contains('dropover')) {\r\n        elt.parentNode.querySelectorAll('li').forEach(function(li) {\r\n          li.classList.remove('dropover');\r\n          li.classList.remove('dropover-after');\r\n          li.classList.remove('dropover-before');\r\n        });\r\n      }\r\n      if (li && li.parentNode.classList.contains('drag') && li !== elt) {\r\n        target = self._getLayerForLI(li);\r\n        // Don't mix layer level\r\n        if (target && !target.get('allwaysOnTop') == !layer.get('allwaysOnTop')) {\r\n          li.classList.add(\"dropover\");\r\n          li.classList.add((elt.offsetTop < li.offsetTop) ? 'dropover-after' : 'dropover-before');\r\n        } else {\r\n          target = false;\r\n        }\r\n        ol_ext_element.show(dragElt);\r\n      } else {\r\n        target = false;\r\n        if (li===elt) ol_ext_element.hide(dragElt);\r\n        else ol_ext_element.show(dragElt);\r\n      }\r\n      \r\n      if (!target) dragElt.classList.add(\"forbidden\");\r\n      else dragElt.classList.remove(\"forbidden\");\r\n    }\r\n  }\r\n\r\n  // Start ordering\r\n  ol_ext_element.addListener(document, 'mousemove touchmove', move);\r\n  ol_ext_element.addListener(document, 'mouseup touchend touchcancel', stop);\r\n};\r\n\r\n\r\n/** Change opacity on drag \r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOpacity_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  var self = this\r\n  // Register start params\r\n  var elt = e.target;\r\n  var layer = this._getLayerForLI(elt.parentNode.parentNode.parentNode);\r\n  if (!layer) return;\r\n  var x = e.pageX \r\n    || (e.touches && e.touches.length && e.touches[0].pageX) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n  var start = ol_ext_element.getStyle (elt, 'left') - x;\r\n  self.dragging_ = true;\r\n\r\n  // stop dragging\r\n  function stop() {\r\n    ol_ext_element.removeListener(document, \"mouseup touchend touchcancel\", stop);\r\n    ol_ext_element.removeListener(document, \"mousemove touchmove\", move);\r\n    self.dragging_ = false;\r\n  }\r\n  // On draggin\r\n  function move(e) {\r\n    var x = e.pageX \r\n      || (e.touches && e.touches.length && e.touches[0].pageX) \r\n      || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n    var delta = (start + x) / ol_ext_element.getStyle(elt.parentNode, 'width');\r\n    var opacity = Math.max (0, Math.min(1, delta));\r\n    ol_ext_element.setStyle (elt, { left: (opacity*100) + \"%\" });\r\n    elt.parentNode.nextElementSibling.innerHTML = Math.round(opacity*100);\r\n    layer.setOpacity(opacity);\r\n  }\r\n  // Register move\r\n  ol_ext_element.addListener(document, \"mouseup touchend touchcancel\", stop);\r\n  ol_ext_element.addListener(document, \"mousemove touchmove\", move);\r\n};\r\n\r\n\r\n/** Render a list of layer\r\n * @param {Elemen} element to render\r\n * @layers {Array{ol.layer}} list of layer to show\r\n * @api stable\r\n */\r\nol_control_LayerSwitcher.prototype.drawList = function(ul, collection) {\r\n  var self = this;\r\n  var layers = collection.getArray();\r\n\r\n  // Change layer visibility\r\n  var setVisibility = function(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.switchLayerVisibility(l, collection);\r\n  };\r\n  // Info button click\r\n  function onInfo(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.oninfo(l); \r\n    self.dispatchEvent({ type: \"info\", layer: l });\r\n  }\r\n  // Zoom to extent button\r\n  function zoomExtent(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    if (self.onextent) self.onextent(l); \r\n    else self.getMap().getView().fit (l.getExtent(), self.getMap().getSize()); \r\n    self.dispatchEvent({ type: \"extent\", layer: l });\r\n  }\r\n  // Remove a layer on trash click\r\n  function removeLayer(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var li = this.parentNode.parentNode.parentNode.parentNode;\r\n    var layer, group = self._getLayerForLI(li);\r\n    // Remove the layer from a group or from a map\r\n    if (group) {\r\n      layer = self._getLayerForLI(this.parentNode.parentNode);\r\n      group.getLayers().remove(layer);\r\n      if (group.getLayers().getLength()==0 && !group.get('noSwitcherDelete')) {\r\n        removeLayer.call(li.querySelectorAll('.layerTrash')[0], e);\r\n      }\r\n    } else {\r\n      li = this.parentNode.parentNode;\r\n      self.getMap().removeLayer(self._getLayerForLI(li));\r\n    }\r\n  }\r\n  \r\n  // Add the layer list\r\n  for (var i=layers.length-1; i>=0; i--) {\r\n    var layer = layers[i];\r\n\r\n    if (!self.displayInLayerSwitcher(layer)) {\r\n      this._setLayerForLI(null, layer);\r\n      continue;\r\n    } \r\n\r\n    var li = ol_ext_element.create('LI', {\r\n      className: (layer.getVisible()?\"visible \":\" \")+(layer.get('baseLayer')?\"baselayer\":\"\"),\r\n      parent: ul\r\n    });\r\n    this._setLayerForLI(li, layer);\r\n\r\n    var layer_buttons = ol_ext_element.create('DIV', {\r\n      className: 'ol-layerswitcher-buttons',\r\n      parent: li\r\n    });\r\n\r\n    // Content div\r\n    var d = ol_ext_element.create('DIV', {\r\n      className: 'li-content',// + (this.testLayerVisibility(layer) ? '' : ' ol-layer-hidden'),\r\n      parent: li\r\n    });\r\n    \r\n    // Visibility\r\n    ol_ext_element.create('INPUT', {\r\n      type: layer.get('baseLayer') ? 'radio' : 'checkbox',\r\n      className: 'ol-visibility',\r\n      checked: layer.getVisible(),\r\n      click: setVisibility,\r\n      parent: d\r\n    });\r\n    // Label\r\n    ol_ext_element.create('LABEL', {\r\n      html: layer.get(\"title\") || layer.get(\"name\"),\r\n      title: layer.get(\"title\") || layer.get(\"name\"),\r\n      click: setVisibility,\r\n      unselectable: 'on',\r\n      style: {\r\n        userSelect: 'none'\r\n      },\r\n      parent: d\r\n    }).addEventListener('selectstart', function(){ return false; });\r\n\r\n    //  up/down\r\n    if (this.reordering) {\r\n      if ( (i<layers.length-1 && (layer.get(\"allwaysOnTop\") || !layers[i+1].get(\"allwaysOnTop\")) )\r\n      || (i>0 && (!layer.get(\"allwaysOnTop\") || layers[i-1].get(\"allwaysOnTop\")) ) ) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerup',\r\n          title: this.tip.up,\r\n          on: { 'mousedown touchstart': function(e) { self.dragOrdering_(e) } },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Show/hide sub layers\r\n    if (layer.getLayers) {\r\n      var nb = 0;\r\n      layer.getLayers().forEach(function(l) {\r\n        if (self.displayInLayerSwitcher(l)) nb++;\r\n      });\r\n      if (nb) {\r\n        ol_ext_element.create('DIV', {\r\n          className: layer.get(\"openInLayerSwitcher\") ? \"collapse-layers\" : \"expend-layers\",\r\n          title: this.tip.plus,\r\n          click: function() {\r\n            var l = self._getLayerForLI(this.parentNode.parentNode);\r\n            l.set(\"openInLayerSwitcher\", !l.get(\"openInLayerSwitcher\") )\r\n          },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Info button\r\n    if (this.oninfo) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerInfo',\r\n        title: this.tip.info,\r\n        click: onInfo,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer remove\r\n    if (this.hastrash && !layer.get(\"noSwitcherDelete\")) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerTrash',\r\n        title: this.tip.trash,\r\n        click: removeLayer,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer extent\r\n    if (this.hasextent && layers[i].getExtent()) {\r\n      var ex = layers[i].getExtent();\r\n      if (ex.length==4 && ex[0]<ex[2] && ex[1]<ex[3]) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerExtent',\r\n          title: this.tip.extent,\r\n          click: zoomExtent,\r\n          parent: layer_buttons  \r\n        });\r\n      }\r\n    }\r\n\r\n    // Progress\r\n    if (this.show_progress && layer instanceof ol_layer_Tile) {\r\n      var p = ol_ext_element.create('DIV', {\r\n        className: 'layerswitcher-progress',\r\n        parent: d\r\n      });\r\n      this.setprogress_(layer);\r\n      layer.layerswitcher_progress = ol_ext_element.create('DIV', { parent: p });\r\n    }\r\n\r\n    // Opacity\r\n    var opacity = ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity',\r\n      // Click on the opacity line\r\n      click: function(e){\r\n        if (e.target !== this) return;\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        var op = Math.max ( 0, Math.min( 1, e.offsetX / ol_ext_element.getStyle(this, 'width')));\r\n        self._getLayerForLI(this.parentNode.parentNode).setOpacity(op);\r\n      },\r\n      parent: d\r\n    });\r\n    // Start dragging\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-cursor',\r\n      style: { left: (layer.getOpacity()*100)+\"%\" },\r\n      on: {\r\n        'mousedown touchstart': function(e) { self.dragOpacity_ (e); }\r\n      },\r\n      parent: opacity\r\n    });\r\n    // Percent\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-label',\r\n      html: Math.round(layer.getOpacity()*100),\r\n      parent: d\r\n    });\r\n\r\n    // Layer group\r\n    if (layer.getLayers) {\r\n      li.classList.add('ol-layer-group');\r\n      if (layer.get(\"openInLayerSwitcher\") === true) {\r\n        var ul2 = ol_ext_element.create('UL', {\r\n          parent: li\r\n        });\r\n        this.drawList (ul2, layer.getLayers());\r\n      }\r\n    }\r\n    else if (layer instanceof ol_layer_Vector) li.classList.add('ol-layer-vector');\r\n    else if (layer instanceof ol_layer_VectorTile) li.classList.add('ol-layer-vector');\r\n    else if (layer instanceof ol_layer_Tile) li.classList.add('ol-layer-tile');\r\n    else if (layer instanceof ol_layer_Image) li.classList.add('ol-layer-image');\r\n    else if (layer instanceof ol_layer_Heatmap) li.classList.add('ol-layer-heatmap');\r\n\r\n    // Dispatch a dralist event to allow customisation\r\n    this.dispatchEvent({ type:'drawlist', layer:layer, li:li });\r\n  }\r\n\r\n  this.viewChange();\r\n\r\n  if (ul === this.panel_) this.overflow();\r\n};\r\n\r\n/** Handle progress bar for a layer\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.setprogress_ = function(layer) {\r\n  if (!layer.layerswitcher_progress) {\r\n    var loaded = 0;\r\n    var loading = 0;\r\n    var draw = function() {\r\n      if (loading === loaded) {\r\n        loading = loaded = 0;\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: 0 });// layer.layerswitcher_progress.width(0);\r\n      } else {\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: (loaded / loading * 100).toFixed(1) + '%' });// layer.layerswitcher_progress.css('width', (loaded / loading * 100).toFixed(1) + '%');\r\n      }\r\n    }\r\n    layer.getSource().on('tileloadstart', function() {\r\n      loading++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloadend', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloaderror', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n  }\r\n};\r\n\r\nexport default ol_control_LayerSwitcher\r\n","/**\n * @module ol/MapBrowserEventType\n */\nimport EventType from './events/EventType.js';\n\n/**\n * Constants for event names.\n * @enum {string}\n */\nexport default {\n\n  /**\n   * A true single click with no dragging and no double click. Note that this\n   * event is delayed by 250 ms to ensure that it is not a double click.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#singleclick\n   * @api\n   */\n  SINGLECLICK: 'singleclick',\n\n  /**\n   * A click with no dragging. A double click will fire two of this.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#click\n   * @api\n   */\n  CLICK: EventType.CLICK,\n\n  /**\n   * A true double click, with no dragging.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#dblclick\n   * @api\n   */\n  DBLCLICK: EventType.DBLCLICK,\n\n  /**\n   * Triggered when a pointer is dragged.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#pointerdrag\n   * @api\n   */\n  POINTERDRAG: 'pointerdrag',\n\n  /**\n   * Triggered when a pointer is moved. Note that on touch devices this is\n   * triggered when the map is panned, so is not the same as mousemove.\n   * @event module:ol/MapBrowserEvent~MapBrowserEvent#pointermove\n   * @api\n   */\n  POINTERMOVE: 'pointermove',\n\n  POINTERDOWN: 'pointerdown',\n  POINTERUP: 'pointerup',\n  POINTEROVER: 'pointerover',\n  POINTEROUT: 'pointerout',\n  POINTERENTER: 'pointerenter',\n  POINTERLEAVE: 'pointerleave',\n  POINTERCANCEL: 'pointercancel'\n};\n\n//# sourceMappingURL=MapBrowserEventType.js.map","/**\n * @module ol/CollectionEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when an item is added to the collection.\n   * @event module:ol/Collection.CollectionEvent#add\n   * @api\n   */\n  ADD: 'add',\n  /**\n   * Triggered when an item is removed from the collection.\n   * @event module:ol/Collection.CollectionEvent#remove\n   * @api\n   */\n  REMOVE: 'remove'\n};\n\n//# sourceMappingURL=CollectionEventType.js.map","/**\n * @module ol/Kinetic\n */\n\n/**\n * @classdesc\n * Implementation of inertial deceleration for map movement.\n *\n * @api\n */\nvar Kinetic = function Kinetic(decay, minVelocity, delay) {\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.decay_ = decay;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.minVelocity_ = minVelocity;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.delay_ = delay;\n\n  /**\n   * @private\n   * @type {Array<number>}\n   */\n  this.points_ = [];\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.angle_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.initialVelocity_ = 0;\n};\n\n/**\n * FIXME empty description for jsdoc\n */\nKinetic.prototype.begin = function begin () {\n  this.points_.length = 0;\n  this.angle_ = 0;\n  this.initialVelocity_ = 0;\n};\n\n/**\n * @param {number} x X.\n * @param {number} y Y.\n */\nKinetic.prototype.update = function update (x, y) {\n  this.points_.push(x, y, Date.now());\n};\n\n/**\n * @return {boolean} Whether we should do kinetic animation.\n */\nKinetic.prototype.end = function end () {\n  if (this.points_.length < 6) {\n    // at least 2 points are required (i.e. there must be at least 6 elements\n    // in the array)\n    return false;\n  }\n  var delay = Date.now() - this.delay_;\n  var lastIndex = this.points_.length - 3;\n  if (this.points_[lastIndex + 2] < delay) {\n    // the last tracked point is too old, which means that the user stopped\n    // panning before releasing the map\n    return false;\n  }\n\n  // get the first point which still falls into the delay time\n  var firstIndex = lastIndex - 3;\n  while (firstIndex > 0 && this.points_[firstIndex + 2] > delay) {\n    firstIndex -= 3;\n  }\n\n  var duration = this.points_[lastIndex + 2] - this.points_[firstIndex + 2];\n  // we don't want a duration of 0 (divide by zero)\n  // we also make sure the user panned for a duration of at least one frame\n  // (1/60s) to compute sane displacement values\n  if (duration < 1000 / 60) {\n    return false;\n  }\n\n  var dx = this.points_[lastIndex] - this.points_[firstIndex];\n  var dy = this.points_[lastIndex + 1] - this.points_[firstIndex + 1];\n  this.angle_ = Math.atan2(dy, dx);\n  this.initialVelocity_ = Math.sqrt(dx * dx + dy * dy) / duration;\n  return this.initialVelocity_ > this.minVelocity_;\n};\n\n/**\n * @return {number} Total distance travelled (pixels).\n */\nKinetic.prototype.getDistance = function getDistance () {\n  return (this.minVelocity_ - this.initialVelocity_) / this.decay_;\n};\n\n/**\n * @return {number} Angle of the kinetic panning animation (radians).\n */\nKinetic.prototype.getAngle = function getAngle () {\n  return this.angle_;\n};\n\nexport default Kinetic;\n\n//# sourceMappingURL=Kinetic.js.map","/**\n * @module ol/Observable\n */\nimport {listen, unlistenByKey, unlisten, listenOnce} from './events.js';\nimport EventTarget from './events/Target.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * An event target providing convenient methods for listener registration\n * and unregistration. A generic `change` event is always available through\n * {@link module:ol/Observable~Observable#changed}.\n *\n * @fires import(\"./events/Event.js\").Event\n * @api\n */\nvar Observable = /*@__PURE__*/(function (EventTarget) {\n  function Observable() {\n\n    EventTarget.call(this);\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.revision_ = 0;\n\n  }\n\n  if ( EventTarget ) Observable.__proto__ = EventTarget;\n  Observable.prototype = Object.create( EventTarget && EventTarget.prototype );\n  Observable.prototype.constructor = Observable;\n\n  /**\n   * Increases the revision counter and dispatches a 'change' event.\n   * @api\n   */\n  Observable.prototype.changed = function changed () {\n    ++this.revision_;\n    this.dispatchEvent(EventType.CHANGE);\n  };\n\n  /**\n   * Get the version number for this object.  Each time the object is modified,\n   * its version number will be incremented.\n   * @return {number} Revision.\n   * @api\n   */\n  Observable.prototype.getRevision = function getRevision () {\n    return this.revision_;\n  };\n\n  /**\n   * Listen for a certain type of event.\n   * @param {string|Array<string>} type The event type or array of event types.\n   * @param {function(?): ?} listener The listener function.\n   * @return {import(\"./events.js\").EventsKey|Array<import(\"./events.js\").EventsKey>} Unique key for the listener. If\n   *     called with an array of event types as the first argument, the return\n   *     will be an array of keys.\n   * @api\n   */\n  Observable.prototype.on = function on (type, listener) {\n    if (Array.isArray(type)) {\n      var len = type.length;\n      var keys = new Array(len);\n      for (var i = 0; i < len; ++i) {\n        keys[i] = listen(this, type[i], listener);\n      }\n      return keys;\n    } else {\n      return listen(this, /** @type {string} */ (type), listener);\n    }\n  };\n\n  /**\n   * Listen once for a certain type of event.\n   * @param {string|Array<string>} type The event type or array of event types.\n   * @param {function(?): ?} listener The listener function.\n   * @return {import(\"./events.js\").EventsKey|Array<import(\"./events.js\").EventsKey>} Unique key for the listener. If\n   *     called with an array of event types as the first argument, the return\n   *     will be an array of keys.\n   * @api\n   */\n  Observable.prototype.once = function once (type, listener) {\n    if (Array.isArray(type)) {\n      var len = type.length;\n      var keys = new Array(len);\n      for (var i = 0; i < len; ++i) {\n        keys[i] = listenOnce(this, type[i], listener);\n      }\n      return keys;\n    } else {\n      return listenOnce(this, /** @type {string} */ (type), listener);\n    }\n  };\n\n  /**\n   * Unlisten for a certain type of event.\n   * @param {string|Array<string>} type The event type or array of event types.\n   * @param {function(?): ?} listener The listener function.\n   * @api\n   */\n  Observable.prototype.un = function un (type, listener) {\n    if (Array.isArray(type)) {\n      for (var i = 0, ii = type.length; i < ii; ++i) {\n        unlisten(this, type[i], listener);\n      }\n      return;\n    } else {\n      unlisten(this, /** @type {string} */ (type), listener);\n    }\n  };\n\n  return Observable;\n}(EventTarget));\n\n\n/**\n * Removes an event listener using the key returned by `on()` or `once()`.\n * @param {import(\"./events.js\").EventsKey|Array<import(\"./events.js\").EventsKey>} key The key returned by `on()`\n *     or `once()` (or an array of keys).\n * @api\n */\nexport function unByKey(key) {\n  if (Array.isArray(key)) {\n    for (var i = 0, ii = key.length; i < ii; ++i) {\n      unlistenByKey(key[i]);\n    }\n  } else {\n    unlistenByKey(/** @type {import(\"./events.js\").EventsKey} */ (key));\n  }\n}\n\n\nexport default Observable;\n\n//# sourceMappingURL=Observable.js.map","/**\n * @module ol/ViewHint\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  ANIMATING: 0,\n  INTERACTING: 1\n};\n\n//# sourceMappingURL=ViewHint.js.map","/**\n * @module ol/Feature\n */\nimport {assert} from './asserts.js';\nimport {listen, unlisten, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\n\n/**\n * @typedef {typeof Feature|typeof import(\"./render/Feature.js\").default} FeatureClass\n */\n\n/**\n * @typedef {Feature|import(\"./render/Feature.js\").default} FeatureLike\n */\n\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature';\n * import Polygon from 'ol/geom/Polygon';\n * import Point from 'ol/geom/Point';\n *\n * var feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon'\n * });\n *\n * // get the polygon geometry\n * var poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * var point = feature.getGeometry();\n * ```\n *\n * @api\n */\nvar Feature = /*@__PURE__*/(function (BaseObject) {\n  function Feature(opt_geometryOrProperties) {\n\n    BaseObject.call(this);\n\n    /**\n     * @private\n     * @type {number|string|undefined}\n     */\n    this.id_ = undefined;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.geometryName_ = 'geometry';\n\n    /**\n     * User provided style.\n     * @private\n     * @type {import(\"./style/Style.js\").StyleLike}\n     */\n    this.style_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./style/Style.js\").StyleFunction|undefined}\n     */\n    this.styleFunction_ = undefined;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.geometryChangeKey_ = null;\n\n    listen(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n\n    if (opt_geometryOrProperties) {\n      if (typeof /** @type {?} */ (opt_geometryOrProperties).getSimplifiedGeometry === 'function') {\n        var geometry = /** @type {import(\"./geom/Geometry.js\").default} */ (opt_geometryOrProperties);\n        this.setGeometry(geometry);\n      } else {\n        /** @type {Object<string, *>} */\n        var properties = opt_geometryOrProperties;\n        this.setProperties(properties);\n      }\n    }\n  }\n\n  if ( BaseObject ) Feature.__proto__ = BaseObject;\n  Feature.prototype = Object.create( BaseObject && BaseObject.prototype );\n  Feature.prototype.constructor = Feature;\n\n  /**\n   * Clone this feature. If the original feature has a geometry it\n   * is also cloned. The feature id is not set in the clone.\n   * @return {Feature} The clone.\n   * @api\n   */\n  Feature.prototype.clone = function clone () {\n    var clone = new Feature(this.getProperties());\n    clone.setGeometryName(this.getGeometryName());\n    var geometry = this.getGeometry();\n    if (geometry) {\n      clone.setGeometry(geometry.clone());\n    }\n    var style = this.getStyle();\n    if (style) {\n      clone.setStyle(style);\n    }\n    return clone;\n  };\n\n  /**\n   * Get the feature's default geometry.  A feature may have any number of named\n   * geometries.  The \"default\" geometry (the one that is rendered by default) is\n   * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n   * @return {import(\"./geom/Geometry.js\").default|undefined} The default geometry for the feature.\n   * @api\n   * @observable\n   */\n  Feature.prototype.getGeometry = function getGeometry () {\n    return (\n      /** @type {import(\"./geom/Geometry.js\").default|undefined} */ (this.get(this.geometryName_))\n    );\n  };\n\n  /**\n   * Get the feature identifier.  This is a stable identifier for the feature and\n   * is either set when reading data from a remote source or set explicitly by\n   * calling {@link module:ol/Feature~Feature#setId}.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  Feature.prototype.getId = function getId () {\n    return this.id_;\n  };\n\n  /**\n   * Get the name of the feature's default geometry.  By default, the default\n   * geometry is named `geometry`.\n   * @return {string} Get the property name associated with the default geometry\n   *     for this feature.\n   * @api\n   */\n  Feature.prototype.getGeometryName = function getGeometryName () {\n    return this.geometryName_;\n  };\n\n  /**\n   * Get the feature's style. Will return what was provided to the\n   * {@link module:ol/Feature~Feature#setStyle} method.\n   * @return {import(\"./style/Style.js\").StyleLike} The feature style.\n   * @api\n   */\n  Feature.prototype.getStyle = function getStyle () {\n    return this.style_;\n  };\n\n  /**\n   * Get the feature's style function.\n   * @return {import(\"./style/Style.js\").StyleFunction|undefined} Return a function\n   * representing the current style of this feature.\n   * @api\n   */\n  Feature.prototype.getStyleFunction = function getStyleFunction () {\n    return this.styleFunction_;\n  };\n\n  /**\n   * @private\n   */\n  Feature.prototype.handleGeometryChange_ = function handleGeometryChange_ () {\n    this.changed();\n  };\n\n  /**\n   * @private\n   */\n  Feature.prototype.handleGeometryChanged_ = function handleGeometryChanged_ () {\n    if (this.geometryChangeKey_) {\n      unlistenByKey(this.geometryChangeKey_);\n      this.geometryChangeKey_ = null;\n    }\n    var geometry = this.getGeometry();\n    if (geometry) {\n      this.geometryChangeKey_ = listen(geometry,\n        EventType.CHANGE, this.handleGeometryChange_, this);\n    }\n    this.changed();\n  };\n\n  /**\n   * Set the default geometry for the feature.  This will update the property\n   * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n   * @param {import(\"./geom/Geometry.js\").default|undefined} geometry The new geometry.\n   * @api\n   * @observable\n   */\n  Feature.prototype.setGeometry = function setGeometry (geometry) {\n    this.set(this.geometryName_, geometry);\n  };\n\n  /**\n   * Set the style for the feature.  This can be a single style object, an array\n   * of styles, or a function that takes a resolution and returns an array of\n   * styles. If it is `null` the feature has no style (a `null` style).\n   * @param {import(\"./style/Style.js\").StyleLike} style Style for this feature.\n   * @api\n   * @fires module:ol/events/Event~Event#event:change\n   */\n  Feature.prototype.setStyle = function setStyle (style) {\n    this.style_ = style;\n    this.styleFunction_ = !style ? undefined : createStyleFunction(style);\n    this.changed();\n  };\n\n  /**\n   * Set the feature id.  The feature id is considered stable and may be used when\n   * requesting features or comparing identifiers returned from a remote source.\n   * The feature id can be used with the\n   * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n   * @param {number|string|undefined} id The feature id.\n   * @api\n   * @fires module:ol/events/Event~Event#event:change\n   */\n  Feature.prototype.setId = function setId (id) {\n    this.id_ = id;\n    this.changed();\n  };\n\n  /**\n   * Set the property name to be used when getting the feature's default geometry.\n   * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n   * this name will be returned.\n   * @param {string} name The property name of the default geometry.\n   * @api\n   */\n  Feature.prototype.setGeometryName = function setGeometryName (name) {\n    unlisten(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n    this.geometryName_ = name;\n    listen(\n      this, getChangeEventType(this.geometryName_),\n      this.handleGeometryChanged_, this);\n    this.handleGeometryChanged_();\n  };\n\n  return Feature;\n}(BaseObject));\n\n\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of Style or single style objects wrapped\n * in a new feature style function.\n * @param {!import(\"./style/Style.js\").StyleFunction|!Array<import(\"./style/Style.js\").default>|!import(\"./style/Style.js\").default} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {import(\"./style/Style.js\").StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n  if (typeof obj === 'function') {\n    return obj;\n  } else {\n    /**\n     * @type {Array<import(\"./style/Style.js\").default>}\n     */\n    var styles;\n    if (Array.isArray(obj)) {\n      styles = obj;\n    } else {\n      assert(typeof /** @type {?} */ (obj).getZIndex === 'function',\n        41); // Expected an `import(\"./style/Style.js\").Style` or an array of `import(\"./style/Style.js\").Style`\n      var style = /** @type {import(\"./style/Style.js\").default} */ (obj);\n      styles = [style];\n    }\n    return function() {\n      return styles;\n    };\n  }\n}\nexport default Feature;\n\n//# sourceMappingURL=Feature.js.map","/**\n * @module ol/MapBrowserEvent\n */\nimport MapEvent from './MapEvent.js';\n\n/**\n * @classdesc\n * Events emitted as map browser events are instances of this type.\n * See {@link module:ol/PluggableMap~PluggableMap} for which events trigger a map browser event.\n */\nvar MapBrowserEvent = /*@__PURE__*/(function (MapEvent) {\n  function MapBrowserEvent(type, map, browserEvent, opt_dragging, opt_frameState) {\n\n    MapEvent.call(this, type, map, opt_frameState);\n\n    /**\n     * The original browser event.\n     * @const\n     * @type {Event}\n     * @api\n     */\n    this.originalEvent = browserEvent;\n\n    /**\n     * The map pixel relative to the viewport corresponding to the original browser event.\n     * @type {import(\"./pixel.js\").Pixel}\n     * @api\n     */\n    this.pixel = map.getEventPixel(browserEvent);\n\n    /**\n     * The coordinate in view projection corresponding to the original browser event.\n     * @type {import(\"./coordinate.js\").Coordinate}\n     * @api\n     */\n    this.coordinate = map.getCoordinateFromPixel(this.pixel);\n\n    /**\n     * Indicates if the map is currently being dragged. Only set for\n     * `POINTERDRAG` and `POINTERMOVE` events. Default is `false`.\n     *\n     * @type {boolean}\n     * @api\n     */\n    this.dragging = opt_dragging !== undefined ? opt_dragging : false;\n\n  }\n\n  if ( MapEvent ) MapBrowserEvent.__proto__ = MapEvent;\n  MapBrowserEvent.prototype = Object.create( MapEvent && MapEvent.prototype );\n  MapBrowserEvent.prototype.constructor = MapBrowserEvent;\n\n  /**\n   * Prevents the default browser action.\n   * See https://developer.mozilla.org/en-US/docs/Web/API/event.preventDefault.\n   * @override\n   * @api\n   */\n  MapBrowserEvent.prototype.preventDefault = function preventDefault () {\n    MapEvent.prototype.preventDefault.call(this);\n    this.originalEvent.preventDefault();\n  };\n\n  /**\n   * Prevents further propagation of the current event.\n   * See https://developer.mozilla.org/en-US/docs/Web/API/event.stopPropagation.\n   * @override\n   * @api\n   */\n  MapBrowserEvent.prototype.stopPropagation = function stopPropagation () {\n    MapEvent.prototype.stopPropagation.call(this);\n    this.originalEvent.stopPropagation();\n  };\n\n  return MapBrowserEvent;\n}(MapEvent));\n\n\nexport default MapBrowserEvent;\n\n//# sourceMappingURL=MapBrowserEvent.js.map","/**\n * @module ol/MapEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n\n  /**\n   * Triggered after a map frame is rendered.\n   * @event module:ol/MapEvent~MapEvent#postrender\n   * @api\n   */\n  POSTRENDER: 'postrender',\n\n  /**\n   * Triggered when the map starts moving.\n   * @event module:ol/MapEvent~MapEvent#movestart\n   * @api\n   */\n  MOVESTART: 'movestart',\n\n  /**\n   * Triggered after the map is moved.\n   * @event module:ol/MapEvent~MapEvent#moveend\n   * @api\n   */\n  MOVEEND: 'moveend'\n\n};\n\n//# sourceMappingURL=MapEventType.js.map","/**\n * @module ol/LayerType\n */\n\n/**\n * A layer type used when creating layer renderers.\n * @enum {string}\n */\nexport default {\n  IMAGE: 'IMAGE',\n  TILE: 'TILE',\n  VECTOR_TILE: 'VECTOR_TILE',\n  VECTOR: 'VECTOR'\n};\n\n//# sourceMappingURL=LayerType.js.map","/**\n * @module ol/Tile\n */\nimport TileState from './TileState.js';\nimport {easeIn} from './easing.js';\nimport EventTarget from './events/Target.js';\nimport EventType from './events/EventType.js';\n\n\n/**\n * A function that takes an {@link module:ol/Tile} for the tile and a\n * `{string}` for the url as arguments. The default is\n * ```js\n * source.setTileLoadFunction(function(tile, src) {\n *   tile.getImage().src = src;\n * });\n * ```\n * For more fine grained control, the load function can use fetch or XMLHttpRequest and involve\n * error handling:\n *\n * ```js\n * import TileState from 'ol/TileState';\n *\n * source.setTileLoadFunction(function(tile, src) {\n *   var xhr = new XMLHttpRequest();\n *   xhr.responseType = 'blob';\n *   xhr.addEventListener('loadend', function (evt) {\n *     var data = this.response;\n *     if (data !== undefined) {\n *       tile.getImage().src = URL.createObjectURL(data);\n *     } else {\n *       tile.setState(TileState.ERROR);\n *     }\n *   });\n *   xhr.addEventListener('error', function () {\n *     tile.setState(TileState.ERROR);\n *   });\n *   xhr.open('GET', src);\n *   xhr.send();\n * });\n * ```\n *\n * @typedef {function(Tile, string)} LoadFunction\n * @api\n */\n\n/**\n * {@link module:ol/source/Tile~Tile} sources use a function of this type to get\n * the url that provides a tile for a given tile coordinate.\n *\n * This function takes an {@link module:ol/tilecoord~TileCoord} for the tile\n * coordinate, a `{number}` representing the pixel ratio and a\n * {@link module:ol/proj/Projection} for the projection  as arguments\n * and returns a `{string}` representing the tile URL, or undefined if no tile\n * should be requested for the passed tile coordinate.\n *\n * @typedef {function(import(\"./tilecoord.js\").TileCoord, number,\n *           import(\"./proj/Projection.js\").default): (string|undefined)} UrlFunction\n * @api\n */\n\n\n/**\n * @typedef {Object} Options\n * @property {number} [transition=250] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @api\n */\n\n\n/**\n * @classdesc\n * Base class for tiles.\n *\n * @abstract\n */\nvar Tile = /*@__PURE__*/(function (EventTarget) {\n  function Tile(tileCoord, state, opt_options) {\n    EventTarget.call(this);\n\n    var options = opt_options ? opt_options : {};\n\n    /**\n     * @type {import(\"./tilecoord.js\").TileCoord}\n     */\n    this.tileCoord = tileCoord;\n\n    /**\n     * @protected\n     * @type {TileState}\n     */\n    this.state = state;\n\n    /**\n     * An \"interim\" tile for this tile. The interim tile may be used while this\n     * one is loading, for \"smooth\" transitions when changing params/dimensions\n     * on the source.\n     * @type {Tile}\n     */\n    this.interimTile = null;\n\n    /**\n     * A key assigned to the tile. This is used by the tile source to determine\n     * if this tile can effectively be used, or if a new tile should be created\n     * and this one be used as an interim tile for this new tile.\n     * @type {string}\n     */\n    this.key = '';\n\n    /**\n     * The duration for the opacity transition.\n     * @type {number}\n     */\n    this.transition_ = options.transition === undefined ? 250 : options.transition;\n\n    /**\n     * Lookup of start times for rendering transitions.  If the start time is\n     * equal to -1, the transition is complete.\n     * @type {Object<string, number>}\n     */\n    this.transitionStarts_ = {};\n\n  }\n\n  if ( EventTarget ) Tile.__proto__ = EventTarget;\n  Tile.prototype = Object.create( EventTarget && EventTarget.prototype );\n  Tile.prototype.constructor = Tile;\n\n  /**\n   * @protected\n   */\n  Tile.prototype.changed = function changed () {\n    this.dispatchEvent(EventType.CHANGE);\n  };\n\n  /**\n   * @return {string} Key.\n   */\n  Tile.prototype.getKey = function getKey () {\n    return this.key + '/' + this.tileCoord;\n  };\n\n  /**\n   * Get the interim tile most suitable for rendering using the chain of interim\n   * tiles. This corresponds to the  most recent tile that has been loaded, if no\n   * such tile exists, the original tile is returned.\n   * @return {!Tile} Best tile for rendering.\n   */\n  Tile.prototype.getInterimTile = function getInterimTile () {\n    if (!this.interimTile) {\n      //empty chain\n      return this;\n    }\n    var tile = this.interimTile;\n\n    // find the first loaded tile and return it. Since the chain is sorted in\n    // decreasing order of creation time, there is no need to search the remainder\n    // of the list (all those tiles correspond to older requests and will be\n    // cleaned up by refreshInterimChain)\n    do {\n      if (tile.getState() == TileState.LOADED) {\n        return tile;\n      }\n      tile = tile.interimTile;\n    } while (tile);\n\n    // we can not find a better tile\n    return this;\n  };\n\n  /**\n   * Goes through the chain of interim tiles and discards sections of the chain\n   * that are no longer relevant.\n   */\n  Tile.prototype.refreshInterimChain = function refreshInterimChain () {\n    if (!this.interimTile) {\n      return;\n    }\n\n    var tile = this.interimTile;\n    var prev = /** @type {Tile} */ (this);\n\n    do {\n      if (tile.getState() == TileState.LOADED) {\n        //we have a loaded tile, we can discard the rest of the list\n        //we would could abort any LOADING tile request\n        //older than this tile (i.e. any LOADING tile following this entry in the chain)\n        tile.interimTile = null;\n        break;\n      } else if (tile.getState() == TileState.LOADING) {\n        //keep this LOADING tile any loaded tiles later in the chain are\n        //older than this tile, so we're still interested in the request\n        prev = tile;\n      } else if (tile.getState() == TileState.IDLE) {\n        //the head of the list is the most current tile, we don't need\n        //to start any other requests for this chain\n        prev.interimTile = tile.interimTile;\n      } else {\n        prev = tile;\n      }\n      tile = prev.interimTile;\n    } while (tile);\n  };\n\n  /**\n   * Get the tile coordinate for this tile.\n   * @return {import(\"./tilecoord.js\").TileCoord} The tile coordinate.\n   * @api\n   */\n  Tile.prototype.getTileCoord = function getTileCoord () {\n    return this.tileCoord;\n  };\n\n  /**\n   * @return {TileState} State.\n   */\n  Tile.prototype.getState = function getState () {\n    return this.state;\n  };\n\n  /**\n   * Sets the state of this tile. If you write your own {@link module:ol/Tile~LoadFunction tileLoadFunction} ,\n   * it is important to set the state correctly to {@link module:ol/TileState~ERROR}\n   * when the tile cannot be loaded. Otherwise the tile cannot be removed from\n   * the tile queue and will block other requests.\n   * @param {TileState} state State.\n   * @api\n   */\n  Tile.prototype.setState = function setState (state) {\n    this.state = state;\n    this.changed();\n  };\n\n  /**\n   * Load the image or retry if loading previously failed.\n   * Loading is taken care of by the tile queue, and calling this method is\n   * only needed for preloading or for reloading in case of an error.\n   * @abstract\n   * @api\n   */\n  Tile.prototype.load = function load () {};\n\n  /**\n   * Get the alpha value for rendering.\n   * @param {string} id An id for the renderer.\n   * @param {number} time The render frame time.\n   * @return {number} A number between 0 and 1.\n   */\n  Tile.prototype.getAlpha = function getAlpha (id, time) {\n    if (!this.transition_) {\n      return 1;\n    }\n\n    var start = this.transitionStarts_[id];\n    if (!start) {\n      start = time;\n      this.transitionStarts_[id] = start;\n    } else if (start === -1) {\n      return 1;\n    }\n\n    var delta = time - start + (1000 / 60); // avoid rendering at 0\n    if (delta >= this.transition_) {\n      return 1;\n    }\n    return easeIn(delta / this.transition_);\n  };\n\n  /**\n   * Determine if a tile is in an alpha transition.  A tile is considered in\n   * transition if tile.getAlpha() has not yet been called or has been called\n   * and returned 1.\n   * @param {string} id An id for the renderer.\n   * @return {boolean} The tile is in transition.\n   */\n  Tile.prototype.inTransition = function inTransition (id) {\n    if (!this.transition_) {\n      return false;\n    }\n    return this.transitionStarts_[id] !== -1;\n  };\n\n  /**\n   * Mark a transition as complete.\n   * @param {string} id An id for the renderer.\n   */\n  Tile.prototype.endTransition = function endTransition (id) {\n    if (this.transition_) {\n      this.transitionStarts_[id] = -1;\n    }\n  };\n\n  return Tile;\n}(EventTarget));\n\n\nexport default Tile;\n\n//# sourceMappingURL=Tile.js.map","/**\n * @module ol/MapBrowserEventHandler\n */\nimport {DEVICE_PIXEL_RATIO} from './has.js';\nimport MapBrowserEventType from './MapBrowserEventType.js';\nimport MapBrowserPointerEvent from './MapBrowserPointerEvent.js';\nimport {listen, unlistenByKey} from './events.js';\nimport EventTarget from './events/Target.js';\nimport PointerEventType from './pointer/EventType.js';\nimport PointerEventHandler from './pointer/PointerEventHandler.js';\n\nvar MapBrowserEventHandler = /*@__PURE__*/(function (EventTarget) {\n  function MapBrowserEventHandler(map, moveTolerance) {\n\n    EventTarget.call(this);\n\n    /**\n     * This is the element that we will listen to the real events on.\n     * @type {import(\"./PluggableMap.js\").default}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {any}\n     * @private\n     */\n    this.clickTimeoutId_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.dragging_ = false;\n\n    /**\n     * @type {!Array<import(\"./events.js\").EventsKey>}\n     * @private\n     */\n    this.dragListenerKeys_ = [];\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.moveTolerance_ = moveTolerance ?\n      moveTolerance * DEVICE_PIXEL_RATIO : DEVICE_PIXEL_RATIO;\n\n    /**\n     * The most recent \"down\" type event (or null if none have occurred).\n     * Set on pointerdown.\n     * @type {import(\"./pointer/PointerEvent.js\").default}\n     * @private\n     */\n    this.down_ = null;\n\n    var element = this.map_.getViewport();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.activePointers_ = 0;\n\n    /**\n     * @type {!Object<number, boolean>}\n     * @private\n     */\n    this.trackedTouches_ = {};\n\n    /**\n     * Event handler which generates pointer events for\n     * the viewport element.\n     *\n     * @type {PointerEventHandler}\n     * @private\n     */\n    this.pointerEventHandler_ = new PointerEventHandler(element);\n\n    /**\n     * Event handler which generates pointer events for\n     * the document (used when dragging).\n     *\n     * @type {PointerEventHandler}\n     * @private\n     */\n    this.documentPointerEventHandler_ = null;\n\n    /**\n     * @type {?import(\"./events.js\").EventsKey}\n     * @private\n     */\n    this.pointerdownListenerKey_ = listen(this.pointerEventHandler_,\n      PointerEventType.POINTERDOWN,\n      this.handlePointerDown_, this);\n\n    /**\n     * @type {?import(\"./events.js\").EventsKey}\n     * @private\n     */\n    this.relayedListenerKey_ = listen(this.pointerEventHandler_,\n      PointerEventType.POINTERMOVE,\n      this.relayEvent_, this);\n\n  }\n\n  if ( EventTarget ) MapBrowserEventHandler.__proto__ = EventTarget;\n  MapBrowserEventHandler.prototype = Object.create( EventTarget && EventTarget.prototype );\n  MapBrowserEventHandler.prototype.constructor = MapBrowserEventHandler;\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.emulateClick_ = function emulateClick_ (pointerEvent) {\n    var newEvent = new MapBrowserPointerEvent(\n      MapBrowserEventType.CLICK, this.map_, pointerEvent);\n    this.dispatchEvent(newEvent);\n    if (this.clickTimeoutId_ !== undefined) {\n      // double-click\n      clearTimeout(this.clickTimeoutId_);\n      this.clickTimeoutId_ = undefined;\n      newEvent = new MapBrowserPointerEvent(\n        MapBrowserEventType.DBLCLICK, this.map_, pointerEvent);\n      this.dispatchEvent(newEvent);\n    } else {\n      // click\n      this.clickTimeoutId_ = setTimeout(function() {\n        this.clickTimeoutId_ = undefined;\n        var newEvent = new MapBrowserPointerEvent(\n          MapBrowserEventType.SINGLECLICK, this.map_, pointerEvent);\n        this.dispatchEvent(newEvent);\n      }.bind(this), 250);\n    }\n  };\n\n  /**\n   * Keeps track on how many pointers are currently active.\n   *\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.updateActivePointers_ = function updateActivePointers_ (pointerEvent) {\n    var event = pointerEvent;\n\n    if (event.type == MapBrowserEventType.POINTERUP ||\n        event.type == MapBrowserEventType.POINTERCANCEL) {\n      delete this.trackedTouches_[event.pointerId];\n    } else if (event.type == MapBrowserEventType.POINTERDOWN) {\n      this.trackedTouches_[event.pointerId] = true;\n    }\n    this.activePointers_ = Object.keys(this.trackedTouches_).length;\n  };\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.handlePointerUp_ = function handlePointerUp_ (pointerEvent) {\n    this.updateActivePointers_(pointerEvent);\n    var newEvent = new MapBrowserPointerEvent(\n      MapBrowserEventType.POINTERUP, this.map_, pointerEvent);\n    this.dispatchEvent(newEvent);\n\n    // We emulate click events on left mouse button click, touch contact, and pen\n    // contact. isMouseActionButton returns true in these cases (evt.button is set\n    // to 0).\n    // See http://www.w3.org/TR/pointerevents/#button-states\n    // We only fire click, singleclick, and doubleclick if nobody has called\n    // event.stopPropagation() or event.preventDefault().\n    if (!newEvent.propagationStopped && !this.dragging_ && this.isMouseActionButton_(pointerEvent)) {\n      this.emulateClick_(this.down_);\n    }\n\n    if (this.activePointers_ === 0) {\n      this.dragListenerKeys_.forEach(unlistenByKey);\n      this.dragListenerKeys_.length = 0;\n      this.dragging_ = false;\n      this.down_ = null;\n      this.documentPointerEventHandler_.dispose();\n      this.documentPointerEventHandler_ = null;\n    }\n  };\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @return {boolean} If the left mouse button was pressed.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.isMouseActionButton_ = function isMouseActionButton_ (pointerEvent) {\n    return pointerEvent.button === 0;\n  };\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.handlePointerDown_ = function handlePointerDown_ (pointerEvent) {\n    this.updateActivePointers_(pointerEvent);\n    var newEvent = new MapBrowserPointerEvent(\n      MapBrowserEventType.POINTERDOWN, this.map_, pointerEvent);\n    this.dispatchEvent(newEvent);\n\n    this.down_ = pointerEvent;\n\n    if (this.dragListenerKeys_.length === 0) {\n      /* Set up a pointer event handler on the `document`,\n       * which is required when the pointer is moved outside\n       * the viewport when dragging.\n       */\n      this.documentPointerEventHandler_ =\n          new PointerEventHandler(document);\n\n      this.dragListenerKeys_.push(\n        listen(this.documentPointerEventHandler_,\n          MapBrowserEventType.POINTERMOVE,\n          this.handlePointerMove_, this),\n        listen(this.documentPointerEventHandler_,\n          MapBrowserEventType.POINTERUP,\n          this.handlePointerUp_, this),\n        /* Note that the listener for `pointercancel is set up on\n         * `pointerEventHandler_` and not `documentPointerEventHandler_` like\n         * the `pointerup` and `pointermove` listeners.\n         *\n         * The reason for this is the following: `TouchSource.vacuumTouches_()`\n         * issues `pointercancel` events, when there was no `touchend` for a\n         * `touchstart`. Now, let's say a first `touchstart` is registered on\n         * `pointerEventHandler_`. The `documentPointerEventHandler_` is set up.\n         * But `documentPointerEventHandler_` doesn't know about the first\n         * `touchstart`. If there is no `touchend` for the `touchstart`, we can\n         * only receive a `touchcancel` from `pointerEventHandler_`, because it is\n         * only registered there.\n         */\n        listen(this.pointerEventHandler_,\n          MapBrowserEventType.POINTERCANCEL,\n          this.handlePointerUp_, this)\n      );\n    }\n  };\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.handlePointerMove_ = function handlePointerMove_ (pointerEvent) {\n    // Between pointerdown and pointerup, pointermove events are triggered.\n    // To avoid a 'false' touchmove event to be dispatched, we test if the pointer\n    // moved a significant distance.\n    if (this.isMoving_(pointerEvent)) {\n      this.dragging_ = true;\n      var newEvent = new MapBrowserPointerEvent(\n        MapBrowserEventType.POINTERDRAG, this.map_, pointerEvent,\n        this.dragging_);\n      this.dispatchEvent(newEvent);\n    }\n\n    // Some native android browser triggers mousemove events during small period\n    // of time. See: https://code.google.com/p/android/issues/detail?id=5491 or\n    // https://code.google.com/p/android/issues/detail?id=19827\n    // ex: Galaxy Tab P3110 + Android 4.1.1\n    pointerEvent.preventDefault();\n  };\n\n  /**\n   * Wrap and relay a pointer event.  Note that this requires that the type\n   * string for the MapBrowserPointerEvent matches the PointerEvent type.\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.relayEvent_ = function relayEvent_ (pointerEvent) {\n    var dragging = !!(this.down_ && this.isMoving_(pointerEvent));\n    this.dispatchEvent(new MapBrowserPointerEvent(\n      pointerEvent.type, this.map_, pointerEvent, dragging));\n  };\n\n  /**\n   * @param {import(\"./pointer/PointerEvent.js\").default} pointerEvent Pointer\n   * event.\n   * @return {boolean} Is moving.\n   * @private\n   */\n  MapBrowserEventHandler.prototype.isMoving_ = function isMoving_ (pointerEvent) {\n    return this.dragging_ ||\n        Math.abs(pointerEvent.clientX - this.down_.clientX) > this.moveTolerance_ ||\n        Math.abs(pointerEvent.clientY - this.down_.clientY) > this.moveTolerance_;\n  };\n\n  /**\n   * @inheritDoc\n   */\n  MapBrowserEventHandler.prototype.disposeInternal = function disposeInternal () {\n    if (this.relayedListenerKey_) {\n      unlistenByKey(this.relayedListenerKey_);\n      this.relayedListenerKey_ = null;\n    }\n    if (this.pointerdownListenerKey_) {\n      unlistenByKey(this.pointerdownListenerKey_);\n      this.pointerdownListenerKey_ = null;\n    }\n\n    this.dragListenerKeys_.forEach(unlistenByKey);\n    this.dragListenerKeys_.length = 0;\n\n    if (this.documentPointerEventHandler_) {\n      this.documentPointerEventHandler_.dispose();\n      this.documentPointerEventHandler_ = null;\n    }\n    if (this.pointerEventHandler_) {\n      this.pointerEventHandler_.dispose();\n      this.pointerEventHandler_ = null;\n    }\n    EventTarget.prototype.disposeInternal.call(this);\n  };\n\n  return MapBrowserEventHandler;\n}(EventTarget));\n\n\nexport default MapBrowserEventHandler;\n\n//# sourceMappingURL=MapBrowserEventHandler.js.map","/**\n * @module ol/MapProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  LAYERGROUP: 'layergroup',\n  SIZE: 'size',\n  TARGET: 'target',\n  VIEW: 'view'\n};\n\n//# sourceMappingURL=MapProperty.js.map","/**\n * @module ol/TileQueue\n */\nimport TileState from './TileState.js';\nimport {listen, unlisten} from './events.js';\nimport EventType from './events/EventType.js';\nimport PriorityQueue from './structs/PriorityQueue.js';\n\n\n/**\n * @typedef {function(import(\"./Tile.js\").default, string, import(\"./coordinate.js\").Coordinate, number): number} PriorityFunction\n */\n\n\nvar TileQueue = /*@__PURE__*/(function (PriorityQueue) {\n  function TileQueue(tilePriorityFunction, tileChangeCallback) {\n\n    PriorityQueue.call(\n      /**\n       * @param {Array} element Element.\n       * @return {number} Priority.\n       */\n      this, function(element) {\n        return tilePriorityFunction.apply(null, element);\n      },\n      /**\n       * @param {Array} element Element.\n       * @return {string} Key.\n       */\n      function(element) {\n        return (/** @type {import(\"./Tile.js\").default} */ (element[0]).getKey());\n      });\n\n    /**\n     * @private\n     * @type {function(): ?}\n     */\n    this.tileChangeCallback_ = tileChangeCallback;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.tilesLoading_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string,boolean>}\n     */\n    this.tilesLoadingKeys_ = {};\n\n  }\n\n  if ( PriorityQueue ) TileQueue.__proto__ = PriorityQueue;\n  TileQueue.prototype = Object.create( PriorityQueue && PriorityQueue.prototype );\n  TileQueue.prototype.constructor = TileQueue;\n\n  /**\n   * @inheritDoc\n   */\n  TileQueue.prototype.enqueue = function enqueue (element) {\n    var added = PriorityQueue.prototype.enqueue.call(this, element);\n    if (added) {\n      var tile = element[0];\n      listen(tile, EventType.CHANGE, this.handleTileChange, this);\n    }\n    return added;\n  };\n\n  /**\n   * @return {number} Number of tiles loading.\n   */\n  TileQueue.prototype.getTilesLoading = function getTilesLoading () {\n    return this.tilesLoading_;\n  };\n\n  /**\n   * @param {import(\"./events/Event.js\").default} event Event.\n   * @protected\n   */\n  TileQueue.prototype.handleTileChange = function handleTileChange (event) {\n    var tile = /** @type {import(\"./Tile.js\").default} */ (event.target);\n    var state = tile.getState();\n    if (state === TileState.LOADED || state === TileState.ERROR ||\n        state === TileState.EMPTY || state === TileState.ABORT) {\n      unlisten(tile, EventType.CHANGE, this.handleTileChange, this);\n      var tileKey = tile.getKey();\n      if (tileKey in this.tilesLoadingKeys_) {\n        delete this.tilesLoadingKeys_[tileKey];\n        --this.tilesLoading_;\n      }\n      this.tileChangeCallback_();\n    }\n  };\n\n  /**\n   * @param {number} maxTotalLoading Maximum number tiles to load simultaneously.\n   * @param {number} maxNewLoads Maximum number of new tiles to load.\n   */\n  TileQueue.prototype.loadMoreTiles = function loadMoreTiles (maxTotalLoading, maxNewLoads) {\n    var newLoads = 0;\n    var abortedTiles = false;\n    var state, tile, tileKey;\n    while (this.tilesLoading_ < maxTotalLoading && newLoads < maxNewLoads &&\n           this.getCount() > 0) {\n      tile = /** @type {import(\"./Tile.js\").default} */ (this.dequeue()[0]);\n      tileKey = tile.getKey();\n      state = tile.getState();\n      if (state === TileState.ABORT) {\n        abortedTiles = true;\n      } else if (state === TileState.IDLE && !(tileKey in this.tilesLoadingKeys_)) {\n        this.tilesLoadingKeys_[tileKey] = true;\n        ++this.tilesLoading_;\n        ++newLoads;\n        tile.load();\n      }\n    }\n    if (newLoads === 0 && abortedTiles) {\n      // Do not stop the render loop when all wanted tiles were aborted due to\n      // a small, saturated tile cache.\n      this.tileChangeCallback_();\n    }\n  };\n\n  return TileQueue;\n}(PriorityQueue));\n\n\nexport default TileQueue;\n\n//# sourceMappingURL=TileQueue.js.map","/**\n * @module ol/PluggableMap\n */\nimport {getUid} from './util.js';\nimport Collection from './Collection.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport MapBrowserEvent from './MapBrowserEvent.js';\nimport MapBrowserEventHandler from './MapBrowserEventHandler.js';\nimport MapBrowserEventType from './MapBrowserEventType.js';\nimport MapEvent from './MapEvent.js';\nimport MapEventType from './MapEventType.js';\nimport MapProperty from './MapProperty.js';\nimport RenderEventType from './render/EventType.js';\nimport BaseObject, {getChangeEventType} from './Object.js';\nimport ObjectEventType from './ObjectEventType.js';\nimport TileQueue from './TileQueue.js';\nimport View from './View.js';\nimport ViewHint from './ViewHint.js';\nimport {assert} from './asserts.js';\nimport {removeNode} from './dom.js';\nimport {listen, unlistenByKey, unlisten} from './events.js';\nimport {stopPropagation} from './events/Event.js';\nimport EventType from './events/EventType.js';\nimport {createEmpty, clone, createOrUpdateEmpty, equals, getForViewAndSize, isEmpty} from './extent.js';\nimport {TRUE} from './functions.js';\nimport {DEVICE_PIXEL_RATIO, TOUCH} from './has.js';\nimport LayerGroup from './layer/Group.js';\nimport {hasArea} from './size.js';\nimport {DROP} from './structs/PriorityQueue.js';\nimport {create as createTransform, apply as applyTransform} from './transform.js';\n\n\n/**\n * State of the current frame. Only `pixelRatio`, `time` and `viewState` should\n * be used in applications.\n * @typedef {Object} FrameState\n * @property {number} pixelRatio The pixel ratio of the frame.\n * @property {number} time The time when rendering of the frame was requested.\n * @property {import(\"./View.js\").State} viewState The state of the current view.\n * @property {boolean} animate\n * @property {import(\"./transform.js\").Transform} coordinateToPixelTransform\n * @property {null|import(\"./extent.js\").Extent} extent\n * @property {import(\"./coordinate.js\").Coordinate} focus\n * @property {number} index\n * @property {Object<string, import(\"./layer/Layer.js\").State>} layerStates\n * @property {Array<import(\"./layer/Layer.js\").State>} layerStatesArray\n * @property {import(\"./transform.js\").Transform} pixelToCoordinateTransform\n * @property {Array<PostRenderFunction>} postRenderFunctions\n * @property {import(\"./size.js\").Size} size\n * @property {!Object<string, boolean>} skippedFeatureUids\n * @property {TileQueue} tileQueue\n * @property {Object<string, Object<string, import(\"./TileRange.js\").default>>} usedTiles\n * @property {Array<number>} viewHints\n * @property {!Object<string, Object<string, boolean>>} wantedTiles\n */\n\n\n/**\n * @typedef {function(PluggableMap, ?FrameState): boolean} PostRenderFunction\n */\n\n\n/**\n * @typedef {Object} AtPixelOptions\n * @property {undefined|function(import(\"./layer/Layer.js\").default): boolean} layerFilter Layer filter\n * function. The filter function will receive one argument, the\n * {@link module:ol/layer/Layer layer-candidate} and it should return a boolean value.\n * Only layers which are visible and for which this function returns `true`\n * will be tested for features. By default, all visible layers will be tested.\n * @property {number} [hitTolerance=0] Hit-detection tolerance in pixels. Pixels\n * inside the radius around the given position will be checked for features. This only\n * works for the canvas renderer and not for WebGL.\n */\n\n\n/**\n * @typedef {Object} MapOptionsInternal\n * @property {Collection<import(\"./control/Control.js\").default>} [controls]\n * @property {Collection<import(\"./interaction/Interaction.js\").default>} [interactions]\n * @property {HTMLElement|Document} keyboardEventTarget\n * @property {Collection<import(\"./Overlay.js\").default>} overlays\n * @property {Object<string, *>} values\n */\n\n\n/**\n * Object literal with config options for the map.\n * @typedef {Object} MapOptions\n * @property {Collection<import(\"./control/Control.js\").default>|Array<import(\"./control/Control.js\").default>} [controls]\n * Controls initially added to the map. If not specified,\n * {@link module:ol/control~defaults} is used.\n * @property {number} [pixelRatio=window.devicePixelRatio] The ratio between\n * physical pixels and device-independent pixels (dips) on the device.\n * @property {Collection<import(\"./interaction/Interaction.js\").default>|Array<import(\"./interaction/Interaction.js\").default>} [interactions]\n * Interactions that are initially added to the map. If not specified,\n * {@link module:ol/interaction~defaults} is used.\n * @property {HTMLElement|Document|string} [keyboardEventTarget] The element to\n * listen to keyboard events on. This determines when the `KeyboardPan` and\n * `KeyboardZoom` interactions trigger. For example, if this option is set to\n * `document` the keyboard interactions will always trigger. If this option is\n * not specified, the element the library listens to keyboard events on is the\n * map target (i.e. the user-provided div for the map). If this is not\n * `document`, the target element needs to be focused for key events to be\n * emitted, requiring that the target element has a `tabindex` attribute.\n * @property {Array<import(\"./layer/Base.js\").default>|Collection<import(\"./layer/Base.js\").default>|LayerGroup} [layers]\n * Layers. If this is not defined, a map with no layers will be rendered. Note\n * that layers are rendered in the order supplied, so if you want, for example,\n * a vector layer to appear on top of a tile layer, it must come after the tile\n * layer.\n * @property {number} [maxTilesLoading=16] Maximum number tiles to load\n * simultaneously.\n * @property {boolean} [loadTilesWhileAnimating=false] When set to `true`, tiles\n * will be loaded during animations. This may improve the user experience, but\n * can also make animations stutter on devices with slow memory.\n * @property {boolean} [loadTilesWhileInteracting=false] When set to `true`,\n * tiles will be loaded while interacting with the map. This may improve the\n * user experience, but can also make map panning and zooming choppy on devices\n * with slow memory.\n * @property {number} [moveTolerance=1] The minimum distance in pixels the\n * cursor must move to be detected as a map move event instead of a click.\n * Increasing this value can make it easier to click on the map.\n * @property {Collection<import(\"./Overlay.js\").default>|Array<import(\"./Overlay.js\").default>} [overlays]\n * Overlays initially added to the map. By default, no overlays are added.\n * @property {HTMLElement|string} [target] The container for the map, either the\n * element itself or the `id` of the element. If not specified at construction\n * time, {@link module:ol/Map~Map#setTarget} must be called for the map to be\n * rendered.\n * @property {View} [view] The map's view.  No layer sources will be\n * fetched unless this is specified at construction time or through\n * {@link module:ol/Map~Map#setView}.\n */\n\n\n/**\n * @fires import(\"./MapBrowserEvent.js\").MapBrowserEvent\n * @fires import(\"./MapEvent.js\").MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @fires module:ol/render/Event~RenderEvent#rendercomplete\n * @api\n */\nvar PluggableMap = /*@__PURE__*/(function (BaseObject) {\n  function PluggableMap(options) {\n\n    BaseObject.call(this);\n\n    var optionsInternal = createOptionsInternal(options);\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxTilesLoading_ = options.maxTilesLoading !== undefined ? options.maxTilesLoading : 16;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.loadTilesWhileAnimating_ =\n        options.loadTilesWhileAnimating !== undefined ?\n          options.loadTilesWhileAnimating : false;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.loadTilesWhileInteracting_ =\n        options.loadTilesWhileInteracting !== undefined ?\n          options.loadTilesWhileInteracting : false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = options.pixelRatio !== undefined ?\n      options.pixelRatio : DEVICE_PIXEL_RATIO;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.animationDelayKey_;\n\n    /**\n     * @private\n     */\n    this.animationDelay_ = function() {\n      this.animationDelayKey_ = undefined;\n      this.renderFrame_.call(this, Date.now());\n    }.bind(this);\n\n    /**\n     * @private\n     * @type {import(\"./transform.js\").Transform}\n     */\n    this.coordinateToPixelTransform_ = createTransform();\n\n    /**\n     * @private\n     * @type {import(\"./transform.js\").Transform}\n     */\n    this.pixelToCoordinateTransform_ = createTransform();\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.frameIndex_ = 0;\n\n    /**\n     * @private\n     * @type {?FrameState}\n     */\n    this.frameState_ = null;\n\n    /**\n     * The extent at the previous 'moveend' event.\n     * @private\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.previousExtent_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.viewPropertyListenerKey_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.viewChangeListenerKey_ = null;\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.layerGroupPropertyListenerKeys_ = null;\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.viewport_ = document.createElement('div');\n    this.viewport_.className = 'ol-viewport' + (TOUCH ? ' ol-touch' : '');\n    this.viewport_.style.position = 'relative';\n    this.viewport_.style.overflow = 'hidden';\n    this.viewport_.style.width = '100%';\n    this.viewport_.style.height = '100%';\n    // prevent page zoom on IE >= 10 browsers\n    this.viewport_.style.msTouchAction = 'none';\n    this.viewport_.style.touchAction = 'none';\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.overlayContainer_ = document.createElement('div');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.viewport_.appendChild(this.overlayContainer_);\n\n    /**\n     * @private\n     * @type {!HTMLElement}\n     */\n    this.overlayContainerStopEvent_ = document.createElement('div');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    var overlayEvents = [\n      EventType.CLICK,\n      EventType.DBLCLICK,\n      EventType.MOUSEDOWN,\n      EventType.TOUCHSTART,\n      EventType.MSPOINTERDOWN,\n      MapBrowserEventType.POINTERDOWN,\n      EventType.MOUSEWHEEL,\n      EventType.WHEEL\n    ];\n    for (var i = 0, ii = overlayEvents.length; i < ii; ++i) {\n      listen(this.overlayContainerStopEvent_, overlayEvents[i], stopPropagation);\n    }\n    this.viewport_.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n     * @private\n     * @type {MapBrowserEventHandler}\n     */\n    this.mapBrowserEventHandler_ = new MapBrowserEventHandler(this, options.moveTolerance);\n    for (var key in MapBrowserEventType) {\n      listen(this.mapBrowserEventHandler_, MapBrowserEventType[key],\n        this.handleMapBrowserEvent, this);\n    }\n\n    /**\n     * @private\n     * @type {HTMLElement|Document}\n     */\n    this.keyboardEventTarget_ = optionsInternal.keyboardEventTarget;\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.keyHandlerKeys_ = null;\n\n    listen(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n    listen(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n    listen(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n\n    /**\n     * @type {Collection<import(\"./control/Control.js\").default>}\n     * @protected\n     */\n    this.controls = optionsInternal.controls || new Collection();\n\n    /**\n     * @type {Collection<import(\"./interaction/Interaction.js\").default>}\n     * @protected\n     */\n    this.interactions = optionsInternal.interactions || new Collection();\n\n    /**\n     * @type {Collection<import(\"./Overlay.js\").default>}\n     * @private\n     */\n    this.overlays_ = optionsInternal.overlays;\n\n    /**\n     * A lookup of overlays by id.\n     * @private\n     * @type {Object<string, import(\"./Overlay.js\").default>}\n     */\n    this.overlayIdIndex_ = {};\n\n    /**\n     * @type {import(\"./renderer/Map.js\").default}\n     * @private\n     */\n    this.renderer_ = this.createRenderer();\n\n    /**\n     * @type {function(Event)|undefined}\n     * @private\n     */\n    this.handleResize_;\n\n    /**\n     * @private\n     * @type {import(\"./coordinate.js\").Coordinate}\n     */\n    this.focus_ = null;\n\n    /**\n     * @private\n     * @type {!Array<PostRenderFunction>}\n     */\n    this.postRenderFunctions_ = [];\n\n    /**\n     * @private\n     * @type {TileQueue}\n     */\n    this.tileQueue_ = new TileQueue(\n      this.getTilePriority.bind(this),\n      this.handleTileChange_.bind(this));\n\n    /**\n     * Uids of features to skip at rendering time.\n     * @type {Object<string, boolean>}\n     * @private\n     */\n    this.skippedFeatureUids_ = {};\n\n    listen(\n      this, getChangeEventType(MapProperty.LAYERGROUP),\n      this.handleLayerGroupChanged_, this);\n    listen(this, getChangeEventType(MapProperty.VIEW),\n      this.handleViewChanged_, this);\n    listen(this, getChangeEventType(MapProperty.SIZE),\n      this.handleSizeChanged_, this);\n    listen(this, getChangeEventType(MapProperty.TARGET),\n      this.handleTargetChanged_, this);\n\n    // setProperties will trigger the rendering of the map if the map\n    // is \"defined\" already.\n    this.setProperties(optionsInternal.values);\n\n    this.controls.forEach(\n      /**\n       * @param {import(\"./control/Control.js\").default} control Control.\n       * @this {PluggableMap}\n       */\n      (function(control) {\n        control.setMap(this);\n      }).bind(this));\n\n    listen(this.controls, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(this);\n      }, this);\n\n    listen(this.controls, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(null);\n      }, this);\n\n    this.interactions.forEach(\n      /**\n       * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction.\n       * @this {PluggableMap}\n       */\n      (function(interaction) {\n        interaction.setMap(this);\n      }).bind(this));\n\n    listen(this.interactions, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(this);\n      }, this);\n\n    listen(this.interactions, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        event.element.setMap(null);\n      }, this);\n\n    this.overlays_.forEach(this.addOverlayInternal_.bind(this));\n\n    listen(this.overlays_, CollectionEventType.ADD,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        this.addOverlayInternal_(/** @type {import(\"./Overlay.js\").default} */ (event.element));\n      }, this);\n\n    listen(this.overlays_, CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"./Collection.js\").CollectionEvent} event CollectionEvent.\n       */\n      function(event) {\n        var overlay = /** @type {import(\"./Overlay.js\").default} */ (event.element);\n        var id = overlay.getId();\n        if (id !== undefined) {\n          delete this.overlayIdIndex_[id.toString()];\n        }\n        event.element.setMap(null);\n      }, this);\n\n  }\n\n  if ( BaseObject ) PluggableMap.__proto__ = BaseObject;\n  PluggableMap.prototype = Object.create( BaseObject && BaseObject.prototype );\n  PluggableMap.prototype.constructor = PluggableMap;\n\n  /**\n   * @abstract\n   * @return {import(\"./renderer/Map.js\").default} The map renderer\n   */\n  PluggableMap.prototype.createRenderer = function createRenderer () {\n    throw new Error('Use a map type that has a createRenderer method');\n  };\n\n  /**\n   * Add the given control to the map.\n   * @param {import(\"./control/Control.js\").default} control Control.\n   * @api\n   */\n  PluggableMap.prototype.addControl = function addControl (control) {\n    this.getControls().push(control);\n  };\n\n  /**\n   * Add the given interaction to the map.\n   * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction to add.\n   * @api\n   */\n  PluggableMap.prototype.addInteraction = function addInteraction (interaction) {\n    this.getInteractions().push(interaction);\n  };\n\n  /**\n   * Adds the given layer to the top of this map. If you want to add a layer\n   * elsewhere in the stack, use `getLayers()` and the methods available on\n   * {@link module:ol/Collection~Collection}.\n   * @param {import(\"./layer/Base.js\").default} layer Layer.\n   * @api\n   */\n  PluggableMap.prototype.addLayer = function addLayer (layer) {\n    var layers = this.getLayerGroup().getLayers();\n    layers.push(layer);\n  };\n\n  /**\n   * Add the given overlay to the map.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @api\n   */\n  PluggableMap.prototype.addOverlay = function addOverlay (overlay) {\n    this.getOverlays().push(overlay);\n  };\n\n  /**\n   * This deals with map's overlay collection changes.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @private\n   */\n  PluggableMap.prototype.addOverlayInternal_ = function addOverlayInternal_ (overlay) {\n    var id = overlay.getId();\n    if (id !== undefined) {\n      this.overlayIdIndex_[id.toString()] = overlay;\n    }\n    overlay.setMap(this);\n  };\n\n  /**\n   *\n   * @inheritDoc\n   */\n  PluggableMap.prototype.disposeInternal = function disposeInternal () {\n    this.mapBrowserEventHandler_.dispose();\n    unlisten(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\n    unlisten(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\n    unlisten(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\n    if (this.handleResize_ !== undefined) {\n      removeEventListener(EventType.RESIZE, this.handleResize_, false);\n      this.handleResize_ = undefined;\n    }\n    if (this.animationDelayKey_) {\n      cancelAnimationFrame(this.animationDelayKey_);\n      this.animationDelayKey_ = undefined;\n    }\n    this.setTarget(null);\n    BaseObject.prototype.disposeInternal.call(this);\n  };\n\n  /**\n   * Detect features that intersect a pixel on the viewport, and execute a\n   * callback with each intersecting feature. Layers included in the detection can\n   * be configured through the `layerFilter` option in `opt_options`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {function(this: S, import(\"./Feature.js\").FeatureLike,\n   *     import(\"./layer/Layer.js\").default): T} callback Feature callback. The callback will be\n   *     called with two arguments. The first argument is one\n   *     {@link module:ol/Feature feature} or\n   *     {@link module:ol/render/Feature render feature} at the pixel, the second is\n   *     the {@link module:ol/layer/Layer layer} of the feature and will be null for\n   *     unmanaged layers. To stop detection, callback functions can return a\n   *     truthy value.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {T|undefined} Callback result, i.e. the return value of last\n   * callback execution, or the first truthy callback return value.\n   * @template S,T\n   * @api\n   */\n  PluggableMap.prototype.forEachFeatureAtPixel = function forEachFeatureAtPixel (pixel, callback, opt_options) {\n    if (!this.frameState_) {\n      return;\n    }\n    var coordinate = this.getCoordinateFromPixel(pixel);\n    opt_options = opt_options !== undefined ? opt_options :\n      /** @type {AtPixelOptions} */ ({});\n    var hitTolerance = opt_options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    var layerFilter = opt_options.layerFilter !== undefined ?\n      opt_options.layerFilter : TRUE;\n    return this.renderer_.forEachFeatureAtCoordinate(\n      coordinate, this.frameState_, hitTolerance, callback, null,\n      layerFilter, null);\n  };\n\n  /**\n   * Get all features that intersect a pixel on the viewport.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {Array<import(\"./Feature.js\").FeatureLike>} The detected features or\n   * `null` if none were found.\n   * @api\n   */\n  PluggableMap.prototype.getFeaturesAtPixel = function getFeaturesAtPixel (pixel, opt_options) {\n    var features = null;\n    this.forEachFeatureAtPixel(pixel, function(feature) {\n      if (!features) {\n        features = [];\n      }\n      features.push(feature);\n    }, opt_options);\n    return features;\n  };\n\n  /**\n   * Detect layers that have a color value at a pixel on the viewport, and\n   * execute a callback with each matching layer. Layers included in the\n   * detection can be configured through `opt_layerFilter`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {function(this: S, import(\"./layer/Layer.js\").default, (Uint8ClampedArray|Uint8Array)): T} callback\n   *     Layer callback. This callback will receive two arguments: first is the\n   *     {@link module:ol/layer/Layer layer}, second argument is an array representing\n   *     [R, G, B, A] pixel values (0 - 255) and will be `null` for layer types\n   *     that do not currently support this argument. To stop detection, callback\n   *     functions can return a truthy value.\n   * @param {AtPixelOptions=} opt_options Configuration options.\n   * @return {T|undefined} Callback result, i.e. the return value of last\n   * callback execution, or the first truthy callback return value.\n   * @template S,T\n   * @api\n   */\n  PluggableMap.prototype.forEachLayerAtPixel = function forEachLayerAtPixel (pixel, callback, opt_options) {\n    if (!this.frameState_) {\n      return;\n    }\n    var options = opt_options || /** @type {AtPixelOptions} */ ({});\n    var hitTolerance = options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    var layerFilter = options.layerFilter || TRUE;\n    return this.renderer_.forEachLayerAtPixel(\n      pixel, this.frameState_, hitTolerance, callback, null, layerFilter, null);\n  };\n\n  /**\n   * Detect if features intersect a pixel on the viewport. Layers included in the\n   * detection can be configured through `opt_layerFilter`.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel.\n   * @param {AtPixelOptions=} opt_options Optional options.\n   * @return {boolean} Is there a feature at the given pixel?\n   * @template U\n   * @api\n   */\n  PluggableMap.prototype.hasFeatureAtPixel = function hasFeatureAtPixel (pixel, opt_options) {\n    if (!this.frameState_) {\n      return false;\n    }\n    var coordinate = this.getCoordinateFromPixel(pixel);\n    opt_options = opt_options !== undefined ? opt_options :\n      /** @type {AtPixelOptions} */ ({});\n    var layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : TRUE;\n    var hitTolerance = opt_options.hitTolerance !== undefined ?\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\n    return this.renderer_.hasFeatureAtCoordinate(\n      coordinate, this.frameState_, hitTolerance, layerFilter, null);\n  };\n\n  /**\n   * Returns the coordinate in view projection for a browser event.\n   * @param {Event} event Event.\n   * @return {import(\"./coordinate.js\").Coordinate} Coordinate.\n   * @api\n   */\n  PluggableMap.prototype.getEventCoordinate = function getEventCoordinate (event) {\n    return this.getCoordinateFromPixel(this.getEventPixel(event));\n  };\n\n  /**\n   * Returns the map pixel position for a browser event relative to the viewport.\n   * @param {Event|TouchEvent} event Event.\n   * @return {import(\"./pixel.js\").Pixel} Pixel.\n   * @api\n   */\n  PluggableMap.prototype.getEventPixel = function getEventPixel (event) {\n    var viewportPosition = this.viewport_.getBoundingClientRect();\n    var eventPosition = 'changedTouches' in event ?\n      /** @type {TouchEvent} */ (event).changedTouches[0] :\n      /** @type {MouseEvent} */ (event);\n\n    return [\n      eventPosition.clientX - viewportPosition.left,\n      eventPosition.clientY - viewportPosition.top\n    ];\n  };\n\n  /**\n   * Get the target in which this map is rendered.\n   * Note that this returns what is entered as an option or in setTarget:\n   * if that was an element, it returns an element; if a string, it returns that.\n   * @return {HTMLElement|string|undefined} The Element or id of the Element that the\n   *     map is rendered in.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.getTarget = function getTarget () {\n    return /** @type {HTMLElement|string|undefined} */ (this.get(MapProperty.TARGET));\n  };\n\n  /**\n   * Get the DOM element into which this map is rendered. In contrast to\n   * `getTarget` this method always return an `Element`, or `null` if the\n   * map has no target.\n   * @return {HTMLElement} The element that the map is rendered in.\n   * @api\n   */\n  PluggableMap.prototype.getTargetElement = function getTargetElement () {\n    var target = this.getTarget();\n    if (target !== undefined) {\n      return typeof target === 'string' ? document.getElementById(target) : target;\n    } else {\n      return null;\n    }\n  };\n\n  /**\n   * Get the coordinate for a given pixel.  This returns a coordinate in the\n   * map view projection.\n   * @param {import(\"./pixel.js\").Pixel} pixel Pixel position in the map viewport.\n   * @return {import(\"./coordinate.js\").Coordinate} The coordinate for the pixel position.\n   * @api\n   */\n  PluggableMap.prototype.getCoordinateFromPixel = function getCoordinateFromPixel (pixel) {\n    var frameState = this.frameState_;\n    if (!frameState) {\n      return null;\n    } else {\n      return applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\n    }\n  };\n\n  /**\n   * Get the map controls. Modifying this collection changes the controls\n   * associated with the map.\n   * @return {Collection<import(\"./control/Control.js\").default>} Controls.\n   * @api\n   */\n  PluggableMap.prototype.getControls = function getControls () {\n    return this.controls;\n  };\n\n  /**\n   * Get the map overlays. Modifying this collection changes the overlays\n   * associated with the map.\n   * @return {Collection<import(\"./Overlay.js\").default>} Overlays.\n   * @api\n   */\n  PluggableMap.prototype.getOverlays = function getOverlays () {\n    return this.overlays_;\n  };\n\n  /**\n   * Get an overlay by its identifier (the value returned by overlay.getId()).\n   * Note that the index treats string and numeric identifiers as the same. So\n   * `map.getOverlayById(2)` will return an overlay with id `'2'` or `2`.\n   * @param {string|number} id Overlay identifier.\n   * @return {import(\"./Overlay.js\").default} Overlay.\n   * @api\n   */\n  PluggableMap.prototype.getOverlayById = function getOverlayById (id) {\n    var overlay = this.overlayIdIndex_[id.toString()];\n    return overlay !== undefined ? overlay : null;\n  };\n\n  /**\n   * Get the map interactions. Modifying this collection changes the interactions\n   * associated with the map.\n   *\n   * Interactions are used for e.g. pan, zoom and rotate.\n   * @return {Collection<import(\"./interaction/Interaction.js\").default>} Interactions.\n   * @api\n   */\n  PluggableMap.prototype.getInteractions = function getInteractions () {\n    return this.interactions;\n  };\n\n  /**\n   * Get the layergroup associated with this map.\n   * @return {LayerGroup} A layer group containing the layers in this map.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.getLayerGroup = function getLayerGroup () {\n    return (\n      /** @type {LayerGroup} */ (this.get(MapProperty.LAYERGROUP))\n    );\n  };\n\n  /**\n   * Get the collection of layers associated with this map.\n   * @return {!Collection<import(\"./layer/Base.js\").default>} Layers.\n   * @api\n   */\n  PluggableMap.prototype.getLayers = function getLayers () {\n    var layers = this.getLayerGroup().getLayers();\n    return layers;\n  };\n\n  /**\n   * Get the pixel for a coordinate.  This takes a coordinate in the map view\n   * projection and returns the corresponding pixel.\n   * @param {import(\"./coordinate.js\").Coordinate} coordinate A map coordinate.\n   * @return {import(\"./pixel.js\").Pixel} A pixel position in the map viewport.\n   * @api\n   */\n  PluggableMap.prototype.getPixelFromCoordinate = function getPixelFromCoordinate (coordinate) {\n    var frameState = this.frameState_;\n    if (!frameState) {\n      return null;\n    } else {\n      return applyTransform(frameState.coordinateToPixelTransform, coordinate.slice(0, 2));\n    }\n  };\n\n  /**\n   * Get the map renderer.\n   * @return {import(\"./renderer/Map.js\").default} Renderer\n   */\n  PluggableMap.prototype.getRenderer = function getRenderer () {\n    return this.renderer_;\n  };\n\n  /**\n   * Get the size of this map.\n   * @return {import(\"./size.js\").Size|undefined} The size in pixels of the map in the DOM.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.getSize = function getSize () {\n    return (\n      /** @type {import(\"./size.js\").Size|undefined} */ (this.get(MapProperty.SIZE))\n    );\n  };\n\n  /**\n   * Get the view associated with this map. A view manages properties such as\n   * center and resolution.\n   * @return {View} The view that controls this map.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.getView = function getView () {\n    return (\n      /** @type {View} */ (this.get(MapProperty.VIEW))\n    );\n  };\n\n  /**\n   * Get the element that serves as the map viewport.\n   * @return {HTMLElement} Viewport.\n   * @api\n   */\n  PluggableMap.prototype.getViewport = function getViewport () {\n    return this.viewport_;\n  };\n\n  /**\n   * Get the element that serves as the container for overlays.  Elements added to\n   * this container will let mousedown and touchstart events through to the map,\n   * so clicks and gestures on an overlay will trigger {@link module:ol/MapBrowserEvent~MapBrowserEvent}\n   * events.\n   * @return {!HTMLElement} The map's overlay container.\n   */\n  PluggableMap.prototype.getOverlayContainer = function getOverlayContainer () {\n    return this.overlayContainer_;\n  };\n\n  /**\n   * Get the element that serves as a container for overlays that don't allow\n   * event propagation. Elements added to this container won't let mousedown and\n   * touchstart events through to the map, so clicks and gestures on an overlay\n   * don't trigger any {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n   * @return {!HTMLElement} The map's overlay container that stops events.\n   */\n  PluggableMap.prototype.getOverlayContainerStopEvent = function getOverlayContainerStopEvent () {\n    return this.overlayContainerStopEvent_;\n  };\n\n  /**\n   * @param {import(\"./Tile.js\").default} tile Tile.\n   * @param {string} tileSourceKey Tile source key.\n   * @param {import(\"./coordinate.js\").Coordinate} tileCenter Tile center.\n   * @param {number} tileResolution Tile resolution.\n   * @return {number} Tile priority.\n   */\n  PluggableMap.prototype.getTilePriority = function getTilePriority (tile, tileSourceKey, tileCenter, tileResolution) {\n    // Filter out tiles at higher zoom levels than the current zoom level, or that\n    // are outside the visible extent.\n    var frameState = this.frameState_;\n    if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {\n      return DROP;\n    }\n    if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {\n      return DROP;\n    }\n    // Prioritize the highest zoom level tiles closest to the focus.\n    // Tiles at higher zoom levels are prioritized using Math.log(tileResolution).\n    // Within a zoom level, tiles are prioritized by the distance in pixels\n    // between the center of the tile and the focus.  The factor of 65536 means\n    // that the prioritization should behave as desired for tiles up to\n    // 65536 * Math.log(2) = 45426 pixels from the focus.\n    var deltaX = tileCenter[0] - frameState.focus[0];\n    var deltaY = tileCenter[1] - frameState.focus[1];\n    return 65536 * Math.log(tileResolution) +\n        Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n  };\n\n  /**\n   * @param {Event} browserEvent Browser event.\n   * @param {string=} opt_type Type.\n   */\n  PluggableMap.prototype.handleBrowserEvent = function handleBrowserEvent (browserEvent, opt_type) {\n    var type = opt_type || browserEvent.type;\n    var mapBrowserEvent = new MapBrowserEvent(type, this, browserEvent);\n    this.handleMapBrowserEvent(mapBrowserEvent);\n  };\n\n  /**\n   * @param {MapBrowserEvent} mapBrowserEvent The event to handle.\n   */\n  PluggableMap.prototype.handleMapBrowserEvent = function handleMapBrowserEvent (mapBrowserEvent) {\n    if (!this.frameState_) {\n      // With no view defined, we cannot translate pixels into geographical\n      // coordinates so interactions cannot be used.\n      return;\n    }\n    this.focus_ = mapBrowserEvent.coordinate;\n    mapBrowserEvent.frameState = this.frameState_;\n    var interactionsArray = this.getInteractions().getArray();\n    if (this.dispatchEvent(mapBrowserEvent) !== false) {\n      for (var i = interactionsArray.length - 1; i >= 0; i--) {\n        var interaction = interactionsArray[i];\n        if (!interaction.getActive()) {\n          continue;\n        }\n        var cont = interaction.handleEvent(mapBrowserEvent);\n        if (!cont) {\n          break;\n        }\n      }\n    }\n  };\n\n  /**\n   * @protected\n   */\n  PluggableMap.prototype.handlePostRender = function handlePostRender () {\n\n    var frameState = this.frameState_;\n\n    // Manage the tile queue\n    // Image loads are expensive and a limited resource, so try to use them\n    // efficiently:\n    // * When the view is static we allow a large number of parallel tile loads\n    //   to complete the frame as quickly as possible.\n    // * When animating or interacting, image loads can cause janks, so we reduce\n    //   the maximum number of loads per frame and limit the number of parallel\n    //   tile loads to remain reactive to view changes and to reduce the chance of\n    //   loading tiles that will quickly disappear from view.\n    var tileQueue = this.tileQueue_;\n    if (!tileQueue.isEmpty()) {\n      var maxTotalLoading = this.maxTilesLoading_;\n      var maxNewLoads = maxTotalLoading;\n      if (frameState) {\n        var hints = frameState.viewHints;\n        if (hints[ViewHint.ANIMATING]) {\n          maxTotalLoading = this.loadTilesWhileAnimating_ ? 8 : 0;\n          maxNewLoads = 2;\n        }\n        if (hints[ViewHint.INTERACTING]) {\n          maxTotalLoading = this.loadTilesWhileInteracting_ ? 8 : 0;\n          maxNewLoads = 2;\n        }\n      }\n      if (tileQueue.getTilesLoading() < maxTotalLoading) {\n        tileQueue.reprioritize(); // FIXME only call if view has changed\n        tileQueue.loadMoreTiles(maxTotalLoading, maxNewLoads);\n      }\n    }\n    if (frameState && this.hasListener(RenderEventType.RENDERCOMPLETE) && !frameState.animate &&\n        !this.tileQueue_.getTilesLoading() && !getLoading(this.getLayers().getArray())) {\n      this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE, frameState);\n    }\n\n    var postRenderFunctions = this.postRenderFunctions_;\n    for (var i = 0, ii = postRenderFunctions.length; i < ii; ++i) {\n      postRenderFunctions[i](this, frameState);\n    }\n    postRenderFunctions.length = 0;\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleSizeChanged_ = function handleSizeChanged_ () {\n    this.render();\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleTargetChanged_ = function handleTargetChanged_ () {\n    // target may be undefined, null, a string or an Element.\n    // If it's a string we convert it to an Element before proceeding.\n    // If it's not now an Element we remove the viewport from the DOM.\n    // If it's an Element we append the viewport element to it.\n\n    var targetElement;\n    if (this.getTarget()) {\n      targetElement = this.getTargetElement();\n    }\n\n    if (this.keyHandlerKeys_) {\n      for (var i = 0, ii = this.keyHandlerKeys_.length; i < ii; ++i) {\n        unlistenByKey(this.keyHandlerKeys_[i]);\n      }\n      this.keyHandlerKeys_ = null;\n    }\n\n    if (!targetElement) {\n      this.renderer_.removeLayerRenderers();\n      removeNode(this.viewport_);\n      if (this.handleResize_ !== undefined) {\n        removeEventListener(EventType.RESIZE, this.handleResize_, false);\n        this.handleResize_ = undefined;\n      }\n    } else {\n      targetElement.appendChild(this.viewport_);\n\n      var keyboardEventTarget = !this.keyboardEventTarget_ ?\n        targetElement : this.keyboardEventTarget_;\n      this.keyHandlerKeys_ = [\n        listen(keyboardEventTarget, EventType.KEYDOWN, this.handleBrowserEvent, this),\n        listen(keyboardEventTarget, EventType.KEYPRESS, this.handleBrowserEvent, this)\n      ];\n\n      if (!this.handleResize_) {\n        this.handleResize_ = this.updateSize.bind(this);\n        window.addEventListener(EventType.RESIZE, this.handleResize_, false);\n      }\n    }\n\n    this.updateSize();\n    // updateSize calls setSize, so no need to call this.render\n    // ourselves here.\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleTileChange_ = function handleTileChange_ () {\n    this.render();\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleViewPropertyChanged_ = function handleViewPropertyChanged_ () {\n    this.render();\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleViewChanged_ = function handleViewChanged_ () {\n    if (this.viewPropertyListenerKey_) {\n      unlistenByKey(this.viewPropertyListenerKey_);\n      this.viewPropertyListenerKey_ = null;\n    }\n    if (this.viewChangeListenerKey_) {\n      unlistenByKey(this.viewChangeListenerKey_);\n      this.viewChangeListenerKey_ = null;\n    }\n    var view = this.getView();\n    if (view) {\n      this.viewport_.setAttribute('data-view', getUid(view));\n      this.viewPropertyListenerKey_ = listen(\n        view, ObjectEventType.PROPERTYCHANGE,\n        this.handleViewPropertyChanged_, this);\n      this.viewChangeListenerKey_ = listen(\n        view, EventType.CHANGE,\n        this.handleViewPropertyChanged_, this);\n    }\n    this.render();\n  };\n\n  /**\n   * @private\n   */\n  PluggableMap.prototype.handleLayerGroupChanged_ = function handleLayerGroupChanged_ () {\n    if (this.layerGroupPropertyListenerKeys_) {\n      this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey);\n      this.layerGroupPropertyListenerKeys_ = null;\n    }\n    var layerGroup = this.getLayerGroup();\n    if (layerGroup) {\n      this.layerGroupPropertyListenerKeys_ = [\n        listen(\n          layerGroup, ObjectEventType.PROPERTYCHANGE,\n          this.render, this),\n        listen(\n          layerGroup, EventType.CHANGE,\n          this.render, this)\n      ];\n    }\n    this.render();\n  };\n\n  /**\n   * @return {boolean} Is rendered.\n   */\n  PluggableMap.prototype.isRendered = function isRendered () {\n    return !!this.frameState_;\n  };\n\n  /**\n   * Requests an immediate render in a synchronous manner.\n   * @api\n   */\n  PluggableMap.prototype.renderSync = function renderSync () {\n    if (this.animationDelayKey_) {\n      cancelAnimationFrame(this.animationDelayKey_);\n    }\n    this.animationDelay_();\n  };\n\n  /**\n   * Request a map rendering (at the next animation frame).\n   * @api\n   */\n  PluggableMap.prototype.render = function render () {\n    if (this.animationDelayKey_ === undefined) {\n      this.animationDelayKey_ = requestAnimationFrame(this.animationDelay_);\n    }\n  };\n\n  /**\n   * Remove the given control from the map.\n   * @param {import(\"./control/Control.js\").default} control Control.\n   * @return {import(\"./control/Control.js\").default|undefined} The removed control (or undefined\n   *     if the control was not found).\n   * @api\n   */\n  PluggableMap.prototype.removeControl = function removeControl (control) {\n    return this.getControls().remove(control);\n  };\n\n  /**\n   * Remove the given interaction from the map.\n   * @param {import(\"./interaction/Interaction.js\").default} interaction Interaction to remove.\n   * @return {import(\"./interaction/Interaction.js\").default|undefined} The removed interaction (or\n   *     undefined if the interaction was not found).\n   * @api\n   */\n  PluggableMap.prototype.removeInteraction = function removeInteraction (interaction) {\n    return this.getInteractions().remove(interaction);\n  };\n\n  /**\n   * Removes the given layer from the map.\n   * @param {import(\"./layer/Base.js\").default} layer Layer.\n   * @return {import(\"./layer/Base.js\").default|undefined} The removed layer (or undefined if the\n   *     layer was not found).\n   * @api\n   */\n  PluggableMap.prototype.removeLayer = function removeLayer (layer) {\n    var layers = this.getLayerGroup().getLayers();\n    return layers.remove(layer);\n  };\n\n  /**\n   * Remove the given overlay from the map.\n   * @param {import(\"./Overlay.js\").default} overlay Overlay.\n   * @return {import(\"./Overlay.js\").default|undefined} The removed overlay (or undefined\n   *     if the overlay was not found).\n   * @api\n   */\n  PluggableMap.prototype.removeOverlay = function removeOverlay (overlay) {\n    return this.getOverlays().remove(overlay);\n  };\n\n  /**\n   * @param {number} time Time.\n   * @private\n   */\n  PluggableMap.prototype.renderFrame_ = function renderFrame_ (time) {\n    var viewState;\n\n    var size = this.getSize();\n    var view = this.getView();\n    var extent = createEmpty();\n    var previousFrameState = this.frameState_;\n    /** @type {?FrameState} */\n    var frameState = null;\n    if (size !== undefined && hasArea(size) && view && view.isDef()) {\n      var viewHints = view.getHints(this.frameState_ ? this.frameState_.viewHints : undefined);\n      var layerStatesArray = this.getLayerGroup().getLayerStatesArray();\n      var layerStates = {};\n      for (var i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n        layerStates[getUid(layerStatesArray[i].layer)] = layerStatesArray[i];\n      }\n      viewState = view.getState(this.pixelRatio_);\n      frameState = /** @type {FrameState} */ ({\n        animate: false,\n        coordinateToPixelTransform: this.coordinateToPixelTransform_,\n        extent: extent,\n        focus: this.focus_ ? this.focus_ : viewState.center,\n        index: this.frameIndex_++,\n        layerStates: layerStates,\n        layerStatesArray: layerStatesArray,\n        pixelRatio: this.pixelRatio_,\n        pixelToCoordinateTransform: this.pixelToCoordinateTransform_,\n        postRenderFunctions: [],\n        size: size,\n        skippedFeatureUids: this.skippedFeatureUids_,\n        tileQueue: this.tileQueue_,\n        time: time,\n        usedTiles: {},\n        viewState: viewState,\n        viewHints: viewHints,\n        wantedTiles: {}\n      });\n    }\n\n    if (frameState) {\n      frameState.extent = getForViewAndSize(viewState.center,\n        viewState.resolution, viewState.rotation, frameState.size, extent);\n    }\n\n    this.frameState_ = frameState;\n    this.renderer_.renderFrame(frameState);\n\n    if (frameState) {\n      if (frameState.animate) {\n        this.render();\n      }\n      Array.prototype.push.apply(this.postRenderFunctions_, frameState.postRenderFunctions);\n\n      if (previousFrameState) {\n        var moveStart = !this.previousExtent_ ||\n                    (!isEmpty(this.previousExtent_) &&\n                    !equals(frameState.extent, this.previousExtent_));\n        if (moveStart) {\n          this.dispatchEvent(\n            new MapEvent(MapEventType.MOVESTART, this, previousFrameState));\n          this.previousExtent_ = createOrUpdateEmpty(this.previousExtent_);\n        }\n      }\n\n      var idle = this.previousExtent_ &&\n          !frameState.viewHints[ViewHint.ANIMATING] &&\n          !frameState.viewHints[ViewHint.INTERACTING] &&\n          !equals(frameState.extent, this.previousExtent_);\n\n      if (idle) {\n        this.dispatchEvent(new MapEvent(MapEventType.MOVEEND, this, frameState));\n        clone(frameState.extent, this.previousExtent_);\n      }\n    }\n\n    this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER, this, frameState));\n\n    setTimeout(this.handlePostRender.bind(this), 0);\n\n  };\n\n  /**\n   * Sets the layergroup of this map.\n   * @param {LayerGroup} layerGroup A layer group containing the layers in this map.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.setLayerGroup = function setLayerGroup (layerGroup) {\n    this.set(MapProperty.LAYERGROUP, layerGroup);\n  };\n\n  /**\n   * Set the size of this map.\n   * @param {import(\"./size.js\").Size|undefined} size The size in pixels of the map in the DOM.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.setSize = function setSize (size) {\n    this.set(MapProperty.SIZE, size);\n  };\n\n  /**\n   * Set the target element to render this map into.\n   * @param {HTMLElement|string|undefined} target The Element or id of the Element\n   *     that the map is rendered in.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.setTarget = function setTarget (target) {\n    this.set(MapProperty.TARGET, target);\n  };\n\n  /**\n   * Set the view for this map.\n   * @param {View} view The view that controls this map.\n   * @observable\n   * @api\n   */\n  PluggableMap.prototype.setView = function setView (view) {\n    this.set(MapProperty.VIEW, view);\n  };\n\n  /**\n   * @param {import(\"./Feature.js\").default} feature Feature.\n   */\n  PluggableMap.prototype.skipFeature = function skipFeature (feature) {\n    this.skippedFeatureUids_[getUid(feature)] = true;\n    this.render();\n  };\n\n  /**\n   * Force a recalculation of the map viewport size.  This should be called when\n   * third-party code changes the size of the map viewport.\n   * @api\n   */\n  PluggableMap.prototype.updateSize = function updateSize () {\n    var targetElement = this.getTargetElement();\n\n    if (!targetElement) {\n      this.setSize(undefined);\n    } else {\n      var computedStyle = getComputedStyle(targetElement);\n      this.setSize([\n        targetElement.offsetWidth -\n            parseFloat(computedStyle['borderLeftWidth']) -\n            parseFloat(computedStyle['paddingLeft']) -\n            parseFloat(computedStyle['paddingRight']) -\n            parseFloat(computedStyle['borderRightWidth']),\n        targetElement.offsetHeight -\n            parseFloat(computedStyle['borderTopWidth']) -\n            parseFloat(computedStyle['paddingTop']) -\n            parseFloat(computedStyle['paddingBottom']) -\n            parseFloat(computedStyle['borderBottomWidth'])\n      ]);\n    }\n  };\n\n  /**\n   * @param {import(\"./Feature.js\").default} feature Feature.\n   */\n  PluggableMap.prototype.unskipFeature = function unskipFeature (feature) {\n    delete this.skippedFeatureUids_[getUid(feature)];\n    this.render();\n  };\n\n  return PluggableMap;\n}(BaseObject));\n\n\n/**\n * @param {MapOptions} options Map options.\n * @return {MapOptionsInternal} Internal map options.\n */\nfunction createOptionsInternal(options) {\n\n  /**\n   * @type {HTMLElement|Document}\n   */\n  var keyboardEventTarget = null;\n  if (options.keyboardEventTarget !== undefined) {\n    keyboardEventTarget = typeof options.keyboardEventTarget === 'string' ?\n      document.getElementById(options.keyboardEventTarget) :\n      options.keyboardEventTarget;\n  }\n\n  /**\n   * @type {Object<string, *>}\n   */\n  var values = {};\n\n  var layerGroup = options.layers && typeof /** @type {?} */ (options.layers).getLayers === 'function' ?\n    /** @type {LayerGroup} */ (options.layers) : new LayerGroup({layers: /** @type {Collection} */ (options.layers)});\n  values[MapProperty.LAYERGROUP] = layerGroup;\n\n  values[MapProperty.TARGET] = options.target;\n\n  values[MapProperty.VIEW] = options.view !== undefined ?\n    options.view : new View();\n\n  var controls;\n  if (options.controls !== undefined) {\n    if (Array.isArray(options.controls)) {\n      controls = new Collection(options.controls.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.controls).getArray === 'function',\n        47); // Expected `controls` to be an array or an `import(\"./Collection.js\").Collection`\n      controls = /** @type {Collection} */ (options.controls);\n    }\n  }\n\n  var interactions;\n  if (options.interactions !== undefined) {\n    if (Array.isArray(options.interactions)) {\n      interactions = new Collection(options.interactions.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.interactions).getArray === 'function',\n        48); // Expected `interactions` to be an array or an `import(\"./Collection.js\").Collection`\n      interactions = /** @type {Collection} */ (options.interactions);\n    }\n  }\n\n  var overlays;\n  if (options.overlays !== undefined) {\n    if (Array.isArray(options.overlays)) {\n      overlays = new Collection(options.overlays.slice());\n    } else {\n      assert(typeof /** @type {?} */ (options.overlays).getArray === 'function',\n        49); // Expected `overlays` to be an array or an `import(\"./Collection.js\").Collection`\n      overlays = options.overlays;\n    }\n  } else {\n    overlays = new Collection();\n  }\n\n  return {\n    controls: controls,\n    interactions: interactions,\n    keyboardEventTarget: keyboardEventTarget,\n    overlays: overlays,\n    values: values\n  };\n\n}\nexport default PluggableMap;\n\n/**\n * @param  {Array<import(\"./layer/Base.js\").default>} layers Layers.\n * @return {boolean} Layers have sources that are still loading.\n */\nfunction getLoading(layers) {\n  for (var i = 0, ii = layers.length; i < ii; ++i) {\n    var layer = layers[i];\n    if (typeof /** @type {?} */ (layer).getLayers === 'function') {\n      return getLoading(/** @type {LayerGroup} */ (layer).getLayers().getArray());\n    } else {\n      var source = /** @type {import(\"./layer/Layer.js\").default} */ (\n        layer).getSource();\n      if (source && source.loading) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\n//# sourceMappingURL=PluggableMap.js.map","/**\n * @module ol/Map\n */\nimport PluggableMap from './PluggableMap.js';\nimport {defaults as defaultControls} from './control/util.js';\nimport {defaults as defaultInteractions} from './interaction.js';\nimport {assign} from './obj.js';\nimport CanvasImageLayerRenderer from './renderer/canvas/ImageLayer.js';\nimport CanvasMapRenderer from './renderer/canvas/Map.js';\nimport CanvasTileLayerRenderer from './renderer/canvas/TileLayer.js';\nimport CanvasVectorLayerRenderer from './renderer/canvas/VectorLayer.js';\nimport CanvasVectorTileLayerRenderer from './renderer/canvas/VectorTileLayer.js';\n\n/**\n * @classdesc\n * The map is the core component of OpenLayers. For a map to render, a view,\n * one or more layers, and a target container are needed:\n *\n *     import Map from 'ol/Map';\n *     import View from 'ol/View';\n *     import TileLayer from 'ol/layer/Tile';\n *     import OSM from 'ol/source/OSM';\n *\n *     var map = new Map({\n *       view: new View({\n *         center: [0, 0],\n *         zoom: 1\n *       }),\n *       layers: [\n *         new TileLayer({\n *           source: new OSM()\n *         })\n *       ],\n *       target: 'map'\n *     });\n *\n * The above snippet creates a map using a {@link module:ol/layer/Tile} to\n * display {@link module:ol/source/OSM~OSM} OSM data and render it to a DOM\n * element with the id `map`.\n *\n * The constructor places a viewport container (with CSS class name\n * `ol-viewport`) in the target element (see `getViewport()`), and then two\n * further elements within the viewport: one with CSS class name\n * `ol-overlaycontainer-stopevent` for controls and some overlays, and one with\n * CSS class name `ol-overlaycontainer` for other overlays (see the `stopEvent`\n * option of {@link module:ol/Overlay~Overlay} for the difference). The map\n * itself is placed in a further element within the viewport.\n *\n * Layers are stored as a {@link module:ol/Collection~Collection} in\n * layerGroups. A top-level group is provided by the library. This is what is\n * accessed by `getLayerGroup` and `setLayerGroup`. Layers entered in the\n * options are added to this group, and `addLayer` and `removeLayer` change the\n * layer collection in the group. `getLayers` is a convenience function for\n * `getLayerGroup().getLayers()`. Note that {@link module:ol/layer/Group~Group}\n * is a subclass of {@link module:ol/layer/Base}, so layers entered in the\n * options or added with `addLayer` can be groups, which can contain further\n * groups, and so on.\n *\n * @fires import(\"./MapBrowserEvent.js\").MapBrowserEvent\n * @fires import(\"./MapEvent.js\").MapEvent\n * @fires module:ol/render/Event~RenderEvent#postcompose\n * @fires module:ol/render/Event~RenderEvent#precompose\n * @api\n */\nvar Map = /*@__PURE__*/(function (PluggableMap) {\n  function Map(options) {\n    options = assign({}, options);\n    if (!options.controls) {\n      options.controls = defaultControls();\n    }\n    if (!options.interactions) {\n      options.interactions = defaultInteractions();\n    }\n\n    PluggableMap.call(this, options);\n  }\n\n  if ( PluggableMap ) Map.__proto__ = PluggableMap;\n  Map.prototype = Object.create( PluggableMap && PluggableMap.prototype );\n  Map.prototype.constructor = Map;\n\n  Map.prototype.createRenderer = function createRenderer () {\n    var renderer = new CanvasMapRenderer(this);\n    renderer.registerLayerRenderers([\n      CanvasImageLayerRenderer,\n      CanvasTileLayerRenderer,\n      CanvasVectorLayerRenderer,\n      CanvasVectorTileLayerRenderer\n    ]);\n    return renderer;\n  };\n\n  return Map;\n}(PluggableMap));\n\n\nexport default Map;\n\n//# sourceMappingURL=Map.js.map","/** Vanilla JS helper to manipulate DOM without jQuery\r\n * @see https://github.com/nefe/You-Dont-Need-jQuery\r\n * @see https://plainjs.com/javascript/\r\n * @see http://youmightnotneedjquery.com/\r\n */\r\n var ol_ext_element = {};\r\n\r\n/**\r\n * Create an element\r\n * @param {string} tagName The element tag, use 'TEXT' to create a text node\r\n * @param {*} options\r\n *  @param {string} options.className className The element class name \r\n *  @param {Element} options.parent Parent to append the element as child\r\n *  @param {Element|string} options.html Content of the element\r\n *  @param {string} options.* Any other attribut to add to the element\r\n */\r\nol_ext_element.create = function (tagName, options) {\r\n  options = options || {};\r\n  var elt;\r\n  // Create text node\r\n  if (tagName === 'TEXT') {\r\n    elt = document.createTextNode(options.html||'');\r\n    if (options.parent) options.parent.appendChild(elt);\r\n  } else {\r\n    // Other element\r\n    elt = document.createElement(tagName);\r\n    if (/button/i.test(tagName)) elt.setAttribute('type', 'button');\r\n    for (var attr in options) {\r\n      switch (attr) {\r\n        case 'className': {\r\n          if (options.className && options.className.trim) elt.setAttribute('class', options.className.trim());\r\n          break;\r\n        }\r\n        case 'html': {\r\n          if (options.html instanceof Element) elt.appendChild(options.html)\r\n          else if (options.html!==undefined) elt.innerHTML = options.html;\r\n          break;\r\n        }\r\n        case 'parent': {\r\n          if (options.parent) options.parent.appendChild(elt);\r\n          break;\r\n        }\r\n        case 'style': {\r\n          this.setStyle(elt, options.style);\r\n          break;\r\n        }\r\n        case 'change':\r\n        case 'click': {\r\n          ol_ext_element.addListener(elt, attr, options[attr]);\r\n          break;\r\n        }\r\n        case 'on': {\r\n          for (var e in options.on) {\r\n            ol_ext_element.addListener(elt, e, options.on[e]);\r\n          }\r\n          break;\r\n        }\r\n        case 'checked': {\r\n          elt.checked = !!options.checked;\r\n          break;\r\n        }\r\n        default: {\r\n          elt.setAttribute(attr, options[attr]);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return elt;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {boolean} options.checked\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createSwitch = function (options) {\r\n  var label = ol_ext_element.create('LABEL',{ \r\n    html: options.html,\r\n    className: 'ol-ext-toggle-switch',\r\n    parent: options.parent\r\n  });\r\n  var input = ol_ext_element.create('INPUT', {\r\n    type: 'checkbox',\r\n    checked: options.checked,\r\n    click: options.click,\r\n    change: options.change,\r\n    on: options.on,\r\n    parent: label\r\n  });\r\n  ol_ext_element.create('SPAN', { parent: label });\r\n  if (options.after) {\r\n    label.appendChild(document.createTextNode(options.after));\r\n  }\r\n  return input;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {string} [options.name] input name\r\n *  @param {string} [options.type=checkbox] input type: radio or checkbox\r\n *  @param {string} options.value input value\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createCheck = function (options) {\r\n  var label = ol_ext_element.create('LABEL', {\r\n    className: 'ol-ext-check ' + (options.type==='radio' ? 'ol-ext-radio' : 'ol-ext-checkbox'),\r\n    html: options.html,\r\n    parent: options.parent\r\n  });\r\n  var input = ol_ext_element.create('INPUT', {\r\n    name: options.name,\r\n    type: (options.type==='radio' ? 'radio' : 'checkbox'),\r\n    value: options.val,\r\n    change: options.change,\r\n    click: options.click,\r\n    on: options.on,\r\n    parent: label\r\n  });\r\n  ol_ext_element.create('SPAN', {\r\n    parent: label\r\n  });\r\n  if (options.after) {\r\n    label.appendChild(document.createTextNode(options.after));\r\n  }\r\n  return input;\r\n};\r\n\r\n\r\n/** Set inner html or append a child element to an element\r\n * @param {Element} element\r\n * @param {Element|string} html Content of the element\r\n */\r\nol_ext_element.setHTML = function(element, html) {\r\n  if (html instanceof Element) element.appendChild(html)\r\n  else if (html!==undefined) element.innerHTML = html;\r\n};\r\n\r\n/** Append text into an elemnt\r\n * @param {Element} element\r\n * @param {string} text text content\r\n */\r\nol_ext_element.appendText = function(element, text) {\r\n  element.appendChild(document.createTextNode(text||''));\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.addListener = function (element, eventType, fn, useCapture ) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.addEventListener(e, fn, useCapture);\r\n  });\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.removeListener = function (element, eventType, fn) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.removeEventListener(e, fn);\r\n  });\r\n};\r\n\r\n/**\r\n * Show an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.show = function (element) {\r\n  element.style.display = '';\r\n};\r\n\r\n/**\r\n * Hide an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.hide = function (element) {\r\n  element.style.display = 'none';\r\n};\r\n\r\n/**\r\n * Test if an element is hihdden\r\n * @param {Element} element\r\n * @return {boolean}\r\n */\r\nol_ext_element.hidden = function (element) {\r\n  return ol_ext_element.getStyle(element, 'display') === 'none';\r\n};\r\n\r\n/**\r\n * Toggle an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.toggle = function (element) {\r\n  element.style.display = (element.style.display==='none' ? '' : 'none');\r\n};\r\n\r\n/** Set style of an element\r\n * @param {DOMElement} el the element\r\n * @param {*} st list of style\r\n */\r\nol_ext_element.setStyle = function(el, st) {\r\n  for (var s in st) {\r\n    switch (s) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n      case 'minWidth':\r\n      case 'maxWidth':\r\n      case 'width':\r\n      case 'height': {\r\n        if (typeof(st[s]) === 'number') {\r\n          el.style[s] = st[s]+'px';\r\n        } else {\r\n          el.style[s] = st[s];\r\n        }\r\n        break;\r\n      }\r\n      default: {\r\n        el.style[s] = st[s];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get style propertie of an element\r\n * @param {DOMElement} el the element\r\n * @param {string} styleProp Propertie name\r\n * @return {*} style value\r\n */\r\nol_ext_element.getStyle = function(el, styleProp) {\r\n  var value, defaultView = (el.ownerDocument || document).defaultView;\r\n  // W3C standard way:\r\n  if (defaultView && defaultView.getComputedStyle) {\r\n    // sanitize property name to css notation\r\n    // (hypen separated words eg. font-Size)\r\n    styleProp = styleProp.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n    value = defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);\r\n  } else if (el.currentStyle) { // IE\r\n    // sanitize property name to camelCase\r\n    styleProp = styleProp.replace(/-(\\w)/g, function(str, letter) {\r\n      return letter.toUpperCase();\r\n    });\r\n    value = el.currentStyle[styleProp];\r\n    // convert other units to pixels on IE\r\n    if (/^\\d+(em|pt|%|ex)?$/i.test(value)) { \r\n      return (function(value) {\r\n        var oldLeft = el.style.left, oldRsLeft = el.runtimeStyle.left;\r\n        el.runtimeStyle.left = el.currentStyle.left;\r\n        el.style.left = value || 0;\r\n        value = el.style.pixelLeft + \"px\";\r\n        el.style.left = oldLeft;\r\n        el.runtimeStyle.left = oldRsLeft;\r\n        return value;\r\n      })(value);\r\n    }\r\n  }\r\n  if (/px$/.test(value)) return parseInt(value);\r\n  return value;\r\n};\r\n\r\n/** Get outerHeight of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerHeight = function(elt) {\r\n  return elt.offsetHeight + ol_ext_element.getStyle(elt, 'marginBottom')\r\n};\r\n\r\n/** Get outerWidth of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerWidth = function(elt) {\r\n  return elt.offsetWidth + ol_ext_element.getStyle(elt, 'marginLeft')\r\n};\r\n\r\n/** Get element offset rect\r\n * @param {DOMElement} elt\r\n * @return {*} \r\n */\r\nol_ext_element.offsetRect = function(elt) {\r\n  var rect = elt.getBoundingClientRect();\r\n  return {\r\n    top: rect.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0),\r\n    left: rect.left + (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0),\r\n    height: rect.height || (rect.bottom - rect.top),\r\n    width: rect.width || (rect.right - rect.left)\r\n  }\r\n};\r\n\r\n/** Make a div scrollable without scrollbar.\r\n * On touch devices the default behavior is preserved\r\n * @param {DOMElement} elt\r\n * @param {*} options\r\n *  @param {function} options.onmove a function that takes a boolean indicating that the div is scrolling\r\n *  @param {boolean} [options.vertical=false] \r\n *  @param {boolean} [options.animate=true] add kinetic to scroll\r\n */\r\nol_ext_element.scrollDiv = function(elt, options) {\r\n  var pos = false;\r\n  var speed = 0;\r\n  var d, dt = 0;\r\n\r\n  var onmove = (typeof(options.onmove) === 'function' ? options.onmove : function(){});\r\n  var page = options.vertical ? 'pageY' : 'pageX';\r\n  var scroll = options.vertical ? 'scrollTop' : 'scrollLeft';\r\n  var moving = false;\r\n\r\n  // Prevent image dragging\r\n  elt.querySelectorAll('img').forEach(function(i) {\r\n    i.ondragstart = function(){ return false; };\r\n  });\r\n  elt.style['touch-action'] = 'none';\r\n  \r\n  // Start scrolling\r\n  ol_ext_element.addListener(elt, ['pointerdown'], function(e) {\r\n    moving = false;\r\n    pos = e[page];\r\n    dt = new Date();\r\n    elt.classList.add('ol-move');\r\n  });\r\n  \r\n  // Register scroll\r\n  ol_ext_element.addListener(window, ['pointermove'], function(e) {\r\n    moving = true;\r\n    if (pos !== false) {\r\n      var delta = pos - e[page];\r\n      elt[scroll] += delta;\r\n      d = new Date();\r\n      if (d-dt) {\r\n        speed = (speed + delta / (d - dt))/2;\r\n      }\r\n      pos = e[page];\r\n      dt = d;\r\n      // Tell we are moving\r\n      if (delta) onmove(true);\r\n    }\r\n  });\r\n  \r\n  // Animate scroll\r\n  var animate = function(to) {\r\n    var step = (to>0) ? Math.min(100, to/2) : Math.max(-100, to/2);\r\n    to -= step;\r\n    elt[scroll] += step;\r\n    if (-1 < to && to < 1) {\r\n      if (moving) setTimeout(function() { elt.classList.remove('ol-move'); });\r\n      else elt.classList.remove('ol-move');\r\n      moving = false;\r\n      onmove(false);\r\n    } else {\r\n      setTimeout(function() {\r\n        animate(to);\r\n      }, 40);\r\n    }\r\n  }\r\n\r\n  // Stop scrolling\r\n  ol_ext_element.addListener(window, ['pointerup','pointercancel'], function(e) {\r\n    dt = new Date() - dt;\r\n    if (dt>100) {\r\n      // User stop: no speed\r\n      speed = 0;\r\n    } else if (dt>0) {\r\n      // Calculate new speed\r\n      speed = ((speed||0) + (pos - e[page]) / dt) / 2;\r\n    }\r\n    animate(options.animate===false ? 0 : speed*200);\r\n    pos = false;\r\n    speed = 0;\r\n    dt = 0;\r\n  });\r\n\r\n  // Handle mousewheel\r\n  if (options.mousewheel) { // && !elt.classList.contains('ol-touch')) {\r\n    ol_ext_element.addListener(elt, \r\n      ['mousewheel', 'DOMMouseScroll', 'onmousewheel'], \r\n      function(e) {\r\n        var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n        elt.classList.add('ol-move');\r\n        elt[scroll] -= delta*30;\r\n        elt.classList.remove('ol-move');\r\n        return false;\r\n      }\r\n    );\r\n  }\r\n};\r\n\r\n/** Dispatch an event to an Element \r\n * @param {string} eventName\r\n * @param {Element} element\r\n*/\r\nol_ext_element.dispatchEvent = function (eventName, element) {\r\n  var event;\r\n  try {\r\n    event = new CustomEvent(eventName);\r\n  } catch(e) {\r\n    // Try customevent on IE\r\n    event = document.createEvent(\"CustomEvent\");\r\n    event.initCustomEvent(eventName, true, true, {});\r\n  }\r\n  element.dispatchEvent(event);\r\n};\r\n\r\nexport default ol_ext_element\r\n","/**\n * @module ol/MapEvent\n */\nimport Event from './events/Event.js';\n\n/**\n * @classdesc\n * Events emitted as map events are instances of this type.\n * See {@link module:ol/PluggableMap~PluggableMap} for which events trigger a map event.\n */\nvar MapEvent = /*@__PURE__*/(function (Event) {\n  function MapEvent(type, map, opt_frameState) {\n\n    Event.call(this, type);\n\n    /**\n     * The map where the event occurred.\n     * @type {import(\"./PluggableMap.js\").default}\n     * @api\n     */\n    this.map = map;\n\n    /**\n     * The frame state at the time of the event.\n     * @type {?import(\"./PluggableMap.js\").FrameState}\n     * @api\n     */\n    this.frameState = opt_frameState !== undefined ? opt_frameState : null;\n\n  }\n\n  if ( Event ) MapEvent.__proto__ = Event;\n  MapEvent.prototype = Object.create( Event && Event.prototype );\n  MapEvent.prototype.constructor = MapEvent;\n\n  return MapEvent;\n}(Event));\n\nexport default MapEvent;\n\n//# sourceMappingURL=MapEvent.js.map","/**\n * @module ol/ObjectEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a property is changed.\n   * @event module:ol/Object.ObjectEvent#propertychange\n   * @api\n   */\n  PROPERTYCHANGE: 'propertychange'\n};\n\n//# sourceMappingURL=ObjectEventType.js.map","/**\n * @module ol/ImageTile\n */\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\nimport {createCanvasContext2D} from './dom.js';\nimport {listenOnce, unlistenByKey} from './events.js';\nimport EventType from './events/EventType.js';\n\n\nvar ImageTile = /*@__PURE__*/(function (Tile) {\n  function ImageTile(tileCoord, state, src, crossOrigin, tileLoadFunction, opt_options) {\n\n    Tile.call(this, tileCoord, state, opt_options);\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ = crossOrigin;\n\n    /**\n     * Image URI\n     *\n     * @private\n     * @type {string}\n     */\n    this.src_ = src;\n\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n    this.image_ = new Image();\n    if (crossOrigin !== null) {\n      this.image_.crossOrigin = crossOrigin;\n    }\n\n    /**\n     * @private\n     * @type {Array<import(\"./events.js\").EventsKey>}\n     */\n    this.imageListenerKeys_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./Tile.js\").LoadFunction}\n     */\n    this.tileLoadFunction_ = tileLoadFunction;\n\n  }\n\n  if ( Tile ) ImageTile.__proto__ = Tile;\n  ImageTile.prototype = Object.create( Tile && Tile.prototype );\n  ImageTile.prototype.constructor = ImageTile;\n\n  /**\n   * @inheritDoc\n   */\n  ImageTile.prototype.disposeInternal = function disposeInternal () {\n    if (this.state == TileState.LOADING) {\n      this.unlistenImage_();\n      this.image_ = getBlankImage();\n    }\n    if (this.interimTile) {\n      this.interimTile.dispose();\n    }\n    this.state = TileState.ABORT;\n    this.changed();\n    Tile.prototype.disposeInternal.call(this);\n  };\n\n  /**\n   * Get the HTML image element for this tile (may be a Canvas, Image, or Video).\n   * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n   * @api\n   */\n  ImageTile.prototype.getImage = function getImage () {\n    return this.image_;\n  };\n\n  /**\n   * @inheritDoc\n   */\n  ImageTile.prototype.getKey = function getKey () {\n    return this.src_;\n  };\n\n  /**\n   * Tracks loading or read errors.\n   *\n   * @private\n   */\n  ImageTile.prototype.handleImageError_ = function handleImageError_ () {\n    this.state = TileState.ERROR;\n    this.unlistenImage_();\n    this.image_ = getBlankImage();\n    this.changed();\n  };\n\n  /**\n   * Tracks successful image load.\n   *\n   * @private\n   */\n  ImageTile.prototype.handleImageLoad_ = function handleImageLoad_ () {\n    var image = /** @type {HTMLImageElement} */ (this.image_);\n    if (image.naturalWidth && image.naturalHeight) {\n      this.state = TileState.LOADED;\n    } else {\n      this.state = TileState.EMPTY;\n    }\n    this.unlistenImage_();\n    this.changed();\n  };\n\n  /**\n   * @inheritDoc\n   * @api\n   */\n  ImageTile.prototype.load = function load () {\n    if (this.state == TileState.ERROR) {\n      this.state = TileState.IDLE;\n      this.image_ = new Image();\n      if (this.crossOrigin_ !== null) {\n        this.image_.crossOrigin = this.crossOrigin_;\n      }\n    }\n    if (this.state == TileState.IDLE) {\n      this.state = TileState.LOADING;\n      this.changed();\n      this.imageListenerKeys_ = [\n        listenOnce(this.image_, EventType.ERROR,\n          this.handleImageError_, this),\n        listenOnce(this.image_, EventType.LOAD,\n          this.handleImageLoad_, this)\n      ];\n      this.tileLoadFunction_(this, this.src_);\n    }\n  };\n\n  /**\n   * Discards event handlers which listen for load completion or errors.\n   *\n   * @private\n   */\n  ImageTile.prototype.unlistenImage_ = function unlistenImage_ () {\n    this.imageListenerKeys_.forEach(unlistenByKey);\n    this.imageListenerKeys_ = null;\n  };\n\n  return ImageTile;\n}(Tile));\n\n\n/**\n * Get a 1-pixel blank image.\n * @return {HTMLCanvasElement} Blank image.\n */\nfunction getBlankImage() {\n  var ctx = createCanvasContext2D(1, 1);\n  ctx.fillStyle = 'rgba(0,0,0,0)';\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.canvas;\n}\n\nexport default ImageTile;\n\n//# sourceMappingURL=ImageTile.js.map","/**\n * @module ol/AssertionError\n */\nimport {VERSION} from './util.js';\n\n/**\n * Error object thrown when an assertion failed. This is an ECMA-262 Error,\n * extended with a `code` property.\n * See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error.\n */\nvar AssertionError = /*@__PURE__*/(function (Error) {\n  function AssertionError(code) {\n    var path = VERSION === 'latest' ? VERSION : 'v' + VERSION.split('-')[0];\n    var message = 'Assertion failed. See https://openlayers.org/en/' + path +\n    '/doc/errors/#' + code + ' for details.';\n\n    Error.call(this, message);\n\n    /**\n     * Error code. The meaning of the code can be found on\n     * https://openlayers.org/en/latest/doc/errors/ (replace `latest` with\n     * the version found in the OpenLayers script's header comment if a version\n     * other than the latest is used).\n     * @type {number}\n     * @api\n     */\n    this.code = code;\n\n    /**\n     * @type {string}\n     */\n    this.name = 'AssertionError';\n\n    // Re-assign message, see https://github.com/Rich-Harris/buble/issues/40\n    this.message = message;\n  }\n\n  if ( Error ) AssertionError.__proto__ = Error;\n  AssertionError.prototype = Object.create( Error && Error.prototype );\n  AssertionError.prototype.constructor = AssertionError;\n\n  return AssertionError;\n}(Error));\n\nexport default AssertionError;\n\n//# sourceMappingURL=AssertionError.js.map","/**\n * @module ol/ImageState\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  IDLE: 0,\n  LOADING: 1,\n  LOADED: 2,\n  ERROR: 3\n};\n\n//# sourceMappingURL=ImageState.js.map","/**\n * @module ol/TileCache\n */\nimport LRUCache from './structs/LRUCache.js';\nimport {fromKey, getKey} from './tilecoord.js';\n\nvar TileCache = /*@__PURE__*/(function (LRUCache) {\n  function TileCache(opt_highWaterMark) {\n\n    LRUCache.call(this, opt_highWaterMark);\n\n  }\n\n  if ( LRUCache ) TileCache.__proto__ = LRUCache;\n  TileCache.prototype = Object.create( LRUCache && LRUCache.prototype );\n  TileCache.prototype.constructor = TileCache;\n\n  /**\n   * @param {!Object<string, import(\"./TileRange.js\").default>} usedTiles Used tiles.\n   */\n  TileCache.prototype.expireCache = function expireCache (usedTiles) {\n    while (this.canExpireCache()) {\n      var tile = this.peekLast();\n      var zKey = tile.tileCoord[0].toString();\n      if (zKey in usedTiles && usedTiles[zKey].contains(tile.tileCoord)) {\n        break;\n      } else {\n        this.pop().dispose();\n      }\n    }\n  };\n\n  /**\n   * Prune all tiles from the cache that don't have the same z as the newest tile.\n   */\n  TileCache.prototype.pruneExceptNewestZ = function pruneExceptNewestZ () {\n    if (this.getCount() === 0) {\n      return;\n    }\n    var key = this.peekFirstKey();\n    var tileCoord = fromKey(key);\n    var z = tileCoord[0];\n    this.forEach(function(tile) {\n      if (tile.tileCoord[0] !== z) {\n        this.remove(getKey(tile.tileCoord));\n        tile.dispose();\n      }\n    }, this);\n  };\n\n  return TileCache;\n}(LRUCache));\n\n\nexport default TileCache;\n\n//# sourceMappingURL=TileCache.js.map","/**\n * @module ol/ViewProperty\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  CENTER: 'center',\n  RESOLUTION: 'resolution',\n  ROTATION: 'rotation'\n};\n\n//# sourceMappingURL=ViewProperty.js.map","/**\n * @module ol/View\n */\nimport {DEFAULT_TILE_SIZE} from './tilegrid/common.js';\nimport {getUid} from './util.js';\nimport {VOID} from './functions.js';\nimport {createExtent, none as centerNone} from './centerconstraint.js';\nimport BaseObject from './Object.js';\nimport {createSnapToResolutions, createSnapToPower} from './resolutionconstraint.js';\nimport {createSnapToZero, createSnapToN, none as rotationNone, disable} from './rotationconstraint.js';\nimport ViewHint from './ViewHint.js';\nimport ViewProperty from './ViewProperty.js';\nimport {linearFindNearest} from './array.js';\nimport {assert} from './asserts.js';\nimport {add as addCoordinate, rotate as rotateCoordinate, equals as coordinatesEqual} from './coordinate.js';\nimport {inAndOut} from './easing.js';\nimport {getForViewAndSize, getCenter, getHeight, getWidth, isEmpty} from './extent.js';\nimport GeometryType from './geom/GeometryType.js';\nimport {fromExtent as polygonFromExtent} from './geom/Polygon.js';\nimport {clamp, modulo} from './math.js';\nimport {assign} from './obj.js';\nimport {createProjection, METERS_PER_UNIT} from './proj.js';\nimport Units from './proj/Units.js';\n\n\n/**\n * An animation configuration\n *\n * @typedef {Object} Animation\n * @property {import(\"./coordinate.js\").Coordinate} [sourceCenter]\n * @property {import(\"./coordinate.js\").Coordinate} [targetCenter]\n * @property {number} [sourceResolution]\n * @property {number} [targetResolution]\n * @property {number} [sourceRotation]\n * @property {number} [targetRotation]\n * @property {import(\"./coordinate.js\").Coordinate} [anchor]\n * @property {number} start\n * @property {number} duration\n * @property {boolean} complete\n * @property {function(number):number} easing\n * @property {function(boolean)} callback\n */\n\n\n/**\n * @typedef {Object} Constraints\n * @property {import(\"./centerconstraint.js\").Type} center\n * @property {import(\"./resolutionconstraint.js\").Type} resolution\n * @property {import(\"./rotationconstraint.js\").Type} rotation\n */\n\n\n/**\n * @typedef {Object} FitOptions\n * @property {import(\"./size.js\").Size} [size] The size in pixels of the box to fit\n * the extent into. Default is the current size of the first map in the DOM that\n * uses this view, or `[100, 100]` if no such map is found.\n * @property {!Array<number>} [padding=[0, 0, 0, 0]] Padding (in pixels) to be\n * cleared inside the view. Values in the array are top, right, bottom and left\n * padding.\n * @property {boolean} [constrainResolution=true] Constrain the resolution.\n * @property {boolean} [nearest=false] If `constrainResolution` is `true`, get\n * the nearest extent instead of the closest that actually fits the view.\n * @property {number} [minResolution=0] Minimum resolution that we zoom to.\n * @property {number} [maxZoom] Maximum zoom level that we zoom to. If\n * `minResolution` is given, this property is ignored.\n * @property {number} [duration] The duration of the animation in milliseconds.\n * By default, there is no animation to the target extent.\n * @property {function(number):number} [easing] The easing function used during\n * the animation (defaults to {@link module:ol/easing~inAndOut}).\n * The function will be called for each frame with a number representing a\n * fraction of the animation's duration.  The function should return a number\n * between 0 and 1 representing the progress toward the destination state.\n * @property {function(boolean)} [callback] Function called when the view is in\n * its final position. The callback will be called with `true` if the animation\n * series completed on its own or `false` if it was cancelled.\n */\n\n\n/**\n * @typedef {Object} ViewOptions\n * @property {import(\"./coordinate.js\").Coordinate} [center] The initial center for\n * the view. The coordinate system for the center is specified with the\n * `projection` option. Layer sources will not be fetched if this is not set,\n * but the center can be set later with {@link #setCenter}.\n * @property {boolean|number} [constrainRotation=true] Rotation constraint.\n * `false` means no constraint. `true` means no constraint, but snap to zero\n * near zero. A number constrains the rotation to that number of values. For\n * example, `4` will constrain the rotation to 0, 90, 180, and 270 degrees.\n * @property {boolean} [enableRotation=true] Enable rotation.\n * If `false`, a rotation constraint that always sets the rotation to zero is\n * used. The `constrainRotation` option has no effect if `enableRotation` is\n * `false`.\n * @property {import(\"./extent.js\").Extent} [extent] The extent that constrains the\n * center, in other words, center cannot be set outside this extent.\n * @property {number} [maxResolution] The maximum resolution used to determine\n * the resolution constraint. It is used together with `minResolution` (or\n * `maxZoom`) and `zoomFactor`. If unspecified it is calculated in such a way\n * that the projection's validity extent fits in a 256x256 px tile. If the\n * projection is Spherical Mercator (the default) then `maxResolution` defaults\n * to `40075016.68557849 / 256 = 156543.03392804097`.\n * @property {number} [minResolution] The minimum resolution used to determine\n * the resolution constraint.  It is used together with `maxResolution` (or\n * `minZoom`) and `zoomFactor`.  If unspecified it is calculated assuming 29\n * zoom levels (with a factor of 2). If the projection is Spherical Mercator\n * (the default) then `minResolution` defaults to\n * `40075016.68557849 / 256 / Math.pow(2, 28) = 0.0005831682455839253`.\n * @property {number} [maxZoom=28] The maximum zoom level used to determine the\n * resolution constraint. It is used together with `minZoom` (or\n * `maxResolution`) and `zoomFactor`.  Note that if `minResolution` is also\n * provided, it is given precedence over `maxZoom`.\n * @property {number} [minZoom=0] The minimum zoom level used to determine the\n * resolution constraint. It is used together with `maxZoom` (or\n * `minResolution`) and `zoomFactor`.  Note that if `maxResolution` is also\n * provided, it is given precedence over `minZoom`.\n * @property {import(\"./proj.js\").ProjectionLike} [projection='EPSG:3857'] The\n * projection. The default is Spherical Mercator.\n * @property {number} [resolution] The initial resolution for the view. The\n * units are `projection` units per pixel (e.g. meters per pixel). An\n * alternative to setting this is to set `zoom`. Layer sources will not be\n * fetched if neither this nor `zoom` are defined, but they can be set later\n * with {@link #setZoom} or {@link #setResolution}.\n * @property {Array<number>} [resolutions] Resolutions to determine the\n * resolution constraint. If set the `maxResolution`, `minResolution`,\n * `minZoom`, `maxZoom`, and `zoomFactor` options are ignored.\n * @property {number} [rotation=0] The initial rotation for the view in radians\n * (positive rotation clockwise, 0 means North).\n * @property {number} [zoom] Only used if `resolution` is not defined. Zoom\n * level used to calculate the initial resolution for the view. The initial\n * resolution is determined using the {@link #constrainResolution} method.\n * @property {number} [zoomFactor=2] The zoom factor used to determine the\n * resolution constraint.\n */\n\n\n/**\n * @typedef {Object} AnimationOptions\n * @property {import(\"./coordinate.js\").Coordinate} [center] The center of the view at the end of\n * the animation.\n * @property {number} [zoom] The zoom level of the view at the end of the\n * animation. This takes precedence over `resolution`.\n * @property {number} [resolution] The resolution of the view at the end\n * of the animation.  If `zoom` is also provided, this option will be ignored.\n * @property {number} [rotation] The rotation of the view at the end of\n * the animation.\n * @property {import(\"./coordinate.js\").Coordinate} [anchor] Optional anchor to remained fixed\n * during a rotation or resolution animation.\n * @property {number} [duration=1000] The duration of the animation in milliseconds.\n * @property {function(number):number} [easing] The easing function used\n * during the animation (defaults to {@link module:ol/easing~inAndOut}).\n * The function will be called for each frame with a number representing a\n * fraction of the animation's duration.  The function should return a number\n * between 0 and 1 representing the progress toward the destination state.\n */\n\n\n/**\n * @typedef {Object} State\n * @property {import(\"./coordinate.js\").Coordinate} center\n * @property {import(\"./proj/Projection.js\").default} projection\n * @property {number} resolution\n * @property {number} rotation\n * @property {number} zoom\n */\n\n\n/**\n * Default min zoom level for the map view.\n * @type {number}\n */\nvar DEFAULT_MIN_ZOOM = 0;\n\n\n/**\n * @classdesc\n * A View object represents a simple 2D view of the map.\n *\n * This is the object to act upon to change the center, resolution,\n * and rotation of the map.\n *\n * ### The view states\n *\n * An View is determined by three states: `center`, `resolution`,\n * and `rotation`. Each state has a corresponding getter and setter, e.g.\n * `getCenter` and `setCenter` for the `center` state.\n *\n * An View has a `projection`. The projection determines the\n * coordinate system of the center, and its units determine the units of the\n * resolution (projection units per pixel). The default projection is\n * Spherical Mercator (EPSG:3857).\n *\n * ### The constraints\n *\n * `setCenter`, `setResolution` and `setRotation` can be used to change the\n * states of the view. Any value can be passed to the setters. And the value\n * that is passed to a setter will effectively be the value set in the view,\n * and returned by the corresponding getter.\n *\n * But a View object also has a *resolution constraint*, a\n * *rotation constraint* and a *center constraint*.\n *\n * As said above, no constraints are applied when the setters are used to set\n * new states for the view. Applying constraints is done explicitly through\n * the use of the `constrain*` functions (`constrainResolution` and\n * `constrainRotation` and `constrainCenter`).\n *\n * The main users of the constraints are the interactions and the\n * controls. For example, double-clicking on the map changes the view to\n * the \"next\" resolution. And releasing the fingers after pinch-zooming\n * snaps to the closest resolution (with an animation).\n *\n * The *resolution constraint* snaps to specific resolutions. It is\n * determined by the following options: `resolutions`, `maxResolution`,\n * `maxZoom`, and `zoomFactor`. If `resolutions` is set, the other three\n * options are ignored. See documentation for each option for more\n * information.\n *\n * The *rotation constraint* snaps to specific angles. It is determined\n * by the following options: `enableRotation` and `constrainRotation`.\n * By default the rotation value is snapped to zero when approaching the\n * horizontal.\n *\n * The *center constraint* is determined by the `extent` option. By\n * default the center is not constrained at all.\n *\n  * @api\n */\nvar View = /*@__PURE__*/(function (BaseObject) {\n  function View(opt_options) {\n    BaseObject.call(this);\n\n    var options = assign({}, opt_options);\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.hints_ = [0, 0];\n\n    /**\n     * @private\n     * @type {Array<Array<Animation>>}\n     */\n    this.animations_ = [];\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.updateAnimationKey_;\n\n    this.updateAnimations_ = this.updateAnimations_.bind(this);\n\n    /**\n     * @private\n     * @const\n     * @type {import(\"./proj/Projection.js\").default}\n     */\n    this.projection_ = createProjection(options.projection, 'EPSG:3857');\n\n    this.applyOptions_(options);\n  }\n\n  if ( BaseObject ) View.__proto__ = BaseObject;\n  View.prototype = Object.create( BaseObject && BaseObject.prototype );\n  View.prototype.constructor = View;\n\n  /**\n   * Set up the view with the given options.\n   * @param {ViewOptions} options View options.\n   */\n  View.prototype.applyOptions_ = function applyOptions_ (options) {\n\n    /**\n     * @type {Object<string, *>}\n     */\n    var properties = {};\n    properties[ViewProperty.CENTER] = options.center !== undefined ?\n      options.center : null;\n\n    var resolutionConstraintInfo = createResolutionConstraint(options);\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxResolution_ = resolutionConstraintInfo.maxResolution;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.minResolution_ = resolutionConstraintInfo.minResolution;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.zoomFactor_ = resolutionConstraintInfo.zoomFactor;\n\n    /**\n     * @private\n     * @type {Array<number>|undefined}\n     */\n    this.resolutions_ = options.resolutions;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.minZoom_ = resolutionConstraintInfo.minZoom;\n\n    var centerConstraint = createCenterConstraint(options);\n    var resolutionConstraint = resolutionConstraintInfo.constraint;\n    var rotationConstraint = createRotationConstraint(options);\n\n    /**\n     * @private\n     * @type {Constraints}\n     */\n    this.constraints_ = {\n      center: centerConstraint,\n      resolution: resolutionConstraint,\n      rotation: rotationConstraint\n    };\n\n    if (options.resolution !== undefined) {\n      properties[ViewProperty.RESOLUTION] = options.resolution;\n    } else if (options.zoom !== undefined) {\n      properties[ViewProperty.RESOLUTION] = this.constrainResolution(\n        this.maxResolution_, options.zoom - this.minZoom_);\n\n      if (this.resolutions_) { // in case map zoom is out of min/max zoom range\n        properties[ViewProperty.RESOLUTION] = clamp(\n          Number(this.getResolution() || properties[ViewProperty.RESOLUTION]),\n          this.minResolution_, this.maxResolution_);\n      }\n    }\n    properties[ViewProperty.ROTATION] = options.rotation !== undefined ? options.rotation : 0;\n    this.setProperties(properties);\n\n    /**\n     * @private\n     * @type {ViewOptions}\n     */\n    this.options_ = options;\n\n  };\n\n  /**\n   * Get an updated version of the view options used to construct the view.  The\n   * current resolution (or zoom), center, and rotation are applied to any stored\n   * options.  The provided options can be used to apply new min/max zoom or\n   * resolution limits.\n   * @param {ViewOptions} newOptions New options to be applied.\n   * @return {ViewOptions} New options updated with the current view state.\n   */\n  View.prototype.getUpdatedOptions_ = function getUpdatedOptions_ (newOptions) {\n    var options = assign({}, this.options_);\n\n    // preserve resolution (or zoom)\n    if (options.resolution !== undefined) {\n      options.resolution = this.getResolution();\n    } else {\n      options.zoom = this.getZoom();\n    }\n\n    // preserve center\n    options.center = this.getCenter();\n\n    // preserve rotation\n    options.rotation = this.getRotation();\n\n    return assign({}, options, newOptions);\n  };\n\n  /**\n   * Animate the view.  The view's center, zoom (or resolution), and rotation\n   * can be animated for smooth transitions between view states.  For example,\n   * to animate the view to a new zoom level:\n   *\n   *     view.animate({zoom: view.getZoom() + 1});\n   *\n   * By default, the animation lasts one second and uses in-and-out easing.  You\n   * can customize this behavior by including `duration` (in milliseconds) and\n   * `easing` options (see {@link module:ol/easing}).\n   *\n   * To chain together multiple animations, call the method with multiple\n   * animation objects.  For example, to first zoom and then pan:\n   *\n   *     view.animate({zoom: 10}, {center: [0, 0]});\n   *\n   * If you provide a function as the last argument to the animate method, it\n   * will get called at the end of an animation series.  The callback will be\n   * called with `true` if the animation series completed on its own or `false`\n   * if it was cancelled.\n   *\n   * Animations are cancelled by user interactions (e.g. dragging the map) or by\n   * calling `view.setCenter()`, `view.setResolution()`, or `view.setRotation()`\n   * (or another method that calls one of these).\n   *\n   * @param {...(AnimationOptions|function(boolean))} var_args Animation\n   *     options.  Multiple animations can be run in series by passing multiple\n   *     options objects.  To run multiple animations in parallel, call the method\n   *     multiple times.  An optional callback can be provided as a final\n   *     argument.  The callback will be called with a boolean indicating whether\n   *     the animation completed without being cancelled.\n   * @api\n   */\n  View.prototype.animate = function animate (var_args) {\n    var arguments$1 = arguments;\n\n    var animationCount = arguments.length;\n    var callback;\n    if (animationCount > 1 && typeof arguments[animationCount - 1] === 'function') {\n      callback = arguments[animationCount - 1];\n      --animationCount;\n    }\n    if (!this.isDef()) {\n      // if view properties are not yet set, shortcut to the final state\n      var state = arguments[animationCount - 1];\n      if (state.center) {\n        this.setCenter(state.center);\n      }\n      if (state.zoom !== undefined) {\n        this.setZoom(state.zoom);\n      }\n      if (state.rotation !== undefined) {\n        this.setRotation(state.rotation);\n      }\n      if (callback) {\n        animationCallback(callback, true);\n      }\n      return;\n    }\n    var start = Date.now();\n    var center = this.getCenter().slice();\n    var resolution = this.getResolution();\n    var rotation = this.getRotation();\n    var series = [];\n    for (var i = 0; i < animationCount; ++i) {\n      var options = /** @type {AnimationOptions} */ (arguments$1[i]);\n\n      var animation = /** @type {Animation} */ ({\n        start: start,\n        complete: false,\n        anchor: options.anchor,\n        duration: options.duration !== undefined ? options.duration : 1000,\n        easing: options.easing || inAndOut\n      });\n\n      if (options.center) {\n        animation.sourceCenter = center;\n        animation.targetCenter = options.center;\n        center = animation.targetCenter;\n      }\n\n      if (options.zoom !== undefined) {\n        animation.sourceResolution = resolution;\n        animation.targetResolution = this.constrainResolution(\n          this.maxResolution_, options.zoom - this.minZoom_, 0);\n        resolution = animation.targetResolution;\n      } else if (options.resolution) {\n        animation.sourceResolution = resolution;\n        animation.targetResolution = options.resolution;\n        resolution = animation.targetResolution;\n      }\n\n      if (options.rotation !== undefined) {\n        animation.sourceRotation = rotation;\n        var delta = modulo(options.rotation - rotation + Math.PI, 2 * Math.PI) - Math.PI;\n        animation.targetRotation = rotation + delta;\n        rotation = animation.targetRotation;\n      }\n\n      animation.callback = callback;\n\n      // check if animation is a no-op\n      if (isNoopAnimation(animation)) {\n        animation.complete = true;\n        // we still push it onto the series for callback handling\n      } else {\n        start += animation.duration;\n      }\n      series.push(animation);\n    }\n    this.animations_.push(series);\n    this.setHint(ViewHint.ANIMATING, 1);\n    this.updateAnimations_();\n  };\n\n  /**\n   * Determine if the view is being animated.\n   * @return {boolean} The view is being animated.\n   * @api\n   */\n  View.prototype.getAnimating = function getAnimating () {\n    return this.hints_[ViewHint.ANIMATING] > 0;\n  };\n\n  /**\n   * Determine if the user is interacting with the view, such as panning or zooming.\n   * @return {boolean} The view is being interacted with.\n   * @api\n   */\n  View.prototype.getInteracting = function getInteracting () {\n    return this.hints_[ViewHint.INTERACTING] > 0;\n  };\n\n  /**\n   * Cancel any ongoing animations.\n   * @api\n   */\n  View.prototype.cancelAnimations = function cancelAnimations () {\n    this.setHint(ViewHint.ANIMATING, -this.hints_[ViewHint.ANIMATING]);\n    for (var i = 0, ii = this.animations_.length; i < ii; ++i) {\n      var series = this.animations_[i];\n      if (series[0].callback) {\n        animationCallback(series[0].callback, false);\n      }\n    }\n    this.animations_.length = 0;\n  };\n\n  /**\n   * Update all animations.\n   */\n  View.prototype.updateAnimations_ = function updateAnimations_ () {\n    if (this.updateAnimationKey_ !== undefined) {\n      cancelAnimationFrame(this.updateAnimationKey_);\n      this.updateAnimationKey_ = undefined;\n    }\n    if (!this.getAnimating()) {\n      return;\n    }\n    var now = Date.now();\n    var more = false;\n    for (var i = this.animations_.length - 1; i >= 0; --i) {\n      var series = this.animations_[i];\n      var seriesComplete = true;\n      for (var j = 0, jj = series.length; j < jj; ++j) {\n        var animation = series[j];\n        if (animation.complete) {\n          continue;\n        }\n        var elapsed = now - animation.start;\n        var fraction = animation.duration > 0 ? elapsed / animation.duration : 1;\n        if (fraction >= 1) {\n          animation.complete = true;\n          fraction = 1;\n        } else {\n          seriesComplete = false;\n        }\n        var progress = animation.easing(fraction);\n        if (animation.sourceCenter) {\n          var x0 = animation.sourceCenter[0];\n          var y0 = animation.sourceCenter[1];\n          var x1 = animation.targetCenter[0];\n          var y1 = animation.targetCenter[1];\n          var x = x0 + progress * (x1 - x0);\n          var y = y0 + progress * (y1 - y0);\n          this.set(ViewProperty.CENTER, [x, y]);\n        }\n        if (animation.sourceResolution && animation.targetResolution) {\n          var resolution = progress === 1 ?\n            animation.targetResolution :\n            animation.sourceResolution + progress * (animation.targetResolution - animation.sourceResolution);\n          if (animation.anchor) {\n            this.set(ViewProperty.CENTER,\n              this.calculateCenterZoom(resolution, animation.anchor));\n          }\n          this.set(ViewProperty.RESOLUTION, resolution);\n        }\n        if (animation.sourceRotation !== undefined && animation.targetRotation !== undefined) {\n          var rotation = progress === 1 ?\n            modulo(animation.targetRotation + Math.PI, 2 * Math.PI) - Math.PI :\n            animation.sourceRotation + progress * (animation.targetRotation - animation.sourceRotation);\n          if (animation.anchor) {\n            this.set(ViewProperty.CENTER,\n              this.calculateCenterRotate(rotation, animation.anchor));\n          }\n          this.set(ViewProperty.ROTATION, rotation);\n        }\n        more = true;\n        if (!animation.complete) {\n          break;\n        }\n      }\n      if (seriesComplete) {\n        this.animations_[i] = null;\n        this.setHint(ViewHint.ANIMATING, -1);\n        var callback = series[0].callback;\n        if (callback) {\n          animationCallback(callback, true);\n        }\n      }\n    }\n    // prune completed series\n    this.animations_ = this.animations_.filter(Boolean);\n    if (more && this.updateAnimationKey_ === undefined) {\n      this.updateAnimationKey_ = requestAnimationFrame(this.updateAnimations_);\n    }\n  };\n\n  /**\n   * @param {number} rotation Target rotation.\n   * @param {import(\"./coordinate.js\").Coordinate} anchor Rotation anchor.\n   * @return {import(\"./coordinate.js\").Coordinate|undefined} Center for rotation and anchor.\n   */\n  View.prototype.calculateCenterRotate = function calculateCenterRotate (rotation, anchor) {\n    var center;\n    var currentCenter = this.getCenter();\n    if (currentCenter !== undefined) {\n      center = [currentCenter[0] - anchor[0], currentCenter[1] - anchor[1]];\n      rotateCoordinate(center, rotation - this.getRotation());\n      addCoordinate(center, anchor);\n    }\n    return center;\n  };\n\n  /**\n   * @param {number} resolution Target resolution.\n   * @param {import(\"./coordinate.js\").Coordinate} anchor Zoom anchor.\n   * @return {import(\"./coordinate.js\").Coordinate|undefined} Center for resolution and anchor.\n   */\n  View.prototype.calculateCenterZoom = function calculateCenterZoom (resolution, anchor) {\n    var center;\n    var currentCenter = this.getCenter();\n    var currentResolution = this.getResolution();\n    if (currentCenter !== undefined && currentResolution !== undefined) {\n      var x = anchor[0] - resolution * (anchor[0] - currentCenter[0]) / currentResolution;\n      var y = anchor[1] - resolution * (anchor[1] - currentCenter[1]) / currentResolution;\n      center = [x, y];\n    }\n    return center;\n  };\n\n  /**\n   * @private\n   * @return {import(\"./size.js\").Size} Viewport size or `[100, 100]` when no viewport is found.\n   */\n  View.prototype.getSizeFromViewport_ = function getSizeFromViewport_ () {\n    var size = [100, 100];\n    var selector = '.ol-viewport[data-view=\"' + getUid(this) + '\"]';\n    var element = document.querySelector(selector);\n    if (element) {\n      var metrics = getComputedStyle(element);\n      size[0] = parseInt(metrics.width, 10);\n      size[1] = parseInt(metrics.height, 10);\n    }\n    return size;\n  };\n\n  /**\n   * Get the constrained center of this view.\n   * @param {import(\"./coordinate.js\").Coordinate|undefined} center Center.\n   * @return {import(\"./coordinate.js\").Coordinate|undefined} Constrained center.\n   * @api\n   */\n  View.prototype.constrainCenter = function constrainCenter (center) {\n    return this.constraints_.center(center);\n  };\n\n  /**\n   * Get the constrained resolution of this view.\n   * @param {number|undefined} resolution Resolution.\n   * @param {number=} opt_delta Delta. Default is `0`.\n   * @param {number=} opt_direction Direction. Default is `0`.\n   * @return {number|undefined} Constrained resolution.\n   * @api\n   */\n  View.prototype.constrainResolution = function constrainResolution (resolution, opt_delta, opt_direction) {\n    var delta = opt_delta || 0;\n    var direction = opt_direction || 0;\n    return this.constraints_.resolution(resolution, delta, direction);\n  };\n\n  /**\n   * Get the constrained rotation of this view.\n   * @param {number|undefined} rotation Rotation.\n   * @param {number=} opt_delta Delta. Default is `0`.\n   * @return {number|undefined} Constrained rotation.\n   * @api\n   */\n  View.prototype.constrainRotation = function constrainRotation (rotation, opt_delta) {\n    var delta = opt_delta || 0;\n    return this.constraints_.rotation(rotation, delta);\n  };\n\n  /**\n   * Get the view center.\n   * @return {import(\"./coordinate.js\").Coordinate|undefined} The center of the view.\n   * @observable\n   * @api\n   */\n  View.prototype.getCenter = function getCenter () {\n    return (\n      /** @type {import(\"./coordinate.js\").Coordinate|undefined} */ (this.get(ViewProperty.CENTER))\n    );\n  };\n\n  /**\n   * @return {Constraints} Constraints.\n   */\n  View.prototype.getConstraints = function getConstraints () {\n    return this.constraints_;\n  };\n\n  /**\n   * @param {Array<number>=} opt_hints Destination array.\n   * @return {Array<number>} Hint.\n   */\n  View.prototype.getHints = function getHints (opt_hints) {\n    if (opt_hints !== undefined) {\n      opt_hints[0] = this.hints_[0];\n      opt_hints[1] = this.hints_[1];\n      return opt_hints;\n    } else {\n      return this.hints_.slice();\n    }\n  };\n\n  /**\n   * Calculate the extent for the current view state and the passed size.\n   * The size is the pixel dimensions of the box into which the calculated extent\n   * should fit. In most cases you want to get the extent of the entire map,\n   * that is `map.getSize()`.\n   * @param {import(\"./size.js\").Size=} opt_size Box pixel size. If not provided, the size of the\n   * first map that uses this view will be used.\n   * @return {import(\"./extent.js\").Extent} Extent.\n   * @api\n   */\n  View.prototype.calculateExtent = function calculateExtent (opt_size) {\n    var size = opt_size || this.getSizeFromViewport_();\n    var center = /** @type {!import(\"./coordinate.js\").Coordinate} */ (this.getCenter());\n    assert(center, 1); // The view center is not defined\n    var resolution = /** @type {!number} */ (this.getResolution());\n    assert(resolution !== undefined, 2); // The view resolution is not defined\n    var rotation = /** @type {!number} */ (this.getRotation());\n    assert(rotation !== undefined, 3); // The view rotation is not defined\n\n    return getForViewAndSize(center, resolution, rotation, size);\n  };\n\n  /**\n   * Get the maximum resolution of the view.\n   * @return {number} The maximum resolution of the view.\n   * @api\n   */\n  View.prototype.getMaxResolution = function getMaxResolution () {\n    return this.maxResolution_;\n  };\n\n  /**\n   * Get the minimum resolution of the view.\n   * @return {number} The minimum resolution of the view.\n   * @api\n   */\n  View.prototype.getMinResolution = function getMinResolution () {\n    return this.minResolution_;\n  };\n\n  /**\n   * Get the maximum zoom level for the view.\n   * @return {number} The maximum zoom level.\n   * @api\n   */\n  View.prototype.getMaxZoom = function getMaxZoom () {\n    return /** @type {number} */ (this.getZoomForResolution(this.minResolution_));\n  };\n\n  /**\n   * Set a new maximum zoom level for the view.\n   * @param {number} zoom The maximum zoom level.\n   * @api\n   */\n  View.prototype.setMaxZoom = function setMaxZoom (zoom) {\n    this.applyOptions_(this.getUpdatedOptions_({maxZoom: zoom}));\n  };\n\n  /**\n   * Get the minimum zoom level for the view.\n   * @return {number} The minimum zoom level.\n   * @api\n   */\n  View.prototype.getMinZoom = function getMinZoom () {\n    return /** @type {number} */ (this.getZoomForResolution(this.maxResolution_));\n  };\n\n  /**\n   * Set a new minimum zoom level for the view.\n   * @param {number} zoom The minimum zoom level.\n   * @api\n   */\n  View.prototype.setMinZoom = function setMinZoom (zoom) {\n    this.applyOptions_(this.getUpdatedOptions_({minZoom: zoom}));\n  };\n\n  /**\n   * Get the view projection.\n   * @return {import(\"./proj/Projection.js\").default} The projection of the view.\n   * @api\n   */\n  View.prototype.getProjection = function getProjection () {\n    return this.projection_;\n  };\n\n  /**\n   * Get the view resolution.\n   * @return {number|undefined} The resolution of the view.\n   * @observable\n   * @api\n   */\n  View.prototype.getResolution = function getResolution () {\n    return /** @type {number|undefined} */ (this.get(ViewProperty.RESOLUTION));\n  };\n\n  /**\n   * Get the resolutions for the view. This returns the array of resolutions\n   * passed to the constructor of the View, or undefined if none were given.\n   * @return {Array<number>|undefined} The resolutions of the view.\n   * @api\n   */\n  View.prototype.getResolutions = function getResolutions () {\n    return this.resolutions_;\n  };\n\n  /**\n   * Get the resolution for a provided extent (in map units) and size (in pixels).\n   * @param {import(\"./extent.js\").Extent} extent Extent.\n   * @param {import(\"./size.js\").Size=} opt_size Box pixel size.\n   * @return {number} The resolution at which the provided extent will render at\n   *     the given size.\n   * @api\n   */\n  View.prototype.getResolutionForExtent = function getResolutionForExtent (extent, opt_size) {\n    var size = opt_size || this.getSizeFromViewport_();\n    var xResolution = getWidth(extent) / size[0];\n    var yResolution = getHeight(extent) / size[1];\n    return Math.max(xResolution, yResolution);\n  };\n\n  /**\n   * Return a function that returns a value between 0 and 1 for a\n   * resolution. Exponential scaling is assumed.\n   * @param {number=} opt_power Power.\n   * @return {function(number): number} Resolution for value function.\n   */\n  View.prototype.getResolutionForValueFunction = function getResolutionForValueFunction (opt_power) {\n    var power = opt_power || 2;\n    var maxResolution = this.maxResolution_;\n    var minResolution = this.minResolution_;\n    var max = Math.log(maxResolution / minResolution) / Math.log(power);\n    return (\n      /**\n       * @param {number} value Value.\n       * @return {number} Resolution.\n       */\n      function(value) {\n        var resolution = maxResolution / Math.pow(power, value * max);\n        return resolution;\n      });\n  };\n\n  /**\n   * Get the view rotation.\n   * @return {number} The rotation of the view in radians.\n   * @observable\n   * @api\n   */\n  View.prototype.getRotation = function getRotation () {\n    return /** @type {number} */ (this.get(ViewProperty.ROTATION));\n  };\n\n  /**\n   * Return a function that returns a resolution for a value between\n   * 0 and 1. Exponential scaling is assumed.\n   * @param {number=} opt_power Power.\n   * @return {function(number): number} Value for resolution function.\n   */\n  View.prototype.getValueForResolutionFunction = function getValueForResolutionFunction (opt_power) {\n    var power = opt_power || 2;\n    var maxResolution = this.maxResolution_;\n    var minResolution = this.minResolution_;\n    var max = Math.log(maxResolution / minResolution) / Math.log(power);\n    return (\n      /**\n       * @param {number} resolution Resolution.\n       * @return {number} Value.\n       */\n      function(resolution) {\n        var value = (Math.log(maxResolution / resolution) / Math.log(power)) / max;\n        return value;\n      });\n  };\n\n  /**\n   * @param {number} pixelRatio Pixel ratio for center rounding.\n   * @return {State} View state.\n   */\n  View.prototype.getState = function getState (pixelRatio) {\n    var center = /** @type {import(\"./coordinate.js\").Coordinate} */ (this.getCenter());\n    var projection = this.getProjection();\n    var resolution = /** @type {number} */ (this.getResolution());\n    var pixelResolution = resolution / pixelRatio;\n    var rotation = this.getRotation();\n    return (\n      /** @type {State} */ ({\n        center: [\n          Math.round(center[0] / pixelResolution) * pixelResolution,\n          Math.round(center[1] / pixelResolution) * pixelResolution\n        ],\n        projection: projection !== undefined ? projection : null,\n        resolution: resolution,\n        rotation: rotation,\n        zoom: this.getZoom()\n      })\n    );\n  };\n\n  /**\n   * Get the current zoom level.  If you configured your view with a resolutions\n   * array (this is rare), this method may return non-integer zoom levels (so\n   * the zoom level is not safe to use as an index into a resolutions array).\n   * @return {number|undefined} Zoom.\n   * @api\n   */\n  View.prototype.getZoom = function getZoom () {\n    var zoom;\n    var resolution = this.getResolution();\n    if (resolution !== undefined) {\n      zoom = this.getZoomForResolution(resolution);\n    }\n    return zoom;\n  };\n\n  /**\n   * Get the zoom level for a resolution.\n   * @param {number} resolution The resolution.\n   * @return {number|undefined} The zoom level for the provided resolution.\n   * @api\n   */\n  View.prototype.getZoomForResolution = function getZoomForResolution (resolution) {\n    var offset = this.minZoom_ || 0;\n    var max, zoomFactor;\n    if (this.resolutions_) {\n      var nearest = linearFindNearest(this.resolutions_, resolution, 1);\n      offset = nearest;\n      max = this.resolutions_[nearest];\n      if (nearest == this.resolutions_.length - 1) {\n        zoomFactor = 2;\n      } else {\n        zoomFactor = max / this.resolutions_[nearest + 1];\n      }\n    } else {\n      max = this.maxResolution_;\n      zoomFactor = this.zoomFactor_;\n    }\n    return offset + Math.log(max / resolution) / Math.log(zoomFactor);\n  };\n\n  /**\n   * Get the resolution for a zoom level.\n   * @param {number} zoom Zoom level.\n   * @return {number} The view resolution for the provided zoom level.\n   * @api\n   */\n  View.prototype.getResolutionForZoom = function getResolutionForZoom (zoom) {\n    return /** @type {number} */ (this.constrainResolution(\n      this.maxResolution_, zoom - this.minZoom_, 0));\n  };\n\n  /**\n   * Fit the given geometry or extent based on the given map size and border.\n   * The size is pixel dimensions of the box to fit the extent into.\n   * In most cases you will want to use the map size, that is `map.getSize()`.\n   * Takes care of the map angle.\n   * @param {import(\"./geom/SimpleGeometry.js\").default|import(\"./extent.js\").Extent} geometryOrExtent The geometry or\n   *     extent to fit the view to.\n   * @param {FitOptions=} opt_options Options.\n   * @api\n   */\n  View.prototype.fit = function fit (geometryOrExtent, opt_options) {\n    var options = opt_options || {};\n    var size = options.size;\n    if (!size) {\n      size = this.getSizeFromViewport_();\n    }\n    /** @type {import(\"./geom/SimpleGeometry.js\").default} */\n    var geometry;\n    assert(Array.isArray(geometryOrExtent) || typeof /** @type {?} */ (geometryOrExtent).getSimplifiedGeometry === 'function',\n      24); // Invalid extent or geometry provided as `geometry`\n    if (Array.isArray(geometryOrExtent)) {\n      assert(!isEmpty(geometryOrExtent),\n        25); // Cannot fit empty extent provided as `geometry`\n      geometry = polygonFromExtent(geometryOrExtent);\n    } else if (geometryOrExtent.getType() === GeometryType.CIRCLE) {\n      geometryOrExtent = geometryOrExtent.getExtent();\n      geometry = polygonFromExtent(geometryOrExtent);\n      geometry.rotate(this.getRotation(), getCenter(geometryOrExtent));\n    } else {\n      geometry = geometryOrExtent;\n    }\n\n    var padding = options.padding !== undefined ? options.padding : [0, 0, 0, 0];\n    var constrainResolution = options.constrainResolution !== undefined ?\n      options.constrainResolution : true;\n    var nearest = options.nearest !== undefined ? options.nearest : false;\n    var minResolution;\n    if (options.minResolution !== undefined) {\n      minResolution = options.minResolution;\n    } else if (options.maxZoom !== undefined) {\n      minResolution = this.constrainResolution(\n        this.maxResolution_, options.maxZoom - this.minZoom_, 0);\n    } else {\n      minResolution = 0;\n    }\n    var coords = geometry.getFlatCoordinates();\n\n    // calculate rotated extent\n    var rotation = this.getRotation();\n    var cosAngle = Math.cos(-rotation);\n    var sinAngle = Math.sin(-rotation);\n    var minRotX = +Infinity;\n    var minRotY = +Infinity;\n    var maxRotX = -Infinity;\n    var maxRotY = -Infinity;\n    var stride = geometry.getStride();\n    for (var i = 0, ii = coords.length; i < ii; i += stride) {\n      var rotX = coords[i] * cosAngle - coords[i + 1] * sinAngle;\n      var rotY = coords[i] * sinAngle + coords[i + 1] * cosAngle;\n      minRotX = Math.min(minRotX, rotX);\n      minRotY = Math.min(minRotY, rotY);\n      maxRotX = Math.max(maxRotX, rotX);\n      maxRotY = Math.max(maxRotY, rotY);\n    }\n\n    // calculate resolution\n    var resolution = this.getResolutionForExtent(\n      [minRotX, minRotY, maxRotX, maxRotY],\n      [size[0] - padding[1] - padding[3], size[1] - padding[0] - padding[2]]);\n    resolution = isNaN(resolution) ? minResolution :\n      Math.max(resolution, minResolution);\n    if (constrainResolution) {\n      var constrainedResolution = this.constrainResolution(resolution, 0, 0);\n      if (!nearest && constrainedResolution < resolution) {\n        constrainedResolution = this.constrainResolution(\n          constrainedResolution, -1, 0);\n      }\n      resolution = constrainedResolution;\n    }\n\n    // calculate center\n    sinAngle = -sinAngle; // go back to original rotation\n    var centerRotX = (minRotX + maxRotX) / 2;\n    var centerRotY = (minRotY + maxRotY) / 2;\n    centerRotX += (padding[1] - padding[3]) / 2 * resolution;\n    centerRotY += (padding[0] - padding[2]) / 2 * resolution;\n    var centerX = centerRotX * cosAngle - centerRotY * sinAngle;\n    var centerY = centerRotY * cosAngle + centerRotX * sinAngle;\n    var center = [centerX, centerY];\n    var callback = options.callback ? options.callback : VOID;\n\n    if (options.duration !== undefined) {\n      this.animate({\n        resolution: resolution,\n        center: center,\n        duration: options.duration,\n        easing: options.easing\n      }, callback);\n    } else {\n      this.setResolution(resolution);\n      this.setCenter(center);\n      animationCallback(callback, true);\n    }\n  };\n\n  /**\n   * Center on coordinate and view position.\n   * @param {import(\"./coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"./size.js\").Size} size Box pixel size.\n   * @param {import(\"./pixel.js\").Pixel} position Position on the view to center on.\n   * @api\n   */\n  View.prototype.centerOn = function centerOn (coordinate, size, position) {\n    // calculate rotated position\n    var rotation = this.getRotation();\n    var cosAngle = Math.cos(-rotation);\n    var sinAngle = Math.sin(-rotation);\n    var rotX = coordinate[0] * cosAngle - coordinate[1] * sinAngle;\n    var rotY = coordinate[1] * cosAngle + coordinate[0] * sinAngle;\n    var resolution = this.getResolution();\n    rotX += (size[0] / 2 - position[0]) * resolution;\n    rotY += (position[1] - size[1] / 2) * resolution;\n\n    // go back to original angle\n    sinAngle = -sinAngle; // go back to original rotation\n    var centerX = rotX * cosAngle - rotY * sinAngle;\n    var centerY = rotY * cosAngle + rotX * sinAngle;\n\n    this.setCenter([centerX, centerY]);\n  };\n\n  /**\n   * @return {boolean} Is defined.\n   */\n  View.prototype.isDef = function isDef () {\n    return !!this.getCenter() && this.getResolution() !== undefined;\n  };\n\n  /**\n   * Rotate the view around a given coordinate.\n   * @param {number} rotation New rotation value for the view.\n   * @param {import(\"./coordinate.js\").Coordinate=} opt_anchor The rotation center.\n   * @api\n   */\n  View.prototype.rotate = function rotate (rotation, opt_anchor) {\n    if (opt_anchor !== undefined) {\n      var center = this.calculateCenterRotate(rotation, opt_anchor);\n      this.setCenter(center);\n    }\n    this.setRotation(rotation);\n  };\n\n  /**\n   * Set the center of the current view.\n   * @param {import(\"./coordinate.js\").Coordinate|undefined} center The center of the view.\n   * @observable\n   * @api\n   */\n  View.prototype.setCenter = function setCenter (center) {\n    this.set(ViewProperty.CENTER, center);\n    if (this.getAnimating()) {\n      this.cancelAnimations();\n    }\n  };\n\n  /**\n   * @param {ViewHint} hint Hint.\n   * @param {number} delta Delta.\n   * @return {number} New value.\n   */\n  View.prototype.setHint = function setHint (hint, delta) {\n    this.hints_[hint] += delta;\n    this.changed();\n    return this.hints_[hint];\n  };\n\n  /**\n   * Set the resolution for this view.\n   * @param {number|undefined} resolution The resolution of the view.\n   * @observable\n   * @api\n   */\n  View.prototype.setResolution = function setResolution (resolution) {\n    this.set(ViewProperty.RESOLUTION, resolution);\n    if (this.getAnimating()) {\n      this.cancelAnimations();\n    }\n  };\n\n  /**\n   * Set the rotation for this view.\n   * @param {number} rotation The rotation of the view in radians.\n   * @observable\n   * @api\n   */\n  View.prototype.setRotation = function setRotation (rotation) {\n    this.set(ViewProperty.ROTATION, rotation);\n    if (this.getAnimating()) {\n      this.cancelAnimations();\n    }\n  };\n\n  /**\n   * Zoom to a specific zoom level.\n   * @param {number} zoom Zoom level.\n   * @api\n   */\n  View.prototype.setZoom = function setZoom (zoom) {\n    this.setResolution(this.getResolutionForZoom(zoom));\n  };\n\n  return View;\n}(BaseObject));\n\n\n/**\n * @param {Function} callback Callback.\n * @param {*} returnValue Return value.\n */\nfunction animationCallback(callback, returnValue) {\n  setTimeout(function() {\n    callback(returnValue);\n  }, 0);\n}\n\n\n/**\n * @param {ViewOptions} options View options.\n * @return {import(\"./centerconstraint.js\").Type} The constraint.\n */\nexport function createCenterConstraint(options) {\n  if (options.extent !== undefined) {\n    return createExtent(options.extent);\n  } else {\n    return centerNone;\n  }\n}\n\n\n/**\n * @param {ViewOptions} options View options.\n * @return {{constraint: import(\"./resolutionconstraint.js\").Type, maxResolution: number,\n *     minResolution: number, minZoom: number, zoomFactor: number}} The constraint.\n */\nexport function createResolutionConstraint(options) {\n  var resolutionConstraint;\n  var maxResolution;\n  var minResolution;\n\n  // TODO: move these to be ol constants\n  // see https://github.com/openlayers/openlayers/issues/2076\n  var defaultMaxZoom = 28;\n  var defaultZoomFactor = 2;\n\n  var minZoom = options.minZoom !== undefined ?\n    options.minZoom : DEFAULT_MIN_ZOOM;\n\n  var maxZoom = options.maxZoom !== undefined ?\n    options.maxZoom : defaultMaxZoom;\n\n  var zoomFactor = options.zoomFactor !== undefined ?\n    options.zoomFactor : defaultZoomFactor;\n\n  if (options.resolutions !== undefined) {\n    var resolutions = options.resolutions;\n    maxResolution = resolutions[minZoom];\n    minResolution = resolutions[maxZoom] !== undefined ?\n      resolutions[maxZoom] : resolutions[resolutions.length - 1];\n    resolutionConstraint = createSnapToResolutions(\n      resolutions);\n  } else {\n    // calculate the default min and max resolution\n    var projection = createProjection(options.projection, 'EPSG:3857');\n    var extent = projection.getExtent();\n    var size = !extent ?\n      // use an extent that can fit the whole world if need be\n      360 * METERS_PER_UNIT[Units.DEGREES] /\n            projection.getMetersPerUnit() :\n      Math.max(getWidth(extent), getHeight(extent));\n\n    var defaultMaxResolution = size / DEFAULT_TILE_SIZE / Math.pow(\n      defaultZoomFactor, DEFAULT_MIN_ZOOM);\n\n    var defaultMinResolution = defaultMaxResolution / Math.pow(\n      defaultZoomFactor, defaultMaxZoom - DEFAULT_MIN_ZOOM);\n\n    // user provided maxResolution takes precedence\n    maxResolution = options.maxResolution;\n    if (maxResolution !== undefined) {\n      minZoom = 0;\n    } else {\n      maxResolution = defaultMaxResolution / Math.pow(zoomFactor, minZoom);\n    }\n\n    // user provided minResolution takes precedence\n    minResolution = options.minResolution;\n    if (minResolution === undefined) {\n      if (options.maxZoom !== undefined) {\n        if (options.maxResolution !== undefined) {\n          minResolution = maxResolution / Math.pow(zoomFactor, maxZoom);\n        } else {\n          minResolution = defaultMaxResolution / Math.pow(zoomFactor, maxZoom);\n        }\n      } else {\n        minResolution = defaultMinResolution;\n      }\n    }\n\n    // given discrete zoom levels, minResolution may be different than provided\n    maxZoom = minZoom + Math.floor(\n      Math.log(maxResolution / minResolution) / Math.log(zoomFactor));\n    minResolution = maxResolution / Math.pow(zoomFactor, maxZoom - minZoom);\n\n    resolutionConstraint = createSnapToPower(\n      zoomFactor, maxResolution, maxZoom - minZoom);\n  }\n  return {constraint: resolutionConstraint, maxResolution: maxResolution,\n    minResolution: minResolution, minZoom: minZoom, zoomFactor: zoomFactor};\n}\n\n\n/**\n * @param {ViewOptions} options View options.\n * @return {import(\"./rotationconstraint.js\").Type} Rotation constraint.\n */\nexport function createRotationConstraint(options) {\n  var enableRotation = options.enableRotation !== undefined ?\n    options.enableRotation : true;\n  if (enableRotation) {\n    var constrainRotation = options.constrainRotation;\n    if (constrainRotation === undefined || constrainRotation === true) {\n      return createSnapToZero();\n    } else if (constrainRotation === false) {\n      return rotationNone;\n    } else if (typeof constrainRotation === 'number') {\n      return createSnapToN(constrainRotation);\n    } else {\n      return rotationNone;\n    }\n  } else {\n    return disable;\n  }\n}\n\n\n/**\n * Determine if an animation involves no view change.\n * @param {Animation} animation The animation.\n * @return {boolean} The animation involves no view change.\n */\nexport function isNoopAnimation(animation) {\n  if (animation.sourceCenter && animation.targetCenter) {\n    if (!coordinatesEqual(animation.sourceCenter, animation.targetCenter)) {\n      return false;\n    }\n  }\n  if (animation.sourceResolution !== animation.targetResolution) {\n    return false;\n  }\n  if (animation.sourceRotation !== animation.targetRotation) {\n    return false;\n  }\n  return true;\n}\n\nexport default View;\n\n//# sourceMappingURL=View.js.map","/**\n * @module ol/TileState\n */\n\n/**\n * @enum {number}\n */\nexport default {\n  IDLE: 0,\n  LOADING: 1,\n  LOADED: 2,\n  /**\n   * Indicates that tile loading failed\n   * @type {number}\n   */\n  ERROR: 3,\n  EMPTY: 4,\n  ABORT: 5\n};\n\n//# sourceMappingURL=TileState.js.map","/** @namespace  ol.ext\r\n */\r\n/*global ol*/\r\nif (window.ol && !ol.ext) {\r\n  ol.ext = {};\r\n}\r\n\r\n/** Inherit the prototype methods from one constructor into another.\r\n * replace deprecated ol method\r\n *\r\n * @param {!Function} childCtor Child constructor.\r\n * @param {!Function} parentCtor Parent constructor.\r\n * @function module:ol.inherits\r\n * @api\r\n */\r\nvar ol_ext_inherits = function(child,parent) {\r\n  child.prototype = Object.create(parent.prototype);\r\n  child.prototype.constructor = child;\r\n};\r\n\r\n// Compatibilty with ol > 5 to be removed when v6 is out\r\nif (window.ol) {\r\n  if (!ol.inherits) ol.inherits = ol_ext_inherits;\r\n}\r\n\r\n/* IE Polyfill */\r\n// NodeList.forEach\r\nif (window.NodeList && !NodeList.prototype.forEach) {\r\n  NodeList.prototype.forEach = Array.prototype.forEach;\r\n}\r\n// Element.remove\r\nif (window.Element && !Element.prototype.remove) {\r\n  Element.prototype.remove = function() {\r\n    if (this.parentNode) this.parentNode.removeChild(this);\r\n  }\r\n}\r\n/* End Polyfill */\r\n\r\nexport {ol_ext_inherits}\r\nexport default ol_ext_inherits\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from './Button'\r\n\r\n/** A simple toggle control\r\n * The control can be created with an interaction to control its activation.\r\n *\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @fires change:active, change:disable\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {ol.interaction} options.interaction interaction associated with the control\r\n *  @param {bool} options.active the control is created active, default false\r\n *  @param {bool} options.disable the control is created disabled, default false\r\n *  @param {ol.control.Bar} options.bar a subbar associated with the control (drawn when active if control is nested in a ol.control.Bar)\r\n *  @param {bool} options.autoActive the control will activate when shown in an ol.control.Bar, default false\r\n *  @param {function} options.onToggle callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Toggle = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n\r\n  this.interaction_ = options.interaction;\r\n  if (this.interaction_) {\r\n    this.interaction_.setActive(options.active);\r\n    this.interaction_.on(\"change:active\", function() {\r\n      self.setActive(self.interaction_.getActive());\r\n    });\r\n  }\r\n\r\n  if (options.toggleFn) options.onToggle = options.toggleFn; // compat old version\r\n  options.handleClick = function() {\r\n    self.toggle();\r\n    if (options.onToggle) options.onToggle.call(self, self.getActive());\r\n  };\r\n  options.className = (options.className||\"\") + \" ol-toggle\";\r\n  ol_control_Button.call(this, options);\r\n\r\n  this.set(\"title\", options.title);\r\n\r\n  this.set (\"autoActivate\", options.autoActivate);\r\n  if (options.bar) this.setSubBar(options.bar);\r\n\r\n  this.setActive (options.active);\r\n  this.setDisable (options.disable);\r\n};\r\nol_ext_inherits(ol_control_Toggle, ol_control_Button);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add interaction attached to it to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_Toggle.prototype.setMap = function(map) {\r\n  if (!map && this.getMap()) {\r\n    if (this.interaction_) {\r\n      this.getMap().removeInteraction (this.interaction_);\r\n    }\r\n    if (this.subbar_) this.getMap().removeControl (this.subbar_);\r\n  }\r\n\r\n  ol_control_Button.prototype.setMap.call(this, map);\r\n\r\n  if (map) {\r\n    if (this.interaction_) map.addInteraction (this.interaction_);\r\n    if (this.subbar_) map.addControl (this.subbar_);\r\n  }\r\n};\r\n\r\n/** Get the subbar associated with a control\r\n * @return {ol_control_Bar}\r\n */\r\nol_control_Toggle.prototype.getSubBar = function () {\r\n  return this.subbar_;\r\n};\r\n\r\n/** Set the subbar associated with a control\r\n * @param {ol_control_Bar} bar a subbar\r\n */\r\nol_control_Toggle.prototype.setSubBar = function (bar) {\r\n  var map = this.getMap();\r\n  if (map && this.subbar_) map.removeControl (this.subbar_);\r\n  this.subbar_ = bar;\r\n  this.subbar_.setTarget(this.element);\r\n  this.subbar_.element.classList.add(\"ol-option-bar\");\r\n  if (map) map.addControl (this.subbar_);\r\n};\r\n\r\n/**\r\n * Test if the control is disabled.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getDisable = function() {\r\n  var button = this.element.querySelector(\"button\");\r\n  return button && button.disabled;\r\n};\r\n\r\n/** Disable the control. If disable, the control will be deactivated too.\r\n* @param {bool} b disable (or enable) the control, default false (enable)\r\n*/\r\nol_control_Toggle.prototype.setDisable = function(b) {\r\n  if (this.getDisable()==b) return;\r\n  this.element.querySelector(\"button\").disabled = b;\r\n  if (b && this.getActive()) this.setActive(false);\r\n\r\n  this.dispatchEvent({ type:'change:disable', key:'disable', oldValue:!b, disable:b });\r\n};\r\n\r\n/**\r\n * Test if the control is active.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getActive = function() {\r\n  return this.element.classList.contains(\"ol-active\");\r\n};\r\n\r\n/** Toggle control state active/deactive\r\n */\r\nol_control_Toggle.prototype.toggle = function() {\r\n  if (this.getActive()) this.setActive(false);\r\n  else this.setActive(true);\r\n};\r\n\r\n/** Change control state\r\n * @param {bool} b activate or deactivate the control, default false\r\n */\r\nol_control_Toggle.prototype.setActive = function(b) {\t\r\n  if (this.interaction_) this.interaction_.setActive (b);\r\n  if (this.subbar_) this.subbar_.setActive(b);\r\n  if (this.getActive()===b) return;\r\n  if (b) this.element.classList.add(\"ol-active\");\r\n  else this.element.classList.remove(\"ol-active\");\r\n\r\n  this.dispatchEvent({ type:'change:active', key:'active', oldValue:!b, active:b });\r\n};\r\n\r\n/** Set the control interaction\r\n* @param {_ol_interaction_} i interaction to associate with the control\r\n*/\r\nol_control_Toggle.prototype.setInteraction = function(i) {\r\n  this.interaction_ = i;\r\n};\r\n\r\n/** Get the control interaction\r\n* @return {_ol_interaction_} interaction associated with the control\r\n*/\r\nol_control_Toggle.prototype.getInteraction = function() {\r\n  return this.interaction_;\r\n};\r\n\r\nexport default ol_control_Toggle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from \"./Button\";\r\n\r\n/** A simple push button control drawn as text\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.title title of the control\r\n *\t@param {String} options.html html to insert in the control\r\n *\t@param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\n\r\nvar ol_control_TextButton = function(options)\r\n{\toptions = options || {};\r\n    options.className = (options.className||\"\") + \" ol-text-button\";\r\n    ol_control_Button.call(this, options);\r\n};\r\nol_ext_inherits(ol_control_TextButton, ol_control_Button);\r\n\r\nexport default ol_control_TextButton\r\n","/*\tCopyright (c) 2018 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\n\r\n/** A Select interaction to delete features on click.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires deletestart\r\n * @fires deleteend\r\n * @param {*} options ol.interaction.Select options\r\n */\r\nvar ol_interaction_Delete = function(options) {\r\n  ol_interaction_Select.call(this, options);\r\n  this.on('select', function(e) {\r\n    this.getFeatures().clear();\r\n    this.delete(e.selected);\r\n  }.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_Delete, ol_interaction_Select);\r\n\r\n/** Get vector source of the map\r\n * @return {Array<ol.source.Vector>}\r\n */\r\nol_interaction_Delete.prototype._getSources = function(layers) {\r\n  if (!this.getMap()) return [];\r\n  if (!layers) layers = this.getMap().getLayers();\r\n  var sources = [];\r\n  layers.forEach(function (l) {\r\n    // LayerGroup\r\n    if (l.getLayers) {\r\n      sources = sources.concat(this._getSources(l.getLayers()));\r\n    } else {\r\n      if (l.getSource && l.getSource() instanceof ol_source_Vector) {\r\n        sources.push(l.getSource());\r\n      }\r\n    }\r\n  }.bind(this));\r\n  return sources;\r\n};\r\n\r\n/** Delete features: remove the features from the map (from all layers in the map)\r\n * @param {ol.Collection<ol.Feature>|Array<ol.Feature>} features The features to delete\r\n * @api\r\n */\r\nol_interaction_Delete.prototype.delete = function(features) {\r\n  if (features && (features.length || features.getLength())) {\r\n    this.dispatchEvent({ type: 'deletestart', features: features });\r\n    var delFeatures = [];\r\n    // Get the sources concerned\r\n    this._getSources().forEach(function (source) {\r\n      try {\r\n        // Try to delete features in the source\r\n        features.forEach(function(f) {\r\n          source.removeFeature(f);\r\n          delFeatures.push(f);\r\n        });\r\n      } catch(e) { /* ok */ }\r\n    })\r\n    this.dispatchEvent({ type: 'deleteend', features: delFeatures });\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Delete","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n\r\n  Usefull function to handle geometric operations\r\n*/\r\n\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_geom_MultiLineString from 'ol/geom/MultiLineString'\r\nimport ol_geom_MultiPoint from 'ol/geom/MultiPoint'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\n\r\n/** Distance beetween 2 points\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {number} distance\r\n */\r\nvar ol_coordinate_dist2d = function(p1, p2) {\r\n  var dx = p1[0]-p2[0];\r\n  var dy = p1[1]-p2[1];\r\n  return Math.sqrt(dx*dx+dy*dy);\r\n}\r\n\r\n/** 2 points are equal\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {boolean}\r\n */\r\nvar ol_coordinate_equal = function(p1, p2) {\r\n  return (p1[0]==p2[0] && p1[1]==p2[1]);\r\n}\r\n\r\n/** Get center coordinate of a feature\r\n * @param {ol.Feature} f\r\n * @return {ol.coordinate} the center\r\n */\r\nvar ol_coordinate_getFeatureCenter = function(f) {\r\n  return ol_coordinate_getGeomCenter (f.getGeometry());\r\n};\r\n\r\n/** Get center coordinate of a geometry\r\n* @param {ol.Feature} geom\r\n* @return {ol.Coordinate} the center\r\n*/\r\nvar ol_coordinate_getGeomCenter = function(geom) {\r\n  switch (geom.getType()) {\r\n    case 'Point': \r\n      return geom.getCoordinates();\r\n    case \"MultiPolygon\":\r\n      geom = geom.getPolygon(0);\r\n      // fallthrough\r\n    case \"Polygon\":\r\n      return geom.getInteriorPoint().getCoordinates();\r\n    default:\r\n      return geom.getClosestPoint(ol_extent_getCenter(geom.getExtent()));\r\n  }\r\n};\r\n\r\n/** Offset a polyline\r\n * @param {Array<ol.Coordinate>} coords\r\n * @param {number} offset\r\n * @return {Array<ol.Coordinate>} resulting coord\r\n * @see http://stackoverflow.com/a/11970006/796832\r\n * @see https://drive.google.com/viewerng/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxqa2dhZGdldHN0b3JlfGd4OjQ4MzI5M2Y0MjNmNzI2MjY\r\n */\r\nvar ol_coordinate_offsetCoords = function (coords, offset) {\r\n  var path = [];\r\n  var N = coords.length-1;\r\n  var max = N;\r\n  var mi, mi1, li, li1, ri, ri1, si, si1, Xi1, Yi1;\r\n  var p0, p1, p2;\r\n  var isClosed = ol_coordinate_equal(coords[0],coords[N]);\r\n  if (!isClosed) {\r\n    p0 = coords[0];\r\n    p1 = coords[1];\r\n    p2 = [\r\n      p0[0] + (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] - (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n    coords.push(coords[N])\r\n    N++;\r\n    max--;\r\n  }\r\n  for (var i = 0; i < max; i++) {\r\n    p0 = coords[i];\r\n    p1 = coords[(i+1) % N];\r\n    p2 = coords[(i+2) % N];\r\n\r\n    mi = (p1[1] - p0[1])/(p1[0] - p0[0]);\r\n    mi1 = (p2[1] - p1[1])/(p2[0] - p1[0]);\r\n    // Prevent alignements\r\n    if (Math.abs(mi-mi1) > 1e-10) {\r\n      li = Math.sqrt((p1[0] - p0[0])*(p1[0] - p0[0])+(p1[1] - p0[1])*(p1[1] - p0[1]));\r\n      li1 = Math.sqrt((p2[0] - p1[0])*(p2[0] - p1[0])+(p2[1] - p1[1])*(p2[1] - p1[1]));\r\n      ri = p0[0] + offset*(p1[1] - p0[1])/li;\r\n      ri1 = p1[0] + offset*(p2[1] - p1[1])/li1;\r\n      si = p0[1] - offset*(p1[0] - p0[0])/li;\r\n      si1 = p1[1] - offset*(p2[0] - p1[0])/li1;\r\n      Xi1 = (mi1*ri1-mi*ri+si-si1) / (mi1-mi);\r\n      Yi1 = (mi*mi1*(ri1-ri)+mi1*si-mi*si1) / (mi1-mi);\r\n\r\n      // Correction for vertical lines\r\n      if(p1[0] - p0[0] == 0) {\r\n        Xi1 = p1[0] + offset*(p1[1] - p0[1])/Math.abs(p1[1] - p0[1]);\r\n        Yi1 = mi1*Xi1 - mi1*ri1 + si1;\r\n      }\r\n      if (p2[0] - p1[0] == 0 ) {\r\n        Xi1 = p2[0] + offset*(p2[1] - p1[1])/Math.abs(p2[1] - p1[1]);\r\n        Yi1 = mi*Xi1 - mi*ri + si;\r\n      }\r\n\r\n      path.push([Xi1, Yi1]);\r\n    }\r\n  }\r\n  if (isClosed) {\r\n    path.push(path[0]);\r\n  } else {\r\n    coords.pop();\r\n    p0 = coords[coords.length-1];\r\n    p1 = coords[coords.length-2];\r\n    p2 = [\r\n      p0[0] - (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] + (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n  }\r\n  return path;\r\n}\r\n\r\n/** Find the segment a point belongs to\r\n * @param {ol.Coordinate} pt\r\n * @param {Array<ol.Coordinate>} coords\r\n * @return {} the index (-1 if not found) and the segment\r\n */\r\nvar ol_coordinate_findSegment = function (pt, coords) {\r\n  for (var i=0; i<coords.length-1; i++) {\r\n    var p0 = coords[i];\r\n    var p1 = coords[i+1];\r\n    if (ol_coordinate_equal(pt, p0) || ol_coordinate_equal(pt, p1)) {\r\n      return { index:1, segment: [p0,p1] };\r\n    } else {\r\n      var d0 = ol_coordinate_dist2d(p0,p1);\r\n      var v0 = [ (p1[0] - p0[0]) / d0, (p1[1] - p0[1]) / d0 ];\r\n      var d1 = ol_coordinate_dist2d(p0,pt);\r\n      var v1 = [ (pt[0] - p0[0]) / d1, (pt[1] - p0[1]) / d1 ];\r\n      if (Math.abs(v0[0]*v1[1] - v0[1]*v1[0]) < 1e-10) {\r\n        return { index:1, segment: [p0,p1] };\r\n      }\r\n    }\r\n  }\r\n  return { index: -1 };\r\n};\r\n\r\n/**\r\n * Split a Polygon geom with horizontal lines\r\n * @param {Array<ol.Coordinate>} geom\r\n * @param {number} y the y to split\r\n * @param {number} n contour index\r\n * @return {Array<Array<ol.Coordinate>>}\r\n */\r\nvar ol_coordinate_splitH = function (geom, y, n) {\r\n  var x, abs;\r\n  var list = [];\r\n  for (var i=0; i<geom.length-1; i++) {\r\n    // Hole separator?\r\n    if (!geom[i].length || !geom[i+1].length) continue;\r\n    // Intersect\r\n    if (geom[i][1]<=y && geom[i+1][1]>y || geom[i][1]>=y && geom[i+1][1]<y) {\r\n      abs = (y-geom[i][1]) / (geom[i+1][1]-geom[i][1]);\r\n      x = abs * (geom[i+1][0]-geom[i][0]) + geom[i][0];\r\n      list.push ({ contour: n, index: i, pt: [x,y], abs: abs });\r\n    }\r\n  }\r\n  // Sort x\r\n  list.sort(function(a,b) { return a.pt[0] - b.pt[0] });\r\n  // Horizontal segment\r\n  var result = [];\r\n  for (var j=0; j<list.length-1; j += 2) {\r\n    result.push([list[j], list[j+1]])\r\n  }\r\n  return result;\r\n};\r\n\r\n/** Create a geometry given a type and coordinates */\r\nvar ol_geom_createFromType = function (type, coordinates) {\r\n  switch (type) {\r\n    case 'LineString': return new ol_geom_LineString(coordinates);\r\n    case 'LinearRing': return new ol_geom_LinearRing(coordinates);\r\n    case 'MultiLineString': return new ol_geom_MultiLineString(coordinates);\r\n    case 'MultiPoint': return new ol_geom_MultiPoint(coordinates);\r\n    case 'MultiPolygon': return new ol_geom_MultiPolygon(coordinates);\r\n    case 'Point': return new ol_geom_Point(coordinates);\r\n    case 'Polygon': return new ol_geom_Polygon(coordinates);\r\n    default:\r\n      console.error('[createFromType] Unsupported type: '+type);\r\n      return null;\r\n  }\r\n};\r\n\r\nexport {ol_geom_createFromType}\r\nexport {ol_coordinate_dist2d, ol_coordinate_equal, ol_coordinate_findSegment, ol_coordinate_getFeatureCenter, ol_coordinate_getGeomCenter, ol_coordinate_offsetCoords, ol_coordinate_splitH}\r\n\r\n/** Intersect 2 lines\r\n * @param {Arrar<ol.coordinate>} d1\r\n * @param {Arrar<ol.coordinate>} d2\r\n */\r\nvar ol_coordinate_getIntersectionPoint = function (d1, d2) {\r\n  var d1x = d1[1][0] - d1[0][0];\r\n  var d1y = d1[1][1] - d1[0][1];\r\n  var d2x = d2[1][0] - d2[0][0];\r\n  var d2y = d2[1][1] - d2[0][1];\r\n  var det = d1x * d2y - d1y * d2x;\r\n  if (det != 0) {\r\n    var k = (d1x * d1[0][1] - d1x * d2[0][1] - d1y * d1[0][0] + d1y * d2[0][0]) / det;\r\n    return [d2[0][0] + k*d2x, d2[0][1] + k*d2y];\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport { ol_coordinate_getIntersectionPoint }\r\n\r\nvar ol_extent_intersection;\r\n\r\n(function() {\r\n// Split at x\r\nfunction splitX(pts, x) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][0]>x && pts[i-1][0]<x) || (pts[i][0]<x && pts[i-1][0]>x)) {\r\n      pt = [ x, (x - pts[i][0]) / (pts[i-1][0]-pts[i][0]) * (pts[i-1][1]-pts[i][1]) + pts[i][1]];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n// Split at y\r\nfunction splitY(pts, y) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][1]>y && pts[i-1][1]<y) || (pts[i][1]<y && pts[i-1][1]>y)) {\r\n      pt = [ (y - pts[i][1]) / (pts[i-1][1]-pts[i][1]) * (pts[i-1][0]-pts[i][0]) + pts[i][0], y];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n\r\n/** Fast polygon intersection with an extent (used for area calculation)\r\n * @param {ol_extent_Extent} extent\r\n * @param {ol_geom_Polygon|ol_geom_MultiPolygon} polygon\r\n * @returns {ol_geom_Polygon|ol_geom_MultiPolygon|null} return null if not a polygon geometry\r\n */\r\nol_extent_intersection = function(extent, polygon) {\r\n  var poly = (polygon.getType() === 'Polygon');\r\n  if (!poly && polygon.getType() !== 'MultiPolygon') return null;\r\n  var geom = polygon.getCoordinates();\r\n  if (poly) geom = [geom];\r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      splitX(c, extent[0]);\r\n      splitX(c, extent[2]);\r\n      splitY(c, extent[1]);\r\n      splitY(c, extent[3]);\r\n    });\r\n  })\r\n  // Snap geom to the extent \r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      c.forEach(function(p) {\r\n        if (p[0]<extent[0]) p[0] = extent[0];\r\n        else if (p[0]>extent[2]) p[0] = extent[2];\r\n        if (p[1]<extent[1]) p[1] = extent[1];\r\n        else if (p[1]>extent[3]) p[1] = extent[3];\r\n      })\r\n    })\r\n  })\r\n  if (poly) {\r\n    return new ol_geom_Polygon(geom[0]);\r\n  } else {\r\n    return new ol_geom_MultiPolygon(geom);\r\n  }\r\n};\r\n})();\r\n\r\nexport {ol_extent_intersection}\r\n\r\n/** Add points along a segment\r\n * @param {ol_Coordinate} p1 \r\n * @param {ol_Coordinate} p2 \r\n * @param {number} d \r\n * @param {boolean} start include starting point, default true\r\n * @returns {Array<ol_Coordinate>}\r\n */\r\nvar ol_coordinate_sampleAt = function(p1, p2, d, start) {\r\n  var pts = [];\r\n  if (start!==false) pts.push(p1);\r\n  var dl = ol_coordinate_dist2d(p1,p2);\r\n  if (dl) {\r\n    var nb = Math.round(dl/d);\r\n    if (nb>1) {\r\n      var dx = (p2[0]-p1[0]) / nb;\r\n      var dy = (p2[1]-p1[1]) / nb;\r\n      for (var i=1; i<nb; i++) {\r\n        pts.push([p1[0] + dx*i, p1[1] + dy*i])\r\n      }\r\n    }\r\n  }\r\n  pts.push(p2);\r\n  return pts;\r\n};\r\nexport { ol_coordinate_sampleAt }\r\n\r\n/** Sample a Polygon at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_Polygon}\r\n */\r\nol_geom_Polygon.prototype.sampleAt = function(res) {\r\n  var poly = this.getCoordinates();\r\n  var result = [];\r\n  poly.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_Polygon(result);\r\n};\r\n\r\n/** Sample a MultiPolygon at a distance\r\n * @param {number} res\r\n * @returns {ol_geom_MultiPolygon}\r\n */\r\nol_geom_MultiPolygon.prototype.sampleAt = function(res) {\r\n  var mpoly = this.getCoordinates();\r\n  var result = [];\r\n  mpoly.forEach(function(poly) {\r\n    var a = [];\r\n    result.push(a);\r\n    poly.forEach(function(p) {\r\n      var l = [];\r\n      for (var i=1; i<p.length; i++) {\r\n        l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n      }\r\n      a.push(l);\r\n    })\r\n  });\r\n  return new ol_geom_MultiPolygon(result);\r\n};\r\n\r\n/** Intersect a geometry using a circle\r\n * @param {ol_geom_Geometry} geom\r\n * @param {number} resolution circle resolution to sample the polygon on the circle, default 1\r\n * @returns {ol_geom_Geometry}\r\n */\r\nol_geom_Circle.prototype.intersection = function(geom, resolution) {\r\n  if (geom.sampleAt) {\r\n    var ext = ol_extent_buffer(this.getCenter().concat(this.getCenter()), this.getRadius());\r\n    geom = ol_extent_intersection(ext, geom);\r\n    geom = geom.simplify(resolution);\r\n    var c = this.getCenter();\r\n    var r = this.getRadius();\r\n    //var res = (resolution||1) * r / 100;\r\n    var g = geom.sampleAt(resolution).getCoordinates();\r\n    switch (geom.getType()) {\r\n      case 'Polygon': g = [g];\r\n        // fallthrough\r\n      case 'MultiPolygon': {\r\n        var hasout = false;\r\n        // var hasin = false;\r\n        var result = [];\r\n        g.forEach(function(poly) {\r\n          var a = [];\r\n          result.push(a);\r\n          poly.forEach(function(ring) {\r\n            var l = [];\r\n            a.push(l);\r\n            ring.forEach(function(p) {\r\n              var d = ol_coordinate_dist2d(c, p);\r\n              if (d > r) {\r\n                hasout = true;\r\n                l.push([\r\n                  c[0] + r / d * (p[0]-c[0]),\r\n                  c[1] + r / d * (p[1]-c[1])\r\n                ]);\r\n              } else {\r\n                // hasin = true;\r\n                l.push(p);\r\n              }\r\n            });\r\n          })\r\n        });\r\n        if (!hasout) return geom;\r\n        if (geom.getType() === 'Polygon') {\r\n          return new ol_geom_Polygon(result[0]);\r\n        } else {\r\n          return new ol_geom_MultiPolygon(result);\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    console.warn('[ol/geom/Circle~intersection] Unsupported geometry type: '+geom.getType());\r\n  }\r\n  return geom;\r\n};\r\n","import ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\n\r\nvar ol_style_Style_defaultStyle;\r\n\r\n(function() {\r\n\r\n// Style\r\nvar white = [255, 255, 255, 1];\r\nvar blue = [0, 153, 255, 1];\r\nvar width = 3;\r\n\r\nvar defaultEditStyle = [\r\n  new ol_style_Style({\r\n    stroke: new ol_style_Stroke({ color: white, width: width + 2 })\r\n  }),\r\n  new ol_style_Style({\r\n    image: new ol_style_Circle({\r\n      radius: width * 2,\r\n      fill: new ol_style_Fill({ color: blue }),\r\n      stroke: new ol_style_Stroke({ color: white, width: width / 2 })\r\n    }),\r\n    stroke: new ol_style_Stroke({ color: blue, width: width }),\r\n    fill: new ol_style_Fill({\r\n      color: [255, 255, 255, 0.5]\r\n    })\r\n  })\r\n];\r\n\r\n/**\r\n * Get the default style\r\n * @param {boolean|*} [edit] true to get editing style or a { color, fillColor } object, default get default blue style\r\n * @return {Array<ol.style.Style>}\r\n */\r\nol_style_Style_defaultStyle = function(edit) {\r\n  if (edit===true) {\r\n    return defaultEditStyle;\r\n  } else {\r\n    edit = edit || {};\r\n    var fill = new ol_style_Fill({\r\n      color: edit.fillColor || 'rgba(255,255,255,0.4)'\r\n    });\r\n    var stroke = new ol_style_Stroke({\r\n      color: edit.color || '#3399CC',\r\n      width: 1.25\r\n    });\r\n    var style = new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    });\r\n    return [ style ];\r\n  }\r\n};\r\n\r\n})();\r\n\r\nexport default ol_style_Style_defaultStyle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport {ol_coordinate_dist2d, ol_coordinate_findSegment, ol_coordinate_offsetCoords} from \"../geom/GeomUtils\";\r\n\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\n\r\n/** Offset interaction for offseting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires offsetstart\r\n * @fires offsetting\r\n * @fires offsetend\r\n * @param {any} options\r\n *\t@param {ol.layer.Vector | Array<ol.layer.Vector>} options.layers list of feature to transform \r\n *\t@param {ol.Collection.<ol.Feature>} options.features collection of feature to transform\r\n *\t@param {ol.source.Vector | undefined} options.source source to duplicate feature when ctrl key is down\r\n *\t@param {boolean} options.duplicate force feature to duplicate (source must be set)\r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} style style for the sketch\r\n */\r\nvar ol_interaction_Offset = function(options) {\r\n  if (!options) options = {};\r\n\r\n\t// Extend pointer\r\n\tol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n    \r\n\t// Collection of feature to transform\r\n\tthis.features_ = options.features;\r\n\t// List of layers to transform\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n  // duplicate\r\n  this.set('duplicate', options.duplicate);\r\n  this.source_ = options.source;\r\n  // Style\r\n  this._style = (typeof (options.style) === 'function') ? options.style : function () { \r\n    if (options.style) return options.style;\r\n    else return ol_style_Style_defaultStyle(true);\r\n  };\r\n\r\n  // init\r\n  this.previousCursor_ = false;\r\n};\r\nol_ext_inherits(ol_interaction_Offset, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Offset.prototype.setMap = function(map) {\r\n\tol_interaction_Pointer.prototype.setMap.call (this, map);\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {any} a feature and the hit point\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.getFeatureAtPixel_ = function(e) {\r\n  var self = this;\r\n\treturn this.getMap().forEachFeatureAtPixel(e.pixel,\r\n\t\tfunction(feature, layer) {\r\n      var current;\r\n\t\t\t// feature belong to a layer\r\n\t\t\tif (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) {\r\n            current = feature;\r\n            break;\r\n          }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// feature in the collection\r\n\t\t\telse if (self.features_) {\r\n        self.features_.forEach (function(f) {\r\n          if (f===feature) {\r\n            current = feature \r\n          }\r\n        });\r\n\t\t\t}\r\n\t\t\t// Others\r\n\t\t\telse {\r\n        current = feature;\r\n      }\r\n\r\n      // Only poygon or linestring\r\n      var typeGeom = current.getGeometry().getType();\r\n      if (current && /Polygon|LineString/.test(typeGeom)) {\r\n        if (typeGeom==='Polygon' && current.getGeometry().getCoordinates().length>1) return false;\r\n        // test distance\r\n        var p = current.getGeometry().getClosestPoint(e.coordinate);\r\n        var dx = p[0]-e.coordinate[0];\r\n        var dy = p[1]-e.coordinate[1];\r\n        var d = Math.sqrt(dx*dx+dy*dy) / e.frameState.viewState.resolution;\r\n      \r\n        if (d<5) {\r\n          return { \r\n            feature: current, \r\n            hit: p, \r\n            coordinates: current.getGeometry().getCoordinates(),\r\n            geom: current.getGeometry().clone(),\r\n            geomType: typeGeom\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n\t\t},  { hitTolerance: 5 });\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDownEvent_ = function(e) {\t\r\n  this.current_ = this.getFeatureAtPixel_(e);\r\n  if (this.current_) {\r\n    this.currentStyle_ = this.current_.feature.getStyle();\r\n    if (this.source_ && (this.get('duplicate') || e.originalEvent.ctrlKey)) {\r\n      this.current_.feature = this.current_.feature.clone();\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this.source_.addFeature(this.current_.feature);\r\n    } else {\r\n      // Modify the current feature\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this._modifystart = true;\r\n    }\r\n    this.dispatchEvent({ type:'offsetstart', feature: this.current_.feature, offset: 0 });\r\n    return true;\r\n  } else  {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDragEvent_ = function(e) {\r\n  if (this._modifystart) {\r\n    this.dispatchEvent({ type:'modifystart', features: [ this.current_.feature ] });\r\n    this._modifystart = false;\r\n  }\r\n  var p = this.current_.geom.getClosestPoint(e.coordinate);\r\n  var d = ol_coordinate_dist2d(p, e.coordinate);\r\n  var seg, v1, v2, offset;\r\n  switch (this.current_.geomType) {\r\n    case  'Polygon': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates[0]).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n\r\n        offset = [];\r\n        for (var i=0; i<this.current_.coordinates.length; i++) {\r\n          offset.push( ol_coordinate_offsetCoords(this.current_.coordinates[i], i==0 ? d : -d) );\r\n        }\r\n        this.current_.feature.setGeometry(new ol_geom_Polygon(offset));\r\n      }\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n        offset = ol_coordinate_offsetCoords(this.current_.coordinates, d);\r\n        this.current_.feature.setGeometry(new ol_geom_LineString(offset));\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      break;\r\n    }\r\n  }\r\n  this.dispatchEvent({ type:'offsetting', feature: this.current_.feature, offset: d, segment: [p, e.coordinate], coordinate: e.coordinate });  \r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleUpEvent_ = function(e) {\r\n  if (!this._modifystart) {\r\n    this.dispatchEvent({ type:'offsetend', feature: this.current_.feature, coordinate: e.coordinate }); \r\n  }\r\n  this.current_.feature.setStyle(this.currentStyle_);\r\n  this.current_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleMoveEvent_ = function(e) {\t\r\n  var f = this.getFeatureAtPixel_(e);\r\n  if (f) {\r\n    if (this.previousCursor_ === false) {\r\n      this.previousCursor_ = e.map.getTargetElement().style.cursor;\r\n    }\r\n    e.map.getTargetElement().style.cursor = 'pointer';\r\n  } else {\r\n    e.map.getTargetElement().style.cursor = this.previousCursor_;\r\n    this.previousCursor_ = false;\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Offset\r\n","import {ol_coordinate_equal} from \"./GeomUtils\";\r\nimport ol_geom_LineString from \"ol/geom/LineString\";\r\n\r\n/** Split a lineString by a point or a list of points\r\n *\tNB: points must be on the line, use getClosestPoint() to get one\r\n* @param {ol.Coordinate | Array<ol.Coordinate>} pt points to split the line\r\n* @param {Number} tol distance tolerance for 2 points to be equal\r\n*/\r\nol_geom_LineString.prototype.splitAt = function(pt, tol) {\r\n  var i;\r\n  if (!pt) return [this];\r\n    if (!tol) tol = 1e-10;\r\n    // Test if list of points\r\n    if (pt.length && pt[0].length) {\r\n      var result = [this];\r\n      for (i=0; i<pt.length; i++) {\r\n        var r = [];\r\n        for (var k=0; k<result.length; k++) {\r\n          var ri = result[k].splitAt(pt[i], tol);\r\n          r = r.concat(ri);\r\n        }\r\n        result = r;\r\n      }\r\n      return result;\r\n    }\r\n    // Nothing to do\r\n    if (ol_coordinate_equal(pt,this.getFirstCoordinate())\r\n    || ol_coordinate_equal(pt,this.getLastCoordinate())) {\r\n      return [this];\r\n    }\r\n    // Get\r\n    var c0 = this.getCoordinates();\r\n    var ci=[c0[0]];\r\n    var c = [];\r\n    for (i=0; i<c0.length-1; i++) {\r\n      // Filter equal points\r\n      if (ol_coordinate_equal(c0[i],c0[i+1])) continue;\r\n      // Extremity found\r\n      if (ol_coordinate_equal(pt,c0[i+1])) {\r\n        ci.push(c0[i+1]);\r\n        c.push(new ol_geom_LineString(ci));\r\n        ci = [];\r\n      }\r\n      // Test alignement\r\n      else if (!ol_coordinate_equal(pt,c0[i])) {\r\n        var d1, d2, split=false;\r\n        if (c0[i][0] == c0[i+1][0]) {\r\n          d1 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (c0[i][0] == pt[0]) && (0 < d1 && d1 <= 1)\r\n        } else if (c0[i][1] == c0[i+1][1]) {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          split = (c0[i][1] == pt[1]) && (0 < d1 && d1 <= 1)\r\n        } else {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          d2 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (Math.abs(d1-d2) <= tol && 0 < d1 && d1 <= 1)\r\n        }\r\n        // pt is inside the segment > split\r\n        if (split) {\r\n          ci.push(pt);\r\n          c.push (new ol_geom_LineString(ci));\r\n          ci = [pt];\r\n        }\r\n      }\r\n      ci.push(c0[i+1]);\r\n    }\r\n    if (ci.length>1) c.push (new ol_geom_LineString(ci));\r\n    if (c.length) return c;\r\n    else return [this];\r\n}\r\n\r\n// import('ol-ext/geom/LineStringSplitAt')","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport {ol_coordinate_dist2d} from \"../geom/GeomUtils\";\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction split interaction for splitting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires  beforesplit, aftersplit, pointermove\r\n * @param {*} \r\n *  @param {ol.source.Vector|Array<ol.source.Vector>} options.source a list of source to split (configured with useSpatialIndex set to true)\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to split\r\n *  @param {integer} options.snapDistance distance (in px) to snap to an object, default 25px\r\n *\t@param {string|undefined} options.cursor cursor name to display when hovering an objet\r\n *  @param {function|undefined} opttion.filter a filter that takes a feature and return true if it can be clipped, default always split.\r\n *  @param ol_style_Style | Array<ol_style_Style> | false | undefined} options.featureStyle Style for the selected features, choose false if you don't want feature selection. By default the default edit style is used.\r\n *  @param {ol_style_Style | Array<ol_style_Style> | undefined} options.sketchStyle Style for the sektch features. \r\n *  @param {function|undefined} options.tolerance Distance between the calculated intersection and a vertex on the source geometry below which the existing vertex will be used for the split.  Default is 1e-10.\r\n */\r\nvar ol_interaction_Split = function(options) {\r\n  if (!options) options = {};\r\n\r\n  ol_interaction_Interaction.call(this, {\r\n    handleEvent: function(e) {\r\n      switch (e.type) {\r\n        case \"singleclick\":\r\n          return this.handleDownEvent(e);\r\n        case \"pointermove\":\r\n          return this.handleMoveEvent(e);\r\n        default: \r\n          return true;\r\n      }\r\n      //return true;\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.snapDistance || 25;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = options.tolerance || 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.sources_ = options.sources ? (options.sources instanceof Array) ? options.sources:[options.sources] : [];\r\n\r\n  if (options.features) {\r\n    this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n  }\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  // Default style\r\n  var white = [255, 255, 255, 1];\r\n  var blue = [0, 153, 255, 1];\r\n  var width = 3;\r\n  var fill = new ol_style_Fill({ color: 'rgba(255,255,255,0.4)' });\r\n  var stroke = new ol_style_Stroke({\r\n    color: '#3399CC',\r\n    width: 1.25\r\n  });\r\n  var sketchStyle = [\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    })\r\n  ];\r\n  var featureStyle = [\r\n    new ol_style_Style({\r\n      stroke: new ol_style_Stroke({\r\n        color: white,\r\n        width: width + 2\r\n      })\r\n    }),\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        radius: 2*width,\r\n        fill: new ol_style_Fill({\r\n          color: blue\r\n        }),\r\n        stroke: new ol_style_Stroke({\r\n          color: white,\r\n          width: width/2\r\n        })\r\n      }),\r\n      stroke: new ol_style_Stroke({\r\n          color: blue,\r\n          width: width\r\n        })\r\n    }),\r\n  ];\r\n\r\n  // Custom style\r\n  if (options.sketchStyle) sketchStyle = options.sketchStyle instanceof Array ? options.sketchStyle : [options.sketchStyle];\r\n  if (options.featureStyle) featureStyle = options.featureStyle instanceof Array ? options.featureStyle : [options.featureStyle];\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Split overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: function(f) {\r\n      if (f._sketch_) return sketchStyle;\r\n      else return featureStyle;\r\n    }\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_Split, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Split.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {ol.feature} \r\n * @private\r\n */\r\nol_interaction_Split.prototype.getClosestFeature = function(e) {\r\n  var source, f, c, g, d = this.snapDistance_+1;\r\n  // Look for closest point in the sources\r\n  this.sources_.forEach(function(si) {\r\n    var fi = si.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (fi && fi.getGeometry().splitAt) {\r\n      var ci = fi.getGeometry().getClosestPoint(e.coordinate);\r\n      var gi = new ol_geom_LineString([e.coordinate,ci]);\r\n      var di = gi.getLength() / e.frameState.viewState.resolution;\r\n      if (di < d) {\r\n        source = si;\r\n        d = di;\r\n        f = fi;\r\n        g = gi;\r\n        c = ci;\r\n      }\r\n    }\r\n  });\r\n  // Snap ?\r\n  if (d > this.snapDistance_) {\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry().getCoordinates());\r\n    var p = this.getMap().getPixelFromCoordinate(coord);\r\n    if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n      c = coord;\r\n    }\r\n    //\r\n    return { source:source, feature:f, coord: c, link: g };\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {Array<ol.coordinate>} coords list of coordinates\r\n* @return {ol.coordinate} the nearest coordinate in the list\r\n*/\r\nol_interaction_Split.prototype.getNearestCoord = function(pt, coords) {\r\n  var d, dm=Number.MAX_VALUE, p0;\r\n  for (var i=0; i < coords.length; i++) {\r\n    d = ol_coordinate_dist2d (pt, coords[i]);\r\n    if (d < dm) {\r\n      dm = d;\r\n      p0 = coords[i];\r\n    }\r\n  }\r\n  return p0;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_Split.prototype.handleDownEvent = function(evt) {\r\n  // Something to split ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current) {\r\n    var self = this;\r\n    self.overlayLayer_.getSource().clear();\r\n    var split = current.feature.getGeometry().splitAt(current.coord, this.tolerance_);\r\n    var i;\r\n    if (split.length > 1) {\r\n      var tosplit = [];\r\n      for (i=0; i<split.length; i++) {\r\n        var f = current.feature.clone();\r\n        f.setGeometry(split[i]);\r\n        tosplit.push(f);\r\n      }\r\n      self.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.removeFeature(current.feature);\r\n      for (i=0; i<tosplit.length; i++) {\r\n        current.source.addFeature(tosplit[i]);\r\n      }\r\n      self.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_Split.prototype.handleMoveEvent = function(e) {\r\n  var map = e.map;\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  if (current && this.filterSplit_(current.feature)) {\r\n    var p, l;\r\n    // Draw sketch\r\n    this.overlayLayer_.getSource().addFeature(current.feature);\r\n    p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    p._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n    //\r\n    l = new ol_Feature(current.link);\r\n    l._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(l);\r\n    // move event\r\n    this.dispatchEvent({\r\n      type: 'pointermove',\r\n      coordinate: e.coordinate,\r\n      frameState: e.frameState,\r\n      originalEvent: e.originalEvent,\r\n      map: e.map,\r\n      pixel: e.pixel,\r\n      feature: current.feature,\r\n      linkGeometry: current.link\r\n    });\r\n  } else {\r\n    this.dispatchEvent(e);\r\n  }\r\n\r\n  var element = map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Split\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_RegularShape from 'ol/style/RegularShape'\r\nimport {fromExtent as ol_geom_Polygon_fromExtent} from 'ol/geom/Polygon'\r\nimport {boundingExtent as ol_extent_boundingExtent, buffer as ol_extent_buffer, createEmpty as ol_extent_createEmpty, extend as ol_extent_extend, getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires select | rotatestart | rotating | rotateend | translatestart | translating | translateend | scalestart | scaling | scaleend\r\n * @param {any} options\r\n *  @param {function} options.filter A function that takes a Feature and a Layer and returns true if the feature may be transformed or false otherwise.\r\n *  @param {Array<ol.Layer>} options.layers array of layers to transform,\r\n *  @param {ol.Collection<ol.Feature>} options.features collection of feature to transform,\r\n *\t@param {ol.EventsConditionType|undefined} options.condition A function that takes an ol.MapBrowserEvent and a feature collection and returns a boolean to indicate whether that event should be handled. default: ol.events.condition.always.\r\n *\t@param {ol.EventsConditionType|undefined} options.addCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled ie. the feature will be added to the transforms features. default: ol.events.condition.never.\r\n *\t@param {number | undefined} options.hitTolerance Tolerance to select feature in pixel, default 0\r\n *\t@param {bool} options.translateFeature Translate when click on feature\r\n *\t@param {bool} options.translate Can translate the feature\r\n *  @param {bool} options.translateBBox Enable translate when the user drags inside the bounding box\r\n *\t@param {bool} options.stretch can stretch the feature\r\n *\t@param {bool} options.scale can scale the feature\r\n *\t@param {bool} options.rotate can rotate the feature\r\n *\t@param {bool} options.noFlip prevent the feature geometry to flip, default false\r\n *\t@param {bool} options.selection the intraction handle selection/deselection, if not use the select prototype to add features to transform, default true\r\n *\t@param {ol.events.ConditionType | undefined} options.keepAspectRatio A function that takes an ol.MapBrowserEvent and returns a boolean to keep aspect ratio, default ol.events.condition.shiftKeyOnly.\r\n *\t@param {ol.events.ConditionType | undefined} options.modifyCenter A function that takes an ol.MapBrowserEvent and returns a boolean to apply scale & strech from the center, default ol.events.condition.metaKey or ol.events.condition.ctrlKey.\r\n *\t@param {boolean} options.enableRotatedTransform Enable transform when map is rotated\r\n *\t@param {} options.style list of ol.style for handles\r\n *\r\n */\r\nvar ol_interaction_Transform = function(options) {\r\n  if (!options) options = {};\r\n\tvar self = this;\r\n\r\n  this.selection_ = new ol_Collection();\r\n\r\n\t// Create a new overlay layer for the sketch\r\n\tthis.handles_ = new ol_Collection();\r\n\tthis.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.handles_,\r\n      useSpatialIndex: false,\r\n      wrapX: false // For vector editing across the -180 and 180 meridians to work properly, this should be set to false\r\n    }),\r\n    name:'Transform overlay',\r\n    displayInLayerSwitcher: false,\r\n    // Return the style according to the handle type\r\n    style: function (feature) {\r\n      return (self.style[(feature.get('handle')||'default')+(feature.get('constraint')||'')+(feature.get('option')||'')]);\r\n    },\r\n  });\r\n\r\n  // Extend pointer\r\n  ol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n\r\n  // Collection of feature to transform\r\n  this.features_ = options.features;\r\n  // Filter or list of layers to transform\r\n  if (typeof(options.filter)==='function') this._filter = options.filter;\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n\r\n  this._handleEvent = options.condition || function() { return true; };\r\n  this.addFn_ = options.addCondition || function() { return false; };\r\n  /* Translate when click on feature */\r\n  this.set('translateFeature', (options.translateFeature!==false));\r\n  /* Can translate the feature */\r\n  this.set('translate', (options.translate!==false));\r\n  /* Translate when click on the bounding box */\r\n  this.set('translateBBox', (options.translateBBox===true));\r\n  /* Can stretch the feature */\r\n  this.set('stretch', (options.stretch!==false));\r\n  /* Can scale the feature */\r\n  this.set('scale', (options.scale!==false));\r\n  /* Can rotate the feature */\r\n  this.set('rotate', (options.rotate!==false));\r\n  /* Keep aspect ratio */\r\n  this.set('keepAspectRatio', (options.keepAspectRatio || function(e){ return e.originalEvent.shiftKey }));\r\n  /* Modify center */\r\n  this.set('modifyCenter', (options.modifyCenter || function(e){ return e.originalEvent.metaKey || e.originalEvent.ctrlKey }));\r\n  /* Prevent flip */\r\n  this.set('noFlip', (options.noFlip || false));\r\n  /* Handle selection */\r\n  this.set('selection', (options.selection !== false));\r\n  /*  */\r\n  this.set('hitTolerance', (options.hitTolerance || 0));\r\n  /* Enable view rotated transforms */\r\n  this.set('enableRotatedTransform', (options.enableRotatedTransform || false));\r\n\r\n\r\n  // Force redraw when changed\r\n  this.on ('propertychange', function() {\r\n    this.drawSketch_();\r\n  });\r\n\r\n  // setstyle\r\n  this.setDefaultStyle();\r\n};\r\nol_ext_inherits(ol_interaction_Transform, ol_interaction_Pointer);\r\n\r\n/** Cursors for transform\r\n*/\r\nol_interaction_Transform.prototype.Cursors = {\r\n  'default': 'auto',\r\n  'select': 'pointer',\r\n  'translate': 'move',\r\n  'rotate': 'move',\r\n  'rotate0': 'move',\r\n  'scale': 'nesw-resize',\r\n  'scale1': 'nwse-resize',\r\n  'scale2': 'nesw-resize',\r\n  'scale3': 'nwse-resize',\r\n  'scalev': 'ew-resize',\r\n  'scaleh1': 'ns-resize',\r\n  'scalev2': 'ew-resize',\r\n  'scaleh3': 'ns-resize'\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setMap = function(map) {\r\n  var oldMap = this.getMap();\r\n  if (oldMap) {\r\n    var targetElement = oldMap.getTargetElement();\r\n    oldMap.removeLayer(this.overlayLayer_);\r\n    if (this.previousCursor_ && targetElement) {\r\n      targetElement.style.cursor = this.previousCursor_;\r\n    }\r\n    this.previousCursor_ = undefined;\r\n  }\r\n  ol_interaction_Pointer.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n  if (map === null) {\r\n    this.select(null);\r\n  }\r\n  if (map !== null) {\r\n    this.isTouch = /touch/.test(map.getViewport().className);\r\n    this.setDefaultStyle();\r\n  }\r\n};\r\n\r\n/**\r\n * Activate/deactivate interaction\r\n * @param {bool}\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setActive = function(b) {\r\n  this.select(null);\r\n  this.overlayLayer_.setVisible(b);\r\n  ol_interaction_Pointer.prototype.setActive.call (this, b);\r\n};\r\n\r\n/** Set default sketch style\r\n * @param {Object|undefined} options\r\n *  @param {ol_style_Stroke} stroke stroke style for selection rectangle\r\n *  @param {ol_style_Fill} fill fill style for selection rectangle\r\n *  @param {ol_style_Stroke} pointStroke stroke style for handles\r\n *  @param {ol_style_Fill} pointFill fill style for handles\r\n */\r\nol_interaction_Transform.prototype.setDefaultStyle = function(options) {\r\n  options = options || {}\r\n  // Style\r\n  var stroke = options.pointStroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1 });\r\n  var strokedash = options.stroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1, lineDash:[4,4] });\r\n  var fill0 = options.fill || new ol_style_Fill({ color:[255,0,0,0.01] });\r\n  var fill = options.pointFill || new ol_style_Fill({ color:[255,255,255,0.8] });\r\n  var circle = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      points: 15\r\n    });\r\n  circle.getAnchor()[0] = this.isTouch ? -10 : -5;\r\n  var bigpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 16 : 8,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  var smallpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  function createStyle (img, stroke, fill) {\r\n    return [ new ol_style_Style({image:img, stroke:stroke, fill:fill}) ];\r\n  }\r\n  /** Style for handles */\r\n  this.style = {\r\n    'default': createStyle (bigpt, strokedash, fill0),\r\n    'translate': createStyle (bigpt, stroke, fill),\r\n    'rotate': createStyle (circle, stroke, fill),\r\n    'rotate0': createStyle (bigpt, stroke, fill),\r\n    'scale': createStyle (bigpt, stroke, fill),\r\n    'scale1': createStyle (bigpt, stroke, fill),\r\n    'scale2': createStyle (bigpt, stroke, fill),\r\n    'scale3': createStyle (bigpt, stroke, fill),\r\n    'scalev': createStyle (smallpt, stroke, fill),\r\n    'scaleh1': createStyle (smallpt, stroke, fill),\r\n    'scalev2': createStyle (smallpt, stroke, fill),\r\n    'scaleh3': createStyle (smallpt, stroke, fill),\r\n  };\r\n  this.drawSketch_();\r\n}\r\n\r\n/**\r\n * Set sketch style.\r\n * @param {style} style Style name: 'default','translate','rotate','rotate0','scale','scale1','scale2','scale3','scalev','scaleh1','scalev2','scaleh3'\r\n * @param {ol.style.Style|Array<ol.style.Style>} olstyle\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setStyle = function(style, olstyle) {\r\n  if (!olstyle) return;\r\n  if (olstyle instanceof Array) this.style[style] = olstyle;\r\n  else this.style[style] = [ olstyle ];\r\n  for (var i=0; i<this.style[style].length; i++) {\r\n    var im = this.style[style][i].getImage();\r\n    if (im) {\r\n      if (style == 'rotate') im.getAnchor()[0] = -5;\r\n      if (this.isTouch) im.setScale(1.8);\r\n    }\r\n    var tx = this.style[style][i].getText();\r\n    if (tx) {\r\n      if (style == 'rotate') tx.setOffsetX(this.isTouch ? 14 : 7);\r\n      if (this.isTouch) tx.setScale(1.8);\r\n    }\r\n  }\r\n  this.drawSketch_();\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.Pixel}\r\n * @return {ol.feature}\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.getFeatureAtPixel_ = function(pixel) {\r\n  var self = this;\r\n  return this.getMap().forEachFeatureAtPixel(pixel,\r\n    function(feature, layer) {\r\n      var found = false;\r\n      // Overlay ?\r\n      if (!layer) {\r\n        if (feature===self.bbox_) {\r\n          if (self.get('translateBBox')) {\r\n            return { feature: feature, handle: 'translate', constraint:'', option: '' };\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n        self.handles_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature, handle:feature.get('handle'), constraint:feature.get('constraint'), option:feature.get('option') };\r\n      }\r\n      // No seletion\r\n      if (!self.get('selection')) {\r\n        // Return the currently selected feature the user is interacting with.\r\n        if (self.selection_.getArray().some(function(f) { return feature === f; })) {\r\n          return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // filter condition\r\n      if (self._filter) {\r\n        if (self._filter(feature,layer)) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // feature belong to a layer\r\n      else if (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // feature in the collection\r\n      else if (self.features_) {\r\n        self.features_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // Others\r\n      else return { feature: feature };\r\n    },\r\n    { hitTolerance: this.get('hitTolerance') }\r\n  ) || {};\r\n}\r\n\r\n/** Rotate feature from map view rotation\r\n * @param {ol.Feature} f the feature\r\n * @param {boolean} clone clone resulting geom\r\n * @param {ol.geom.Geometry} rotated geometry\r\n */\r\nol_interaction_Transform.prototype.getGeometryRotateToZero_ = function(f, clone) {\r\n  var origGeom = f.getGeometry();\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  if (viewRotation === 0 || !this.get('enableRotatedTransform')) {\r\n    return (clone) ? origGeom.clone() : origGeom;\r\n  }\r\n  var rotGeom = origGeom.clone();\r\n  rotGeom.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n  return rotGeom;\r\n}\r\n\r\n/** Draw transform sketch\r\n* @param {boolean} draw only the center\r\n*/\r\nol_interaction_Transform.prototype.drawSketch_ = function(center) {\r\n  var i, f, geom;\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.selection_.getLength()) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var ext = this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();\r\n  // Clone and extend\r\n  ext = ol_extent_buffer(ext, 0);\r\n  this.selection_.forEach(function (f) {\r\n    var extendExt = this.getGeometryRotateToZero_(f).getExtent();\r\n    ol_extent_extend(ext, extendExt);\r\n  }.bind(this));\r\n\r\n  if (center===true) {\r\n    if (!this.ispt_) {\r\n      this.overlayLayer_.getSource().addFeature(new ol_Feature( { geometry: new ol_geom_Point(this.center_), handle:'rotate0' }) );\r\n      geom = ol_geom_Polygon_fromExtent(ext);\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n      }\r\n      f = this.bbox_ = new ol_Feature(geom);\r\n      this.overlayLayer_.getSource().addFeature (f);\r\n    }\r\n  }\r\n  else {\r\n    if (this.ispt_) {\r\n      var p = this.getMap().getPixelFromCoordinate([ext[0], ext[1]]);\r\n      ext = ol_extent_boundingExtent([\r\n        this.getMap().getCoordinateFromPixel([p[0]-10, p[1]-10]),\r\n        this.getMap().getCoordinateFromPixel([p[0]+10, p[1]+10])\r\n      ]);\r\n    }\r\n    geom = ol_geom_Polygon_fromExtent(ext);\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n    }\r\n    f = this.bbox_ = new ol_Feature(geom);\r\n    var features = [];\r\n    var g = geom.getCoordinates()[0];\r\n    if (!this.ispt_) {\r\n      features.push(f);\r\n      // Middle\r\n      if (!this.iscircle_ && this.get('stretch') && this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[i][0]+g[i+1][0])/2,(g[i][1]+g[i+1][1])/2]), handle:'scale', constraint:i%2?\"h\":\"v\", option:i });\r\n        features.push(f);\r\n      }\r\n      // Handles\r\n      if (this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point(g[i]), handle:'scale', option:i });\r\n        features.push(f);\r\n      }\r\n      // Center\r\n      if (this.get('translate') && !this.get('translateFeature')) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[0][0]+g[2][0])/2, (g[0][1]+g[2][1])/2]), handle:'translate' });\r\n        features.push(f);\r\n      }\r\n    }\r\n    // Rotate\r\n    if (!this.iscircle_ && this.get('rotate')) {\r\n      f = new ol_Feature( { geometry: new ol_geom_Point(g[3]), handle:'rotate' });\r\n      features.push(f);\r\n    }\r\n    // Add sketch\r\n    this.overlayLayer_.getSource().addFeatures(features);\r\n  }\r\n\r\n};\r\n\r\n/** Select a feature to transform\r\n* @param {ol.Feature} feature the feature to transform\r\n* @param {boolean} add true to add the feature to the selection, default false\r\n*/\r\nol_interaction_Transform.prototype.select = function(feature, add) {\r\n  if (!feature) {\r\n    this.selection_.clear();\r\n    this.drawSketch_();\r\n    return;\r\n  }\r\n  if (!feature.getGeometry || !feature.getGeometry()) return;\r\n  // Add to selection\r\n  if (add) {\r\n    this.selection_.push(feature);\r\n  } else {\r\n\tvar index = this.selection_.getArray().indexOf(feature);\r\n\tthis.selection_.removeAt(index);\t\r\n  }\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', feature: feature, features: this.selection_ });\r\n};\r\n\r\n/** Update the selection collection.\r\n* @param {ol.Collection<ol.Feature>} features the features to transform\r\n*/\r\nol_interaction_Transform.prototype.setSelection = function(features) {\r\n  this.selection_.clear();\r\n  features.forEach(function(feature) {\r\n    this.selection_.push(feature);\r\n  }.bind(this));\r\n\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', features: this.selection_ });\r\n};\r\n\r\n/** Watch selected features\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.watchFeatures_ = function() {\r\n  // Listen to feature modification\r\n  if (this._featureListeners) {\r\n    this._featureListeners.forEach(function (l) {\r\n      ol_Observable_unByKey(l)\r\n    });\r\n  }\r\n  this._featureListeners = [];\r\n  this.selection_.forEach(function(f) {\r\n    this._featureListeners.push(\r\n      f.on('change', function() {\r\n        if (!this.isUpdating_) {\r\n          this.drawSketch_();\r\n        }\r\n      }.bind(this))\r\n    );\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDownEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.selection_)) return;\r\n  var sel = this.getFeatureAtPixel_(evt.pixel);\r\n  var feature = sel.feature;\r\n  if (this.selection_.getLength()\r\n    && this.selection_.getArray().indexOf(feature) >= 0\r\n    && ((this.ispt_ && this.get('translate')) || this.get('translateFeature'))\r\n  ){\r\n    sel.handle = 'translate';\r\n  }\r\n  if (sel.handle) {\r\n    this.mode_ = sel.handle;\r\n    this.opt_ = sel.option;\r\n    this.constraint_ = sel.constraint;\r\n    // Save info\r\n    var viewRotation = this.getMap().getView().getRotation();\r\n    this.coordinate_ = evt.coordinate;\r\n    this.pixel_ = evt.pixel;\r\n    this.geoms_ = [];\r\n    this.rotatedGeoms_ = [];\r\n    var extent = ol_extent_createEmpty();\r\n    var rotExtent = ol_extent_createEmpty();\r\n    for (var i=0, f; f=this.selection_.item(i); i++) {\r\n      this.geoms_.push(f.getGeometry().clone());\r\n      extent = ol_extent_extend(extent, f.getGeometry().getExtent());\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var rotGeom = this.getGeometryRotateToZero_(f, true);\r\n        this.rotatedGeoms_.push(rotGeom);\r\n        rotExtent = ol_extent_extend(rotExtent, rotGeom.getExtent());\r\n      }\r\n    }\r\n    this.extent_ = (ol_geom_Polygon_fromExtent(extent)).getCoordinates()[0];\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      this.rotatedExtent_ = (ol_geom_Polygon_fromExtent(rotExtent)).getCoordinates()[0];\r\n    }\r\n    if (this.mode_==='rotate') {\r\n      this.center_ = this.getCenter() || ol_extent_getCenter(extent);\r\n      // we are now rotating (cursor down on rotate mode), so apply the grabbing cursor\r\n      var element = evt.map.getTargetElement();\r\n      element.style.cursor = this.Cursors.rotate0;\r\n      this.previousCursor_ = element.style.cursor;\r\n    } else {\r\n      this.center_ = ol_extent_getCenter(extent);\r\n    }\r\n    this.angle_ = Math.atan2(this.center_[1]-evt.coordinate[1], this.center_[0]-evt.coordinate[0]);\r\n\r\n    this.dispatchEvent({\r\n      type: this.mode_+'start',\r\n      feature: this.selection_.item(0), // backward compatibility\r\n      features: this.selection_,\r\n      pixel: evt.pixel,\r\n      coordinate: evt.coordinate\r\n    });\r\n    return true;\r\n  }\r\n  else if (this.get('selection')) {\r\n    if (feature){\r\n      if (!this.addFn_(evt)) this.selection_.clear();\r\n      var index = this.selection_.getArray().indexOf(feature);\r\n      if (index < 0) this.selection_.push(feature);\r\n      else this.selection_.removeAt(index);\r\n    } else {\r\n      this.selection_.clear();\r\n    }\r\n    this.ispt_ = this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false;\r\n    this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n    this.drawSketch_();\r\n    this.watchFeatures_();\r\n    this.dispatchEvent({ type:'select', feature: feature, features: this.selection_, pixel: evt.pixel, coordinate: evt.coordinate });\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Get features to transform\r\n * @return {ol.Collection<ol.Feature>}\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\n/**\r\n * Get the rotation center\r\n * @return {ol.coordinates|undefined}\r\n */\r\nol_interaction_Transform.prototype.getCenter = function() {\r\n  return this.get('center');\r\n};\r\n\r\n/**\r\n * Set the rotation center\r\n * @param {ol.coordinates|undefined} c the center point, default center on the objet\r\n */\r\nol_interaction_Transform.prototype.setCenter = function(c) {\r\n  return this.set('center', c);\r\n}\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDragEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var i, f, geometry;\r\n  var pt0 = [this.coordinate_[0], this.coordinate_[1]];\r\n  var pt = [evt.coordinate[0], evt.coordinate[1]];\r\n  this.isUpdating_ = true;\r\n  switch (this.mode_) {\r\n    case 'rotate': {\r\n      var a = Math.atan2(this.center_[1]-pt[1], this.center_[0]-pt[0]);\r\n      if (!this.ispt) {\r\n        // var geometry = this.geom_.clone();\r\n        // geometry.rotate(a-this.angle_, this.center_);\r\n        // this.feature_.setGeometry(geometry);\r\n        for (i=0, f; f=this.selection_.item(i); i++) {\r\n          geometry = this.geoms_[i].clone();\r\n          geometry.rotate(a - this.angle_, this.center_);\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          f.setGeometry(geometry);\r\n        }\r\n      }\r\n      this.drawSketch_(true);\r\n      this.dispatchEvent({\r\n        type:'rotating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        angle: a-this.angle_,\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'translate': {\r\n      var deltaX = pt[0] - pt0[0];\r\n      var deltaY = pt[1] - pt0[1];\r\n\r\n      //this.feature_.getGeometry().translate(deltaX, deltaY);\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      }\r\n      this.handles_.forEach(function(f) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      });\r\n\r\n      this.coordinate_ = evt.coordinate;\r\n      this.dispatchEvent({\r\n        type:'translating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        delta:[deltaX,deltaY],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'scale': {\r\n      var center = this.center_;\r\n      if (this.get('modifyCenter')(evt)) {\r\n        var extentCoordinates = this.extent_;\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          extentCoordinates = this.rotatedExtent_;\r\n        }\r\n        center = extentCoordinates[(Number(this.opt_)+2)%4];\r\n      }\r\n\r\n      var downCoordinate = this.coordinate_;\r\n      var dragCoordinate = evt.coordinate;\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var downPoint = new ol_geom_Point(this.coordinate_);\r\n        downPoint.rotate(viewRotation * -1, center);\r\n        downCoordinate = downPoint.getCoordinates();\r\n\r\n        var dragPoint = new ol_geom_Point(evt.coordinate);\r\n        dragPoint.rotate(viewRotation * -1, center);\r\n        dragCoordinate = dragPoint.getCoordinates();\r\n      }\r\n\r\n      var scx = ((dragCoordinate)[0] - (center)[0]) / (downCoordinate[0] - (center)[0]);\r\n      var scy = ((dragCoordinate)[1] - (center)[1]) / (downCoordinate[1] - (center)[1]);\r\n\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var centerPoint = new ol_geom_Point(center);\r\n        centerPoint.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n        center = centerPoint.getCoordinates();\r\n      }\r\n\r\n      if (this.get('noFlip')) {\r\n        if (scx<0) scx=-scx;\r\n        if (scy<0) scy=-scy;\r\n      }\r\n\r\n      if (this.constraint_) {\r\n        if (this.constraint_==\"h\") scx=1;\r\n        else scy=1;\r\n      } else {\r\n        if (this.get('keepAspectRatio')(evt)) {\r\n          scx = scy = Math.min(scx,scy);\r\n        }\r\n      }\r\n\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        geometry = (viewRotation === 0 || !this.get('enableRotatedTransform')) ? this.geoms_[i].clone() : this.rotatedGeoms_[i].clone();\r\n        geometry.applyTransform(function(g1, g2, dim) {\r\n          if (dim<2) return g2;\r\n\r\n          for (var j=0; j<g1.length; j+=dim) {\r\n            if (scx!=1) g2[j] = center[0] + (g1[j]-center[0])*scx;\r\n            if (scy!=1) g2[j+1] = center[1] + (g1[j+1]-center[1])*scy;\r\n          }\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          return g2;\r\n        });\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          //geometry.rotate(viewRotation, rotationCenter);\r\n          geometry.rotate(viewRotation, this.getMap().getView().getCenter());\r\n        }\r\n        f.setGeometry(geometry);\r\n      }\r\n      this.drawSketch_();\r\n      this.dispatchEvent({\r\n        type:'scaling',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        scale:[scx,scy],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    default: break;\r\n  }\r\n  this.isUpdating_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleMoveEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  // console.log(\"handleMoveEvent\");\r\n  if (!this.mode_) {\r\n    var sel = this.getFeatureAtPixel_(evt.pixel);\r\n    var element = evt.map.getTargetElement();\r\n    if (sel.feature) {\r\n      var c = sel.handle ? this.Cursors[(sel.handle||'default')+(sel.constraint||'')+(sel.option||'')] : this.Cursors.select;\r\n\r\n      if (this.previousCursor_===undefined) {\r\n        this.previousCursor_ = element.style.cursor;\r\n      }\r\n      element.style.cursor = c;\r\n    } else {\r\n      if (this.previousCursor_!==undefined) element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_Transform.prototype.handleUpEvent_ = function(evt) {\r\n  // remove rotate0 cursor on Up event, otherwise it's stuck on grab/grabbing\r\n  if (this.mode_ === 'rotate') {\r\n    var element = evt.map.getTargetElement();\r\n    element.style.cursor = this.Cursors.default;\r\n    this.previousCursor_ = undefined;\r\n  }\r\n\r\n  //dispatchEvent\r\n  this.dispatchEvent({\r\n    type:this.mode_+'end',\r\n    feature: this.selection_.item(0),\r\n    features: this.selection_,\r\n    oldgeom: this.geoms_[0],\r\n    oldgeoms: this.geoms_\r\n  });\r\n\r\n  this.drawSketch_();\r\n  this.mode_ = null;\r\n  return false;\r\n};\r\n\r\n/** Get the features that are selected for transform\r\n * @return ol.Collection\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\nexport default ol_interaction_Transform\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport {ol_coordinate_dist2d, ol_coordinate_equal} from \"../geom/GeomUtils\";\r\nimport {boundingExtent as ol_extent_boundingExtent} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\nimport {altKeyOnly as ol_events_condition_altKeyOnly} from 'ol/events/condition'\r\nimport {primaryAction as ol_events_condition_primaryAction} from 'ol/events/condition'\r\nimport {always as ol_events_condition_always} from 'ol/events/condition'\r\n\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction for modifying feature geometries. Similar to the core ol/interaction/Modify.\r\n * The interaction is more suitable to use to handle feature modification: only features concerned \r\n * by the modification are passed to the events (instead of all feature with ol/interaction/Modify)\r\n * - the modifystart event is fired before the feature is modified (no points still inserted)\r\n * - the modifyend event is fired after the modification\r\n * - it fires a modifying event\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires modifystart\r\n * @fires modifying\r\n * @fires modifyend\r\n * @fires select\r\n * @param {*} options\r\n *\t@param {ol.source.Vector} options.source a source to modify (configured with useSpatialIndex set to true)\r\n *\t@param {ol.source.Vector|Array<ol.source.Vector>} options.sources a list of source to modify (configured with useSpatialIndex set to true)\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to modify\r\n *  @param {integer} options.pixelTolerance Pixel tolerance for considering the pointer close enough to a segment or vertex for editing. Default is 10.\r\n *  @param {function|undefined} options.filter a filter that takes a feature and return true if it can be modified, default always true.\r\n *  @param {ol.style.Style | Array<ol.style.Style> | undefined} options.style Style for the sketch features.\r\n *  @param {ol.EventsConditionType | undefined} options.condition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event will be considered to add or move a vertex to the sketch. Default is ol.events.condition.primaryAction.\r\n *  @param {ol.EventsConditionType | undefined} options.deleteCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled. By default, ol.events.condition.singleClick with ol.events.condition.altKeyOnly results in a vertex deletion.\r\n *  @param {ol.EventsConditionType | undefined} options.insertVertexCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether a new vertex can be added to the sketch features. Default is ol.events.condition.always\r\n *  @param {boolean} options.wrapX Wrap the world horizontally on the sketch overlay, default false\r\n */\r\nvar ol_interaction_ModifyFeature = function(options){\r\n  if (!options) options = {};\r\n\r\n  var dragging, modifying;\r\n  ol_interaction_Pointer.call(this,{\r\n    /*\r\n    handleDownEvent: this.handleDownEvent,\r\n    handleDragEvent: this.handleDragEvent,\r\n    handleMoveEvent: this.handleMoveEvent,\r\n    handleUpEvent: this.handleUpEvent,\r\n    */\r\n    handleEvent: function(e) {\r\n      switch(e.type) {\r\n        case 'pointerdown': {\r\n          dragging = this.handleDownEvent(e);\r\n          modifying = dragging || this._deleteCondition(e);\r\n          return !dragging;\r\n        }\r\n        case 'pointerup': {\r\n          dragging = false;\r\n          return this.handleUpEvent(e);\r\n        }\r\n        case 'pointerdrag': {\r\n          if (dragging) return this.handleDragEvent(e);\r\n          else return true;\r\n        }\r\n        case 'pointermove': {\r\n          if (!dragging) return this.handleMoveEvent(e);\r\n          else return true;\r\n        }\r\n        case 'singleclick':\r\n        case 'click': {\r\n          // Prevent click when modifying\r\n          return !modifying;\r\n        }\r\n        default: return true;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.pixelTolerance || 10;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.sources_ = options.sources ? (options.sources instanceof Array) ? options.sources:[options.sources] : [];\r\n  if (options.source) this.sources_.push (options.source);\r\n  if (options.features) this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  this._condition = options.condition || ol_events_condition_primaryAction;\r\n  this._deleteCondition = options.deleteCondition || ol_events_condition_altKeyOnly;\r\n  this._insertVertexCondition = options.insertVertexCondition || ol_events_condition_always;\r\n\r\n  // Default style\r\n  var sketchStyle = function() {\r\n    return [ new ol_style_Style({\r\n        image: new ol_style_Circle({\r\n          radius: 6,\r\n          fill: new ol_style_Fill({ color: [0, 153, 255, 1] }),\r\n          stroke: new ol_style_Stroke({ color: '#FFF', width: 1.25 })\r\n        })\r\n      })\r\n    ];\r\n  }\r\n\r\n  // Custom style\r\n  if (options.style) {\r\n    if (typeof(options.style) === 'function') {\r\n      sketchStyle = options.style\r\n     } else {\r\n       sketchStyle = function() { return options.style; }\r\n     }\r\n  }\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Modify overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: sketchStyle,\r\n    wrapX: options.wrapX\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_ModifyFeature, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate or deactivate the interaction + remove the sketch.\r\n * @param {boolean} active.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  if (this.overlayLayer_) this.overlayLayer_.getSource().clear();\r\n};\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {*} \r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.getClosestFeature = function(e) {\r\n  var f, c, d = this.snapDistance_+1;\r\n  for (var i=0; i<this.sources_.length; i++) {\r\n    var source = this.sources_[i];\r\n    f = source.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (f && this.filterSplit_(f)) {\r\n      var ci = f.getGeometry().getClosestPoint(e.coordinate);\r\n      var di = ol_coordinate_dist2d(e.coordinate,ci) / e.frameState.viewState.resolution;\r\n      if (di < d){\r\n        d = di;\r\n        c = ci;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  if (d > this.snapDistance_) {\r\n    if (this.currentFeature) this.dispatchEvent({ type: 'select', selected: [], deselected: [this.currentFeature] })\r\n    this.currentFeature = null;\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry());\r\n    if (coord) {\r\n      coord = coord.coord;\r\n      var p = this.getMap().getPixelFromCoordinate(coord);\r\n      if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n        c = coord;\r\n      }\r\n      //\r\n      if (this.currentFeature !== f) this.dispatchEvent({ type: 'select', selected: [f], deselected: [this.currentFeature] })\r\n      this.currentFeature = f;\r\n      return { source:source, feature:f, coord: c };\r\n    }\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {ol.geom} coords list of coordinates\r\n* @return {*} the nearest point with a coord (projected point), dist (distance to the geom), ring (if Polygon)\r\n*/\r\nol_interaction_ModifyFeature.prototype.getNearestCoord = function(pt, geom) {\r\n  var i, l, p, p0, dm;\r\n  switch (geom.getType()) {\r\n    case 'Point': {\r\n      return { coord: geom.getCoordinates(), dist: ol_coordinate_dist2d(geom.getCoordinates(), pt) };\r\n    }\r\n    case 'MultiPoint': {\r\n      return this.getNearestCoord (pt, new ol_geom_LineString(geom.getCoordinates()));\r\n    }\r\n    case 'LineString':\r\n    case 'LinearRing': {\r\n      var d;\r\n      dm = Number.MAX_VALUE;\r\n      var coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        d = ol_coordinate_dist2d (pt, coords[i]);\r\n        if (d < dm) {\r\n          dm = d;\r\n          p0 = coords[i];\r\n        }\r\n      }\r\n      return { coord: p0, dist: dm };\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      p0 = false, dm = Number.MAX_VALUE;\r\n      for (i=0; l=lstring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=lring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=poly[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.poly = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'GeometryCollection': {\r\n      var g = geom.getGeometries();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=g[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.geom = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    default: return false;\r\n  }\r\n};\r\n\r\n/** Get arcs concerned by a modification \r\n * @param {ol.geom} geom the geometry concerned\r\n * @param {ol.coordinate} coord pointed coordinates\r\n */\r\nol_interaction_ModifyFeature.prototype.getArcs = function(geom, coord) {\r\n  var arcs = false;\r\n  var coords, i, s, l, g;\r\n  switch(geom.getType()) {\r\n    case 'Point': {\r\n      if (ol_coordinate_equal(coord, geom.getCoordinates())) {\r\n        arcs = { \r\n          geom: geom, \r\n          type: geom.getType(),\r\n          coord1: [],\r\n          coord2: [],\r\n          node: true\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        if (ol_coordinate_equal(coord, coords[i])) {\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            index: i,\r\n            coord1: [],\r\n            coord2: [],\r\n            node: true\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'LinearRing': \r\n    case 'LineString': {\r\n      var p = geom.getClosestPoint(coord);\r\n      if (ol_coordinate_dist2d(p,coord) < 1.5*this.tolerance_) {\r\n        var split;\r\n        // Split the line in two\r\n        if (geom.getType() === 'LinearRing') {\r\n          g = new ol_geom_LineString(geom.getCoordinates());\r\n          split = g.splitAt(coord, this.tolerance_);\r\n        } else {\r\n          split = geom.splitAt(coord, this.tolerance_);\r\n        }\r\n        // If more than 2\r\n        if (split.length>2) {\r\n          coords = split[1].getCoordinates();\r\n          for (i=2; s=split[i]; i++) {\r\n            var c = s.getCoordinates();\r\n            c.shift();\r\n            coords = coords.concat(c);\r\n          }\r\n          split = [ split[0], new ol_geom_LineString(coords) ];\r\n        }\r\n        // Split in two\r\n        if (split.length === 2) {\r\n          var c0 = split[0].getCoordinates();\r\n          var c1 = split[1].getCoordinates();\r\n          var nbpt = c0.length + c1.length -1;\r\n          c0.pop();\r\n          c1.shift();\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            coord1: c0, \r\n            coord2: c1,\r\n            node: (geom.getCoordinates().length === nbpt),\r\n            closed: false\r\n          }\r\n        } else if (split.length === 1) {\r\n          s = split[0].getCoordinates();\r\n          var start = ol_coordinate_equal(s[0], coord);\r\n          var end = ol_coordinate_equal(s[s.length-1], coord);\r\n          // Move first point\r\n          if (start) {\r\n            s.shift();\r\n            if (end) s.pop();\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: [], \r\n              coord2: s,\r\n              node: true,\r\n              closed: end\r\n            }\r\n          } else if (end) {\r\n            // Move last point\r\n            s.pop()\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: s, \r\n              coord2: [],\r\n              node: true,\r\n              closed: false\r\n            }\r\n          }\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      for (i=0; l=lstring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.lstring = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      for (i=0; l=lring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.index = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      for (i=0; l=poly[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.poly = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      g = geom.getGeometries();\r\n      for (i=0; l=g[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.g = i;\r\n          arcs.typeg = arcs.type;\r\n          arcs.type = geom.getType();\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      console.error('ol/interaction/ModifyFeature '+geom.getType()+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return arcs;\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDownEvent = function(evt) {\r\n  if (!this.getActive()) return false;\r\n\r\n  // Something to move ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current && (this._condition(evt) || this._deleteCondition(evt))) {\r\n    var features = [];\r\n    this.arcs = [];\r\n\r\n    // Get features concerned\r\n    this.sources_.forEach(function(s) {\r\n      var extent = ol_extent_buffer (ol_extent_boundingExtent([current.coord]), this.tolerance_);\r\n      features = features.concat(features, s.getFeaturesInExtent(extent));\r\n    }.bind(this));\r\n\r\n    // Get arcs concerned\r\n    this._modifiedFeatures = [];\r\n    features.forEach(function(f) {\r\n      var a = this.getArcs(f.getGeometry(), current.coord);\r\n      if (a) {\r\n        if (this._insertVertexCondition(evt) || a.node) {\r\n          a.feature = f;\r\n          this._modifiedFeatures.push(f);\r\n          this.arcs.push(a);\r\n        }\r\n      }\r\n    }.bind(this));\r\n\r\n    if (this._modifiedFeatures.length) {\r\n      if (this._deleteCondition(evt)) {\r\n        return !this._removePoint(current, evt); \r\n      } else {\r\n        this.dispatchEvent({ \r\n          type:'modifystart', \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent,\r\n          features: this._modifiedFeatures\r\n        });\r\n        this.handleDragEvent({ \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent\r\n        })\r\n        return true;\r\n      }\r\n    } else {\r\n      return true;\r\n    }\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Get modified features\r\n * @return {Array<ol.Feature>} list of modified features\r\n */\r\nol_interaction_ModifyFeature.prototype.getModifiedFeatures = function() {\r\n  return this._modifiedFeatures || [];\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n */\r\nol_interaction_ModifyFeature.prototype.removePoint = function() {\r\n  this._removePoint({},{});\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._getModification = function(a) {\r\n  var coords = a.coord1.concat(a.coord2);\r\n  switch (a.type) {\r\n    case 'LineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        if (a.geom.getCoordinates().length != coords.length) {\r\n          a.coords = coords;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        var c = a.geom.getCoordinates();\r\n        if (c[a.lstring].length != coords.length) {\r\n          c[a.lstring] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.index].length != coords.length) {\r\n          c[a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.poly][a.index].length != coords.length) {\r\n          c[a.poly][a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      var found = this._getModification(a);\r\n      // Restore current arc\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      return found;\r\n    }\r\n    default: {\r\n      //console.error('ol/interaction/ModifyFeature '+a.type+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._removePoint = function(current, evt) {\r\n  if (!this.arcs) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n\r\n  var found = false;\r\n  // Get all modifications\r\n  this.arcs.forEach(function(a) {\r\n    found = found || this._getModification(a);\r\n  }.bind(this));\r\n\r\n  // Almost one point is removed\r\n  if (found) {\r\n    this.dispatchEvent({ \r\n      type:'modifystart', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n    this.arcs.forEach(function(a) {\r\n      if (a.geom.getType() === 'GeometryCollection') {\r\n        if (a.coords) {\r\n          var geoms = a.geom.getGeometries();\r\n          geoms[a.g].setCoordinates(a.coords);\r\n          a.geom.setGeometries(geoms);\r\n        }\r\n      } else {\r\n        if (a.coords) a.geom.setCoordinates(a.coords);\r\n      }\r\n    }.bind(this));\r\n    this.dispatchEvent({ \r\n      type:'modifyend', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n  }\r\n\r\n  this.arcs = [];\r\n  return found;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleUpEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs || !this.arcs.length) return true;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  this.dispatchEvent({ \r\n    type:'modifyend', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n  \r\n  this.arcs = [];\r\n  return true;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.setArcCoordinates = function(a, coords) {\r\n  var c;\r\n  switch (a.type) {\r\n    case 'Point': {\r\n      a.geom.setCoordinates(coords[0]);\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords[0];\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      a.geom.setCoordinates(coords);\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.lstring] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.poly][a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      this.setArcCoordinates(a, coords);\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      break;\r\n    }\r\n  }\r\n};\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDragEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs) return true;\r\n\r\n  // Show sketch\r\n  this.overlayLayer_.getSource().clear();\r\n  var p = new ol_Feature(new ol_geom_Point(e.coordinate));\r\n  this.overlayLayer_.getSource().addFeature(p);\r\n\r\n  // Nothing to do\r\n  if (!this.arcs.length) return true;\r\n\r\n  // Move arcs\r\n  this.arcs.forEach(function(a) {\r\n    var coords = a.coord1.concat([e.coordinate], a.coord2);\r\n    if (a.closed) coords.push(e.coordinate);\r\n    this.setArcCoordinates(a, coords);\r\n  }.bind(this));\r\n\r\n  this.dispatchEvent({ \r\n    type:'modifying', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleMoveEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  // Draw sketch\r\n  if (current) {\r\n    var p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n  }\r\n\r\n  // Show cursor\r\n  var element = e.map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/** Get the current feature to modify\r\n * @return {ol.Feature} \r\n */\r\nol_interaction_ModifyFeature.prototype.getCurrentFeature = function() {\r\n  return this.currentFeature;\r\n};\r\n\r\nexport default ol_interaction_ModifyFeature","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {fromCircle as ol_geom_Polygon_fromCircle} from 'ol/geom/Polygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_Feature from 'ol/Feature'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart, drawing, drawend, drawcancel\r\n * @param {olx.interaction.TransformOptions} options\r\n *  @param {Array<ol.Layer>} source Destination source for the drawn features\r\n *  @param {ol.Collection<ol.Feature>} features Destination collection for the drawn features \r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} style style for the sketch\r\n *  @param {integer} sides number of sides, default 0 = circle\r\n *  @param { ol.events.ConditionType | undefined } squareCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw square features.\r\n *  @param { ol.events.ConditionType | undefined } centerCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw centered features.\r\n *  @param { bool } canRotate Allow rotation when centered + square, default: true\r\n *  @param { number } clickTolerance click tolerance on touch devices, default: 6\r\n *  @param { number } maxCircleCoordinates Maximum number of point on a circle, default: 100\r\n */\r\nvar ol_interaction_DrawRegular = function(options) {\r\n  if (!options) options={};\r\n\r\n  this.squaredClickTolerance_ = options.clickTolerance ? options.clickTolerance * options.clickTolerance : 36;\r\n  this.maxCircleCoordinates_ = options.maxCircleCoordinates || 100;\r\n\r\n  // Collection of feature to transform \r\n  this.features_ = options.features;\r\n  // List of layers to transform \r\n  this.source_ = options.source;\r\n  // Square condition\r\n  this.squareFn_ = options.squareCondition;\r\n  // Centered condition\r\n  this.centeredFn_ = options.centerCondition;\r\n  // Allow rotation when centered + square\r\n  this.canRotate_ = (options.canRotate !== false);\r\n  // Specify custom geometry name\r\n  this.geometryName_ = options.geometryName\r\n\r\n  // Number of sides (default=0: circle)\r\n  this.setSides(options.sides);\r\n\r\n  // Style\r\n  var defaultStyle = ol_style_Style_defaultStyle(true);\r\n\r\n  // Create a new overlay layer for the sketch\r\n  this.sketch_ = new ol_Collection();\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.sketch_,\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'DrawRegular overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: options.style || defaultStyle\r\n  });\r\n\r\n  ol_interaction_Interaction.call(this, {\t\r\n      /*\r\n      handleDownEvent: this.handleDownEvent_,\r\n      handleMoveEvent: this.handleMoveEvent_,\r\n      handleUpEvent: this.handleUpEvent_,\r\n      */\r\n      handleEvent: this.handleEvent_\r\n    });\r\n};\r\nol_ext_inherits(ol_interaction_DrawRegular, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setActive = function(b) {\r\n  this.reset();\r\n  ol_interaction_Interaction.prototype.setActive.call (this, b);\r\n}\r\n\r\n/**\r\n * Reset the interaction\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.reset = function() {\r\n  this.overlayLayer_.getSource().clear();\r\n  this.started_ = false;\r\n}\r\n\r\n/**\r\n * Set the number of sides.\r\n * @param {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setSides = function (nb) {\r\n  nb = parseInt(nb);\r\n  this.sides_ = nb>2 ? nb : 0;\r\n}\r\n\r\n/**\r\n * Allow rotation when centered + square\r\n * @param {bool} \r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.canRotate = function (b) {\r\n  if (b===true || b===false) this.canRotate_ = b;\r\n  return this.canRotate_;\r\n}\r\n\r\n/**\r\n * Get the number of sides.\r\n * @return {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.getSides = function () {\r\n  return this.sides_;\r\n}\r\n\r\n/** Default start angle array for each sides\r\n*/\r\nol_interaction_DrawRegular.prototype.startAngle = {\r\n  'default':Math.PI/2,\r\n  3: -Math.PI/2,\r\n  4: Math.PI/4\r\n};\r\n\r\n/** Get geom of the current drawing\r\n* @return {ol.geom.Polygon | ol.geom.Point}\r\n*/\r\nol_interaction_DrawRegular.prototype.getGeom_ = function () {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.center_) return false;\r\n\r\n  var g;\r\n  if (this.coord_) {\r\n    var center = this.center_;\r\n    var coord = this.coord_;\r\n\r\n    // Specific case: circle\r\n    var d, dmax, r, circle, centerPx;\r\n    if (!this.sides_ && this.square_ && !this.centered_) {\r\n      center = [(coord[0] + center[0])/2, (coord[1] + center[1])/2];\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      circle = new ol_geom_Circle(center, r, 'XY');\r\n      // Optimize points on the circle\r\n      centerPx = this.getMap().getPixelFromCoordinate(center);\r\n      dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n      dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / 3 ));\r\n      return ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n    } else {\r\n      var hasrotation = this.canRotate_ && this.centered_ && this.square_;\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      if (this.square_ && !hasrotation) {\r\n        //var d = [coord[0] - center[0], coord[1] - center[1]];\r\n        var dm = Math.max (Math.abs(d[0]), Math.abs(d[1])); \r\n        coord = [ \r\n          center[0] + (d[0]>0 ? dm:-dm),\r\n          center[1] + (d[1]>0 ? dm:-dm)\r\n        ];\r\n      }\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      if (r>0) {\r\n        circle = new ol_geom_Circle(center, r, 'XY');\r\n        var a;\r\n        if (hasrotation) a = Math.atan2(d[1], d[0]);\r\n        else a = this.startAngle[this.sides_] || this.startAngle['default'];\r\n\r\n        if (this.sides_) {\r\n          g = ol_geom_Polygon_fromCircle (circle, this.sides_, a);\r\n        } else {\r\n          // Optimize points on the circle\r\n          centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n          dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n          dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / (this.centered_ ? 3:5) ));\r\n          g = ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n        }\r\n\r\n        if (hasrotation) return g;\r\n      \r\n        // Scale polygon to fit extent\r\n        var ext = g.getExtent();\r\n        if (!this.centered_) center = this.center_;\r\n        else center = [ 2*this.center_[0]-this.coord_[0], 2*this.center_[1]-this.coord_[1] ];\r\n        var scx = (center[0] - coord[0]) / (ext[0] - ext[2]);\r\n        var scy = (center[1] - coord[1]) / (ext[1] - ext[3]);\r\n        if (this.square_) {\r\n          var sc = Math.min(Math.abs(scx),Math.abs(scy));\r\n          scx = Math.sign(scx)*sc;\r\n          scy = Math.sign(scy)*sc;\r\n        }\r\n        var t = [ center[0] - ext[0]*scx, center[1] - ext[1]*scy ];\r\n      \r\n        g.applyTransform(function(g1, g2, dim) {\r\n          for (var i=0; i<g1.length; i+=dim) {\r\n            g2[i] = g1[i]*scx + t[0];\r\n            g2[i+1] = g1[i+1]*scy + t[1];\r\n          }\r\n          return g2;\r\n        });\r\n        return g;\r\n      }\r\n    }\r\n  }\r\n\r\n  // No geom => return a point\r\n  return new ol_geom_Point(this.center_);\r\n};\r\n\r\n/** Draw sketch\r\n* @return {ol.Feature} The feature being drawn.\r\n*/\r\nol_interaction_DrawRegular.prototype.drawSketch_ = function(evt) {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (evt) {\r\n    this.square_ = this.squareFn_ ? this.squareFn_(evt) : evt.originalEvent.shiftKey;\r\n    this.centered_ = this.centeredFn_ ? this.centeredFn_(evt) : evt.originalEvent.metaKey || evt.originalEvent.ctrlKey;\r\n    var g = this.getGeom_();\r\n    if (g) {\r\n      var f = this.feature_;\r\n      if (this.geometryName_) f.setGeometryName(this.geometryName_)\r\n\r\n      //f.setGeometry (g);\r\n      if (g.getType()==='Polygon') f.getGeometry().setCoordinates(g.getCoordinates());\r\n      this.overlayLayer_.getSource().addFeature(f);\r\n      if (this.coord_ \r\n        && this.square_ \r\n        && ((this.canRotate_ && this.centered_ && this.coord_) || (!this.sides_ && !this.centered_))) {\r\n        this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_LineString([this.center_,this.coord_])));\r\n      }\r\n      return f;\r\n    }\r\n  }\r\n};\r\n\r\n/** Draw sketch (Point)\r\n*/\r\nol_interaction_DrawRegular.prototype.drawPoint_ = function(pt, noclear) {\r\n  if (!noclear) this.overlayLayer_.getSource().clear();\r\n  this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_Point(pt)));\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleEvent_ = function(evt) {\r\n  var dx, dy;\r\n  // Event date time\r\n  this._eventTime = new Date();\r\n  switch (evt.type) {\r\n    case \"pointerdown\": {\r\n      this.downPx_ = evt.pixel;\r\n      this.start_(evt);\r\n      // Test long touch\r\n      var dt = 500;\r\n      this._longTouch = false;\r\n      setTimeout(function() {\r\n        this._longTouch = (new Date() - this._eventTime > .9*dt);\r\n        if (this._longTouch) this.handleMoveEvent_(evt);\r\n      }.bind(this), dt);\r\n      break;\r\n    }\r\n    case \"pointerup\": {\r\n      // Started and fisrt move\r\n      if (this.started_ && this.coord_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          // The pointer has moved\r\n          if ( this.lastEvent == \"pointermove\" || this.lastEvent == \"keydown\" ) {\r\n            this.end_(evt);\r\n          }\r\n          // On touch device there is no move event : terminate = click on the same point\r\n          else {\r\n            dx = this.upPx_[0] - evt.pixel[0];\r\n            dy = this.upPx_[1] - evt.pixel[1];\r\n            if ( dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n              this.end_(evt);\r\n            } else  {\r\n              this.handleMoveEvent_(evt);\r\n              this.drawPoint_(evt.coordinate,true);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.upPx_ = evt.pixel;\t\r\n      break;\r\n    }\r\n    case \"pointerdrag\": {\r\n      if (this.started_) {\r\n        var centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n        dx = centerPx[0] - evt.pixel[0];\r\n        dy = centerPx[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          this.reset();\r\n        }\r\n      }\r\n      return !this._longTouch;\r\n      // break;\r\n    }\r\n    case \"pointermove\": {\r\n      if (this.started_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy > this.squaredClickTolerance_) {\r\n          this.handleMoveEvent_(evt);\r\n          this.lastEvent = evt.type;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      this.lastEvent = evt.type;\r\n      // Prevent zoom in on dblclick\r\n      if (this.started_ && evt.type==='dblclick') {\r\n        //evt.stopPropagation();\r\n        return false;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/** Stop drawing.\r\n */\r\nol_interaction_DrawRegular.prototype.finishDrawing = function() {\r\n  if (this.started_ && this.coord_) {\r\n    this.end_({ pixel: this.upPx_, coordinate: this.coord_});\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleMoveEvent_ = function(evt) {\r\n  if (this.started_) {\r\n    this.coord_ = evt.coordinate;\r\n    this.coordPx_ = evt.pixel;\r\n    var f = this.drawSketch_(evt);\r\n    this.dispatchEvent({ \r\n      type:'drawing', \r\n      feature: f, \r\n      pixel: evt.pixel, \r\n      startCoordinate: this.center_,\r\n      coordinate: evt.coordinate, \r\n      square: this.square_, \r\n      centered: this.centered_ \r\n    });\r\n  } else  {\r\n    this.drawPoint_(evt.coordinate);\r\n  }\r\n};\r\n\r\n/** Start an new draw\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.start_ = function(evt) {\r\n  if (!this.started_) {\r\n    this.started_ = true;\r\n    this.center_ = evt.coordinate;\r\n    this.coord_ = null;\r\n    var geom = new ol_geom_Polygon([[evt.coordinate,evt.coordinate,evt.coordinate]]);\r\n    var f = this.feature_ = new ol_Feature(geom);\r\n    this.drawSketch_(evt);\r\n    this.dispatchEvent({ type:'drawstart', feature: f, pixel: evt.pixel, coordinate: evt.coordinate });\r\n  } else {\r\n    this.coord_ = evt.coordinate;\r\n  }\r\n};\r\n\r\n/** End drawing\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.end_ = function(evt) {\r\n  this.coord_ = evt.coordinate;\r\n  this.started_ = false;\r\n  if (this.coord_ && (this.center_[0]!==this.coord_[0] || this.center_[1]!==this.coord_[1])) {\r\n    var f = this.feature_;\r\n    if (this.geometryName_) f.setGeometryName(this.geometryName_)\r\n\r\n    f.setGeometry(this.getGeom_());\r\n    if (this.source_) this.source_.addFeature(f);\r\n    else if (this.features_) this.features_.push(f);\r\n    this.dispatchEvent({ type:'drawend', feature: f, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  } else {\r\n    this.dispatchEvent({ type:'drawcancel', feature: null, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  }\r\n\r\n  this.center_ = this.coord_ = null;\r\n  this.drawSketch_();\r\n};\r\n\r\nexport default ol_interaction_DrawRegular\r\n","/*\tCopyright (c) 2017 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\n/** Interaction to draw holes in a polygon.\r\n * It fires a drawstart, drawend event when drawing the hole\r\n * and a modifystart, modifyend event before and after inserting the hole in the feature geometry.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart\r\n * @fires drawend\r\n * @fires modifystart\r\n * @fires modifyend\r\n * @param {olx.interaction.DrawHoleOptions} options extend olx.interaction.DrawOptions\r\n * \t@param {Array<ol.layer.Vector> | function | undefined} options.layers A list of layers from which polygons should be selected. Alternatively, a filter function can be provided. default: all visible layers\r\n * \t@param {Array<ol.Feature> | ol.Collection<ol.Feature> | function | undefined} options.features An array or a collection of features the interaction applies on or a function that takes a feature and a layer and returns true if the feature is a candidate\r\n * \t@param { ol.style.Style | Array<ol.style.Style> | StyleFunction | undefined }\tStyle for the selected features, default: default edit style\r\n */\r\nvar ol_interaction_DrawHole = function(options) {\r\n  if (!options) options = {};\r\n  var self = this;\r\n\r\n  // Select interaction for the current feature\r\n  this._select = new ol_interaction_Select({ style: options.style });\r\n  this._select.setActive(false);\r\n\r\n  // Geometry function that test points inside the current\r\n  var geometryFn, geomFn = options.geometryFunction;\r\n  if (geomFn) {\r\n    geometryFn = function(c,g) {\r\n      g = self._geometryFn (c, g);\r\n      return geomFn (c,g);\r\n    }\r\n  } else {\r\n    geometryFn = function(c,g) { return self._geometryFn (c, g); }\r\n  }\r\n\r\n  // Create draw interaction\r\n  options.type = \"Polygon\";\r\n  options.geometryFunction = geometryFn;\r\n  ol_interaction_Draw.call(this, options);\r\n\r\n  // Layer filter function\r\n  if (options.layers) {\r\n    if (typeof (options.layers) === 'function') {\r\n      this.layers_ = options.layers;\r\n    } else if (options.layers.indexOf) {\r\n      this.layers_ = function(l) {\r\n        return (options.layers.indexOf(l) >= 0); \r\n      };\r\n    }\r\n  }\r\n\r\n  // Features to apply on \r\n  if (typeof(options.features) === 'function') {\r\n    this._features = options.features;\r\n  } else if (options.features) {\r\n    var features = options.features;\r\n    this._features = function(f) {\r\n      if (features.indexOf) {\r\n        return !!features[features.indexOf(f)];\r\n      } else {\r\n        return !!features.item(features.getArray().indexOf(f));\r\n      }\r\n    }\r\n  } else {\r\n    this._features = function() { return true }\r\n  }\r\n\r\n  // Start drawing if inside a feature\r\n  this.on('drawstart', this._startDrawing.bind(this));\r\n  // End drawing add the hole to the current Polygon\r\n  this.on('drawend', this._finishDrawing.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_DrawHole, ol_interaction_Draw);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeInteraction(this._select);\r\n  if (map) map.addInteraction(this._select);\r\n  ol_interaction_Draw.prototype.setMap.call (this, map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setActive = function(b) {\r\n  this._select.getFeatures().clear();\r\n  ol_interaction_Draw.prototype.setActive.call (this, b);\r\n};\r\n\r\n/**\r\n * Remove last point of the feature currently being drawn \r\n * (test if points to remove before).\r\n */\r\nol_interaction_DrawHole.prototype.removeLastPoint = function() {\r\n  if (this._feature && this._feature.getGeometry().getCoordinates()[0].length>2) {\r\n    ol_interaction_Draw.prototype.removeLastPoint.call(this);\r\n  }\r\n};\r\n\r\n/** \r\n * Get the current polygon to hole\r\n * @return {ol.Feature}\r\n */\r\nol_interaction_DrawHole.prototype.getPolygon = function() {\r\n  return this._polygon;\r\n  // return this._select.getFeatures().item(0).getGeometry();\r\n};\r\n\r\n/**\r\n * Get current feature to add a hole and start drawing\r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._startDrawing = function(e) {\r\n  var map = this.getMap();\r\n  this._feature = e.feature;\r\n  var coord = e.feature.getGeometry().getCoordinates()[0][0];\r\n  this._current = null;\r\n  // Check object under the pointer\r\n  map.forEachFeatureAtPixel(\r\n    map.getPixelFromCoordinate(coord),\r\n    function(feature, layer) {\r\n      if (this._features(feature, layer)) {\r\n        var poly = feature.getGeometry();\r\n        if (poly.getType() === \"Polygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          this._polygonIndex = false;\r\n          this._polygon = poly;\r\n          this._current = feature;\r\n        } else if (poly.getType() === \"MultiPolygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          for (var i=0, p; p=poly.getPolygon(i); i++) {\r\n            if (p.intersectsCoordinate(coord)) {\r\n              this._polygonIndex = i;\r\n              this._polygon = p;\r\n              this._current = feature;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }.bind(this), {\r\n      layerFilter: this.layers_\r\n    }\r\n  );\r\n  this._select.getFeatures().clear();\r\n  if (!this._current) {\r\n    this.setActive(false);\r\n    this.setActive(true);\r\n  } else {\r\n    this._select.getFeatures().push(this._current);\r\n  }\r\n};\r\n\r\n/**\r\n * Stop drawing and add the sketch feature to the target feature. \r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._finishDrawing = function(e) {\r\n  // The feature is the hole\r\n  e.hole = e.feature;\r\n  // Get the current feature\r\n  e.feature = this._select.getFeatures().item(0);\r\n  this.dispatchEvent({ type: 'modifystart', features: [ this._current ] });\r\n  // Create the hole\r\n  var c = e.hole.getGeometry().getCoordinates()[0];\r\n  if (c.length > 3) {\r\n    if (this._polygonIndex!==false) {\r\n      var geom = e.feature.getGeometry();\r\n      var newGeom = new ol_geom_MultiPolygon([]);\r\n      for (var i=0, pi; pi=geom.getPolygon(i); i++) {\r\n        if (i===this._polygonIndex) {\r\n          pi.appendLinearRing(new ol_geom_LinearRing(c));\r\n          newGeom.appendPolygon(pi);\r\n        } else {\r\n          newGeom.appendPolygon(pi);\r\n        }\r\n      }\r\n      e.feature.setGeometry(newGeom);\r\n    } else {\r\n      this.getPolygon().appendLinearRing(new ol_geom_LinearRing(c));\r\n    }\r\n  }\r\n  this.dispatchEvent({ type: 'modifyend', features: [ this._current ] });\r\n  // reset\r\n  this._feature = null;\r\n  this._select.getFeatures().clear();\r\n};\r\n\r\n/**\r\n * Function that is called when a geometry's coordinates are updated.\r\n * @param {Array<ol.coordinate>} coordinates\r\n * @param {ol_geom_Polygon} geometry\r\n * @return {ol_geom_Polygon}\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._geometryFn = function(coordinates, geometry) {\r\n  var coord = coordinates[0].pop();\r\n  if (!this.getPolygon() || this.getPolygon().intersectsCoordinate(coord)) {\r\n    this.lastOKCoord = [coord[0],coord[1]];\r\n  }\r\n  coordinates[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]);\r\n\r\n  if (geometry) {\r\n    geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n  } else {\r\n    geometry = new ol_geom_Polygon(coordinates);\r\n  }\r\n  return geometry;\r\n};\r\n\r\nexport default ol_interaction_DrawHole\r\n","import ol_ext_inherits from '../util/ext'\r\nimport {shiftKeyOnly as ol_events_condition_shiftKeyOnly} from 'ol/events/condition'\r\nimport {click as ol_events_condition_click} from 'ol/events/condition'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\nimport ol_control_Bar from './Bar'\r\nimport ol_control_Button from './Button'\r\nimport ol_control_Toggle from './Toggle'\r\nimport ol_control_TextButton from './TextButton'\r\nimport ol_interaction_Delete from '../interaction/Delete'\r\nimport ol_ext_element from '../util/element'\r\nimport ol_interaction_Offset from '../interaction/Offset'\r\nimport ol_interaction_Split from '../interaction/Split'\r\nimport ol_interaction_Transform from '../interaction/Transform'\r\nimport ol_interaction_ModifyFeature from '../interaction/ModifyFeature'\r\nimport ol_interaction_DrawRegular from '../interaction/DrawRegular'\r\nimport ol_interaction_DrawHole from '../interaction/DrawHole'\r\n\r\n/** Control bar for editing in a layer\r\n * @constructor\r\n * @extends {ol_control_Bar}\r\n * @fires info\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.target Specify a target if you want the control to be rendered outside of the map's viewport.\r\n *\t@param {boolean} options.edition false to remove the edition tools, default true\r\n *\t@param {Object} options.interactions List of interactions to add to the bar \r\n *    ie. Select, Delete, Info, DrawPoint, DrawLine, DrawPolygon\r\n *    Each interaction can be an interaction or true (to get the default one) or false to remove it from bar\r\n *\t@param {ol.source.Vector} options.source Source for the drawn features. \r\n */\r\nvar ol_control_EditBar = function(options) {\r\n  options = options || {};\r\n  options.interactions = options.interactions || {};\r\n\r\n  // New bar\r\n\tol_control_Bar.call(this, {\r\n    className: (options.className ? options.className+' ': '') + 'ol-editbar',\r\n    toggleOne: true,\r\n\t\ttarget: options.target\r\n  });\r\n\r\n  this._source = options.source;\r\n  // Add buttons / interaction\r\n  this._interactions = {};\r\n  this._setSelectInteraction(options);\r\n  if (options.edition!==false) this._setEditInteraction(options);\r\n  this._setModifyInteraction(options);\r\n};\r\nol_ext_inherits(ol_control_EditBar, ol_control_Bar);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_EditBar.prototype.setMap = function (map) {\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().removeInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().removeInteraction(this._interactions.ModifySelect);\r\n  }\r\n  \r\n  ol_control_Bar.prototype.setMap.call(this, map);\r\n\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().addInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n  }\r\n};\r\n\r\n/** Get an interaction associated with the bar\r\n * @param {string} name \r\n */\r\nol_control_EditBar.prototype.getInteraction = function (name) {\r\n  return this._interactions[name];\r\n};\r\n\r\n/** Get the option title */\r\nol_control_EditBar.prototype._getTitle = function (option) {\r\n  return (option && option.title) ? option.title : option;\r\n};\r\n\r\n/** Add selection tool:\r\n * 1. a toggle control with a select interaction\r\n * 2. an option bar to delete / get information on the selected feature\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setSelectInteraction = function (options) {\r\n  var self = this;\r\n  \r\n  // Sub bar\r\n  var sbar = new ol_control_Bar();\r\n  var selectCtrl;\r\n\r\n  // Delete button\r\n  if (options.interactions.Delete !== false) {\r\n    if (options.interactions.Delete instanceof ol_interaction_Delete) {\r\n      this._interactions.Delete = options.interactions.Delete; \r\n    } else {\r\n      this._interactions.Delete = new ol_interaction_Delete();\r\n    }\r\n    var del = this._interactions.Delete;\r\n    del.setActive(false);\r\n    if (this.getMap()) this.getMap().addInteraction(del);\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-delete',\r\n      title: this._getTitle(options.interactions.Delete) || \"Delete\",\r\n      name: 'Delete',\r\n      handleClick: function(e) {\r\n        // Delete selection\r\n        del.delete(selectCtrl.getInteraction().getFeatures());\r\n        var evt = {\r\n          type: 'select',\r\n          selected: [],\r\n          deselected: selectCtrl.getInteraction().getFeatures().getArray().slice(),\r\n          mapBrowserEvent: e.mapBrowserEvent\r\n        };\r\n        selectCtrl.getInteraction().getFeatures().clear();\r\n        selectCtrl.getInteraction().dispatchEvent(evt);\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Info button\r\n  if (options.interactions.Info !== false) {\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-info',\r\n      name: 'Info',\r\n      title: this._getTitle(options.interactions.Info) || \"Show informations\",\r\n      handleClick: function() {\r\n        self.dispatchEvent({ \r\n          type: 'info', \r\n          features: selectCtrl.getInteraction().getFeatures() \r\n        });\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Select button\r\n  if (options.interactions.Select !== false) {\r\n    if (options.interactions.Select instanceof ol_interaction_Select) {\r\n      this._interactions.Select = options.interactions.Select\r\n    } else {\r\n      this._interactions.Select = new ol_interaction_Select({\r\n        condition: ol_events_condition_click\r\n      });\r\n    }\r\n    var sel = this._interactions.Select;\r\n    selectCtrl = new ol_control_Toggle({\r\n      className: 'ol-selection',\r\n      name: 'Select',\r\n      title: this._getTitle(options.interactions.Select) || \"Select\",\r\n      interaction: sel,\r\n      bar: sbar.getControls().length ? sbar : undefined,\r\n      autoActivate:true,\r\n      active:true\r\n    });\r\n\r\n    this.addControl(selectCtrl);\r\n    sel.on('change:active', function() {\r\n      sel.getFeatures().clear();\r\n    });\r\n  }\r\n};\r\n\r\n\r\n/** Add editing tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setEditInteraction = function (options) {\r\n  if (options.interactions.DrawPoint !== false) {\r\n    if (options.interactions.DrawPoint instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawPoint = options.interactions.DrawPoint;\r\n    } else {\r\n      this._interactions.DrawPoint = new ol_interaction_Draw({\r\n        type: 'Point',\r\n        source: this._source\r\n      });\r\n    }\r\n    var pedit = new ol_control_Toggle({\r\n      className: 'ol-drawpoint',\r\n      name: 'DrawPoint',\r\n      title: this._getTitle(options.interactions.DrawPoint) || 'Point',\r\n      interaction: this._interactions.DrawPoint\r\n    });\r\n    this.addControl ( pedit );\r\n  }\r\n\r\n  if (options.interactions.DrawLine !== false) {\r\n    if (options.interactions.DrawLine instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawLine = options.interactions.DrawLine\r\n    } else {\r\n      this._interactions.DrawLine = new ol_interaction_Draw ({\r\n        type: 'LineString',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          if (geometry) geometry.setCoordinates(coordinates);\r\n          else geometry = new ol_geom_LineString(coordinates);\r\n          this.nbpts = geometry.getCoordinates().length;\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    var ledit = new ol_control_Toggle({\r\n      className: 'ol-drawline',\r\n      title: this._getTitle(options.interactions.DrawLine) || 'LineString',\r\n      name: 'DrawLine',\r\n      interaction: this._interactions.DrawLine,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n            title: this._getTitle(options.interactions.UndoDraw) || \"delete last point\",\r\n            handleClick: function() {\r\n              if (ledit.getInteraction().nbpts>1) ledit.getInteraction().removeLastPoint();\r\n            }\r\n          }),\r\n          new ol_control_TextButton ({\r\n            html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n            title: this._getTitle(options.interactions.FinishDraw) || \"finish\",\r\n            handleClick: function() {\r\n              // Prevent null objects on finishDrawing\r\n              if (ledit.getInteraction().nbpts>2) ledit.getInteraction().finishDrawing();\r\n            }\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n\r\n    this.addControl ( ledit );\r\n  }\r\n\r\n  if (options.interactions.DrawPolygon !== false) {\r\n    if (options.interactions.DrawPolygon instanceof ol_interaction_Draw){\r\n      this._interactions.DrawPolygon = options.interactions.DrawPolygon\r\n    } else {\r\n      this._interactions.DrawPolygon = new ol_interaction_Draw ({\r\n        type: 'Polygon',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          this.nbpts = coordinates[0].length;\r\n          if (geometry) geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n          else geometry = new ol_geom_Polygon(coordinates);\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawpolygon', \r\n      this._interactions.DrawPolygon, \r\n      this._getTitle(options.interactions.DrawPolygon) || 'Polygon', \r\n      'DrawPolygon',\r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw hole\r\n  if (options.interactions.DrawHole !== false) {\r\n    if (options.interactions.DrawHole instanceof ol_interaction_DrawHole){\r\n      this._interactions.DrawHole = options.interactions.DrawHole;\r\n    } else {\r\n      this._interactions.DrawHole = new ol_interaction_DrawHole ();\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawhole', \r\n      this._interactions.DrawHole, \r\n      this._getTitle(options.interactions.DrawHole) || 'Hole',\r\n      'DrawHole', \r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw regular\r\n  if (options.interactions.DrawRegular !== false) {\r\n    if (options.interactions.DrawRegular instanceof ol_interaction_DrawRegular) {\r\n      this._interactions.DrawRegular = options.interactions.DrawRegular\r\n    } else {\r\n      this._interactions.DrawRegular = new ol_interaction_DrawRegular ({\r\n        source: this._source,\r\n        sides: 4\r\n      });\r\n    }\r\n    var regular = this._interactions.DrawRegular;\r\n\r\n    var div = document.createElement('DIV');\r\n\r\n    var down = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(down, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() -1;\r\n      if (sides < 2) sides = 2;\r\n      regular.setSides (sides);\r\n      text.textContent = sides>2 ? sides+' pts' : 'circle';\r\n    }.bind(this));\r\n\r\n    var text = ol_ext_element.create('TEXT', { html:'4 pts', parent: div });\r\n    \r\n    var up = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(up, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() +1;\r\n      if (sides<3) sides=3;\r\n      regular.setSides(sides);\r\n      text.textContent = sides+' pts';\r\n    }.bind(this));\r\n\r\n    var ctrl = new ol_control_Toggle({\r\n      className: 'ol-drawregular',\r\n      title: this._getTitle(options.interactions.DrawRegular) || 'Regular',\r\n      name: 'DrawRegular',\r\n      interaction: this._interactions.DrawRegular,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: div\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n    this.addControl (ctrl);\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setDrawPolygon = function (className, interaction, title, name, options) {\r\n  var fedit = new ol_control_Toggle ({\r\n    className: className,\r\n    name: name,\r\n    title: title,\r\n    interaction: interaction,\r\n    // Options bar associated with the control\r\n    bar: new ol_control_Bar({\r\n      controls:[ \r\n        new ol_control_TextButton ({\r\n          html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n          title: this._getTitle(options.interactions.UndoDraw) || 'undo last point',\r\n          handleClick: function(){\r\n            if (fedit.getInteraction().nbpts>1) fedit.getInteraction().removeLastPoint();\r\n          }\r\n        }),\r\n        new ol_control_TextButton({\r\n          html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          title: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          handleClick: function() {\r\n            // Prevent null objects on finishDrawing\r\n            if (fedit.getInteraction().nbpts>3) fedit.getInteraction().finishDrawing();\r\n          }\r\n        })\r\n      ]\r\n    }) \r\n  });\r\n  this.addControl (fedit);\r\n  return fedit;\r\n};\r\n\r\n/** Add modify tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setModifyInteraction = function (options) {\r\n  // Modify on selected features\r\n  if (options.interactions.ModifySelect !== false && options.interactions.Select !== false) {\r\n    if (options.interactions.ModifySelect instanceof ol_interaction_ModifyFeature) {\r\n      this._interactions.ModifySelect = options.interactions.ModifySelect;\r\n    } else {\r\n      this._interactions.ModifySelect = new ol_interaction_ModifyFeature({\r\n        features: this.getInteraction('Select').getFeatures()\r\n      });\r\n    }\r\n    if (this.getMap()) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n    // Activate with select\r\n    this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    this._interactions.Select.on('change:active', function() {\r\n      this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    }.bind(this));\r\n  }\r\n\r\n  if (options.interactions.Transform !== false) {\r\n    if (options.interactions.Transform instanceof ol_interaction_Transform) {\r\n      this._interactions.Transform = options.interactions.Transform;\r\n    } else {\r\n      this._interactions.Transform = new ol_interaction_Transform ({\r\n        addCondition: ol_events_condition_shiftKeyOnly\r\n      });\r\n    }\r\n    var transform = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-transform',\r\n      title: this._getTitle(options.interactions.Transform) || 'Transform',\r\n      name: 'Transform',\r\n      interaction: this._interactions.Transform\r\n    });\r\n    this.addControl (transform);\r\n  }\r\n\r\n  if (options.interactions.Split !== false) {\r\n    if (options.interactions.Split instanceof ol_interaction_Split) {\r\n      this._interactions.Split = options.interactions.Split;\r\n    } else {\r\n      this._interactions.Split = new ol_interaction_Split ({\r\n          sources: this._source\r\n      });\r\n    }\r\n    var split = new ol_control_Toggle ({\r\n      className: 'ol-split',\r\n      title: this._getTitle(options.interactions.Split) || 'Split',\r\n      name: 'Split', \r\n      interaction: this._interactions.Split\r\n    });\r\n    this.addControl (split);\r\n  }\r\n\r\n  if (options.interactions.Offset !== false) {\r\n    if (options.interactions.Offset instanceof ol_interaction_Offset) {\r\n      this._interactions.Offset = options.interactions.Offset;\r\n    } else {\r\n      this._interactions.Offset = new ol_interaction_Offset ({\r\n          source: this._source\r\n      });\r\n    }\r\n    var offset = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-offset',\r\n      title: this._getTitle(options.interactions.Offset) || 'Offset',\r\n      name: 'Offset',\r\n      interaction: this._interactions.Offset\r\n    });\r\n    this.addControl (offset);\r\n  }\r\n\r\n};\r\n\r\nexport default ol_control_EditBar\r\n","/*\r\n  Copyright (c) 2015 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\n/**\r\n * @classdesc Swipe Control.\r\n *\r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} Control options.\r\n *  @param {ol.layer} options.layers layer to swipe\r\n *  @param {ol.layer} options.rightLayer layer to swipe on right side\r\n *  @param {string} options.className control class name\r\n *  @param {number} options.position position propertie of the swipe [0,1], default 0.5\r\n *  @param {string} options.orientation orientation propertie (vertical|horizontal), default vertical\r\n */\r\nvar ol_control_Swipe = function(options) {\r\n  options = options || {};\r\n\r\n  var button = document.createElement('button');\r\n\r\n  var element = document.createElement('div');\r\n  element.className = (options.className || \"ol-swipe\") + \" ol-unselectable ol-control\";\r\n  element.appendChild(button);\r\n\r\n  element.addEventListener(\"mousedown\", this.move.bind(this));\r\n  element.addEventListener(\"touchstart\", this.move.bind(this));\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element\r\n  });\r\n\r\n  // An array of listener on layer postcompose\r\n  this.precomposeRight_ = this.precomposeRight.bind(this);\r\n  this.precomposeLeft_ = this.precomposeLeft.bind(this);\r\n  this.postcompose_ = this.postcompose.bind(this);\r\n\r\n  this.layers = [];\r\n  if (options.layers) this.addLayer(options.layers, false);\r\n  if (options.rightLayers) this.addLayer(options.rightLayers, true);\r\n\r\n  this.on('propertychange', function() {\r\n    if (this.getMap()) this.getMap().renderSync();\r\n    if (this.get('orientation') === \"horizontal\") {\r\n      this.element.style.top = this.get('position')*100+\"%\";\r\n      this.element.style.left = \"\";\r\n    } else {\r\n      if (this.get('orientation') !== \"vertical\") this.set('orientation', \"vertical\");\r\n      this.element.style.left = this.get('position')*100+\"%\";\r\n      this.element.style.top = \"\";\r\n    }\r\n    this.element.classList.remove(\"horizontal\", \"vertical\");\r\n    this.element.classList.add(this.get('orientation'));\r\n  }.bind(this));\r\n\r\n  this.set('position', options.position || 0.5);\r\n  this.set('orientation', options.orientation || 'vertical');\r\n};\r\nol_ext_inherits(ol_control_Swipe, ol_control_Control);\r\n\r\n/**\r\n * Set the map instance the control associated with.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_Swipe.prototype.setMap = function(map) {\r\n  var i;\r\n  var l;\r\n\r\n  if (this.getMap()) {\r\n    for (i=0; i<this.layers.length; i++) {\r\n      l = this.layers[i];\r\n      if (l.right) l.layer.un(['precompose','prerender'], this.precomposeRight_);\r\n      else l.layer.un(['precompose','prerender'], this.precomposeLeft_);\r\n      l.layer.un(['postcompose','postrender'], this.postcompose_);\r\n    }\r\n    this.getMap().renderSync();\r\n  }\r\n\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n\r\n  if (map) {\r\n    this._listener = [];\r\n    for (i=0; i<this.layers.length; i++) {\r\n      l = this.layers[i];\r\n      if (l.right) l.layer.on(['precompose','prerender'], this.precomposeRight_);\r\n      else l.layer.on(['precompose','prerender'], this.precomposeLeft_);\r\n      l.layer.on(['postcompose','postrender'], this.postcompose_);\r\n    }\r\n    map.renderSync();\r\n  }\r\n};\r\n\r\n/** @private\r\n*/\r\nol_control_Swipe.prototype.isLayer_ = function(layer){\r\n  for (var k=0; k<this.layers.length; k++) {\r\n    if (this.layers[k].layer === layer) return k;\r\n  }\r\n  return -1;\r\n};\r\n\r\n/** Add a layer to clip\r\n *\t@param {ol.layer|Array<ol.layer>} layer to clip\r\n*\t@param {bool} add layer in the right part of the map, default left.\r\n*/\r\nol_control_Swipe.prototype.addLayer = function(layers, right) {\r\n  if (!(layers instanceof Array)) layers = [layers];\r\n  for (var i=0; i<layers.length; i++) {\r\n    var l = layers[i];\r\n    if (this.isLayer_(l) < 0) {\r\n      this.layers.push({ layer:l, right:right });\r\n      if (this.getMap()) {\r\n        if (right) l.on(['precompose','prerender'], this.precomposeRight_);\r\n        else l.on(['precompose','prerender'], this.precomposeLeft_);\r\n        l.on(['postcompose','postrender'], this.postcompose_);\r\n        this.getMap().renderSync();\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/** Remove a layer to clip\r\n *\t@param {ol.layer|Array<ol.layer>} layer to clip\r\n*/\r\nol_control_Swipe.prototype.removeLayer = function(layers) {\r\n  if (!(layers instanceof Array)) layers = [layers];\r\n  for (var i=0; i<layers.length; i++) {\r\n    var k = this.isLayer_(layers[i]);\r\n    if (k >=0 && this.getMap()) {\r\n      if (this.layers[k].right) layers[i].un(['precompose','prerender'], this.precomposeRight_);\r\n      else layers[i].un(['precompose','prerender'], this.precomposeLeft_);\r\n      layers[i].un(['postcompose','postrender'], this.postcompose_);\r\n      this.layers.splice(k,1);\r\n      this.getMap().renderSync();\r\n    }\r\n  }\r\n};\r\n\r\n/** @private\r\n*/\r\nol_control_Swipe.prototype.move = function(e) {\r\n  var self = this;\r\n  var l;\r\n  switch (e.type) {\r\n    case 'touchcancel':\r\n    case 'touchend':\r\n    case 'mouseup': {\r\n      self.isMoving = false;\r\n      [\"mouseup\", \"mousemove\", \"touchend\", \"touchcancel\", \"touchmove\"]\r\n        .forEach(function(eventName) {\r\n          document.removeEventListener(eventName, self.move);\r\n        });\r\n      break;\r\n    }\r\n    case 'mousedown':\r\n    case 'touchstart': {\r\n      self.isMoving = true;\r\n      [\"mouseup\", \"mousemove\", \"touchend\", \"touchcancel\", \"touchmove\"]\r\n        .forEach(function(eventName) {\r\n          document.addEventListener(eventName, self.move.bind(self));\r\n        });\r\n    }\r\n    // fallthrough\r\n    case 'mousemove':\r\n    case 'touchmove': {\r\n      if (self.isMoving) {\r\n        if (self.get('orientation') === \"vertical\") {\r\n          var pageX = e.pageX\r\n            || (e.touches && e.touches.length && e.touches[0].pageX)\r\n            || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n          if (!pageX) break;\r\n          pageX -= self.getMap().getTargetElement().getBoundingClientRect().left +\r\n            window.pageXOffset - document.documentElement.clientLeft;\r\n\r\n          l = self.getMap().getSize()[0];\r\n          l = Math.min(Math.max(0, 1-(l-pageX)/l), 1);\r\n          self.set('position', l);\r\n        } else {\r\n          var pageY = e.pageY\r\n            || (e.touches && e.touches.length && e.touches[0].pageY)\r\n            || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n          if (!pageY) break;\r\n          pageY -= self.getMap().getTargetElement().getBoundingClientRect().top +\r\n            window.pageYOffset - document.documentElement.clientTop;\r\n\r\n          l = self.getMap().getSize()[1];\r\n          l = Math.min(Math.max(0, 1-(l-pageY)/l), 1);\r\n          self.set('position', l);\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: break;\r\n  }\r\n};\r\n\r\nol_control_Swipe.prototype._drawRect = function(e, pts) {\r\n  var tr = e.inversePixelTransform;\r\n  if (tr) {\r\n    var r = [\r\n      [pts[0][0], pts[0][1]],\r\n      [pts[0][0], pts[1][1]],\r\n      [pts[1][0], pts[1][1]],\r\n      [pts[1][0], pts[0][1]],\r\n      [pts[0][0], pts[0][1]]\r\n    ];\r\n    r.forEach(function (pt, i) {\r\n      pt = [\r\n        (pt[0]*tr[0] - pt[1]*tr[1] + tr[4]),\r\n        (-pt[0]*tr[2] + pt[1]*tr[3] + tr[5])\r\n      ];\r\n      if (!i) {\r\n        e.context.moveTo(pt[0], pt[1]);\r\n      } else {\r\n        e.context.lineTo(pt[0], pt[1]);\r\n      }\r\n    });\r\n  } else {\r\n    var ratio = e.frameState.pixelRatio;\r\n    e.context.rect(pts[0][0]*ratio,pts[0][1]*ratio,pts[1][0]*ratio,pts[1][1]*ratio);\r\n  }\r\n};\r\n\r\n/** @private\r\n*/\r\nol_control_Swipe.prototype.precomposeLeft = function(e) {\r\n  var ctx = e.context;\r\n  var size = e.frameState.size;\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  var pts = [[0,0],[size[0],size[1]]];\r\n  if (this.get('orientation') === \"vertical\") {\r\n    pts[1] = [\r\n      size[0]*this.get('position'), \r\n      size[1]\r\n    ];\r\n  } else {\r\n    pts[1] = [\r\n      size[0],\r\n      size[1]*this.get('position')\r\n    ];\r\n  }\r\n  this._drawRect(e, pts);\r\n  ctx.clip();\r\n};\r\n\r\n/** @private\r\n*/\r\nol_control_Swipe.prototype.precomposeRight = function(e) {\r\n  var ctx = e.context;\r\n  var size = e.frameState.size;\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  var pts = [[0,0],[size[0],size[1]]];\r\n  if (this.get('orientation') === \"vertical\") {\r\n    pts[0] = [\r\n      size[0]*this.get('position'), \r\n      0\r\n    ];\r\n  } else {\r\n    pts[0] = [\r\n      0,\r\n      size[1]*this.get('position')\r\n    ]\r\n  }\r\n  this._drawRect(e, pts);\r\n  ctx.clip();\r\n};\r\n\r\n/** @private\r\n*/\r\nol_control_Swipe.prototype.postcompose = function(e) {\r\n  // restore context when decluttering is done\r\n  // https://github.com/openlayers/openlayers/issues/10096\r\n  if (e.target.getClassName()!=='ol-layer' && e.target.get('declutter')) {\r\n    setTimeout(function () {\r\n      e.context.restore();\r\n    }, 0);\r\n  } else {\r\n    e.context.restore();\r\n  }\r\n};\r\n\r\nexport default ol_control_Swipe\r\n","import ol_source_Vector from 'ol/source/Vector'\r\n\r\n(function () {\r\n  var clear = ol_source_Vector.prototype.clear;\r\n\r\n  /** Overwrite ol/source/Vector clear to fire clearstart / clearend event\r\n   */\r\n  ol_source_Vector.prototype.clear = function(opt_fast) {\r\n    this.dispatchEvent({ type: 'clearstart' });\r\n    clear.call(this, opt_fast)\r\n    this.dispatchEvent({ type: 'clearend' });\r\n  };\r\n})();\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport '../source/Vector' \r\n\r\n/** Undo/redo interaction\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires undo\r\n * @fires redo\r\n * @fires change:add\r\n * @fires change:remove\r\n * @fires change:clear\r\n * @param {Object} options\r\n *  @param {number=} options.maxLength max undo stack length (0=Infinity), default Infinity\r\n */\r\nvar ol_interaction_UndoRedo = function(options) {\r\n  if (!options) options = {};\r\n\r\n\tol_interaction_Interaction.call(this, {\t\r\n    handleEvent: function() { \r\n      return true; \r\n    }\r\n  });\r\n\r\n  this._undoStack = new ol_Collection();\r\n  this._redoStack = new ol_Collection();\r\n  // Zero level stack\r\n  this._undo = [];\r\n  this._redo = [];\r\n  this._undoStack.on('add', function(e) {\r\n    if (e.element.level === undefined) {\r\n      e.element.level = this._level;\r\n      if (!e.element.level) {\r\n        e.element.view = {\r\n          center: this.getMap().getView().getCenter(),\r\n          zoom: this.getMap().getView().getZoom()\r\n        };\r\n        this._undo.push(e.element);\r\n      }\r\n    } else {\r\n      if (!e.element.level) this._undo.push(this._redo.shift());\r\n    }\r\n    if (!e.element.level) {\r\n      this.dispatchEvent({ \r\n        type: 'stack:add', \r\n        action: e.element\r\n      });\r\n    }\r\n    this._reduce();\r\n  }.bind(this));\r\n  this._undoStack.on('remove', function(e) {\r\n    if (!e.element.level) {\r\n      if (this._doShift) {\r\n        this._undo.shift();\r\n      } else {\r\n        if (this._undo.length) this._redo.push(this._undo.pop());\r\n      }\r\n      if (!this._doClear) {\r\n        this.dispatchEvent({ \r\n          type: 'stack:remove', \r\n          action: e.element,\r\n          shift: this._doShift\r\n        });\r\n      }\r\n    }\r\n  }.bind(this));\r\n  // Block counter\r\n  this._block = 0;\r\n  this._level = 0;\r\n  // Shift an undo action ?\r\n  this._doShift = false;\r\n  // Start recording\r\n  this._record = true;\r\n  // Custom definitions\r\n  this._defs = {};\r\n};\r\nol_ext_inherits(ol_interaction_UndoRedo, ol_interaction_Interaction);\r\n\r\n/** Add a custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {function} undoFn function called when undoing\r\n * @param {function} redoFn function called when redoing\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.define = function(action, undoFn, redoFn) {\r\n  this._defs[action] = { undo: undoFn, redo: redoFn };\r\n};\r\n\r\n/** Get first level undo / redo length\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.length = function(type) {\r\n  return (type==='redo') ? this._redo.length : this._undo.length;\r\n};\r\n\r\n/** Set undo stack max length\r\n * @param {number} length\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxLength = function(length) {\r\n  length = parseInt(length);\r\n  if (length && length<0) length = 0;\r\n  this.set('maxLength', length);\r\n  this._reduce();\r\n};\r\n\r\n/** Get undo / redo size (includes all block levels)\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.size = function(type) {\r\n  return (type==='redo') ? this._redoStack.getLength() : this._undoStack.getLength();\r\n};\r\n\r\n/** Set undo stack max size\r\n * @param {number} size\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxSize = function(size) {\r\n  size = parseInt(size);\r\n  if (size && size<0) size = 0;\r\n  this.set('maxSize', size);\r\n  this._reduce();\r\n};\r\n\r\n/** Reduce stack: shift undo to set size\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._reduce = function() {\r\n  if (this.get('maxLength')) {\r\n    while (this.length() > this.get('maxLength')) {\r\n      this.shift();\r\n    }\r\n  }\r\n  if (this.get('maxSize')) {\r\n    while (this.length() > 1 && this.size() > this.get('maxSize')) {\r\n      this.shift();\r\n    }\r\n  }\r\n};\r\n\r\n/** Get first level undo / redo first level stack\r\n * @param {string} [type] get redo stack, default get undo\r\n * @return {Array<*>}\r\n */\r\nol_interaction_UndoRedo.prototype.getStack = function(type) {\r\n  return (type==='redo') ? this._redo : this._undo;\r\n};\r\n\r\n/** Add a new custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {any} prop an object that will be passed in the undo/redo functions of the action\r\n * @param {string} name action name\r\n * @return {boolean} true if the action is defined\r\n */\r\nol_interaction_UndoRedo.prototype.push = function(action, prop, name) {\r\n  if (this._defs[action]) {\r\n    this._undoStack.push({ \r\n      type: action,\r\n      name: name,\r\n      custom: true,\r\n      prop: prop \r\n    });\r\n    return true;\r\n  } else {\r\n    console.warn('[UndoRedoInteraction]: \"'+action+'\" is not defined.');\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Remove undo action from the beginning of the stack. \r\n * The action is not returned.\r\n */\r\nol_interaction_UndoRedo.prototype.shift = function() {\r\n  this._doShift = true;\r\n  var a = this._undoStack.removeAt(0);\r\n  this._doShift = false;\r\n  // Remove all block\r\n  if (a.type==='blockstart') {\r\n    a = this._undoStack.item(0);\r\n    while (this._undoStack.getLength() && a.level>0) {\r\n      this._undoStack.removeAt(0);\r\n      a = this._undoStack.item(0);\r\n    }\r\n  }\r\n};\r\n\r\n/** Activate or deactivate the interaction, ie. records or not events on the map.\r\n * @param {boolean} active\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  this._record = active;\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any, and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setMap = function(map) {\r\n  if (this._mapListener) {\r\n    this._mapListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._mapListener = [];\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  // Watch blocks\r\n  if (map) {\r\n    this._mapListener.push(map.on('undoblockstart', this.blockStart.bind(this)));\r\n    this._mapListener.push(map.on('undoblockend', this.blockEnd.bind(this)));\r\n  }\r\n  // Watch sources\r\n  this._watchSources();\r\n  this._watchInteractions();\r\n};\r\n\r\n/** Watch for changes in the map sources\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchSources = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._sourceListener) {\r\n    this._sourceListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._sourceListener = [];\r\n\r\n  // Ges vector layers \r\n  function getVectorLayers(layers, init) {\r\n    if (!init) init = [];\r\n    layers.forEach(function(l) {\r\n      if (l instanceof ol_layer_Vector) {\r\n        init.push(l);\r\n      } else if (l.getLayers) {\r\n        getVectorLayers(l.getLayers(), init);\r\n      }\r\n    });\r\n    return init;\r\n  }\r\n\r\n  if (map) {\r\n    // Watch the vector sources in the map \r\n    var vectors = getVectorLayers(map.getLayers());\r\n    vectors.forEach((function(l) {\r\n      var s = l.getSource();\r\n      this._sourceListener.push( s.on(['addfeature', 'removefeature'], this._onAddRemove.bind(this)) );\r\n      this._sourceListener.push( s.on('clearstart', function() {\r\n        this.blockStart('clear')\r\n      }.bind(this)));\r\n      this._sourceListener.push( s.on('clearend', this.blockEnd.bind(this)) );\r\n    }).bind(this));\r\n\r\n    // Watch new inserted/removed\r\n    this._sourceListener.push( map.getLayers().on(['add', 'remove'], this._watchSources.bind(this) ) );\r\n  }\r\n};\r\n\r\n/** Watch for interactions\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchInteractions = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._interactionListener) {\r\n    this._interactionListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._interactionListener = [];\r\n\r\n  if (map) {\r\n    // Watch the interactions in the map \r\n    map.getInteractions().forEach((function(i) {\r\n      this._interactionListener.push(i.on(\r\n        ['setattributestart', 'modifystart', 'rotatestart', 'translatestart', 'scalestart', 'deletestart', 'deleteend', 'beforesplit', 'aftersplit'], \r\n        this._onInteraction.bind(this)\r\n      ));\r\n    }).bind(this));\r\n\r\n    // Watch new inserted / unwatch removed\r\n    this._interactionListener.push( map.getInteractions().on(\r\n      ['add', 'remove'], \r\n      this._watchInteractions.bind(this)\r\n    ));\r\n  }\r\n};\r\n\r\n/** A feature is added / removed\r\n */\r\nol_interaction_UndoRedo.prototype._onAddRemove = function(e) {\r\n  if (this._record) {\r\n    this._redoStack.clear();\r\n    this._redo.length = 0;\r\n    this._undoStack.push({\r\n      type: e.type, \r\n      source: e.target, \r\n      feature: e.feature\r\n    });\r\n  }\r\n};\r\n\r\n/** Perform an interaction\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction = function(e) {\r\n  var fn = this._onInteraction[e.type];\r\n  if (fn) fn.call(this,e);\r\n};\r\n\r\n/** Set attribute\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.setattributestart = function(e) {\r\n  this.blockStart(e.target.get('name') || 'setattribute');\r\n  var newp = Object.assign({}, e.properties);\r\n  e.features.forEach(function(f) {\r\n    var oldp = {};\r\n    for (var p in newp) {\r\n      oldp[p] = f.get(p);\r\n    }\r\n    this._undoStack.push({\r\n      type: 'changeattribute', \r\n      feature: f,\r\n      newProperties: newp,\r\n      oldProperties: oldp\r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\nol_interaction_UndoRedo.prototype._onInteraction.rotatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.translatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.scalestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.modifystart = function (e) {\r\n  this.blockStart(e.type.replace(/start$/,''));\r\n  e.features.forEach(function(m) {\r\n    this._undoStack.push({ \r\n      type: 'changegeometry', \r\n      feature: m, \r\n      oldGeom: m.getGeometry().clone() \r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\n/** Start an undo block\r\n * @param {string} [name] name f the action\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockStart = function (name) {\r\n  this._redoStack.clear();\r\n  this._redo.length = 0;\r\n  this._undoStack.push({ \r\n    type: 'blockstart', \r\n    name: name\r\n  });\r\n  this._level++;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.beforesplit = function() {\r\n  this.blockStart('split');\r\n};\r\nol_interaction_UndoRedo.prototype._onInteraction.deletestart = function() {\r\n  this.blockStart('delete');\r\n}\r\n\r\n/** End an undo block\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockEnd = function () {\r\n  this._undoStack.push({ type: 'blockend' });\r\n  this._level--;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.aftersplit =\r\nol_interaction_UndoRedo.prototype._onInteraction.deleteend =\r\nol_interaction_UndoRedo.prototype.blockEnd;\r\n\r\n/** handle undo/redo\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._handleDo = function(e, undo) {\r\n  // Not active\r\n  if (!this.getActive()) return;\r\n\r\n  // Stop recording while undoing\r\n  this._record = false;\r\n  if (e.custom) {\r\n    if (this._defs[e.type]) {\r\n      if (undo) this._defs[e.type].undo(e.prop);\r\n      else this._defs[e.type].redo(e.prop);\r\n    } else {\r\n      console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n    }\r\n  } else {\r\n    switch (e.type) {\r\n      case 'addfeature': {\r\n        if (undo) e.source.removeFeature(e.feature);\r\n        else e.source.addFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'removefeature': {\r\n        if (undo) e.source.addFeature(e.feature);\r\n        else e.source.removeFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'changegeometry': {\r\n        var geom = e.feature.getGeometry();\r\n        e.feature.setGeometry(e.oldGeom);\r\n        e.oldGeom = geom;\r\n        break;\r\n      }\r\n      case 'changeattribute': {\r\n        var newp = e.newProperties;\r\n        var oldp = e.oldProperties;\r\n        for (var p in oldp) {\r\n          if (oldp === undefined) e.feature.unset(p);\r\n          else e.feature.set(p, oldp[p]);\r\n        }\r\n        e.oldProperties = newp;\r\n        e.newProperties = oldp;\r\n        break;\r\n      }\r\n      case 'blockstart': {\r\n        this._block += undo ? -1 : 1;\r\n        break;\r\n      }\r\n      case 'blockend': {\r\n        this._block += undo ? 1 : -1;\r\n        break;\r\n      }\r\n      default: {\r\n        console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle block\r\n  if (this._block<0) this._block = 0;\r\n  if (this._block) {\r\n    if (undo) this.undo();\r\n    else this.redo();\r\n  }\r\n  this._record = true;\r\n\r\n  // Dispatch event\r\n  this.dispatchEvent( { \r\n    type: undo ? 'undo' : 'redo',\r\n    action: e\r\n  });\r\n};\r\n\r\n/** Undo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.undo = function() {\r\n  var e = this._undoStack.item(this._undoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._redoStack.push(e);\r\n  this._undoStack.pop();\r\n  this._handleDo(e, true);\r\n};\r\n\r\n/** Redo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.redo = function() {\r\n  var e = this._redoStack.item(this._redoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._undoStack.push(e);\r\n  this._redoStack.pop();\r\n  this._handleDo(e, false);\r\n};\r\n\r\n/** Clear undo stack\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.clear = function() {\r\n  this._doClear = true;\r\n  this._undo.length = this._redo.length = 0;\r\n  this._undoStack.clear();\r\n  this._redoStack.clear();\r\n  this._doClear = false;\r\n  this.dispatchEvent({ type: 'stack:clear' });\r\n};\r\n\r\n/** Check if undo is avaliable\r\n * @return {number} the number of undo \r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasUndo = function() {\r\n  return this._undoStack.getLength();\r\n};\r\n\r\n/** Check if redo is avaliable\r\n * @return {number} the number of redo\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasRedo = function() {\r\n  return this._redoStack.getLength();\r\n};\r\n\r\nexport default ol_interaction_UndoRedo\r\n","/**\n * @module ol/Disposable\n */\n\n/**\n * @classdesc\n * Objects that need to clean up after themselves.\n */\nvar Disposable = function Disposable() {\n  /**\n   * The object has already been disposed.\n   * @type {boolean}\n   * @private\n   */\n  this.disposed_ = false;\n};\n\n/**\n * Clean up.\n */\nDisposable.prototype.dispose = function dispose () {\n  if (!this.disposed_) {\n    this.disposed_ = true;\n    this.disposeInternal();\n  }\n};\n\n/**\n * Extension point for disposable objects.\n * @protected\n */\nDisposable.prototype.disposeInternal = function disposeInternal () {};\n\nexport default Disposable;\n\n//# sourceMappingURL=Disposable.js.map","/**\n * @module ol/TileRange\n */\n\n/**\n * A representation of a contiguous block of tiles.  A tile range is specified\n * by its min/max tile coordinates and is inclusive of coordinates.\n */\nvar TileRange = function TileRange(minX, maxX, minY, maxY) {\n\n  /**\n   * @type {number}\n   */\n  this.minX = minX;\n\n  /**\n   * @type {number}\n   */\n  this.maxX = maxX;\n\n  /**\n   * @type {number}\n   */\n  this.minY = minY;\n\n  /**\n   * @type {number}\n   */\n  this.maxY = maxY;\n\n};\n\n/**\n * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n * @return {boolean} Contains tile coordinate.\n */\nTileRange.prototype.contains = function contains (tileCoord) {\n  return this.containsXY(tileCoord[1], tileCoord[2]);\n};\n\n/**\n * @param {TileRange} tileRange Tile range.\n * @return {boolean} Contains.\n */\nTileRange.prototype.containsTileRange = function containsTileRange (tileRange) {\n  return this.minX <= tileRange.minX && tileRange.maxX <= this.maxX &&\n     this.minY <= tileRange.minY && tileRange.maxY <= this.maxY;\n};\n\n/**\n * @param {number} x Tile coordinate x.\n * @param {number} y Tile coordinate y.\n * @return {boolean} Contains coordinate.\n */\nTileRange.prototype.containsXY = function containsXY (x, y) {\n  return this.minX <= x && x <= this.maxX && this.minY <= y && y <= this.maxY;\n};\n\n/**\n * @param {TileRange} tileRange Tile range.\n * @return {boolean} Equals.\n */\nTileRange.prototype.equals = function equals (tileRange) {\n  return this.minX == tileRange.minX && this.minY == tileRange.minY &&\n     this.maxX == tileRange.maxX && this.maxY == tileRange.maxY;\n};\n\n/**\n * @param {TileRange} tileRange Tile range.\n */\nTileRange.prototype.extend = function extend (tileRange) {\n  if (tileRange.minX < this.minX) {\n    this.minX = tileRange.minX;\n  }\n  if (tileRange.maxX > this.maxX) {\n    this.maxX = tileRange.maxX;\n  }\n  if (tileRange.minY < this.minY) {\n    this.minY = tileRange.minY;\n  }\n  if (tileRange.maxY > this.maxY) {\n    this.maxY = tileRange.maxY;\n  }\n};\n\n/**\n * @return {number} Height.\n */\nTileRange.prototype.getHeight = function getHeight () {\n  return this.maxY - this.minY + 1;\n};\n\n/**\n * @return {import(\"./size.js\").Size} Size.\n */\nTileRange.prototype.getSize = function getSize () {\n  return [this.getWidth(), this.getHeight()];\n};\n\n/**\n * @return {number} Width.\n */\nTileRange.prototype.getWidth = function getWidth () {\n  return this.maxX - this.minX + 1;\n};\n\n/**\n * @param {TileRange} tileRange Tile range.\n * @return {boolean} Intersects.\n */\nTileRange.prototype.intersects = function intersects (tileRange) {\n  return this.minX <= tileRange.maxX &&\n     this.maxX >= tileRange.minX &&\n     this.minY <= tileRange.maxY &&\n     this.maxY >= tileRange.minY;\n};\n\n\n/**\n * @param {number} minX Minimum X.\n * @param {number} maxX Maximum X.\n * @param {number} minY Minimum Y.\n * @param {number} maxY Maximum Y.\n * @param {TileRange=} tileRange TileRange.\n * @return {TileRange} Tile range.\n */\nexport function createOrUpdate(minX, maxX, minY, maxY, tileRange) {\n  if (tileRange !== undefined) {\n    tileRange.minX = minX;\n    tileRange.maxX = maxX;\n    tileRange.minY = minY;\n    tileRange.maxY = maxY;\n    return tileRange;\n  } else {\n    return new TileRange(minX, maxX, minY, maxY);\n  }\n}\n\n\nexport default TileRange;\n\n//# sourceMappingURL=TileRange.js.map","/**\n * @module ol/MapBrowserPointerEvent\n */\nimport MapBrowserEvent from './MapBrowserEvent.js';\n\nvar MapBrowserPointerEvent = /*@__PURE__*/(function (MapBrowserEvent) {\n  function MapBrowserPointerEvent(type, map, pointerEvent, opt_dragging, opt_frameState) {\n\n    MapBrowserEvent.call(this, type, map, pointerEvent.originalEvent, opt_dragging, opt_frameState);\n\n    /**\n     * @const\n     * @type {import(\"./pointer/PointerEvent.js\").default}\n     */\n    this.pointerEvent = pointerEvent;\n\n  }\n\n  if ( MapBrowserEvent ) MapBrowserPointerEvent.__proto__ = MapBrowserEvent;\n  MapBrowserPointerEvent.prototype = Object.create( MapBrowserEvent && MapBrowserEvent.prototype );\n  MapBrowserPointerEvent.prototype.constructor = MapBrowserPointerEvent;\n\n  return MapBrowserPointerEvent;\n}(MapBrowserEvent));\n\nexport default MapBrowserPointerEvent;\n\n//# sourceMappingURL=MapBrowserPointerEvent.js.map","/**\n * @module ol/Object\n */\nimport {getUid} from './util.js';\nimport ObjectEventType from './ObjectEventType.js';\nimport Observable from './Observable.js';\nimport Event from './events/Event.js';\nimport {assign} from './obj.js';\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Object~BaseObject} instances are instances of this type.\n */\nexport var ObjectEvent = /*@__PURE__*/(function (Event) {\n  function ObjectEvent(type, key, oldValue) {\n    Event.call(this, type);\n\n    /**\n     * The name of the property whose value is changing.\n     * @type {string}\n     * @api\n     */\n    this.key = key;\n\n    /**\n     * The old value. To get the new value use `e.target.get(e.key)` where\n     * `e` is the event object.\n     * @type {*}\n     * @api\n     */\n    this.oldValue = oldValue;\n\n  }\n\n  if ( Event ) ObjectEvent.__proto__ = Event;\n  ObjectEvent.prototype = Object.create( Event && Event.prototype );\n  ObjectEvent.prototype.constructor = ObjectEvent;\n\n  return ObjectEvent;\n}(Event));\n\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Most non-trivial classes inherit from this.\n *\n * This extends {@link module:ol/Observable} with observable\n * properties, where each property is observable as well as the object as a\n * whole.\n *\n * Classes that inherit from this have pre-defined properties, to which you can\n * add your owns. The pre-defined properties are listed in this documentation as\n * 'Observable Properties', and have their own accessors; for example,\n * {@link module:ol/Map~Map} has a `target` property, accessed with\n * `getTarget()` and changed with `setTarget()`. Not all properties are however\n * settable. There are also general-purpose accessors `get()` and `set()`. For\n * example, `get('target')` is equivalent to `getTarget()`.\n *\n * The `set` accessors trigger a change event, and you can monitor this by\n * registering a listener. For example, {@link module:ol/View~View} has a\n * `center` property, so `view.on('change:center', function(evt) {...});` would\n * call the function whenever the value of the center property changes. Within\n * the function, `evt.target` would be the view, so `evt.target.getCenter()`\n * would return the new center.\n *\n * You can add your own observable properties with\n * `object.set('prop', 'value')`, and retrieve that with `object.get('prop')`.\n * You can listen for changes on that property value with\n * `object.on('change:prop', listener)`. You can get a list of all\n * properties with {@link module:ol/Object~BaseObject#getProperties}.\n *\n * Note that the observable properties are separate from standard JS properties.\n * You can, for example, give your map object a title with\n * `map.title='New title'` and with `map.set('title', 'Another title')`. The\n * first will be a `hasOwnProperty`; the second will appear in\n * `getProperties()`. Only the second is observable.\n *\n * Properties can be deleted by using the unset method. E.g.\n * object.unset('foo').\n *\n * @fires ObjectEvent\n * @api\n */\nvar BaseObject = /*@__PURE__*/(function (Observable) {\n  function BaseObject(opt_values) {\n    Observable.call(this);\n\n    // Call {@link module:ol/util~getUid} to ensure that the order of objects' ids is\n    // the same as the order in which they were created.  This also helps to\n    // ensure that object properties are always added in the same order, which\n    // helps many JavaScript engines generate faster code.\n    getUid(this);\n\n    /**\n     * @private\n     * @type {!Object<string, *>}\n     */\n    this.values_ = {};\n\n    if (opt_values !== undefined) {\n      this.setProperties(opt_values);\n    }\n  }\n\n  if ( Observable ) BaseObject.__proto__ = Observable;\n  BaseObject.prototype = Object.create( Observable && Observable.prototype );\n  BaseObject.prototype.constructor = BaseObject;\n\n  /**\n   * Gets a value.\n   * @param {string} key Key name.\n   * @return {*} Value.\n   * @api\n   */\n  BaseObject.prototype.get = function get (key) {\n    var value;\n    if (this.values_.hasOwnProperty(key)) {\n      value = this.values_[key];\n    }\n    return value;\n  };\n\n  /**\n   * Get a list of object property names.\n   * @return {Array<string>} List of property names.\n   * @api\n   */\n  BaseObject.prototype.getKeys = function getKeys () {\n    return Object.keys(this.values_);\n  };\n\n  /**\n   * Get an object of all property names and values.\n   * @return {Object<string, *>} Object.\n   * @api\n   */\n  BaseObject.prototype.getProperties = function getProperties () {\n    return assign({}, this.values_);\n  };\n\n  /**\n   * @param {string} key Key name.\n   * @param {*} oldValue Old value.\n   */\n  BaseObject.prototype.notify = function notify (key, oldValue) {\n    var eventType;\n    eventType = getChangeEventType(key);\n    this.dispatchEvent(new ObjectEvent(eventType, key, oldValue));\n    eventType = ObjectEventType.PROPERTYCHANGE;\n    this.dispatchEvent(new ObjectEvent(eventType, key, oldValue));\n  };\n\n  /**\n   * Sets a value.\n   * @param {string} key Key name.\n   * @param {*} value Value.\n   * @param {boolean=} opt_silent Update without triggering an event.\n   * @api\n   */\n  BaseObject.prototype.set = function set (key, value, opt_silent) {\n    if (opt_silent) {\n      this.values_[key] = value;\n    } else {\n      var oldValue = this.values_[key];\n      this.values_[key] = value;\n      if (oldValue !== value) {\n        this.notify(key, oldValue);\n      }\n    }\n  };\n\n  /**\n   * Sets a collection of key-value pairs.  Note that this changes any existing\n   * properties and adds new ones (it does not remove any existing properties).\n   * @param {Object<string, *>} values Values.\n   * @param {boolean=} opt_silent Update without triggering an event.\n   * @api\n   */\n  BaseObject.prototype.setProperties = function setProperties (values, opt_silent) {\n    for (var key in values) {\n      this.set(key, values[key], opt_silent);\n    }\n  };\n\n  /**\n   * Unsets a property.\n   * @param {string} key Key name.\n   * @param {boolean=} opt_silent Unset without triggering an event.\n   * @api\n   */\n  BaseObject.prototype.unset = function unset (key, opt_silent) {\n    if (key in this.values_) {\n      var oldValue = this.values_[key];\n      delete this.values_[key];\n      if (!opt_silent) {\n        this.notify(key, oldValue);\n      }\n    }\n  };\n\n  return BaseObject;\n}(Observable));\n\n\n/**\n * @type {Object<string, string>}\n */\nvar changeEventTypeCache = {};\n\n\n/**\n * @param {string} key Key name.\n * @return {string} Change name.\n */\nexport function getChangeEventType(key) {\n  return changeEventTypeCache.hasOwnProperty(key) ?\n    changeEventTypeCache[key] :\n    (changeEventTypeCache[key] = 'change:' + key);\n}\n\n\nexport default BaseObject;\n\n//# sourceMappingURL=Object.js.map","/**\n * @module ol/Collection\n */\nimport AssertionError from './AssertionError.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport BaseObject from './Object.js';\nimport Event from './events/Event.js';\n\n\n/**\n * @enum {string}\n * @private\n */\nvar Property = {\n  LENGTH: 'length'\n};\n\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Collection~Collection} instances are instances of this\n * type.\n */\nexport var CollectionEvent = /*@__PURE__*/(function (Event) {\n  function CollectionEvent(type, opt_element) {\n    Event.call(this, type);\n\n    /**\n     * The element that is added to or removed from the collection.\n     * @type {*}\n     * @api\n     */\n    this.element = opt_element;\n\n  }\n\n  if ( Event ) CollectionEvent.__proto__ = Event;\n  CollectionEvent.prototype = Object.create( Event && Event.prototype );\n  CollectionEvent.prototype.constructor = CollectionEvent;\n\n  return CollectionEvent;\n}(Event));\n\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [unique=false] Disallow the same item from being added to\n * the collection twice.\n */\n\n/**\n * @classdesc\n * An expanded version of standard JS Array, adding convenience methods for\n * manipulation. Add and remove changes to the Collection trigger a Collection\n * event. Note that this does not cover changes to the objects _within_ the\n * Collection; they trigger events on the appropriate object, not on the\n * Collection as a whole.\n *\n * @fires CollectionEvent\n *\n * @template T\n * @api\n */\nvar Collection = /*@__PURE__*/(function (BaseObject) {\n  function Collection(opt_array, opt_options) {\n\n    BaseObject.call(this);\n\n    var options = opt_options || {};\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.unique_ = !!options.unique;\n\n    /**\n     * @private\n     * @type {!Array<T>}\n     */\n    this.array_ = opt_array ? opt_array : [];\n\n    if (this.unique_) {\n      for (var i = 0, ii = this.array_.length; i < ii; ++i) {\n        this.assertUnique_(this.array_[i], i);\n      }\n    }\n\n    this.updateLength_();\n\n  }\n\n  if ( BaseObject ) Collection.__proto__ = BaseObject;\n  Collection.prototype = Object.create( BaseObject && BaseObject.prototype );\n  Collection.prototype.constructor = Collection;\n\n  /**\n   * Remove all elements from the collection.\n   * @api\n   */\n  Collection.prototype.clear = function clear () {\n    while (this.getLength() > 0) {\n      this.pop();\n    }\n  };\n\n  /**\n   * Add elements to the collection.  This pushes each item in the provided array\n   * to the end of the collection.\n   * @param {!Array<T>} arr Array.\n   * @return {Collection<T>} This collection.\n   * @api\n   */\n  Collection.prototype.extend = function extend (arr) {\n    for (var i = 0, ii = arr.length; i < ii; ++i) {\n      this.push(arr[i]);\n    }\n    return this;\n  };\n\n  /**\n   * Iterate over each element, calling the provided callback.\n   * @param {function(T, number, Array<T>): *} f The function to call\n   *     for every element. This function takes 3 arguments (the element, the\n   *     index and the array). The return value is ignored.\n   * @api\n   */\n  Collection.prototype.forEach = function forEach (f) {\n    var array = this.array_;\n    for (var i = 0, ii = array.length; i < ii; ++i) {\n      f(array[i], i, array);\n    }\n  };\n\n  /**\n   * Get a reference to the underlying Array object. Warning: if the array\n   * is mutated, no events will be dispatched by the collection, and the\n   * collection's \"length\" property won't be in sync with the actual length\n   * of the array.\n   * @return {!Array<T>} Array.\n   * @api\n   */\n  Collection.prototype.getArray = function getArray () {\n    return this.array_;\n  };\n\n  /**\n   * Get the element at the provided index.\n   * @param {number} index Index.\n   * @return {T} Element.\n   * @api\n   */\n  Collection.prototype.item = function item (index) {\n    return this.array_[index];\n  };\n\n  /**\n   * Get the length of this collection.\n   * @return {number} The length of the array.\n   * @observable\n   * @api\n   */\n  Collection.prototype.getLength = function getLength () {\n    return this.get(Property.LENGTH);\n  };\n\n  /**\n   * Insert an element at the provided index.\n   * @param {number} index Index.\n   * @param {T} elem Element.\n   * @api\n   */\n  Collection.prototype.insertAt = function insertAt (index, elem) {\n    if (this.unique_) {\n      this.assertUnique_(elem);\n    }\n    this.array_.splice(index, 0, elem);\n    this.updateLength_();\n    this.dispatchEvent(\n      new CollectionEvent(CollectionEventType.ADD, elem));\n  };\n\n  /**\n   * Remove the last element of the collection and return it.\n   * Return `undefined` if the collection is empty.\n   * @return {T|undefined} Element.\n   * @api\n   */\n  Collection.prototype.pop = function pop () {\n    return this.removeAt(this.getLength() - 1);\n  };\n\n  /**\n   * Insert the provided element at the end of the collection.\n   * @param {T} elem Element.\n   * @return {number} New length of the collection.\n   * @api\n   */\n  Collection.prototype.push = function push (elem) {\n    if (this.unique_) {\n      this.assertUnique_(elem);\n    }\n    var n = this.getLength();\n    this.insertAt(n, elem);\n    return this.getLength();\n  };\n\n  /**\n   * Remove the first occurrence of an element from the collection.\n   * @param {T} elem Element.\n   * @return {T|undefined} The removed element or undefined if none found.\n   * @api\n   */\n  Collection.prototype.remove = function remove (elem) {\n    var arr = this.array_;\n    for (var i = 0, ii = arr.length; i < ii; ++i) {\n      if (arr[i] === elem) {\n        return this.removeAt(i);\n      }\n    }\n    return undefined;\n  };\n\n  /**\n   * Remove the element at the provided index and return it.\n   * Return `undefined` if the collection does not contain this index.\n   * @param {number} index Index.\n   * @return {T|undefined} Value.\n   * @api\n   */\n  Collection.prototype.removeAt = function removeAt (index) {\n    var prev = this.array_[index];\n    this.array_.splice(index, 1);\n    this.updateLength_();\n    this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE, prev));\n    return prev;\n  };\n\n  /**\n   * Set the element at the provided index.\n   * @param {number} index Index.\n   * @param {T} elem Element.\n   * @api\n   */\n  Collection.prototype.setAt = function setAt (index, elem) {\n    var n = this.getLength();\n    if (index < n) {\n      if (this.unique_) {\n        this.assertUnique_(elem, index);\n      }\n      var prev = this.array_[index];\n      this.array_[index] = elem;\n      this.dispatchEvent(\n        new CollectionEvent(CollectionEventType.REMOVE, prev));\n      this.dispatchEvent(\n        new CollectionEvent(CollectionEventType.ADD, elem));\n    } else {\n      for (var j = n; j < index; ++j) {\n        this.insertAt(j, undefined);\n      }\n      this.insertAt(index, elem);\n    }\n  };\n\n  /**\n   * @private\n   */\n  Collection.prototype.updateLength_ = function updateLength_ () {\n    this.set(Property.LENGTH, this.array_.length);\n  };\n\n  /**\n   * @private\n   * @param {T} elem Element.\n   * @param {number=} opt_except Optional index to ignore.\n   */\n  Collection.prototype.assertUnique_ = function assertUnique_ (elem, opt_except) {\n    for (var i = 0, ii = this.array_.length; i < ii; ++i) {\n      if (this.array_[i] === elem && i !== opt_except) {\n        throw new AssertionError(58);\n      }\n    }\n  };\n\n  return Collection;\n}(BaseObject));\n\n\nexport default Collection;\n\n//# sourceMappingURL=Collection.js.map","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** A simple push button control\r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.name an optional name, default none\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Button = function(options){\r\n  options = options || {};\r\n\r\n  var element = document.createElement(\"div\");\r\n  element.className = (options.className || '') + \" ol-button ol-unselectable ol-control\";\r\n  var self = this;\r\n\r\n  var bt = this.button_ = document.createElement(/ol-text-button/.test(options.className) ? \"div\": \"button\");\r\n  bt.type = \"button\";\r\n  if (options.title) bt.title = options.title;\r\n  if (options.name) bt.name = options.name;\r\n  if (options.html instanceof Element) bt.appendChild(options.html)\r\n  else bt.innerHTML = options.html || \"\";\r\n  var evtFunction = function(e) {\r\n    if (e && e.preventDefault) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (options.handleClick) {\r\n      options.handleClick.call(self, e);\r\n    }\r\n  };\r\n  bt.addEventListener(\"click\", evtFunction);\r\n  bt.addEventListener(\"touchstart\", evtFunction);\r\n  element.appendChild(bt);\r\n\r\n  // Try to get a title in the button content\r\n  if (!options.title && bt.firstElementChild) {\r\n    bt.title = bt.firstElementChild.title;\r\n  }\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  if (options.title) {\r\n    this.set(\"title\", options.title);\r\n  }\r\n  if (options.title) this.set(\"title\", options.title);\r\n  if (options.name) this.set(\"name\", options.name);\r\n};\r\nol_ext_inherits(ol_control_Button, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n* @param {boolean} b \r\n*/\r\nol_control_Button.prototype.setVisible = function (val) {\r\n  if (val) ol_ext_element.show(this.element);\r\n  else ol_ext_element.hide(this.element);\r\n};\r\n\r\n/**\r\n * Set the button title\r\n * @param {string} title\r\n */\r\nol_control_Button.prototype.setTitle = function(title) {\r\n  this.button_.setAttribute('title', title);\r\n};\r\n\r\n/**\r\n * Set the button html\r\n * @param {string} html\r\n */\r\nol_control_Button.prototype.setHtml = function(html) {\r\n  ol_ext_element.setHTML (this.button_, html);\r\n};\r\n\r\n/**\r\n * Get the button element\r\n * @returns {Element}\r\n */\r\nol_control_Button.prototype.getButtonElement = function() {\r\n  return this.button_;\r\n};\r\n\r\nexport default ol_control_Button\r\n","/**\n * @module ol/ImageBase\n */\nimport {abstract} from './util.js';\nimport EventTarget from './events/Target.js';\nimport EventType from './events/EventType.js';\n\n/**\n * @abstract\n */\nvar ImageBase = /*@__PURE__*/(function (EventTarget) {\n  function ImageBase(extent, resolution, pixelRatio, state) {\n\n    EventTarget.call(this);\n\n    /**\n     * @protected\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.extent = extent;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @protected\n     * @type {number|undefined}\n     */\n    this.resolution = resolution;\n\n    /**\n     * @protected\n     * @type {import(\"./ImageState.js\").default}\n     */\n    this.state = state;\n\n  }\n\n  if ( EventTarget ) ImageBase.__proto__ = EventTarget;\n  ImageBase.prototype = Object.create( EventTarget && EventTarget.prototype );\n  ImageBase.prototype.constructor = ImageBase;\n\n  /**\n   * @protected\n   */\n  ImageBase.prototype.changed = function changed () {\n    this.dispatchEvent(EventType.CHANGE);\n  };\n\n  /**\n   * @return {import(\"./extent.js\").Extent} Extent.\n   */\n  ImageBase.prototype.getExtent = function getExtent () {\n    return this.extent;\n  };\n\n  /**\n   * @abstract\n   * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n   */\n  ImageBase.prototype.getImage = function getImage () {\n    return abstract();\n  };\n\n  /**\n   * @return {number} PixelRatio.\n   */\n  ImageBase.prototype.getPixelRatio = function getPixelRatio () {\n    return this.pixelRatio_;\n  };\n\n  /**\n   * @return {number} Resolution.\n   */\n  ImageBase.prototype.getResolution = function getResolution () {\n    return /** @type {number} */ (this.resolution);\n  };\n\n  /**\n   * @return {import(\"./ImageState.js\").default} State.\n   */\n  ImageBase.prototype.getState = function getState () {\n    return this.state;\n  };\n\n  /**\n   * Load not yet loaded URI.\n   * @abstract\n   */\n  ImageBase.prototype.load = function load () {\n    abstract();\n  };\n\n  return ImageBase;\n}(EventTarget));\n\n\nexport default ImageBase;\n\n//# sourceMappingURL=ImageBase.js.map","/**\n * @module ol/ImageCanvas\n */\nimport ImageBase from './ImageBase.js';\nimport ImageState from './ImageState.js';\n\n\n/**\n * A function that is called to trigger asynchronous canvas drawing.  It is\n * called with a \"done\" callback that should be called when drawing is done.\n * If any error occurs during drawing, the \"done\" callback should be called with\n * that error.\n *\n * @typedef {function(function(Error=))} Loader\n */\n\n\nvar ImageCanvas = /*@__PURE__*/(function (ImageBase) {\n  function ImageCanvas(extent, resolution, pixelRatio, canvas, opt_loader) {\n\n    var state = opt_loader !== undefined ? ImageState.IDLE : ImageState.LOADED;\n\n    ImageBase.call(this, extent, resolution, pixelRatio, state);\n\n    /**\n     * Optional canvas loader function.\n     * @type {?Loader}\n     * @private\n     */\n    this.loader_ = opt_loader !== undefined ? opt_loader : null;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = canvas;\n\n    /**\n     * @private\n     * @type {Error}\n     */\n    this.error_ = null;\n\n  }\n\n  if ( ImageBase ) ImageCanvas.__proto__ = ImageBase;\n  ImageCanvas.prototype = Object.create( ImageBase && ImageBase.prototype );\n  ImageCanvas.prototype.constructor = ImageCanvas;\n\n  /**\n   * Get any error associated with asynchronous rendering.\n   * @return {Error} Any error that occurred during rendering.\n   */\n  ImageCanvas.prototype.getError = function getError () {\n    return this.error_;\n  };\n\n  /**\n   * Handle async drawing complete.\n   * @param {Error=} err Any error during drawing.\n   * @private\n   */\n  ImageCanvas.prototype.handleLoad_ = function handleLoad_ (err) {\n    if (err) {\n      this.error_ = err;\n      this.state = ImageState.ERROR;\n    } else {\n      this.state = ImageState.LOADED;\n    }\n    this.changed();\n  };\n\n  /**\n   * @inheritDoc\n   */\n  ImageCanvas.prototype.load = function load () {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n      this.loader_(this.handleLoad_.bind(this));\n    }\n  };\n\n  /**\n   * @return {HTMLCanvasElement} Canvas element.\n   */\n  ImageCanvas.prototype.getImage = function getImage () {\n    return this.canvas_;\n  };\n\n  return ImageCanvas;\n}(ImageBase));\n\n\nexport default ImageCanvas;\n\n//# sourceMappingURL=ImageCanvas.js.map","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\n/** Control bar for OL3\r\n * The control bar is a container for other controls. It can be used to create toolbars.\r\n * Control bars can be nested and combined with ol.control.Toggle to handle activate/deactivate.\r\n * @class\r\n * @constructor\r\n * @extends ol_control_Control\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {boolean} options.group is a group, default false\r\n *  @param {boolean} options.toggleOne only one toggle control is active at a time, default false\r\n *  @param {boolean} options.autoDeactivate used with subbar to deactivate all control when top level control deactivate, default false\r\n *  @param {Array<ol_control_Control> } options.controls a list of control to add to the bar\r\n */\r\nvar ol_control_Bar = function(options) {\r\n  if (!options) options={};\r\n  var element = document.createElement(\"div\");\r\n      element.classList.add('ol-unselectable', 'ol-control', 'ol-bar');\r\n  if (options.className) {\r\n    var classes = options.className.split(' ').filter(function(className) {\r\n      return className.length > 0;\r\n    });\r\n    element.classList.add.apply(element.classList, classes)\r\n  }\r\n  if (options.group) element.classList.add('ol-group');\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('toggleOne', options.toggleOne);\r\n  this.set('autoDeactivate', options.autoDeactivate);\r\n\r\n  this.controls_ = [];\r\n  if (options.controls instanceof Array) {\r\n    for (var i=0; i<options.controls.length; i++) {\r\n      this.addControl(options.controls[i]);\r\n    }\r\n  }\r\n};\r\nol_ext_inherits(ol_control_Bar, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n * @param {boolean} val\r\n */\r\nol_control_Bar.prototype.setVisible = function (val) {\r\n  if (val) this.element.style.display = '';\r\n  else this.element.style.display = 'none';\r\n}\r\n\r\n/** Get the control visibility\r\n * @return {boolean} b\r\n */\r\nol_control_Bar.prototype.getVisible = function () {\r\n  return this.element.style.display != 'none';\r\n}\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {ol_Map} map The map instance.\r\n */\r\nol_control_Bar.prototype.setMap = function (map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n    var c = this.controls_[i];\r\n    // map.addControl(c);\r\n    c.setMap(map);\r\n  }\r\n};\r\n\r\n/** Get controls in the panel\r\n *\t@param {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getControls = function () {\r\n  return this.controls_;\r\n};\r\n\r\n/** Set tool bar position\r\n * @param {string} pos a combinaison of top|left|bottom|right\r\n */\r\nol_control_Bar.prototype.setPosition = function (pos) {\r\n  this.element.classList.remove('ol-left', 'ol-top', 'ol-bottom', 'ol-right');\r\n  pos = pos.split ('-');\r\n  for (var i=0; i<pos.length; i++) {\r\n    switch (pos[i]) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n        this.element.classList.add(\"ol-\"+pos[i]);\r\n        break;\r\n      default: break;\r\n    }\r\n  }\r\n};\r\n\r\n/** Add a control to the bar\r\n *\t@param {ol_control_Control} c control to add\r\n */\r\nol_control_Bar.prototype.addControl = function (c) {\r\n  this.controls_.push(c);\r\n  c.setTarget(this.element);\r\n  if (this.getMap()) {\r\n    this.getMap().addControl(c);\r\n  }\r\n  // Activate and toogleOne\r\n  c.on ('change:active', function(e) { this.onActivateControl_(e, c); }.bind(this));\r\n  if (c.getActive) {\r\n    // c.dispatchEvent({ type:'change:active', key:'active', oldValue:false, active:true });\r\n    this.onActivateControl_({ target: c, active: c.getActive() }, c);\r\n  }\r\n};\r\n\r\n/** Deativate all controls in a bar\r\n * @param {ol_control_Control} [except] a control\r\n */\r\nol_control_Bar.prototype.deactivateControls = function (except) {\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n  if (this.controls_[i] !== except && this.controls_[i].setActive) {\r\n      this.controls_[i].setActive(false);\r\n    }\r\n  }\r\n};\r\n\r\n/** Get active control in the bar\r\n * @returns {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getActiveControls = function () {\r\n  var active = [];\r\n  for (var i=0, c; c=this.controls_[i]; i++) {\r\n    if (c.getActive && c.getActive()) active.push(c);\r\n  }\r\n  return active;\r\n}\r\n\r\n/** Auto activate/deactivate controls in the bar\r\n * @param {boolean} b activate/deactivate\r\n */\r\nol_control_Bar.prototype.setActive = function (b) {\r\n  if (!b && this.get(\"autoDeactivate\")) {\r\n    this.deactivateControls();\r\n  }\r\n  if (b) {\r\n    var ctrls = this.getControls();\r\n    for (var i=0, sb; (sb = ctrls[i]); i++) {\r\n      if (sb.get(\"autoActivate\")) sb.setActive(true);\r\n    }\r\n  }\r\n}\r\n\r\n/** Post-process an activated/deactivated control\r\n *\t@param {ol.event} e :an object with a target {_ol_control_} and active flag {bool}\r\n */\r\nol_control_Bar.prototype.onActivateControl_ = function (e, ctrl) {\r\n  if (this.get('toggleOne')) {\r\n    if (e.active) {\r\n      var n;\r\n      //var ctrl = e.target;\r\n      for (n=0; n<this.controls_.length; n++) {\r\n        if (this.controls_[n]===ctrl) break;\r\n      }\r\n      // Not here!\r\n      if (n==this.controls_.length) return;\r\n      this.deactivateControls (this.controls_[n]);\r\n    } else {\r\n      // No one active > test auto activate\r\n      if (!this.getActiveControls().length) {\r\n        for (var i=0, c; c=this.controls_[i]; i++) {\r\n          if (c.get(\"autoActivate\")) {\r\n            c.setActive(true);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} name of the control to search\r\n * @return {ol.control.Control}\r\n */\r\nol_control_Bar.prototype.getControlsByName = function(name) {\r\n  var controls = this.getControls();\r\n  return controls.filter(\r\n    function(control) {\r\n      return (control.get('name') === name);\r\n    }\r\n  );\r\n};\r\n\r\nexport default ol_control_Bar\r\n"],"sourceRoot":""}