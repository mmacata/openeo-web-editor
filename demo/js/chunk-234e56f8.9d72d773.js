(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-234e56f8"],{"0791":function(e,t,s){"use strict";s("c240")},"0921":function(e,t,s){"use strict";var a=s("3115"),i=s("025e"),r=(s("5bc0"),s("c320")),o=s("9d47"),n=s("8f3a"),l=s("0af5"),c=s("a2e1"),u=s("5eee"),h=s("a2c7"),d=s("256f"),p=s("480c"),m=s("3e6b"),f=s("5831"),g=s("d0e9"),v=(s("1399"),s("0417")),b=s("3900");class y{constructor(){this.createHtml(),this.loading=0,this.loaded=0}addLoading(){this.loading++,this.update()}addLoaded(){this.loaded++,this.update()}update(){var e=(this.loaded/this.loading*100).toFixed(1)+"%";this.label.innerText="Loading Tiles ("+e+")",this.progressBarInner.style.width=e,this.loading===this.loaded&&(this.loading=0,this.loaded=0),this.el.style.opacity=this.show()?1:0}show(){return this.loading>0&&this.loaded<=this.loading}createHtml(){this.el=document.createElement("div"),this.el.className="ol-unselectable ol-progress-control",this.progressBar=document.createElement("div"),this.progressBar.className="progress-bar",this.progressBarInner=document.createElement("div"),this.progressBarInner.className="progress-bar-inner",this.progressBar.appendChild(this.progressBarInner),this.label=document.createElement("div"),this.label.className="progress-label",this.el.appendChild(this.progressBar),this.el.appendChild(this.label)}getControl(){var e=new b["a"]({element:this.el});return e}}var w,C,S={mixins:[a["a"]],props:{id:{type:String,required:!0},center:{type:Array,default:()=>[0,0]},zoom:{type:Number,default:1},show:{type:Boolean,default:!0},editable:{type:Boolean,default:!0}},data(){return{map:null,baseLayer:null,osm:null,progress:null}},watch:{show(){this.showMap()}},mounted(){this.showMap()},methods:{showMap(){this.show&&this.$nextTick(this.renderMap)},createMap(e=!1){if(null!==this.map)return this.map.updateSize(),void this.map.render();this.progress=new y,this.osm=new g["a"],this.baseLayer=new p["a"]({source:this.trackTileProgress(this.osm),baseLayer:!0,title:"OpenStreetMap"});var t=[new r["a"],new o["a"],this.progress.getControl()];e&&t.push(new v["a"]);var s={target:this.id,layers:[this.baseLayer],view:new h["a"]({center:Object(d["d"])([this.center[1],this.center[0]]),zoom:this.zoom})};this.editable?s.controls=Object(n["a"])().extend(t):(s.interactions=[],s.controls=t),this.map=new u["a"](s),this.listen("windowResized",this.updateMapSize)},renderMap(){this.createMap()},updateMapSize(){this.map&&this.map.updateSize()},addGeoJson(e){var t={};i["a"].detectGeoJson(e)&&(t.features=(new c["a"]).readFeatures(e,{featureProjection:this.osm.getProjection()}));var s=new f["a"](t),a=new m["a"]({title:"GeoJSON",source:s});this.map.addLayer(a);var r=s.getExtent();return Object(l["H"])(r)||this.map.getView().fit(r),a},trackTileProgress(e){return e.on("tileloadstart",()=>{this.progress.addLoading()}),e.on("tileloadend",()=>{this.progress.addLoaded()}),e.on("tileloaderror",()=>{this.progress.addLoaded()}),e}}},k=S,P=s("2877"),x=Object(P["a"])(k,w,C,!1,null,null,null);t["a"]=x.exports},"0f29":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"textEditor",class:e.languageString},[s("div",{staticClass:"sourceHeader"},[e.title?s("h3",[e._v(e._s(e.title))]):e._e(),s("div",{staticClass:"sourceToolbar"},[e.editable?s("span",{staticClass:"sepr"},[s("button",{attrs:{type:"button",title:"New script / Clear current script"},on:{click:e.confirmClear}},[s("i",{staticClass:"fas fa-file"})]),e._t("file-toolbar")],2):e._e(),e.editable?s("span",{staticClass:"sepr"},[s("button",{attrs:{type:"button",disabled:!e.canUndo,title:"Revert last change"},on:{click:function(t){return e.editor.undo()}}},[s("i",{staticClass:"fas fa-undo-alt"})]),s("button",{attrs:{type:"button",disabled:!e.canRedo,title:"Redo last reverted change"},on:{click:function(t){return e.editor.redo()}}},[s("i",{staticClass:"fas fa-redo-alt"})]),e._t("edit-toolbar")],2):e._e(),s("FullscreenButton",{attrs:{element:e.$el}}),e._t("toolbar")],2)]),s("div",{staticClass:"sourceCodeEditor",attrs:{id:e.id}})])},i=[],r=s("025e"),o=s("5472"),n=s("a76e"),l=s("56b3"),c=s.n(l),u=(s("a7be"),s("f9d4"),s("959b"),s("ced6"),s("db91"),s("903e"),s("d7d5"),s("8c33"),s("10b2"),s("0dd0"),s("8822"),s("d2de"),s("4ebc")),h=s.n(u);window.jsonlint=h.a;var d={name:"TextEditor",components:{FullscreenButton:o["a"]},props:{id:String,editable:{type:Boolean,default:!0},value:{required:!0},language:{type:String,default:null},placeholder:{type:String,default:""},title:{type:String}},computed:{...r["a"].mapGetters(["processRegistry"]),languageString(){return"string"===typeof this.language?this.language.toLowerCase():""},editorOptions(){let e={indentUnit:2,lineNumbers:!0,indentWithTabs:!0,matchBrackets:!0,autoCloseBrackets:!0,readOnly:!this.editable,placeholder:this.placeholder};switch(this.languageString){case"r":e.mode="text/x-rsrc";break;case"python":e.mode="text/x-python";break;case"math":e.mode="text/x-mathematica";break;case"markdown":e.mode="text/x-markdown";break;case"json":case"processgraph":Object.assign(e,{mode:"application/json",gutters:["CodeMirror-lint-markers"],lint:!0});break}return e}},data(){return{canUndo:!1,canRedo:!1,editor:null,emitValue:this.value}},watch:{value(){this.emitValue!==this.value&&(this.updateContent(),this.editor.clearHistory())},editorOptions(){for(var e in this.editorOptions)this.editor.setOption(e,this.editorOptions[e])}},mounted(){this.editor=c()(document.getElementById(this.id),this.editorOptions),this.editor.setSize(null,"100%"),"processgraph"===this.languageString&&this.editor.on("change",()=>this.updateState()),this.updateContent(),this.editor.on("changes",(e,t)=>{try{0===Object.values(t).filter(e=>"setValue"===e.origin).length&&this.commit()}catch(s){this.$emit("error",s)}})},methods:{confirmClear(){var e=confirm("Do you really want to clear the existing code?");e&&(this.insert(""),this.emit(null))},updateState(){this.editor.setOption("lint",!!this.editor.getValue().trim());let e=this.editor.getDoc().historySize();this.canUndo=e.undo>0,this.canRedo=e.redo>0,this.editor.refresh()},commit(){var e=this.editor.getValue();switch(this.languageString){case"math":return this.emit(e.replace(/[\r\n\t]+/," "));case"processgraph":if(e){var t=JSON.parse(e);if(r["a"].size(t)>0){var s=new n["ProcessGraph"](t,this.processRegistry);return s.allowEmpty(),s.parse(),this.emit(t)}}return this.emit(null);case"json":return e?this.emit(JSON.parse(e)):this.emit(null);default:return this.emit(e)}},emit(e){this.emitValue=e,this.$emit("input",e)},insert(e,t=!0){if("string"!==typeof e&&(e=String(e)),t){const t=this.editor.getValue();if(e!==t){const t=this.editor.getScrollInfo();this.editor.setValue(e),this.editor.scrollTo(t.left,t.top)}}else this.editor.replaceSelection(e)},updateContent(){if(this.value)switch(this.languageString){case"processgraph":r["a"].isObject(this.value)?this.insert(JSON.stringify(this.value,null,this.editorOptions.indentUnit)):this.insert("");break;case"json":this.insert(JSON.stringify(this.value,null,this.editorOptions.indentUnit));break;default:this.insert(this.value)}else this.insert("");this.editor.getDoc().clearHistory(),this.updateState()},insertProcess(e){try{this.insert(JSON.stringify(e,null,2),!1)}catch(t){r["a"].exception(this,t)}}}},p=d,m=(s("4cd1"),s("ccbe"),s("2877")),f=Object(m["a"])(p,a,i,!1,null,"17370a10",null);t["a"]=f.exports},"15dd":function(e,t,s){"use strict";s("bdf7")},"1a7e":function(e,t,s){},"1b7a":function(e,t,s){"use strict";s("7ae6")},"1ea2":function(e,t,s){"use strict";s("ae44")},"1fa6":function(e,t,s){"use strict";s("de39")},"206d":function(e,t,s){},"25f7":function(e,t,s){},"2f5a":function(e,t,s){"use strict";s("dc31")},"30ee":function(e,t,s){"use strict";s("1a7e")},3265:function(e,t,s){},"352f":function(e,t,s){"use strict";s("da12")},"357d":function(e,t,s){},"35cc":function(e,t,s){"use strict";s("375e")},"375e":function(e,t,s){},3916:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.selectedSchema?s("div",{staticClass:"fieldContainer"},[e.showDataTypeChooser?s("div",{staticClass:"dataTypeChooser"},[s("select",{attrs:{name:"dataType",disabled:!e.editable},domProps:{value:e.selectedType},on:{input:e.onSelectType}},e._l(e.groupedallowedTypes,(function(t){return s("optgroup",{key:t.name,attrs:{label:t.name}},e._l(t.types,(function(t,a){return s("option",{key:a,domProps:{value:t.dataType()}},[e._v(e._s(t.title()))])})),0)})),0)]):e._e(),!e.isItem&&e.selectedSchema.description()?s("div",{staticClass:"description"},[s("i",{staticClass:"fas fa-info-circle"}),s("Description",{attrs:{description:e.selectedSchema.description(),compact:!0}})],1):e._e(),s("ParameterDataType",{attrs:{editable:e.editable,parameter:e.parameter,schema:e.selectedSchema,processId:e.processId,context:e.context,parent:e.parent},on:{changeType:e.setSelected},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}})],1):e._e()},i=[],r=s("025e"),o=s("a76e"),n=s("783b"),l=s.n(n),c=s("fbdae"),u=null;class h extends o["JsonSchemaValidator"]{static create(e){return null===u&&(u=new h(e)),u}constructor(e){super(),this.store=e,this.setFileFormats(this.store.getters.fileFormats)}async validateBandName(e){return e.length>0}async validateEpsgCode(e){if(await this.store.dispatch("editor/loadEpsgCodes"),this.store.state.editor.epsgCodes[e])return!0;throw new l.a.ValidationError([{message:"Invalid EPSG code '"+e+"' specified."}])}async validateCollectionId(e){if(this.store.state.collections.filter(t=>t.id===e).length>0)return!0;throw new l.a.ValidationError([{message:"Collection with id '"+e+"' doesn't exist."}])}async validateFilePath(e){if(this.store.getters["files/getById"](e))return!0;throw new l.a.ValidationError([{message:"File at '"+e+"' doesn't exist."}])}async validateInputFormatOptions(e){throw"Not supported"}async validateOutputFormatOptions(e){throw"Not supported"}async validateJobId(e){if(this.store.getters["jobs/getById"](e))return!0;throw new l.a.ValidationError([{message:"Job with id '"+e+"' doesn't exist."}])}async validateUri(e){if(e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/))return!0;throw new l.a.ValidationError([{message:"URI is invalid"}])}async validateUdfCode(e){if(e.match(/(\r|\n)/))return!0;throw new l.a.ValidationError([{message:"UDF Code is invalid"}])}async validateUdfRuntime(e){if(e in this.store.state.udfRuntimes)return!0;throw new l.a.ValidationError([{message:"UDF runtime '"+e+"' is not supported."}])}async validateUdfRuntimeVersion(e){if(c["Versions"].validate(e))return!0;throw new l.a.ValidationError([{message:"UDF runtime version '"+e+"' is not a valid version number."}])}}var d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fieldEditorContainer"},[e.isResult?[s("div",{staticClass:"fieldValue externalData fromNode"},[s("span",[e._v("Output of "),s("tt",[e._v("#"+e._s(e.state.from_node))])],1)]),"array"===e.nativeParameterType?s("button",{attrs:{type:"button"},on:{click:function(t){return e.convertToArray()}}},[s("i",{staticClass:"fas fa-list"}),e._v(" Convert to array")]):e._e()]:"raster-cube"===e.type||"vector-cube"===e.type?s("div",{staticClass:"fieldValue description"},[s("i",{staticClass:"fas fa-exclamation-circle"}),e._v(' This parameter can only be set by creating a connection between an "Output" / "Result" and this parameter in the Visual Model. ')]):e.isPgParameter?[s("div",{staticClass:"fieldValue externalData fromArgument"},[s("span",[e._v("Value of process parameter "),s("tt",[e._v(e._s(e.state.from_parameter))])],1)]),"array"===e.nativeParameterType?s("button",{attrs:{type:"button"},on:{click:function(t){return e.convertToArray()}}},[s("i",{staticClass:"fas fa-list"}),e._v(" Convert to array")]):e._e()]:"null"===e.type?s("div",{staticClass:"description"},[s("i",{staticClass:"fas fa-info-circle"}),e._v(" This is set to "),s("strong",[s("tt",[e._v("null")])],1),e._v(", which is usually used as placeholder for no-data values or a default value.")]):e.isSelection?s("SelectBox",{key:e.type,attrs:{type:e.type,editable:e.editable,schema:e.schema,context:e.dependency},on:{onDetails:e.onSelectDetails},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):e.isTemporal?s("TemporalPicker",{key:e.type,attrs:{type:e.type,editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"bounding-box"===e.type?s("MapAreaSelect",{key:e.type,staticClass:"areaSelector",attrs:{id:e.name+"_bbox",editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"geojson"===e.type?s("MapGeoJsonEditor",{key:e.type,staticClass:"geoJsonEditor",attrs:{id:e.name+"_geojson",editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"process-graph"===e.type?s("Editor",{staticClass:"callbackEditor",attrs:{id:e.name,editable:e.editable,pgParameters:e.processParameters,showDiscoveryToolbar:!0,defaultValue:e.editorDefaultValue},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"output-format-options"===e.type||"input-format-options"===e.type?s("FileFormatOptionsEditor",{ref:"fileFormatOptionsEditor",attrs:{type:e.type,format:e.dependency},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"budget"===e.type?s("Budget",{attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"udf-code"===e.type?s("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:e.dependency},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"commonmark"===e.type?s("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:"markdown"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"wkt2-definition"===e.type||"proj-definition"===e.type?s("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"json"==e.type?s("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:"json"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"boolean"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"checkbox",name:e.name,disabled:!e.editable},domProps:{checked:Array.isArray(e.state)?e._i(e.state,null)>-1:e.state},on:{change:function(t){var s=e.state,a=t.target,i=!!a.checked;if(Array.isArray(s)){var r=null,o=e._i(s,r);a.checked?o<0&&(e.state=s.concat([r])):o>-1&&(e.state=s.slice(0,o).concat(s.slice(o+1)))}else e.state=i}}}):"integer"===e.type||"number"===e.type?s("input",{directives:[{name:"model",rawName:"v-model.number",value:e.state,expression:"state",modifiers:{number:!0}}],staticClass:"fieldValue",attrs:{type:"number",min:e.numericMin,max:e.numericMax,step:e.numericStep,name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}):"url"===e.type||"uri"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"url",name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=t.target.value)}}}):"object"===e.nativeType||"array"===e.nativeType?s("ObjectEditor",{attrs:{editable:e.editable,parameter:e.parameter,schema:e.schema,isObject:"object"===e.nativeType,context:e.context},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"text",name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=t.target.value)}}})],2)},p=[],m=s("3115"),f=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("div",{class:{editor:!0,array:!t.isObject,object:t.isObject}},[a("div",{staticClass:"buttons"},[t.editable?a("button",{staticClass:"addBtn",attrs:{type:"button"},on:{click:function(e){return t.add()}}},[a("i",{staticClass:"fas fa-plus"}),t._v(" Add")]):t._e(),a("FullscreenButton",{attrs:{element:function(){return e.$el}}})],1),t.elements.length?a("draggable",{attrs:{handle:".mover"},model:{value:t.elements,callback:function(e){t.elements=e},expression:"elements"}},t._l(t.elements,(function(e,s){return a("div",{key:e.id,staticClass:"fieldValue element"},[a("label",{key:s,staticClass:"fieldLabel"},[t.isObject?a("input",{directives:[{name:"model",rawName:"v-model",value:e.key,expression:"e.key"}],attrs:{type:"text",disabled:!t.editable},domProps:{value:e.key},on:{input:function(s){s.target.composing||t.$set(e,"key",s.target.value)}}}):[t._v(t._s(s))]],2),a("ParameterDataTypes",{attrs:{editable:t.editable,parameter:t.elementSchema(s,e.key),isItem:!0,context:t.context},model:{value:e.value,callback:function(s){t.$set(e,"value",s)},expression:"e.value"}}),t.editable?a("button",{staticClass:"deleteBtn",attrs:{type:"button"},on:{click:function(e){return t.remove(s)}}},[a("i",{staticClass:"fas fa-trash"})]):t._e(),a("button",{directives:[{name:"show",rawName:"v-show",value:t.editable&&!t.isObject,expression:"editable && !isObject"}],staticClass:"mover",attrs:{type:"button"}},[a("i",{staticClass:"fas fa-arrows-alt"})])],1)})),0):a("div",{staticClass:"empty description"},[a("i",{staticClass:"fas fa-info-circle"}),t.isObject?[t._v(" Object is empty")]:[t._v(" Array is empty")]],2)],1)},g=[],v=s("b76a"),b=s.n(v),y=s("5472"),w={name:"ObjectEditor",components:{draggable:b.a,FullscreenButton:y["a"],ParameterDataTypes:()=>Promise.resolve().then(s.bind(null,"3916"))},props:{parameter:Object,editable:{type:Boolean,default:!0},schema:Object,value:{},isObject:{type:Boolean,default:!1},context:{}},data(){return{elements:[]}},computed:{newValue(){if(this.isObject){let e={};for(let t of this.elements)e[t.key]=t.value;return e}return this.elements.map(e=>e.value)}},watch:{newValue:{deep:!0,handler(e){this.$emit("input",e)}},value:{immediate:!0,handler(e){if(this.newValue!==e&&(this.elements=[],e&&"object"===typeof e))for(var t in e)this.add(t,e[t])}}},methods:{elementSchema(e,t=null){return this.schema.getElementSchema(t||e)},add(e=null,t){let s={id:String(this.elements.length),value:t};this.isObject&&(s.key=e||"unnamed"+this.elements.length),"undefined"===typeof s.value&&(s.value=this.elementSchema(this.elements.length,s.key).default),this.elements.push(s)},remove(e){this.elements.splice(e,1)}}},C=w,S=(s("35cc"),s("2877")),k=Object(S["a"])(C,f,g,!1,null,"e5082542",null),P=k.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"datatypeEditor budget"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.hasBudget,expression:"hasBudget"}],attrs:{type:"checkbox",disabled:!e.editable},domProps:{checked:Array.isArray(e.hasBudget)?e._i(e.hasBudget,null)>-1:e.hasBudget},on:{change:function(t){var s=e.hasBudget,a=t.target,i=!!a.checked;if(Array.isArray(s)){var r=null,o=e._i(s,r);a.checked?o<0&&(e.hasBudget=s.concat([r])):o>-1&&(e.hasBudget=s.slice(0,o).concat(s.slice(o+1)))}else e.hasBudget=i}}}),s("input",{directives:[{name:"model",rawName:"v-model.number",value:e.amount,expression:"amount",modifiers:{number:!0}}],attrs:{type:"number",min:"0.00",max:e.max,step:"0.01",disabled:!e.hasBudget||!e.editable},domProps:{value:e.amount},on:{input:function(t){t.target.composing||(e.amount=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "+e._s(e.capabilities.currency())+" ")])},E=[],_={name:"Budget",computed:{...r["a"].mapState(["userInfo"]),...r["a"].mapGetters(["capabilities"]),max(){return this.userInfo.budget>0?this.userInfo.budget:Number.MAX_VALUE}},props:{value:{type:Number,default:null},editable:{type:Boolean,default:!0}},data(){return{hasBudget:"number"===typeof this.value,amount:this.value}},watch:{hasBudget(){this.updateData()},amount(){this.updateData()}},methods:{updateData(){this.$emit("input",this.hasBudget&&!Number.isNaN(this.amount)?this.amount:null)}}},T=_,D=Object(S["a"])(T,x,E,!1,null,null,null),F=D.exports,I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:e.id}})},M=[],$=s("0921"),O=s("3900"),B=s("256f");class j{constructor(e,t=!0,s=null,a=null){this.map=e;var i=this.map.getSize();this.width=s||(i[0]>0?.7*i[0]:300),this.height=a||(i[1]>0?.7*i[1]:200),this.moving=!1,this.editable=t,this.interactionListener=null,this.createElements(),this.addControls(),this.render()}setInteractionListener(e){this.interactionListener=e}getBounds(e=!1){var t=this.map.getSize(),s=[0,0],a=[0,0];a[0]=Math.round((t[0]-this.width)/2),s[1]=Math.round((t[1]-this.height)/2),s[0]=t[0]-a[0],a[1]=t[1]-s[1];var i=Object(B["i"])(this.map.getCoordinateFromPixel(a)),r=Object(B["i"])(this.map.getCoordinateFromPixel(s));return e?i.concat(r):{west:i[0],south:i[1],east:r[0],north:r[1]}}setBounds(e){if(e){Array.isArray(e)&&(e=r["a"].extentToBBox(e));var t=Object(B["d"])([e.west,e.south]),s=Object(B["d"])([e.east,e.north]),a={callback:()=>{var e=this.map.getPixelFromCoordinate(t),a=this.map.getPixelFromCoordinate(s);this.width=parseInt(Math.abs(e[0]-a[0])),this.height=parseInt(Math.abs(e[1]-a[1])),this.render()}},i=this.map.getSize();!this.editable&&i&&(a.padding=[i[0]/3,i[1]/3,i[0]/3,i[1]/3]),this.map.getView().fit([...t,...s],a)}}createElement(e,t,s){var a=document.createElement(e);return a.className=t,s&&s.appendChild(a),a}createElements(){this.overlayContainer||(this.overlayContainer=this.createElement("div","ol-unselectable ol-areaselect ol-areaselect-shade-container",this.map.getOverlayContainer()),this.topShade=this.createElement("div","ol-areaselect-shade",this.overlayContainer),this.bottomShade=this.createElement("div","ol-areaselect-shade",this.overlayContainer),this.leftShade=this.createElement("div","ol-areaselect-shade",this.overlayContainer),this.rightShade=this.createElement("div","ol-areaselect-shade",this.overlayContainer),this.editable&&(this.nwHandle=this.createElement("div","ol-areaselect-handle"),this.swHandle=this.createElement("div","ol-areaselect-handle"),this.neHandle=this.createElement("div","ol-areaselect-handle"),this.seHandle=this.createElement("div","ol-areaselect-handle"),this.setUpHandlerEvents(this.nwHandle,1,1),this.setUpHandlerEvents(this.neHandle,-1,1),this.setUpHandlerEvents(this.swHandle,1,-1),this.setUpHandlerEvents(this.seHandle,-1,-1)),this.map.on("change:size",()=>this.onInteraction()))}setUpHandlerEvents(e,t,s){var a=e=>{if(this.moving){var a=this.map.getSize();this.width+=2*(this.moving[0]-e.pageX)*t,this.height+=2*(this.moving[1]-e.pageY)*s,this.width=Math.max(30,this.width),this.height=Math.max(30,this.height),this.width=Math.min(a[0]-30,this.width),this.height=Math.min(a[1]-30,this.height),this.moving=[e.pageX,e.pageY],this.render()}},i=this.map.getTargetElement(),r=document.querySelector("html"),o=()=>{this.map.getTargetElement()&&(i.removeEventListener("mousemove",a),r.removeEventListener("mouseup",o),this.moving=!1,"function"===typeof this.interactionListener&&this.interactionListener())};e.addEventListener("mousedown",e=>{e.stopPropagation(),this.moving=[e.pageX,e.pageY],i.addEventListener("mousemove",a),r.addEventListener("mouseup",o)})}onInteraction(){this.render()}render(){var e=this.map.getSize(),t=Math.round((e[1]-this.height)/2),s=Math.round((e[0]-this.width)/2);if(this.setElementDimensions(this.overlayContainer,{width:e[0],height:e[1]}),this.setElementDimensions(this.topShade,{width:e[0],height:t,top:0,left:0}),this.setElementDimensions(this.bottomShade,{width:e[0],height:t,bottom:0,left:0}),this.setElementDimensions(this.leftShade,{width:s,height:e[1]-2*t,top:t,left:0}),this.setElementDimensions(this.rightShade,{width:s,height:e[1]-2*t,top:t,right:0}),this.editable){var a=Math.round(this.nwHandle.offsetWidth/2);this.setElementDimensions(this.nwHandle,{left:s-a,top:t-7}),this.setElementDimensions(this.neHandle,{right:s-a,top:t-7}),this.setElementDimensions(this.swHandle,{left:s-a,bottom:t-7}),this.setElementDimensions(this.seHandle,{right:s-a,bottom:t-7})}}setElementDimensions(e,t){e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.bottom=t.bottom+"px",e.style.right=t.right+"px"}addControls(){this.editable&&(this.addControl(this.nwHandle),this.addControl(this.neHandle),this.addControl(this.swHandle),this.addControl(this.seHandle))}addControl(e){this.map.addControl(new O["a"]({element:e}))}}var R={name:"MapAreaSelect",mixins:[$["a"]],props:{value:{type:[Object,Array],default:()=>null}},computed:{asArray(){return Array.isArray(this.value)}},methods:{renderMap(){if(this.createMap(),this.areaSelect=new j(this.map,this.editable),null!==this.value&&this.areaSelect.setBounds(this.value),this.editable){var e=()=>this.$emit("input",this.areaSelect.getBounds(this.asArray));this.areaSelect.setInteractionListener(e),this.map.on("change",e),this.map.getView().on("change",e),this.map.on("propertychange",e)}}}},L=R,N=(s("991b"),s("1fa6"),Object(S["a"])(L,I,M,!1,null,null,null)),V=N.exports,J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:e.id}})},A=[],U=s("a2e1"),z=s("b2fc"),H=(s("faaa"),s("f087")),G=s("e887"),q=(s("159a"),s("c516")),W=s("d803"),Y={name:"MapGeoJsonEditor",mixins:[$["a"]],props:{value:{type:Object,default:null}},data(){return{geoJsonLayer:null}},methods:{showMap(){this.show&&this.$nextTick(this.renderMap)},renderMap(){if(this.createMap(!0),this.editable?this.geoJsonLayer=this.geoJsonEditor(this.value):this.geoJsonLayer=this.addGeoJson(this.value),this.editable){var e=()=>this.$emit("input",this.getGeoJson());this.geoJsonLayer.getSource().on("change",e)}},geoJsonEditor(e){var t=this.addGeoJson(e),s=new H["a"];this.map.addControl(s);var a=new q["a"]({source:t.getSource(),interactions:{Info:!1,DrawHole:!1,Offset:!1,Split:!1}});s.addControl(a);var i=new W["a"];this.map.addInteraction(i),i.on("undo",e=>{"addfeature"===e.action.type&&(a.getInteraction("Select").getFeatures().clear(),a.getInteraction("Transform").select())});var r=new H["a"]({group:!0,controls:[new G["a"]({html:'<i class="fas fa-undo-alt"></i>',title:"Undo",handleClick:()=>i.undo()}),new G["a"]({html:'<i class="fas fa-redo-alt"></i>',title:"Redo",handleClick:()=>i.redo()})]});return s.addControl(r),this.map.addInteraction(new z["a"]({source:t.getSource()})),t},getGeoJson(){var e=new U["a"],t=this.geoJsonLayer.getSource().getFeatures(),s=[];for(var a in t)s.push(e.writeFeatureObject(t[a],{dataProjection:"EPSG:4326",featureProjection:this.osm.getProjection()}));return 0===s.length?null:1===s.length?!s[0].properties&&s[0].geometry?s[0].geometry:s[0]:{type:"FeatureCollection",features:s}}}},X=Y,Z=Object(S["a"])(X,J,A,!1,null,null,null),K=Z.exports,Q=s("0f29"),ee={name:"ParameterDataType",mixins:[m["a"]],components:{ObjectEditor:P,Budget:F,MapAreaSelect:V,MapGeoJsonEditor:K,TextEditor:Q["a"],Editor:()=>Promise.resolve().then(s.bind(null,"ceb0")),FileFormatOptionsEditor:()=>s.e("chunk-68913ea4").then(s.bind(null,"eeea")),ParameterDataTypes:()=>Promise.resolve().then(s.bind(null,"3916")),SelectBox:()=>s.e("chunk-2ae6eedc").then(s.bind(null,"3e57")),TemporalPicker:()=>s.e("chunk-4d09c208").then(s.bind(null,"cca6"))},props:{parameter:Object,editable:{type:Boolean,default:!0},schema:Object,value:{},processId:String,context:{},parent:{}},data(){return{state:this.value}},computed:{...r["a"].mapGetters(["processRegistry"]),type(){return this.schema.dataType()},nativeType(){return this.schema.nativeDataType()},nativeParameterType(){return this.parameter.nativeDataType()},editorDefaultValue(){if("process-graph"===this.type){if("undefined"!==typeof this.parameter.default)return this.parameter.default;if(this.parameter.nullable())return null}},isTemporal(){return"date"===this.type||"time"===this.type||"date-time"===this.type||"temporal-interval"===this.type||"year"===this.type},isSelection(){switch(this.type){case"collection-id":case"job-id":case"file-path":case"file-paths":case"epsg-code":case"input-format":case"output-format":case"service-type":case"billing-plan":case"udf-runtime":case"udf-runtime-version":return!0;case"band-name":return!!this.dependency;default:return this.schema.isEnum()}},name(){return this.parameter.name+(Array.isArray(this.parameter.value)?"[]":"")},isResult(){return Boolean(r["a"].isObject(this.state)&&this.state.from_node&&1===r["a"].size(this.state)&&this.schema.schema.isRef)},isPgParameter(){return Boolean(r["a"].isObject(this.state)&&this.state.from_parameter&&1===r["a"].size(this.state)&&this.schema.schema.isRef)},numericMin(){return"number"===typeof this.schema.minimum?this.schema.minimum:""},numericMax(){return"number"===typeof this.schema.maximum?this.schema.maximum:""},numericStep(){return"number"===typeof this.schema.multipleOf?this.schema.multipleOf:"integer"===this.type?1:"any"},newValue(){if("number"===this.type){var e=Number.parseFloat(this.state);return Number.isNaN(e)?null:e}if("integer"===this.type){e=Number.parseInt(this.state);return Number.isNaN(e)?null:e}if("null"===this.type)return null;if("string"===typeof this.state&&this.state.length>0&&("any"===this.type||"mixed"===this.type)){e=Number(this.state);return Number.isNaN(e)?this.state:e}return this.state},dependency(){switch(this.type){case"output-format-options":case"input-format-options":return this.getValueFromOtherParameterByDataType(this.type.replace("-options",""));case"udf-runtime-version":case"udf-code":return this.getValueFromOtherParameterByDataType("udf-runtime");case"band-name":return this.getValueFromOtherParameterByDataType("collection-id");default:return}},processParameters(){let e=this.schema.getCallbackParameters(),t=[];r["a"].isObject(this.parent)&&"function"===typeof this.parent.getPgParameters&&(t=this.parent.getPgParameters().map(e=>e.spec));let s=e.map(e=>e.name),a=t.filter(e=>!s.includes(e.name));return e.concat(a)}},watch:{value(e){e!==this.newValue&&(this.state=this.value)},async newValue(e){this.$emit("input",e)}},methods:{getValueFromOtherParameterByDataType(e){if(r["a"].isObject(this.context)&&r["a"].isObject(this.context.schemas)&&r["a"].isObject(this.context.values))for(let t in this.context.schemas){let s=this.context.schemas[t];if(r["a"].isObject(s)&&s.dataType()===e)return this.context.values[t]}},convertToArray(){this.state=[this.state],this.$emit("input",this.state),this.$emit("changeType","array")},onSelectDetails(){"collection-id"===this.type&&this.emit("showCollection",this.state)}}},te=ee,se=(s("9800"),Object(S["a"])(te,d,p,!1,null,"1e23d04c",null)),ae=se.exports,ie=s("8088"),re=s("79e5");const oe=r["a"].resolveJsonRefs(s("ff6c")).definitions,ne=["Basics","References","Spatial","Temporal","File and Folders","Resources","CRS","UDF","Other"],le=()=>(new Date).toISOString().replace(/\.\d+/,""),ce=[{type:"null",const:null,group:"Basics"},{type:"string",default:"",group:"Basics"},{type:"integer",default:0,group:"Basics"},{type:"number",default:0,group:"Basics"},{type:"boolean",default:!1,group:"Basics"},{type:"array",default:[],group:"Basics"},{type:"object",default:{},group:"Basics"},{type:"string",subtype:"date-time",format:"date-time",title:"Date and Time",group:"Temporal",default:()=>le()},{type:"string",subtype:"date",format:"date",title:"Date only",group:"Temporal",default:()=>le().substring(0,10)},{type:"string",subtype:"time",format:"time",title:"Time only",group:"Temporal",default:()=>le().substring(11)},{type:"string",subtype:"year",title:"Year only",group:"Temporal"},{type:"array",subtype:"temporal-interval",title:"Temporal interval",group:"Temporal"},{type:"array",subtype:"temporal-intervals",title:"Temporal intervals (multiple)",group:"Temporal",default:[]},{type:"object",subtype:"geojson",title:"GeoJSON",group:"Spatial"},{type:"object",subtype:"bounding-box",title:"Bounding Box",group:"Spatial"},{type:"string",subtype:"band-name",title:"Band",group:"Resources"},{type:"string",subtype:"collection-id",title:"Collection",group:"Resources"},{type:"string",subtype:"job-id",title:"Batch Job",group:"Resources"},{type:"string",subtype:"udf-code",title:"UDF Source Code",group:"UDF",default:""},{type:"string",subtype:"udf-runtime",title:"UDF Runtime",group:"UDF"},{type:"string",subtype:"udf-runtime-version",title:"UDF Runtime Version",group:"UDF",any:!1},{type:"integer",subtype:"epsg-code",title:"EPSG Code (CRS)",group:"CRS"},{type:"string",subtype:"proj-definition",title:"PROJ defintiion (CRS)",group:"CRS",default:""},{type:"string",subtype:"wkt2-definition",title:"WKT2 defintiion (CRS)",group:"CRS",default:""},{type:"array",subtype:"file-path",title:"File path",group:"File and Folders"},{type:"array",subtype:"file-paths",title:"File paths (multiple)",group:"File and Folders",default:[]},{type:"string",subtype:"uri",format:"uri",title:"URI / URL",group:"File and Folders"},{type:"string",subtype:"output-format",title:"Export file format",group:"File and Folders"},{type:"object",subtype:"output-format-options",title:"Export file format parameters",group:"File and Folders",any:!1},{type:"string",subtype:"input-format",title:"Import file format",group:"File and Folders"},{type:"object",subtype:"input-format-options",title:"Import file format parameters",group:"File and Folders",any:!1},{type:"object",subtype:"process-graph",title:"Custom Process"},{subtype:"json",title:"JSON"}];var ue={name:"ParameterDataTypes",mixins:[m["a"]],components:{Description:ie["default"],ParameterDataType:ae},props:{parameter:{type:Object,default:()=>new re["c"]({})},editable:{type:Boolean,default:!0},processId:String,value:{},isItem:{type:Boolean,default:!1},context:{},parent:{}},data(){return{state:"undefined"===typeof this.value?this.parameter.default:this.value,selectedType:null,selectedSchema:null,jsonSchemaValidator:h.create(this.$store)}},async created(){await this.detectType()},computed:{refSchemas(){let e={};for(let t of this.parameter.getRefs()){let s;t.from_node?(s="from_node:"+t.from_node,e[s]=new re["b"]({type:"object",group:"References",refId:s,isRef:"from_node",from_node:t.from_node,title:"Output of #"+t.from_node,required:["from_node"],properties:{from_node:{type:"string",const:t.from_node}},const:t,additionalProperties:!1})):t.from_parameter&&(s="from_parameter:"+t.from_parameter,e[s]=new re["b"]({type:"object",group:"References",refId:s,isRef:"from_parameter",from_parameter:t.from_parameter,title:'Value of process parameter "'+t.from_parameter+'"',required:["from_parameter"],properties:{from_parameter:{type:"string",const:t.from_parameter}},const:t,additionalProperties:!1}))}return e},showDataTypeChooser(){return r["a"].size(this.allowedTypes)>=2},allowedTypes(){if("any"===this.parameter.dataType())return Object.assign({},this.supportedTypes,this.refSchemas);{let e={};for(let t of this.parameter.schemas){let s=t.dataType();e[s]=t}return Object.assign(e,this.refSchemas)}},supportedTypes(){let e={};for(let t of ce){if(!1===t.any)continue;let s=t.subtype||t.type,a=Object.assign({},oe[s],t);e[s]=new re["b"](a,this.parameter)}return e},groupedallowedTypes(){let e={};for(let t in this.allowedTypes){let s=this.allowedTypes[t],a=s.group();Array.isArray(e[a])?e[a].push(s):e[a]=[s]}return ne.map(t=>({name:t,types:e[t]||[]})).filter(e=>0!==e.types.length)}},watch:{value(e){e!==this.state&&(this.state=e)},state(e){this.$emit("input",e)},selectedType(e){this.$emit("schemaSelected",this.supportedTypes[e])}},methods:{async getTypeForValue(e,t){var s=[],a=[];for(var i of e)try{var r=await this.jsonSchemaValidator.validateValue(t,i.schema);if(r.length>0)continue;let e=i.dataType();e===i.nativeDataType()?a.push(e):s.push(e)}catch(o){}return 0===s.length?a:s},async detectType(){let e=Object.keys(this.allowedTypes),t="undefined"===typeof this.state;if(0===e.length)await this.setSelected("json");else if(1===e.length)await this.setSelected(e[0],t);else if(t){let t=e.filter(e=>"null"!==e);await this.setSelected(t[0],!0)}else{let e=await this.getTypeForValue(Object.values(this.allowedTypes),this.state);if(0===e.length)await this.setSelected("json");else if(1===e.length)await this.setSelected(e[0]);else{e.sort();let t=2===e.length&&"integer"===e[0]&&"number"===e[1];r["a"].isRef(this.state)||t||console.warn("A parameter is ambiguous. Potential types: "+e.join(", ")+". Value: "+JSON.stringify(this.state)),await this.setSelected(e[0])}}},async onSelectType(e){await this.setSelected(e.target.value,!0)},async setSelected(e,t=!1){if(e instanceof re["b"]?(this.selectedSchema=e,this.selectedType=e.dataType()):(this.selectedSchema=this.allowedTypes[e]?this.allowedTypes[e]:this.supportedTypes[e],this.selectedType=e),t)if(this.selectedSchema.isNull())this.state=null;else if("undefined"!==typeof this.selectedSchema.const)this.state=this.selectedSchema.const;else if(this.selectedSchema.isEnum()&&1===this.selectedSchema.getEnumChoices().length)this.state=this.selectedSchema.getEnumChoices()[0];else{let e=this.selectedSchema.default();try{("undefined"===typeof this.state||(await this.jsonSchemaValidator.validateValue(this.state,this.selectedSchema)).length>0)&&(this.state=e)}catch(s){this.state=e}}}}},he=ue,de=(s("2f5a"),Object(S["a"])(he,a,i,!1,null,null,null));t["default"]=de.exports},3986:function(e,t,s){},4525:function(e,t,s){},"4cd1":function(e,t,s){"use strict";s("3265")},"4d982":function(e,t,s){"use strict";s("c98e")},"50e5":function(e,t,s){},5472:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{attrs:{type:"button",title:e.isFullscreen?"Close fullscreen":"Show fullscreen"},on:{click:e.toggleFullscreen}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.isFullscreen,expression:"isFullscreen"}]},[s("i",{staticClass:"fas fa-compress"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.isFullscreen,expression:"!isFullscreen"}]},[s("i",{staticClass:"fas fa-expand"})])])},i=[],r=s("025e"),o={name:"FullscreenButton",props:["element"],data(){return{isFullscreen:!1,keyDownFn:null,oldZIndex:"auto"}},mounted(){this.keyDownFn=this.onkeyDown.bind(this);let e=this.getElement();e&&e.addEventListener("keydown",this.keyDownFn)},beforeDestroy(){let e=this.getElement();e&&e.removeEventListener("keydown",this.keyDownFn)},computed:{...r["a"].mapState("editor",["hightestModalZIndex"])},methods:{...r["a"].mapMutations("editor",["openModal","closeModal"]),onkeyDown(e){("F11"===e.key||this.isFullscreen&&"Escape"===e.key)&&(this.toggleFullscreen(),e.preventDefault(),e.stopPropagation())},getElement(){return"string"===typeof this.element?document.querySelector(this.element):"function"===typeof this.element?this.element():this.element},toggleFullscreen(){let e=this.getElement();this.isFullscreen?(this.isFullscreen=!1,e.classList.remove("fullscreen"),e.style.zIndex=this.oldZIndex,this.closeModal()):(this.isFullscreen=!0,e.classList.add("fullscreen"),this.openModal(),this.oldZIndex=e.style.zIndex,e.style.zIndex=this.hightestModalZIndex),this.$emit("changed",this.isFullscreen)}}},n=o,l=(s("90f4"),s("2877")),c=Object(l["a"])(n,a,i,!1,null,null,null);t["a"]=c.exports},"54a8":function(e,t,s){},"6e6b":function(e,t,s){"use strict";s("ded2")},"76b6":function(e,t,s){},"7ae6":function(e,t,s){},"7b86":function(e,t,s){"use strict";s("3986")},"8f78":function(e,t,s){"use strict";s("c5cf")},"90b4":function(e,t,s){},"90f4":function(e,t,s){"use strict";s("206d")},"916f":function(e,t,s){"use strict";s("ebe9")},"97e8":function(e,t,s){},9800:function(e,t,s){"use strict";s("54a8")},"991b":function(e,t,s){"use strict";s("90b4")},9961:function(e,t,s){"use strict";s("76b6")},a168:function(e,t,s){},a5c1:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:e.id}})},i=[],r=s("0921"),o=s("025e"),n=s("4cdf"),l=s("5bc3"),c=s("256f"),u=s("480c"),h=s("6cf3"),d=s("3e6b"),p=s("5831"),m=s("2ef1"),f=(s("7505"),s("cfd3")),g={name:"MapViewer",mixins:[r["a"]],props:{extents:{type:Array,default:()=>null},geoJson:{type:Object,default:()=>null}},data(){return{userLayers:{},swipe:{control:null,left:null,right:null}}},methods:{renderMap(){let e=Array.isArray(this.extents)&&this.extents.length>0;if(this.createMap(!e),e)for(let s of this.extents){var t=o["a"].extentToBBox(s);this.addRectangle(t.west,t.east,t.north,t.south)}o["a"].isObject(this.geoJson)&&(this.geoJsonLayer=this.addGeoJson(this.geoJson))},addRectangle(e,t,s,a){var i=[...Object(c["d"])([e,a]),...Object(c["d"])([t,s])];this.map.addLayer(new d["a"]({title:"Extent",displayInLayerSwitcher:!1,source:new p["a"]({features:[new n["a"](Object(l["c"])(i))],wrapX:!1})})),this.map.getView().fit(i)},getVisibleLayers(){var e=[];for(var t in this.userLayers)this.userLayers[t].getVisible()&&e.push(t);return e},showWebService(e){switch(e.type.toLowerCase()){case"xyz":this.updateXYZLayer(e);break;default:o["a"].error(this,"Sorry, the service type is not supported by the map.")}},toggleSwipeControl(){var e=this.getVisibleLayers();2===e.length?(null===this.swipe.control&&(this.swipe.control=new f["a"],this.map.addControl(this.swipe.control)),this.swipe.left!==e[0]&&(this.swipe.control.addLayer(this.userLayers[e[0]]),this.swipe.left=e[0]),this.swipe.right!==e[1]&&(this.swipe.control.addLayer(this.userLayers[e[1]],!0),this.swipe.right=e[1])):(this.map.removeControl(this.swipe.control),this.swipe.control=null,this.swipe.left=null,this.swipe.right=null)},addLayerToMap(e,t){this.userLayers[e]=t,this.map.addLayer(t),this.toggleSwipeControl(),t.on("change",()=>this.toggleSwipeControl()),t.on("change:visible",()=>this.toggleSwipeControl()),t.on("change:zIndex",()=>this.toggleSwipeControl())},removeLayerFromMap(e){this.userLayers[e]&&(this.map.removeLayer(this.userLayers[e]),delete this.userLayers[e],this.toggleSwipeControl())},updateGeoTiffLayer(e,t=null){var s=new u["a"]({source:new h["a"]({url:"http://tiles.rdnt.io/tiles?url="+encodeURIComponent(e),crossOrigin:"anonymous"})});this.addLayerToMap(t||"GeoTiff",s)},updateXYZLayer(e){var t=e.id,s=e.url,a=o["a"].getResourceTitle(e,"Service")+" (XYZ)";if("undefined"===typeof this.userLayers[t]){var i=new u["a"]({source:this.trackTileProgress(new m["a"]({url:s})),title:a});this.addLayerToMap(t,i)}else{var r=o["a"].replaceParam(s,"__editorSessionId",(new Date).getTime());r=r.replace(/%7B/g,"{").replace(/%7D/g,"}"),this.userLayers[t].getSource().setUrl(r)}}}},v=g,b=(s("991b"),s("2877")),y=Object(b["a"])(v,a,i,!1,null,null,null);t["a"]=y.exports},a89b:function(e,t,s){"use strict";s("357d")},aab4:function(e,t,s){"use strict";s("97e8")},ae44:function(e,t,s){},b16a:function(e,t,s){"use strict";s("25f7")},b5d7:function(e,t,s){"use strict";s("50e5")},bdf7:function(e,t,s){},c240:function(e,t,s){},c261:function(e,t,s){},c2aeb:function(e,t,s){},c2dc:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{ref:"__modal",attrs:{minWidth:"60%",maxWidth:"90%",minHeight:"75%"},scopedSlots:e._u([{key:"main",fn:function(){return[0===e.editableFields.length?s("p",[e._v("No editable parameters available.")]):s("form",{attrs:{id:"parameterModal"},on:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[e._l(e.editableFields,(function(t,a){return s("div",{key:a,staticClass:"fieldRow"},[s("label",{class:{fieldLabel:!0,highlight:t.name===e.selectParameter}},[e._v(" "+e._s(e.displayLabel(t))),t.optional?e._e():s("strong",{staticClass:"required",attrs:{title:"required"}},[e._v("*")]),t.description?s("div",{staticClass:"description"},[s("Description",{attrs:{description:t.description}})],1):e._e()]),s("ParameterDataTypes",{ref:t.name,refInFor:!0,attrs:{editable:e.editable,parameter:t,processId:e.processId,context:e.context,parent:e.parent},on:{schemaSelected:function(s){return e.updateType(t,s)}},model:{value:e.values[t.name],callback:function(s){e.$set(e.values,t.name,s)},expression:"values[param.name]"}}),t.unspecified?s("button",{staticClass:"deleteBtn",attrs:{title:"Delete unspecified parameter",type:"button"},on:{click:function(t){return e.deleteParam(a)}}},[s("i",{staticClass:"fas fa-trash"})]):e._e()],1)})),s("button",{staticStyle:{display:"none"},attrs:{type:"submit"}})],2)]},proxy:!0},"function"===typeof e.saveCallback?{key:"footer",fn:function(){return[s("div",{staticClass:"footer"},[s("button",{staticClass:"save",on:{click:e.save}},[e._v("Save")])])]},proxy:!0}:null],null,!0)})},i=[],r=s("025e"),o=s("2930"),n=s("8088"),l=s("3916"),c={name:"ParameterModal",components:{Modal:o["a"],Description:n["default"],ParameterDataTypes:l["default"]},data(){return{editableFields:[],values:{},schemas:{},editable:!0,selectParameter:null,saveCallback:null,processId:null,parent:null}},computed:{context(){return{values:this.values,schemas:this.schemas,parameters:this.editableFields}}},methods:{deleteParam(e){let t=this.editableFields[e].name;this.$delete(this.editableFields,e),this.$delete(this.schemas,t),this.$delete(this.values,t)},updateType(e,t){this.$set(this.schemas,e.name,t)},displayLabel(e){return"string"===typeof e.label&&e.label.length>0?e.label:r["a"].prettifyString(e.name)},save(){try{"function"===typeof this.saveCallback&&this.saveCallback(this.values),this.$refs.__modal.close()}catch(e){r["a"].exception(this,e)}},show(e,t,s,a=!0,i=null,o=null,n=null,l=null,c=null){this.editableFields=t,this.values=r["a"].deepClone(s),this.schemas={},this.editable=a,this.saveCallback=i,this.processId=n,this.selectParameter=l,this.parent=c,this.$refs.__modal.show(e,o),setTimeout(()=>{let e;this.selectParameter?e=this.componentforParameter(this.selectParameter):this.editableFields.length>0&&(e=this.componentforParameter(this.editableFields[0].name)),e&&(this.selectParameter&&e.$el.scrollIntoView(),this.focusInput(e))},100)},componentforParameter(e){return e&&Array.isArray(this.$refs[e])&&this.$refs[e][0]?this.$refs[e][0]:null},focusInput(e){let t=e.$el.querySelector('input:not([type="hidden"]):not([disabled]):not([class~="multiselect__input"]), button:not([disabled]), textarea:not([disabled]), select:not([disabled]), datalist:not([disabled])');t&&t.focus()}}},u=c,h=(s("e827"),s("6e6b"),s("2877")),d=Object(h["a"])(u,a,i,!1,null,"f66e0864",null);t["default"]=d.exports},c46c:function(e,t,s){"use strict";s("c261")},c5cf:function(e,t,s){},c98e:function(e,t,s){},cbd9:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"discovery-toolbar"},[s("SearchBox",{model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}}),s("div",{staticClass:"search-results"},[s("Collections",{staticClass:"category",attrs:{collections:e.collections,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var a=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsLoadCollection},on:{dragstart:function(t){return e.onDrag(t,"collection",a)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showCollectionInfo(a.id)}}},[s("strong",{attrs:{title:a.id}},[e._v(e._s(a.id))]),a.title?s("small",{attrs:{title:a.title}},[e._v(e._s(a.title))]):e._e()]),e.supportsLoadCollection?s("button",{staticClass:"discovery-button",attrs:{type:"button",title:"Insert"},on:{click:function(t){return e.insertCollection(a)}}},[s("i",{staticClass:"fas fa-plus"})]):e._e()])]}}])}),s("Processes",{staticClass:"category",attrs:{processes:e.processes,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var a=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:"true"},on:{dragstart:function(t){return e.onDrag(t,"process",a)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showProcessInfo(a)}}},[a.native?e._e():s("i",{staticClass:"custom-process fas fa-xs fa-sitemap",attrs:{title:"Custom Process"}}),s("strong",{attrs:{title:a.id}},[e._v(e._s(a.id))]),a.summary?s("small",{attrs:{title:a.summary}},[e._v(e._s(a.summary))]):e._e()]),s("button",{staticClass:"discovery-button",attrs:{type:"button",title:"Insert"},on:{click:function(t){return e.insertProcess(e.e)}}},[s("i",{staticClass:"fas fa-plus"})])])]}}])}),e.hasUdfRuntimes?s("UdfRuntimes",{staticClass:"category",attrs:{runtimes:e.udfRuntimes,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var a=t.summary,i=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsRunUdf},on:{dragstart:function(t){return e.onDrag(t,"udf",{runtime:a.identifier,version:i.default})}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showUdfInfo(a.identifier,i)}}},[s("strong",{attrs:{title:a.identifier}},[e._v(e._s(a.identifier)+" ("+e._s(i.default)+")")]),a.summary?s("small",{attrs:{title:a.summary}},[e._v(e._s(a.summary))]):e._e()]),e.supportsRunUdf?s("button",{staticClass:"discovery-button",attrs:{type:"button",title:"Insert"},on:{click:function(t){return e.insertUdf(a.identifier,i.default)}}},[s("i",{staticClass:"fas fa-plus"})]):e._e()])]}}],null,!1,1122562181)}):e._e(),s("FileFormats",{staticClass:"category",attrs:{formats:e.fileFormats,showInput:!1,heading:"Export File Formats",searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var a=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsSaveResult},on:{dragstart:function(t){return e.onDrag(t,"fileformat",a)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showFileFormatInfo(a)}}},[s("strong",{attrs:{title:a.name}},[e._v(e._s(a.name))]),a.title?s("small",{attrs:{title:a.title}},[e._v(e._s(a.title))]):e._e()]),e.supportsSaveResult?s("button",{staticClass:"discovery-button",attrs:{type:"button",title:"Insert"},on:{click:function(t){return e.insertFileFormat(a)}}},[s("i",{staticClass:"fas fa-plus"})]):e._e()])]}}])})],1)],1)},i=[],r=s("3115"),o=s("025e"),n=s("69d2"),l=s("a0e2"),c=s("9b5d"),u=s("2979"),h=s("d235"),d={name:"DiscoveryToolbar",mixins:[r["a"]],components:{Collections:n["a"],FileFormats:l["a"],Processes:c["a"],SearchBox:u["default"],UdfRuntimes:h["a"]},props:{onAddProcess:{type:Function,required:!0}},data(){return{searchTerm:"",collapsed:!0}},computed:{...o["a"].mapState(["predefinedProcesses","collections","udfRuntimes"]),...o["a"].mapState("userProcesses",["userProcesses"]),...o["a"].mapGetters(["supports","collectionDefaults","fileFormats"]),...o["a"].mapGetters("userProcesses",{getProcessById:"getAllById"}),supportsLoadCollection(){return!!this.getProcessById("load_collection")},supportsRunUdf(){return!!this.getProcessById("run_udf")},supportsSaveResult(){return!!this.getProcessById("save_result")},hasUdfRuntimes(){return o["a"].size(this.udfRuntimes)},processes(){return this.predefinedProcesses.concat(this.userProcesses)}},watch:{searchTerm(e,t){!e&&t?this.collapsed=!0:e&&!t&&(this.collapsed=!1)}},methods:{onDrag(e,t,s){let a=this.getNode(t,s);e.dataTransfer.setData("application/openeo-node",JSON.stringify(a)),e.dataTransfer.setData("text/plain",JSON.stringify(a,null,2))},showCollectionInfo(e){this.supports("listCollections")&&this.emit("showCollection",e)},showProcessInfo(e){this.emit("showProcessInfo",e)},showUdfInfo(e,t){this.emit("showUdfRuntimeInfo",e,t,t.default)},showFileFormatInfo(e){this.emit("showFileFormatInfo",e.name,this.fileFormats.output[e.name],"output")},getNode(e,t){switch(e){case"collection":return{process_id:"load_collection",arguments:this.collectionDefaults(t.id)};case"process":return{process_id:t.id,arguments:{}};case"udf":return{process_id:"run_udf",arguments:t};case"fileformat":return{process_id:"save_result",arguments:{format:t.name,options:{}}}}},insertCollection(e){let t=this.getNode("collection",e);this.onAddProcess(t)},insertProcess(e){let t=this.getNode("process",e);this.onAddProcess(t)},insertUdf(e,t){let s=this.getNode("udf",{runtime:e,version:t});this.onAddProcess(s)},insertFileFormat(e){let t=this.getNode("fileformat",e);this.onAddProcess(t)}}},p=d,m=(s("7b86"),s("eee8"),s("2877")),f=Object(m["a"])(p,a,i,!1,null,"3c92eebc",null);t["a"]=f.exports},ccbe:function(e,t,s){"use strict";s("4525")},ccd4:function(e,t,s){},ceb0:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Tabs",{ref:"tabs",staticClass:"editor",attrs:{id:"customProcessContent",position:"bottom"}},[s("Tab",{attrs:{id:"visual",name:"Visual Model",icon:"fa-project-diagram",selected:!0,allowShow:e.canSwitchView},on:{show:e.showModel}},[s("VisualEditor",{ref:"graphBuilder",staticClass:"visualEditorTab",attrs:{editable:e.editable,pgParameters:e.pgParameters,value:e.modelValue,title:e.title,id:e.id+"_visual",showDiscoveryToolbar:e.showDiscoveryToolbar,defaultValue:e.defaultValue},on:{input:e.commit,error:e.onError},scopedSlots:e._u([{key:"file-toolbar",fn:function(){return[e._t("file-toolbar")]},proxy:!0},{key:"toolbar",fn:function(){return[e._t("toolbar")]},proxy:!0}],null,!0)})],1),s("Tab",{attrs:{id:"source",name:"Code",icon:"fa-code",allowShow:e.canSwitchView},on:{show:e.showCode}},[s("TextEditor",{ref:"sourceEditor",staticClass:"textEditorTab",attrs:{editable:e.editable,value:e.codeValue,title:e.title,id:e.id+"_text",language:"processgraph"},on:{input:e.commit,error:e.onError},scopedSlots:e._u([{key:"file-toolbar",fn:function(){return[e._t("file-toolbar")]},proxy:!0},{key:"toolbar",fn:function(){return[e._t("toolbar")]},proxy:!0}],null,!0)})],1)],1)},i=[],r=s("025e"),o=s("e7ea"),n=s("bdb2"),l=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("div",{ref:"visualEditor",staticClass:"visualEditor"},[a("div",{staticClass:"sourceHeader"},[t.title?a("h3",[t._v(t._s(t.title))]):t._e(),a("div",{staticClass:"sourceToolbar"},[t.editable?a("span",{staticClass:"sepr"},[a("button",{attrs:{type:"button",title:"New script / Clear current script"},on:{click:t.confirmClear}},[a("i",{staticClass:"fas fa-file"})]),t._t("file-toolbar")],2):t._e(),t.editable?a("span",{staticClass:"sepr"},[a("button",{attrs:{type:"button",disabled:!t.canUndo,title:"Revert last change"},on:{click:function(e){return t.$refs.blocks.undo()}}},[a("i",{staticClass:"fas fa-undo-alt"})]),a("button",{attrs:{type:"button",disabled:!t.canRedo,title:"Redo last reverted change"},on:{click:function(e){return t.$refs.blocks.redo()}}},[a("i",{staticClass:"fas fa-redo-alt"})]),a("button",{attrs:{type:"button",disabled:!t.hasSelection,title:"Delete selected elements"},on:{click:function(e){return t.$refs.blocks.deleteSelected()}}},[a("i",{staticClass:"fas fa-trash"})])]):t._e(),t.editable?a("span",{staticClass:"sepr"},[a("button",{attrs:{type:"button",title:"Add Parameter"},on:{click:t.addParameter}},[a("i",{staticClass:"fas fa-parking"})]),t.supportsMath?a("button",{class:{highlightFormula:t.isMath},attrs:{type:"button",title:"Insert/Edit formula"},on:{click:t.showExpressionModal}},[a("i",{staticClass:"fas fa-square-root-alt"})]):t._e()]):t._e(),a("button",{class:{compactMode:t.compactMode},attrs:{type:"button",title:"Compact Mode"},on:{click:function(e){return t.$refs.blocks.toggleCompact()}}},[a("i",{staticClass:"fas fa-compress-arrows-alt"})]),a("button",{attrs:{type:"button",title:"Scale to perfect size"},on:{click:function(e){return t.$refs.blocks.perfectScale()}}},[a("i",{staticClass:"fas fa-arrows-alt"})]),a("FullscreenButton",{attrs:{element:function(){return e.$refs.visualEditor}},on:{changed:function(s){e.$refs.blocks.perfectScale(),t.isFullScreen=s}}}),t._t("toolbar")],2)]),a("div",{staticClass:"editorSplitter"},[(t.showDiscoveryToolbar||t.isFullScreen)&&t.editable?a("DiscoveryToolbar",{staticClass:"discoveryToolbar",attrs:{onAddProcess:t.insertProcess}}):t._e(),a("div",{staticClass:"graphBuilder",on:{drop:function(e){return t.onDrop(e)},dragover:function(e){return t.allowDrop(e)}}},[a("Blocks",{ref:"blocks",attrs:{editable:t.editable,id:t.id,processes:t.processRegistry,collections:t.collections,pgParameters:t.pgParameters,value:t.value},on:{input:t.commit,error:t.errorHandler,showProcess:function(e){return t.emit("showProcess",e)},showCollection:function(e){return t.emit("showCollection",e)},showSchema:t.showSchemaModal,editParameters:t.openParameterEditor,compactMode:function(t){return e.compactMode=t},selectionChanged:t.selectionChanged,historyChanged:t.historyChanged}})],1)],1),a("ParameterModal",{ref:"parameterModal"}),t.editable&&t.supportsMath?a("ExpressionModal",{ref:"expressionModal",on:{save:t.insertNodes}}):t._e()],1)},c=[],u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"div",staticClass:"blocks_js_editor",attrs:{id:e.id,tabindex:"0"},on:{mousemove:function(t){return e.onMouseMove(t)},mousedown:function(t){return e.onMouseDown(t)},mousewheel:function(t){return t.preventDefault(),e.onMouseWheel(t)},keydown:function(t){return e.onKeyDown(t)},focus:function(t){return e.highlight(!0)},blur:function(t){return e.highlight(!1)},DOMMouseScroll:function(t){return t.preventDefault(),e.onMouseWheel(t)}}},[s("svg",{staticClass:"canvas",attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}},[e._l(e.edges,(function(t){return s("Edge",e._b({key:t.id,ref:"edges",refInFor:!0,attrs:{state:e.state,parameter1:t.parameter1,parameter2:t.parameter2},on:{position:function(e){t.position1=arguments[0],t.position2=arguments[1]}}},"Edge",t,!1))})),e.linkingLine?s("line",e._b({},"line",e.linkingLine,!1)):e._e(),e.selectRect?s("rect",e._b({},"rect",e.selectRect,!1)):e._e()],2),s("div",{staticClass:"blocks"},e._l(e.blocks,(function(t){return s("Block",{key:t.type+t.id,attrs:{id:t.id,type:t.type,value:t.value,spec:t.spec,state:e.state,selected:t.selected},on:{"update:selected":function(s){return e.$set(t,"selected",s)},input:function(t){return e.commit()},parameterRemoved:e.parameterRemoved,mounted:e.mountBlock,unmounted:e.unmountBlock,move:e.startDragBlock,moved:e.refreshEdges}})})),1)])},h=[],d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"div",class:e.containerClasses,style:e.styles,attrs:{id:"block"+this.id},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.onMouseDown(t))}}},[s("div",{staticClass:"blockTitle",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.emitDrag(t))}}},[s("span",{staticClass:"titleText",attrs:{title:e.plainTitle}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.invalid,expression:"invalid"}],staticClass:"invalid",attrs:{title:"Process or Collection not supported!"}},[s("i",{staticClass:"fas fa-exclamation-triangle"})]),e._v(" "+e._s(e.name)+" "),e.showId?s("span",{staticClass:"blockId"},[e._v("#"+e._s(e.id))]):e._e()]),s("div",{staticClass:"blockicon",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.focus())}}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsComment&&!e.hasComment,expression:"allowsComment && !hasComment"}],staticClass:"addComment",attrs:{title:"Add comment"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.addComment()}}},[s("i",{staticClass:"fas fa-comment-medical"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsDelete,expression:"allowsDelete"}],staticClass:"delete",attrs:{title:"Remove (DEL)"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.remove()}}},[s("i",{staticClass:"fas fa-trash"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsInfo,expression:"allowsInfo"}],staticClass:"info",attrs:{title:"Details"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.showInfo()}}},[s("i",{staticClass:"fas fa-info"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsParameterChange,expression:"allowsParameterChange"}],staticClass:"settings",attrs:{title:"Change parameter values"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.showParameters()}}},[s("i",{staticClass:"fas fa-sliders-h"})])])]),s("div",{staticClass:"inout"},[s("div",{staticClass:"inputs"},e._l(e.parameters,(function(t,a){return s("BlockParameter",e._b({key:a,ref:"parameters",refInFor:!0,attrs:{state:e.state},on:{edgesChanged:function(s){return e.edgesChanged(t,s)}},model:{value:e.args[t.name],callback:function(s){e.$set(e.args,t.name,s)},expression:"args[param.name]"}},"BlockParameter",t,!1))})),1),s("div",{staticClass:"outputs"},[s("BlockParameter",e._b({ref:"output",attrs:{state:e.state,label:e.outputLabel}},"BlockParameter",e.output,!1))],1)]),e.hasComment?s("textarea",{directives:[{name:"model",rawName:"v-model.lazy",value:e.comment,expression:"comment",modifiers:{lazy:!0}}],ref:"commentField",staticClass:"editComment",attrs:{placeholder:"Type comment here..."},domProps:{value:e.comment},on:{blur:function(t){return e.updateComment(t)},mousedown:function(e){e.stopPropagation()},change:function(t){e.comment=t.target.value}}}):e._e()])},p=[],m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._g({class:e.classes},e.listeners),[e.output?e._e():s("div",e._g({ref:"circle",class:e.circleClasses},e.circleListeners)),s("span",{staticClass:"text"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.unspecified,expression:"unspecified"}],staticClass:"unspecified",attrs:{title:"Parameter is likely unsupported!"}},[s("i",{staticClass:"fas fa-exclamation-triangle"})]),e._v(" "+e._s(e.displayLabel)),e.displayValue.length?[e._v(": ")]:e._e(),s("span",{domProps:{innerHTML:e._s(e.displayValue)}})],2),e.output?s("div",e._g({ref:"circle",class:e.circleClasses},e.circleListeners)):e._e()])},f=[],g=s("79e5"),v=s("a76e"),b={name:"BlockParameter",props:{name:{type:String,default:"output"},description:{type:String,default:""},optional:{type:Boolean,default:!1},deprecated:{type:Boolean,default:!1},experimental:{type:Boolean,default:!1},default:{},value:{},schema:{type:[Object,Array],default:null},label:{type:String},output:{type:Boolean,default:!1},state:{type:Object,required:!0}},data(){return{edges:[]}},computed:{schemas(){return this.schema instanceof g["d"]?this.schema:new g["d"](this.schema)},hasValue(){return void 0!==this.value},listeners(){return this.allowsParameterChange?{dblclick:this.openEditorForParameter}:{}},circleListeners(){var e={};return this.state.editable&&(e.mousedown=e=>{1==e.which&&(this.state.root.link(this),e.preventDefault(),e.stopPropagation())},this.output&&(e.click=e=>{if(1==e.which){if(this.getEdgeCount()>0)return void this.state.root.$emit("error","A result node can't have outgoing edges.");this.state.root.setResultNode(this.$parent)}}),e.mouseover=()=>this.state.linkFrom&&this.state.root.link(this),e.mouseout=()=>this.state.linkTo&&this.state.root.unlink(this)),e},classes(){return[this.output?"output":"input","connector","field_"+this.name,this.hasValue||this.optional||this.output||this.getEdgeCount()>0?"hasValue":"noValue"]},unspecified(){return!this.$parent.invalid&&this.state.root.hasProcesses&&this.schemas.unspecified},circleClasses(){var e=["circle"];this.getEdgeCount()>0&&e.push("io_active");var t=this.edges;for(var s in t)t[s].selected&&e.push("io_selected");return this.state.linkFrom!=this&&this.state.linkTo!=this||e.push("io_selected"),e},displayValue(){var e=25-this.displayLabel.length,t=null;return!this.isEditable||this.state.compactMode||r["a"].isRef(this.value)||"undefined"===typeof this.value||(t=this.formatValue(this.value,e,!0)),"string"===typeof t?0===t.length&&(t="<em>Empty</em>"):t="",t},displayLabel(){return this.output&&this.state.compactMode?"":"string"===typeof this.label&&this.label.length>0?this.label:this.name},isDefaultValue(){return!this.hasValue||"undefined"!==typeof this.default&&this.default==this.value},isArrayType(){return"array"===this.schemas.nativeDataType()},isObjectType(){return"object"===this.schemas.nativeDataType()},isEditable(){return!this.output&&this.schemas.isEditable()},allowsParameterChange(){return!this.output&&this.state.root.supports("editParameters")&&this.schemas.isEditable()},allowsMultipleInputs(){return this.isArrayType||this.isObjectType||"any"===this.schemas.nativeDataType()}},watch:{edges(){this.updateEdgeStatus(),this.$emit("edgesChanged",this.edges,this)},value:{immediate:!0,handler(){this.updateEdgeStatus()}}},methods:{updateEdgeStatus(){if(!this.output)for(var e of this.edges)e.inactive=!this.isEdgeUsed(e)},getCirclePosition(){var e=r["a"].domBoundingBox(this.$refs.circle),t=this.state.root.getDimensions(),s=e.offsetLeft-t.offsetLeft+e.width/2,a=e.offsetTop-t.offsetTop+e.height/2;return[s,a]},openEditorForParameter(){this.allowsParameterChange&&this.$parent.showParameters(this.name)},jsonSchema(){return this.schemas.toJSON()},setValue(e){"boolean0"!=this.schemas.nativeDataType()||r["a"].isRef(e)||(e=!!e),this.$emit("input",e)},resetValue(){if("undefined"===typeof this.default){var e;if(this.schemas.nullable())e=null;else{var t=this.schemas.nativeDataType();switch(t){case"object":e={};break;case"array":e=[];break;case"string":e="";break;case"integer":case"number":e=0;break;case"boolean":e=!1;break;default:e=void 0}}this.setValue(e)}else this.setValue(this.default)},getEdgeRef(e){return this.output?this.value:e.parameter1.value},addRefToValue(e){var t=this.getEdgeRef(e);if(t)if(this.allowsMultipleInputs)if(this.isArrayType)if(r["a"].isRef(this.value))this.setValue([this.value,t]);else if(Array.isArray(this.value)&&this.value.length>0){var s=this.value;s.push(t),this.setValue(s)}else this.setValue(t);else if(this.isObjectType){var a=r["a"].size(this.value);1!==this.getEdgeCount()||this.hasValue&&a?a||this.resetValue():this.setValue(t)}else this.setValue(t);else this.setValue(t)},removeRefFromValue(e){var t=this.getEdgeRef(e);r["a"].isRefEqual(t,this.value)?this.resetValue():(this.isArrayType||this.isObjectType)&&this.setValue(this.removeRefFromValueDeep(this.value,t))},removeRefFromValueDeep(e,t){if(Array.isArray(e)){var s=e.length;while(--s>=0)null!==e[s]&&"object"===typeof e[s]&&(r["a"].isRefEqual(t,e[s])?e.splice(s,1):e[s]=this.removeRefFromValueDeep(e[s],t))}else if(r["a"].isObject(e))for(var a in e)e.hasOwnProperty(a)&&null!==e[a]&&"object"===typeof e[a]&&(r["a"].isRefEqual(t,e[a])?delete e[a]:e[s]=this.removeRefFromValueDeep(e[a],t));return e},addEdge(e){this.edges.push(e),this.isEdgeUsed(e)||this.output||this.addRefToValue(e)},eraseEdge(e){for(var t in this.edges)if(this.edges[t]==e)return this.removeRefFromValue(e),this.$delete(this.edges,t),!0;return!1},isEdgeUsed(e){var t=this.getEdgeRef(e);return!!r["a"].isRefEqual(t,this.value)||this.hasRefInValue(t,this.value)},hasRefInValue(e,t){if(!t||"object"!==typeof t)return!1;if(r["a"].isRefEqual(e,t))return!0;for(let s in t)if(this.hasRefInValue(e,t[s]))return!0;return!1},getEdgeCount(){return this.edges.length},formatProcess(e){if(e instanceof v["ProcessGraph"]&&1===e.getNodeCount())return r["a"].htmlentities(e.getResultNode().process_id);var t=Object.values(e.process_graph);return 1===t.length?r["a"].htmlentities(t[0].process_id):"Process"},formatValue(e,t,s=!0){var a=null;if("object"===typeof e)a=null===e?"N/A":Array.isArray(e)?this.formatArray(e,t,s):this.formatObject(e,s);else if("string"===typeof e)if(e.length>t){var i=r["a"].htmlentities(e.substr(0,t))+"…";a=s?'<span title="'+r["a"].htmlentities(e)+'">'+i+"…</span>":i}else a=r["a"].htmlentities(e);else a="boolean"===typeof e?e?"✔️":"❌":"number"===typeof e?e.toString():r["a"].htmlentities(JSON.stringify(e));return a},formatArray(e,t,s=!0){var a=e.map(e=>this.formatValue(e,25,!1)).join(", "),i=r["a"].htmlentities_decode(a);if(i.length>0&&i.length<=t)return"["+a+"]";var o="List("+e.length+")";return s?'<span title="'+a+'">'+o+"</span>":o},formatObject(e,t=!0){return 0===Object.keys(e).length?"None":e instanceof v["ProcessGraph"]||r["a"].isObject(e.process_graph)?this.formatProcess(e):r["a"].isRef(e)?r["a"].formatRef(e):"undefined"!==typeof e.west&&"undefined"!==typeof e.east&&"undefined"!==typeof e.south&&"undefined"!==typeof e.north?"Bounding Box":r["a"].detectGeoJson(e)?e.type:t?'<span title="'+r["a"].htmlentities(JSON.stringify(e))+'">Object</span>':"Object"}}},y=b,w=(s("dff8"),s("2877")),C=Object(w["a"])(y,m,f,!1,null,"94a5417e",null),S=C.exports,k=s("2b0e");const P=10;var x={name:"Block",components:{BlockParameter:S},props:{id:{type:String,required:!0},type:{type:String,required:!0},value:{type:Object,required:!0},selected:{type:Boolean,default:!1},spec:{type:Object,default:()=>null},state:{type:Object,required:!0}},data(){return{data:{},drag:null}},watch:{"state.compactMode"(){this.$emit("moved",this.position)},value:{immediate:!0,handler(e){this.data=k["a"].observable(e)}}},computed:{position:{set(e){e=r["a"].ensurePoint(e),this.$set(this.data,"position",e),this.$emit("moved",e)},get(){return r["a"].ensurePoint(this.data.position)}},args:{set(e){r["a"].isObject(this.data.arguments)||(this.data.arguments={});for(let t in this.data.arguments)"undefined"!==typeof e[t]||this.hasParametersDefined&&-1!==this.spec.parameters.findIndex(e=>e.name===t)||this.$emit("parameterRemoved",this,t);this.$set(this.data,"arguments",e),this.commit()},get(){return r["a"].isObject(this.data.arguments)?this.data.arguments:{}}},comment:{set(e){this.$set(this.data,"description",e),this.commit()},get(){return this.data.description}},result:{set(e){this.$set(this.data,"result",e),this.commit()},get(){return this.data.result||!1}},width(){return this.parameters.length>0?this.state.compactMode?110:200:this.state.compactMode?60:110},styles(){return{marginLeft:Math.round(this.state.center[0]+this.position[0]*this.state.scale)+"px",marginTop:Math.round(this.state.center[1]+this.position[1]*this.state.scale)+"px",fontSize:Math.round(this.state.scale*P)+"px",width:Math.round(this.state.scale*this.width)+"px"}},plainTitle(){return this.name+(this.showId?" #"+this.id:"")},name(){switch(this.type){case"process":return this.collectionId?this.collectionId:this.processId;case"parameter":return this.spec.name;default:return this.id}},outputLabel(){return this.result?"Result":"parameter"===this.type?"Process Parameter":"Output"},containerClasses(){var e=["block"];return this.collectionId?e.push("block_collection"):"parameter"===this.type&&e.push("block_argument"),this.result&&e.push("block_result"),this.selected&&e.push("block_selected"),this.invalid&&e.push("block_invalid"),this.state.compactMode&&e.push("compact"),this.state.scale<.5?e.push("scale_xs"):this.state.scale<.7?e.push("scale_s"):this.state.scale<.9?e.push("scale_m"):this.state.scale<1.1&&e.push("scale_l"),e},invalid(){if("process"!==this.type||!this.$parent.hasProcesses)return!1;if(!this.processId)return!0;if(!this.spec)return!0;if("load_collection"===this.processId&&!r["a"].isRef(this.args.id)){for(let e of this.$parent.collections)if(this.args.id===e.id)return!1;return!0}return!1},processId(){if("process"===this.type){if(this.value.process_id)return this.value.process_id;if(r["a"].isObject(this.spec)&&this.spec.id)return this.spec.id}return null},collectionId(){return"process"!==this.type||"load_collection"!==this.processId||r["a"].isRef(this.args.id)?null:this.args.id},allowsParameterChange(){return this.$parent.supports("editParameters")&&this.parameters.filter(e=>e.isEditable()).length>0&&"parameter"!==this.type},allowsDelete(){return this.state.editable&&(!this.spec||r["a"].isObject(this.spec)&&"prop"!==this.spec.origin)},allowsInfo(){return this.collectionId?this.$parent.supports("showCollection"):"parameter"===this.type?r["a"].isObject(this.spec)&&this.$parent.supports("showSchema"):this.$parent.supports("showProcess")},allowsComment(){return this.state.editable&&"process"===this.type},hasComment(){return"string"===typeof this.comment},showId(){return"parameter"!==this.type},hasParametersDefined(){return Boolean(r["a"].isObject(this.spec)&&Array.isArray(this.spec.parameters)&&this.spec.parameters.length>0)},parameters(){let e=[],t=[];if(this.hasParametersDefined&&(t=this.spec.parameters.map(e=>new g["c"](e)),e=t.map(e=>e.name)),r["a"].size(this.args)>0)for(var s in this.args)e.includes(s)||t.push(new g["c"]({name:s,description:""}));return t},fields(){var e={};for(var t of this.parameters)e[t.name]=t;return e.output=this.output,e},output(){var e={};r["a"].isObject(this.spec)&&("parameter"===this.type?e=this.spec:r["a"].isObject(this.spec.returns)&&(e=this.spec.returns));var t={name:"output",schema:e.schema||{},description:e.description||"",optional:!0,output:!0,value:{}};return"parameter"===this.type?t.value.from_parameter=this.id:t.value.from_node=this.id,t}},mounted(){this.draggingFn=this.dragging.bind(this),document.addEventListener("mousemove",this.draggingFn),this.stopDragFn=this.stopDrag.bind(this),document.addEventListener("mouseup",this.stopDragFn),this.$emit("mounted",this)},beforeDestroy(){document.removeEventListener("mousemove",this.draggingFn),document.removeEventListener("mouseup",this.stopDragFn),this.$emit("unmounted",this)},methods:{commit(){this.$emit("input",this.data)},focus(){this.$parent.focus()},async onMouseDown(e){return this.$parent.unselectAll(e),await this.select(!this.selected,!1)},async select(e=!0,t=!0){return this.unselectOthers&&this.$parent.unselectAll(),this.$emit("update:selected",e),this.focus(),await this.$nextTick(),e},getDimensions(){let e=r["a"].domBoundingBox(this.$refs.div);var t=this.$parent.getDimensions();return e.x=e.offsetLeft-t.offsetLeft,e.y=e.offsetTop-t.offsetTop,e},edgesChanged(e,t,s){e.setRefs(t.map(e=>e.parameter1.value))},showParameters(e=null){this.$parent.$emit("editParameters",this.parameters.filter(e=>e.isEditable()),this.args,this.plainTitle,this.state.editable,e,e=>this.args=e,this.processId,this.$parent)},showInfo(){this.collectionId?this.$parent.$emit("showCollection",this.collectionId):"parameter"===this.type?this.$parent.$emit("showSchema",this.name,this.spec.schema):this.$parent.$emit("showProcess",this.processId)},async addComment(){await this.select(),this.comment="",await this.$nextTick(),this.$refs.commentField.focus()},updateComment(e){"string"===typeof e.target.value&&e.target.value.length>0?this.comment=e.target.value:this.comment=null},async emitDrag(e){this.focus();let t=await this.onMouseDown(e);t&&this.$emit("move")},getDragPos(e){return[this.state.mouse[0]/this.state.scale-e[0],this.state.mouse[1]/this.state.scale-e[1]]},startDrag(){this.selected&&(this.drag={origin:this.position,mouse:this.getDragPos(this.position)})},stopDrag(){if(this.drag){var e=5/this.state.scale;(Math.abs(this.drag.origin[0]-this.position[0])>e||Math.abs(this.drag.origin[1]-this.position[1])>e)&&this.commit(),this.drag=null}},dragging(){this.drag&&(this.position=this.getDragPos(this.drag.mouse))},hasOutputEdges(){return this.$refs.output&&this.$refs.output.getEdgeCount()>0},async remove(){await this.$parent.removeBlock(this)},getBlockParameter(e){if("output"===e&&this.$refs.output)return this.$refs.output;if(Array.isArray(this.$refs.parameters)){var t=this.$refs.parameters.filter(t=>t.name===e);if(t.length>0)return t[0]}return null}}},E=x,_=(s("30ee"),Object(w["a"])(E,d,p,!1,null,"fdf9e7ce",null)),T=_.exports,D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("g",e._l(e.lines,(function(t,a){return s("line",e._b({key:a},"line",t,!1))})),0)},F=[];class I{constructor(e,t,s,a){this.x=e,this.y=t,this.dx=s,this.dy=a}distance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}distanceP(e){var t=this.normal();t.x=e.x,t.y=e.y;var s=this.intersection(t);return[s[0],this.distance(t.alpha(s[1]),e)]}normal(){return new I(this.x,this.y,this.dy,-this.dx)}intersection(e){var t=this.dx,s=-e.dx,a=this.dy,i=-e.dy,r=e.x-this.x,o=e.y-this.y,n=t*i-s*a;if(0==n)return null;var l=(i*r-s*o)/n,c=(-a*r+t*o)/n;return[l,c]}alpha(e){var t={};return t.x=this.x+this.dx*e,t.y=this.y+this.dy*e,t}}var M={name:"Edge",props:{id:{type:Number,required:!0},parameter1:{type:Object,required:!0},parameter2:{type:Object,required:!0},selected:{type:Boolean,default:!1},inactive:{type:Boolean,default:!1},lineWidth:{type:Number,default:3},state:{type:Object,required:!0}},data(){return{position1:null,position2:null}},computed:{segment(){return new I(this.position1[0],this.position1[1],this.position2[0]-this.position1[0],this.position2[1]-this.position1[1])},scaledLineWidth(){return this.lineWidth*this.state.scale},lines(){var e=(this.position1[0]+this.position2[0])/2,t=(this.position1[1]+this.position2[1])/2,s=35*Math.PI/180,a=Math.cos(s),i=Math.sin(s),r=Math.cos(-s),o=Math.sin(-s),n=Math.sqrt(Math.pow(this.position1[0]-this.position2[0],2)+Math.pow(this.position1[1]-this.position2[1],2)),l=10*this.state.scale/(n/1.5),c=(this.position1[0]-e)*l,u=(this.position1[1]-t)*l,h=this.getLineStyle(this.scaledLineWidth,this.selected,this.inactive),d=this.getLineStyle(this.scaledLineWidth/1.5,this.selected),p=this.getLine(this.position1[0],this.position1[1],this.position2[0],this.position2[1],h);return this.inactive||n/this.state.scale<25?[p]:[p,this.getLine(e,t,e+(c*a-u*i),t+(u*a+c*i),d),this.getLine(e,t,e+(c*r-u*o),t+(u*r+c*o),d)]}},watch:{"state.center"(){this.updatePositions()},"state.scale"(){this.updatePositions()},"state.moving"(){this.updatePositions()}},created(){this.updatePositions()},methods:{updatePositions(){let e=this.parameter1.getCirclePosition(),t=this.parameter2.getCirclePosition();this.position1&&this.position2&&e[0]===this.position1[0]&&e[1]===this.position1[1]&&t[0]===this.position2[0]&&t[1]===this.position2[1]||(this.position1=e,this.position2=t,this.$emit("position",this.position1,this.position2))},getLineStyle(e,t=!1,s=!1){let a=2*this.state.scale;return{stroke:t?"rgba(0, 200, 0, 1)":"rgba(255, 200, 0, 1)","stroke-width":e,"stroke-dasharray":s?3*a+" "+2*a:"none"}},getLine(e,t,s,a,i={}){return Object.assign({x1:e,y1:t,x2:s,y2:a},i)},collide(e,t){if(!this.segment)return!1;var s=this.segment.distanceP({x:e,y:t});return s[0]>=0&&s[0]<=1&&s[1]<this.lineWidth*this.state.scale*2&&s[0]},equals(e){return this.parameter1==e.parameter1&&this.parameter2==e.parameter2||this.parameter1==e.parameter2&&this.parameter2==e.parameter1}}},$=M,O=Object(w["a"])($,D,F,!1,null,null,null),B=O.exports,j=s("0dd6"),R=s.n(j),L=s("a13e"),N=s.n(L);const V=function(e){return k["a"].observable({root:e,editable:!1,compactMode:!1,moving:null,selecting:null,center:[0,0],mouse:[0,0],scale:1.3,linkFrom:null,linkTo:null})},J=20,A=function(e,t){Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,s)=>e.id===t[s].id)||this.$emit("selectionChanged",this.selectedBlocks,this.selectedEdges)};var U={name:"Blocks",components:{Block:T,Edge:B},props:{id:{type:String,required:!0},editable:{type:Boolean,default:!1},value:{type:Object,default:()=>({})},collections:{type:Array,default:()=>[]},processes:{type:[Array,Object],default:()=>[]},pgParameters:{type:Array,default:()=>[]}},data(){return{isMounted:!1,newBlockOffset:0,history:[],historyPointer:null,process:this.value,blocks:[],edges:[],processGraph:null,nextBlockId:1,nextEdgeId:1,activeTransactions:0,state:V(this)}},computed:{selectRect(){return this.state.selecting?{x:Math.min(this.state.mouse[0],this.state.selecting[0]),y:Math.min(this.state.mouse[1],this.state.selecting[1]),width:Math.abs(this.state.mouse[0]-this.state.selecting[0]),height:Math.abs(this.state.mouse[1]-this.state.selecting[1]),stroke:"rgba(0,0,0,0.8)","stroke-width":1,fill:"rgba(0,0,0,0.05)"}:null},linkingLine(){if(this.state.linkFrom){var e=this.state.linkFrom.getCirclePosition();return{x1:e[0],y1:e[1],x2:this.state.mouse[0],y2:this.state.mouse[1],stroke:"rgba(0,0,0,0.4)","stroke-width":3*this.state.scale}}return null},processRegistry(){return this.processes instanceof v["ProcessRegistry"]?this.processes:new v["ProcessRegistry"](this.processes)},hasProcesses(){return this.processRegistry.count()>0},processBlocks(){return this.blocks.filter(e=>"process"===e.type)},selectedBlocks(){return this.blocks.filter(e=>e.selected)},selectedEdges(){return this.edges.filter(e=>e.selected)},selectedSideEdge(){return 1===this.selectedEdges.length&&this.selectedEdges[0].selectedParameter?this.selectedEdges[0]:null}},watch:{pgParameters(e){this.importPgParameters(e,"prop")},async value(e){this.isMounted&&(e instanceof z||(this.process=e,await this.import(e,{propagate:!1,undoOnError:!1})))},editable:{immediate:!0,handler(e){this.state.editable=e}},selectedEdges:A,selectedBlocks:A},async mounted(){this.supports("error")||this.$on("error",(e,t=null)=>console.error(e,t)),this.moveCenter(0,0,!0),this.onDocumentMouseUpFn=this.onDocumentMouseUp.bind(this),document.addEventListener("mouseup",this.onDocumentMouseUpFn),await this.importPgParameters(this.pgParameters,"prop"),await this.import(this.value,{propagate:!1,undoOnError:!1})||this.perfectScale(),A.bind(this)(),this.isMounted=!0},beforeDestroy(){document.removeEventListener("mouseup",this.onDocumentMouseUpFn)},methods:{mountBlock(e){this.setBlockElement(e,e)},unmountBlock(e){this.setBlockElement(e,null)},parameterRemoved(e,t){for(let s of this.edges)s.parameter2.$parent===e&&s.parameter2.name===t&&this.removeEdge(s)},setBlockElement(e,t){for(var s of this.blocks)if(s.id===e.id)return void(s.$el=t)},startDragBlock(){for(let e in this.blocks)this.blocks[e].$el&&this.blocks[e].$el.startDrag()},refreshEdges(){for(let e in this.$refs.edges)this.$refs.edges[e].updatePositions()},supports(e){return this.$listeners&&this.$listeners[e]},focus(){this.$refs.div.focus()},highlight(e){e?this.$refs.div.classList.add("focus"):this.$refs.div.classList.remove("focus")},link(e){this.state.linkFrom?this.state.linkTo=e:this.state.linkFrom=e},unlink(e=null){e?this.state.linkTo==e?this.state.linkTo=null:this.state.linkFrom==e&&(this.state.linkFrom=null):(this.state.linkTo=null,this.state.linkFrom=null)},multiSelect(){let e=this.selectRect;this.blocks.filter(t=>{if(Array.isArray(t.value.position)&&t.$el){let s=t.$el.getDimensions();return R()(e.x,e.y,e.width,e.height,s.x,s.y,s.width,s.height)}return!1}).map(e=>e.selected=!0),this.edges.filter(t=>Array.isArray(t.position1)&&Array.isArray(t.position2)&&N()(e.x,e.y,e.width,e.height,t.position1[0],t.position1[1],t.position2[0],t.position2[1])).map(e=>e.selected=!0)},async onDocumentMouseUp(e){if(this.selectedSideEdge&&this.selectEdge(this.selectedSideEdge,null,null,null),this.state.selecting&&(this.multiSelect(),this.state.selecting=null),this.state.moving&&(this.state.moving=null),this.state.editable&&this.state.linkFrom){if(1==e.which&&this.state.linkTo)try{await this.addEdge(this.state.linkFrom,this.state.linkTo)}catch(t){this.$emit("error",t)}this.unlink()}},onKeyDown(e){var t=document.querySelectorAll("input, textarea, button, select, datalist");for(let s of t)if(s===document.activeElement)return;this.state.editable&&46==e.keyCode&&this.deleteSelected()},onMouseWheel(e){var t=this.state.mouse[0]-this.state.center[0],s=this.state.mouse[1]-this.state.center[1],a=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=Math.pow(1.1,a);this.moveCenter(-t*(i-1),-s*(i-1)),this.state.scale*=i},onMouseMove(e){try{var t=this.getDimensions(),s=e.pageX-t.offsetLeft,a=e.pageY-t.offsetTop;if(this.state.mouse=[s,a],this.state.editable&&this.selectedSideEdge){var i=this.selectedSideEdge.selectedPosition,r=Math.sqrt(Math.pow(s-i[0],2)+Math.pow(a-i[1],2));r>10&&(this.link(this.selectedSideEdge.selectedParameter),this.removeEdge(this.selectedSideEdge),this.commit())}this.state.moving&&(this.moveCenter(s-this.state.moving[0],a-this.state.moving[1]),this.state.moving=this.state.mouse)}catch(o){console.log(o)}},onMouseDown(e){let t=null;if(1==e.which&&e.shiftKey)this.state.selecting=this.state.mouse;else if(1==e.which)for(var s in this.unselectAll(e),this.$refs.edges){var a=this.$refs.edges[s],i=a.collide(this.state.mouse[0],this.state.mouse[1]);if(0!=i){0===this.selectedEdges.length&&(i<.3?t=a.parameter2:i>.7&&(t=a.parameter1)),this.selectEdge(s,!0,e,t),e.preventDefault();break}}2!=e.which&&(1!=e.which||t||e.shiftKey)||(this.state.moving=this.state.mouse),this.focus()},getDimensions(){return r["a"].domBoundingBox(this.$refs.div)},async clear(){return await this.startTransaction(async()=>(this.edges=[],this.blocks=this.blocks.filter(e=>"parameter"===e.type&&r["a"].isObject(e.spec)&&"prop"===e.spec.origin),this.nextBlockId=1,this.nextEdgeId=1,this.process={},!0))},commit(e=null,t=!0,s=!0){this.activeTransactions>0||(!1!==t&&this.saveHistory(),!1!==s&&this.$emit("input",null===e?this.export():e))},saveHistory(){var e=this.export(!0);this.history.splice(this.historyPointer+1,this.historySize,e),this.history.length>this.historySize&&this.history.shift(),this.historyPointer=this.history.length-1,this.$emit("historyChanged",this.history,this.historyPointer)},async undo(){await this.historyStep(-1)},async redo(){await this.historyStep(1)},async historyStep(e){var t=this.historyPointer+e,s=this.history[t];s&&(this.historyPointer=t,this.import(s,{saveHistory:!1,undoOnError:!1,perfectScale:!1}),this.$emit("historyChanged",this.history,this.historyPointer))},setResultNode(e,t=!0){if(e=this.getBlockById(e.id),e&&e.value.result!==t){var s=(e,t)=>{this.$set(e.value,"result",t),this.commit()};s(e,t);var a=!1,i=!1;for(var r of this.processBlocks)if(!e||r.id!==e.id)if(i=!0,t)s(r,!1);else if(r.$el&&!r.$el.hasOutputEdges()){s(r,!0),a=!0;break}!i||t||a||this.$emit("error","No result node available, please specify one.")}},getPositionForPageXY(e,t){var s=this.getDimensions();return null!==e&&(e=(e-s.offsetLeft-this.state.center[0])/this.state.scale),null!==t&&(t=(t-s.offsetTop-this.state.center[1])/this.state.scale),[e,t]},addProcess(e,t={},s=[],a={}){return this.addBlock(Object.assign({process_id:e,arguments:t,position:s},a))},addBlock(e,t=null){var s={id:String(this.incrementId(t)),type:"process",selected:!1,value:"function"===typeof e.toJSON?e.toJSON():e};this.processRegistry&&(s.spec=this.processRegistry.get(e.process_id));var a=this.getBlockSize(s);return s.value.position=r["a"].ensurePoint(s.value.position,()=>this.getNewBlockDefaultPosition(a)),s.value.result&&this.blocks.filter(e=>!0===e.value.result).length?delete s.value.result:0===this.processBlocks.length&&(s.value.result=!0),this.blocks.push(k["a"].observable(s)),this.commit(),s},getNewBlockDefaultPosition(e){var t=this.getDimensions(),s=[(-this.state.center[0]+t.width/2)/this.state.scale-e[0]/2+this.newBlockOffset,(-this.state.center[1]+t.height/2)/this.state.scale-e[1]/2+this.newBlockOffset];return this.newBlockOffset<150&&(this.newBlockOffset+=10),s},getBlockSize(e){if(e.$el){let t=e.$el.getDimensions();return[t.width/this.state.scale,t.height/this.state.scale]}var t,s=Math.max(r["a"].isObject(e.value)?r["a"].size(e.value.arguments):0,r["a"].isObject(e.spec)?r["a"].size(e.spec.parameters):0);t=s>0?this.state.compactMode?110:200:this.state.compactMode?60:110;var a=r["a"].isObject(e.value)&&"string"===typeof e.value.description?40:0,i=J+15*s+a;return[t,i]},moveCenter(e,t,s=!1){var a=this.getDimensions();this.state.center=[(s?a.width/2:this.state.center[0])+e,(s?a.height/2:this.state.center[1])+t],this.newBlockOffset=0},unselectAll(e=null){if(!e||!e.shiftKey){for(var t in this.blocks)this.$set(this.blocks[t],"selected",!1);for(var t in this.edges)this.selectEdge(t,!1)}},selectEdge(e,t=!0,s=null,a=null){s&&this.unselectAll(s),r["a"].isObject(e)||(e=this.edges[e]),null!==t&&this.$set(e,"selected",t),this.$set(e,"selectedParameter",a),this.$set(e,"selectedPosition",a?this.state.mouse:null)},removeEdge(e){e.parameter1.eraseEdge(e),e.parameter2.eraseEdge(e),this.$delete(this.edges,this.edges.indexOf(e))},hiddenParameterRefs(e,t){if("process"!==e.type)return null;for(let s in e.value.arguments){let a=e.value.arguments[s];if(r["a"].isObject(a)&&r["a"].isObject(a.process_graph)){let e=v["Utils"].getRefs(a,!0,!0);if(e.find(e=>e.from_parameter===t))return s}}return null},async removeBlock(e){if("parameter"===e.type){let t=null,s=this.blocks.find(s=>(t=this.hiddenParameterRefs(s,e.id),null!==t));if(s)throw new Error(`Parameter is still used in '#${s.id}', parameter '${t}'. Only unused parameters can be deleted.`)}return await this.startTransaction(async()=>{var t=this.blocks.findIndex(t=>t.id==e.id);if(t<0)return!1;for(var s of this.edges.slice(0))s.parameter1.$parent.id!==e.id&&s.parameter2.$parent.id!==e.id||this.removeEdge(s);return e.value.result&&this.setResultNode(e,!1),this.$delete(this.blocks,t),!0})},getBlockById(e){var t=this.blocks.filter(t=>t.id===e);return t.length>0?t[0]:null},async deleteSelected(){return(0!==this.selectedBlocks.length||0!==this.selectedEdges.length)&&await this.startTransaction(async()=>{for(var e of this.selectedBlocks.slice(0))e.$el.allowsDelete&&this.removeBlock(e);for(var t of this.selectedEdges.slice(0))this.removeEdge(t);return!0})},async addEdgeByNames(e,t,s,a){var i=[];for(var r of[e,s]){var o=this.getBlockById(r);if(!o)throw"Can't find block: "+r;if(!o.$el)throw"Block not mounted yet: "+r;i.push(o.$el)}await this.addEdge(i[0].getBlockParameter(t),i[1].getBlockParameter(a))},async addEdge(e,t){if(!e||!t)throw"One of the parameters is invalid.";if(e!=t){if(e.$parent==t.$parent)throw"You can't link a block to itself";var s=this.nextEdgeId++,a={id:s,selected:!1,inactive:!1};if(e.output?(a.parameter1=e,a.parameter2=t):(a.parameter1=t,a.parameter2=e),!a.parameter1.output)throw"You have to link an input with an output";if(-1!==this.allSuccessors(a.parameter1).indexOf(a.parameter2.id))throw"You can not create a loop";if(!v["JsonSchemaValidator"].isSchemaCompatible(a.parameter2.schema||{},a.parameter1.schema||{},!1,!0))throw'Incoming data type is not compatible for parameter "'+a.parameter2.name+'"';if(a.parameter2.getEdgeCount()>0&&!a.parameter2.allowsMultipleInputs)throw"Parameter accepts only one input";for(var i in this.$refs.edges)if(this.$refs.edges[i].equals(a))throw"This connection exists already";return await this.startTransaction(async()=>(this.unlink(),this.edges.push(k["a"].observable(a)),a.parameter1.addEdge(a),a.parameter2.addEdge(a),this.setResultNode(a.parameter1.$parent,!1),!0))}},allSuccessors(e){var t=e.$parent,s={},a=[t];s[t.id]=!0;while(a.length>0){var i=a.pop();for(var r in i.edges)for(var o in i.edges[r]){var n=i.edges[r][o];if(n.block1==i){var l=n.block2;l.id in s||(s[l.id]=!0,a.push(l))}}}return Object.values(s)},async toggleCompact(){this.state.compactMode=!this.state.compactMode,this.$emit("compactMode",this.state.compactMode),await this.$nextTick(),this.refreshEdges()},export(e=!1){var t={};for(var s of this.processBlocks){let a=r["a"].deepClone(s.value);e||delete a.position,null===a.description&&delete a.description,!0!==a.result&&delete a.result,t[s.id]=a}return new z(Object.assign({},this.process,{process_graph:t}))},async startTransaction(e,t={},...s){let a;this.activeTransactions++;try{a=await e(s)}catch(i){if(this.$emit("error",i,"Model is invalid"),console.log(i),!1!==t.undoOnError)try{await this.undo()}catch(r){this.$emit("error",i,"Revert failed"),console.log(i)}a=!1}return this.activeTransactions--,this.commit(null,t.saveHistory,t.propagate),a},async import(e,t={}){return await this.startTransaction(async()=>(!1!==t.clear&&(await this.clear(),this.process=e instanceof v["ProcessGraph"]?e.toJSON():e),!!r["a"].isObject(e)&&(e instanceof v["ProcessGraph"]?(this.processGraph=new v["ProcessGraph"](e.toJSON(),this.processRegistry),this.processGraph.setParent(e.parentProcessId,e.parentParameterName)):this.processGraph=new v["ProcessGraph"](e,this.processRegistry),this.processGraph.allowEmpty(),this.processGraph.parse(),await this.importPgParameters(this.processGraph.getProcessParameters(),"pg",!1!==t.clear),await this.importNodes(this.processGraph.getStartNodes()),await this.importEdges(this.processGraph),!1!==t.perfectScale&&this.perfectScale(),!0)),t)},async importPgParameters(e,t,s=!0){if(!Array.isArray(e))return;s&&(this.blocks=this.blocks.filter(e=>"parameter"!==e.type||e.spec.origin!==t));let a=this.getBlockSize({}),i=[0,0];for(var r in e)i=[-a[0]-J,r*(a[1]+J)],this.addPgParameter(e[r],t,i);await this.$nextTick()},addPgParameter(e,t="user",s=null){this.blocks.findIndex(t=>"parameter"===t.type&&t.id==e.name)>=0||(e=r["a"].deepClone(e),"undefined"===typeof e.schema&&(e.schema={}),e.origin=t,this.blocks.push(k["a"].observable({id:e.name,type:"parameter",value:{from_parameter:e.name,position:r["a"].ensurePoint(s,()=>this.getNewBlockDefaultPosition(this.getBlockSize({})))},spec:e})))},getPgParameters(){return this.blocks.filter(e=>"parameter"===e.type)},async importEdges(e){var t=e.getNodes();for(var s of Object.values(t)){var a=s.getArgumentNames();for(let t in a){var i=s.getRawArgument(a[t]);switch(s.getArgumentType(a[t])){case"result":await this.addEdgeByNames(e.getNode(i.from_node).id,"output",s.id,a[t],!1);break;case"parameter":await this.addEdgeByNames(i.from_parameter,"output",s.id,a[t],!1);break;case"object":case"array":await this.importEdgeDeep(i,e,s,a,t);break}}}},async importEdgeDeep(e,t,s,a,i){for(let o in e)if(e[o]&&"object"===typeof e[o]&&"process_graph"!==o)await this.importEdgeDeep(e[o],t,s,a,i);else{if(!r["a"].isRef(e))continue;e.from_node?await this.addEdgeByNames(t.getNode(e.from_node).id,"output",s.id,a[i],!1):e.from_parameter&&await this.addEdgeByNames(e.from_parameter,"output",s.id,a[i],!1)}},async importNodes(e,t=0,s=0,a=[]){let i=0===a.length,o=[],n=0;for(let l of e){if(a.includes(l.id)||void 0!==l.getPreviousNodes().find(e=>!a.includes(e.id))){s+=J/2;continue}let e="function"===typeof l.toJSON?l.toJSON():l;e.position=r["a"].ensurePoint(e.position,()=>[t,s]);let i=this.addBlock(e,l.id);a.push(l.id);let c=this.getBlockSize(i);n=Math.max(n,e.position[0]+c[0]),s=e.position[1]+c[1]+J,o=o.concat(l.getNextNodes())}o.length&&await this.importNodes(o,n+J,0,a),i&&await this.$nextTick()},incrementId(e=null){return"number"===typeof e||"string"===typeof e&&0!==e.length?isNaN(parseInt(e))||(this.nextBlockId=Math.max(this.nextBlockId,parseInt(e)+1)):(e=this.nextBlockId,this.nextBlockId++),e},perfectScale(){if(this.$refs.div&&0!==this.blocks.length){var e=null,t=null,s=null,a=null;for(let i in this.blocks){let o=this.blocks[i],n=this.getBlockSize(o),l=r["a"].ensurePoint(o.value.position);null==e?(e=l[0]-15,t=l[0]+n[0]+15,s=l[1]-15,a=l[1]+n[1]+15):(e=Math.min(e,l[0]-15),t=Math.max(t,l[0]+n[0]+15),s=Math.min(s,l[1]-15),a=Math.max(a,l[1]+n[1]+15))}var i=this.$refs.div.getBoundingClientRect(),o=i.width/(t-e),n=i.height/(a-s);this.state.scale=Math.min(o,n,1.5),this.state.center=[i.width/2-this.state.scale*(e+t)/2,i.height/2-this.state.scale*(s+a)/2],this.newBlockOffset=0}}}};class z{constructor(e){Object.assign(this,e)}}var H=U,G=(s("1ea2"),Object(w["a"])(H,u,h,!1,null,"c76ef7c6",null)),q=G.exports,W=s("cbd9"),Y=s("c2dc"),X=s("3115"),Z=s("5472"),K={name:"VisualEditor",mixins:[X["a"]],components:{Blocks:q,DiscoveryToolbar:W["a"],ParameterModal:Y["default"],FullscreenButton:Z["a"],ExpressionModal:()=>s.e("chunk-2fdad1d2").then(s.bind(null,"3d5e"))},props:{id:String,editable:{type:Boolean,default:!0},value:{type:Object,default:()=>null},pgParameters:{type:Array,default:()=>[]},showDiscoveryToolbar:{type:Boolean,default:!1},title:{type:String},defaultValue:{}},computed:{...r["a"].mapState(["collections"]),...r["a"].mapGetters(["processRegistry"]),...r["a"].mapGetters("userProcesses",["supportsMath","isMathProcess"])},data(){return{canUndo:!1,canRedo:!1,compactMode:!1,hasSelection:!1,isMath:!1,isFullScreen:!1}},watch:{value(e){this.isMath=this.isMathProcess(e)}},methods:{...r["a"].mapActions("userProcesses",{readUserProcess:"read"}),commit(e){"undefined"!==typeof this.defaultValue&&r["a"].isObject(e)&&0===r["a"].size(e.process_graph)&&(e=this.defaultValue),this.$emit("input",e)},errorHandler(e,t=null){r["a"].exception(this,e,t)},selectionChanged(e,t){this.hasSelection=Boolean(e.filter(e=>e.$el.allowsDelete).length||t.length)},historyChanged(e,t){this.canUndo=!!e[t-1],this.canRedo=!!e[t+1]},allowDrop(e){e.preventDefault()},onDrop(e){var t=e.dataTransfer.getData("application/openeo-node");if(t){e.preventDefault();let s=JSON.parse(t);this.insertProcess(s,e.pageX,e.pageY)}},addParameter(){var e=[{name:"name",label:"Parameter name",schema:{type:"string"},default:null}];this.emit("showDataForm","Add Parameter",e,e=>{"string"===typeof e.name&&e.name.length>0&&this.$refs.blocks.addPgParameter(e)})},showSchemaModal(e,t){this.emit("showSchema",e,t)},showExpressionModal(){this.$refs.expressionModal.show(this.value,this.$refs.blocks.getPgParameters())},openParameterEditor(e,t,s="Edit",a=!0,i=null,r=null,o=null,n=null){this.$refs.parameterModal.show(s,e,t,a,r,null,o,i,n)},confirmClear(){var e=confirm("Do you really want to clear the existing model?");e&&this.clear()},clear(){this.$refs.blocks&&this.$refs.blocks.clear(),this.commit(null)},insertProcess(e,t=null,s=null){try{var a=this.$refs.blocks.getPositionForPageXY(t,s);this.$refs.blocks.addProcess(e.process_id,e.arguments,a)}catch(i){r["a"].exception(this,i)}},async insertNodes(e,t=!1){return await this.$refs.blocks.import({process_graph:e},{clear:t})}}},Q=K,ee=(s("4d982"),Object(w["a"])(Q,l,c,!1,null,null,null)),te=ee.exports,se=s("0f29"),ae={name:"Editor",components:{VisualEditor:te,TextEditor:se["a"],Tabs:o["default"],Tab:n["default"]},props:{id:String,editable:{type:Boolean,default:!0},value:{type:Object,default:()=>null},title:{type:String},pgParameters:{type:Array,default:()=>[]},showDiscoveryToolbar:{type:Boolean,default:!1},defaultValue:{}},watch:{value(){this.updateTab()}},data(){return{modelValue:null,codeValue:null,error:null}},mounted(){this.updateTab()},computed:{...r["a"].mapGetters("userProcesses",{getProcessById:"getAllById"})},methods:{showModel(){this.error=null,this.modelValue=this.value},showCode(){this.error=null,this.codeValue=this.value,this.$refs.sourceEditor.updateState()},updateTab(){"source"===this.$refs.tabs.getActiveTabId()?this.showCode():this.showModel()},commit(e){this.error=null,this.$emit("input",e)},onError(e){this.error=e},activeEditor(){return"source"===this.$refs.tabs.getActiveTabId()?this.$refs.sourceEditor:this.$refs.graphBuilder},async insertProcess(e){try{let t=this.getProcessById(e.process_id);null==t||t.native||await this.readUserProcess({data:t}),this.activeEditor().insertProcess(e)}catch(t){r["a"].exception(this,t)}},canSwitchView(){return!this.editable||null===this.error||(r["a"].exception(this,this.error,"Process Invalid Error"),!1)}}},ie=ae,re=(s("b16a"),Object(w["a"])(ie,a,i,!1,null,null,null));t["default"]=re.exports},da12:function(e,t,s){},dc31:function(e,t,s){},de39:function(e,t,s){},ded2:function(e,t,s){},dff8:function(e,t,s){"use strict";s("ccd4")},e827:function(e,t,s){"use strict";s("a168")},ebe9:function(e,t,s){},eee8:function(e,t,s){"use strict";s("c2aeb")},f3db:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"wrapper"}},[a("div",{attrs:{id:"ide"},on:{mouseup:function(t){return e.stopMovingSeparator(t)},mousemove:function(t){return e.moveSeparator(t)}}},[a("header",{staticClass:"navbar"},[a("div",{staticClass:"logo"},[a("img",{attrs:{src:s("cf05"),alt:"openEO"}}),a("h2",[e._v("Web Editor "),a("span",{staticClass:"version",on:{click:e.showWebEditorInfo}},[e._v(e._s(e.version))])])]),a("ul",{attrs:{id:"menu"}},[a("li",[a("div",{staticClass:"menuItem",attrs:{title:"Get server information"},on:{click:e.showServerInfo}},[a("i",{staticClass:"fas fa-info fa-fw"}),e._v(" Server")])]),a("li",[a("UserMenu")],1)])]),a("main",{staticClass:"page"},[a("div",{ref:"discovery",attrs:{id:"discovery"}},[a("DiscoveryToolbar",{staticClass:"toolbar",attrs:{onAddProcess:e.insertProcess}})],1),a("hr",{ref:"separator0",staticClass:"separator",on:{dblclick:function(t){return e.centerSeparator(t,0)},mousedown:function(t){return e.startMovingSeparator(t,0)}}}),a("div",{ref:"workspace",attrs:{id:"workspace"}},[a("Editor",{ref:"editor",staticClass:"mainEditor",attrs:{id:"main",value:e.process,title:e.contextTitle},on:{input:e.updateEditor},scopedSlots:e._u([{key:"file-toolbar",fn:function(){return[a("button",{directives:[{name:"show",rawName:"v-show",value:e.saveSupported,expression:"saveSupported"}],attrs:{type:"button",title:"Save to "+e.contextTitle},on:{click:e.saveProcess}},[a("i",{staticClass:"fas fa-save"})])]},proxy:!0}])}),e.isAuthenticated?a("UserWorkspace",{staticClass:"userContent"}):e._e()],1),a("hr",{ref:"separator1",staticClass:"separator",on:{dblclick:function(t){return e.centerSeparator(t,1)},mousedown:function(t){return e.startMovingSeparator(t,1)}}}),a("div",{ref:"viewer",attrs:{id:"viewer"}},[a("Viewer")],1)])]),a("CollectionModal",{ref:"collectionModal"}),a("ProcessModal",{ref:"processModal"}),a("ServerInfoModal",{ref:"serverInfoModal"}),a("ServiceInfoModal",{ref:"serviceModal"}),a("JobInfoModal",{ref:"jobModal"}),a("ParameterModal",{ref:"parameterModal"}),a("SchemaModal",{ref:"schemaModal"}),a("UdfRuntimeModal",{ref:"udfRuntimeModal"}),a("FileFormatModal",{ref:"fileFormatModal"}),a("JobEstimateModal",{ref:"jobEstimateModal"})],1)},i=[],r=s("9224"),o=s("3115"),n=s("025e"),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"UserMenu"}},[s("div",{staticClass:"menuItem"},[e._m(0),s("div",{staticClass:"data"},[s("span",{staticClass:"name nowrap"},[s("i",{staticClass:"fas fa-user"}),e._v(" "+e._s(e.userName))]),e.budget?s("span",{staticClass:"credits nowrap"},[s("i",{staticClass:"fas fa-dollar-sign fa-fw"}),e._v(" "+e._s(e.budget))]):e._e(),e.hasStorage?s("span",{staticClass:"storage nowrap"},[s("i",{staticClass:"fas fa-database fa-fw"}),e._v(" "+e._s(e.storageUsedPercent)+"% used")]):e._e()])]),s("div",{staticClass:"dropdown"},[s("div",{staticClass:"item"},[e._v(" Welcome, "+e._s(e.userName)+"! ")]),e.hasStorage?s("div",{staticClass:"item"},[s("h4",[e._v("Storage")]),s("div",{staticClass:"storagePercent"},[s("div",{staticClass:"used",style:"width: "+e.storageUsedPercent+"%"})]),s("div",{staticClass:"nowrap"},[e._v("Used "+e._s(e.formatMegabyte(e.storageUsed))+" of "+e._s(e.formatMegabyte(e.userInfo.storage.quota))+".")])]):e._e(),e._l(e.links,(function(t,a){return s("div",{key:a,staticClass:"item"},[s("a",{attrs:{href:t.href,target:"_blank",rel:t.rel}},[e._v(e._s(t.title))])])})),s("div",{staticClass:"item"},[s("button",{staticClass:"navButton",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.logout.apply(null,arguments)}}},[s("i",{staticClass:"fas fa-sign-out-alt"}),e._v(" Logout")])])],2)])},c=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"down"},[s("i",{staticClass:"fas fa-chevron-down"})])}],u={name:"UserMenu",computed:{...n["a"].mapState(["userInfo"]),...n["a"].mapGetters(["currency"]),links(){return n["a"].friendlyLinks(this.userInfo.links)},hasStorage(){return n["a"].isObject(this.userInfo.storage)&&"number"===typeof this.userInfo.storage.quota&&"number"===typeof this.userInfo.storage.free},budget(){return n["a"].formatBudget(this.userInfo.budget,this.currency)},userName(){return"string"===typeof this.userInfo.name?this.userInfo.name:"string"===typeof this.userInfo.user_id?this.userInfo.user_id:"Guest"},storageUsed(){return this.hasStorage?this.userInfo.storage.quota-this.userInfo.storage.free:null},storageUsedPercent(){return this.hasStorage?Math.round(this.storageUsed/this.userInfo.storage.quota*100):null}},methods:{...n["a"].mapActions({logoutServer:"logout"}),...n["a"].mapMutations("editor",{resetEditor:"reset"}),async logout(){await this.logoutServer(),this.resetEditor()},formatMegabyte(e){var t=1073741824;return e>t?Math.round(e/t)+" GB":Math.round(e/1048576)+" MB"}}},h=u,d=(s("a89b"),s("2877")),p=Object(d["a"])(h,l,c,!1,null,"078435c4",null),m=p.exports,f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Tabs",{ref:"tabs",attrs:{id:"userContent"}},[e.showJobs?s("Tab",{attrs:{id:"jobs",name:"Batch Jobs",icon:"fa-tasks"},on:{show:e.onShow,hide:e.onHide}},[s("JobPanel")],1):e._e(),e.showServices?s("Tab",{attrs:{id:"services",name:"Web Services",icon:"fa-cloud"},on:{show:e.onShow,hide:e.onHide}},[s("ServicePanel")],1):e._e(),e.showCustomProcesses?s("Tab",{attrs:{id:"customProcesses",name:"Custom Processes",icon:"fa-sitemap"},on:{show:e.onShow,hide:e.onHide}},[s("CustomProcessPanel")],1):e._e(),e.showFiles?s("Tab",{attrs:{id:"files",name:"Files",icon:"fa-file"},on:{show:e.onShow,hide:e.onHide}},[s("FilePanel")],1):e._e()],1)},g=[],v=s("e7ea"),b=s("bdb2"),y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"FilePanel"},on:{dragenter:function(t){return e.dropZoneInfo(!0)},dragleave:function(t){return e.dropZoneInfo(!1)},drop:function(t){return e.uploadFiles(t)},dragover:function(t){return e.allowDrop(t)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showUploadDropHint,expression:"showUploadDropHint"}],staticClass:"dropZone"},[e._v("To upload files, drop them here.")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.supportsCreate,expression:"supportsCreate"}],staticClass:"addFile"},[s("input",{ref:"uploadUserFile",staticClass:"uploadUserFile",attrs:{type:"file",name:"uploadUserFile",multiple:""},on:{change:e.uploadFiles}})]),s("div",{staticClass:"percent"},[s("div",{staticClass:"used",class:{error:e.uploadErrored},style:"width: "+this.uploadProgress+"%; opacity: "+this.uploadFadeOut})]),s("DataTable",{ref:"table",attrs:{data:e.data,columns:e.columns},scopedSlots:e._u([{key:"actions",fn:function(t){return[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Download"},on:{click:function(s){return e.downloadFile(t.row)}}},[s("i",{staticClass:"fas fa-download"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsDelete,expression:"supportsDelete"}],attrs:{title:"Delete"},on:{click:function(s){return e.deleteFile(t.row)}}},[s("i",{staticClass:"fas fa-trash"})])]}}])})],1)},w=[],C=s("2f5c"),S=(e,t,s)=>({components:{DataTable:C["a"]},data(){return{columns:{},syncTimer:null,lastSyncTime:null}},mounted(){this.updateData()},beforeDestroy(){this.stopSyncTimer()},computed:{...n["a"].mapState(e,{data:e}),...n["a"].mapGetters(e,["supportsList","supportsCreate","supportsRead","supportsUpdate","supportsDelete"])},methods:{...n["a"].mapActions(e,["list","create","read","update","delete"]),getTable(){return this.$refs&&this.$refs.table?this.$refs.table:null},onShow(){this.updateData(),this.startSyncTimer()},onHide(){this.stopSyncTimer()},startSyncTimer(){this.supportsList&&null===this.syncTimer&&(this.syncTimer=setInterval(this.updateData,this.getSyncInterval()))},stopSyncTimer(){null!==this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)},getSyncInterval(){return 60*this.$config.dataRefreshInterval*1e3},refreshElement(e,s=null){var a=Object.assign({},e);this.read({data:e}).then(e=>{"function"===typeof s&&s(e,a)}).catch(e=>n["a"].exception(this,e,"Load "+t+" error"))},updateData(){var e=this.getTable(),a=Date.now()-this.getSyncInterval();if(e&&!(this.lastSyncTime>a))if(this.supportsList)if(this.supportsCreate){var i=this.data.length>0;i||e.setNoData("Loading "+s+"..."),this.lastSyncTime=Date.now(),this.list().then(s=>{0==s.length&&e.setNoData("Add your first "+t+" here...")}).catch(t=>{i?console.log(t):e.setNoData(t)})}else e.setNoData("Sorry, this feature is not supported by the server.");else e.setNoData("Sorry, listing stored "+s+" is not supported by the server.")}}}),k={name:"FilePanel",mixins:[S("files","file","files")],data(){return{columns:{path:{name:"Path",primaryKey:!0,sortFn:n["a"].sortByPath,sort:"asc"},size:{name:"Size",format:"FileSize",filterable:!1},modified:{name:"Last modified",format:"Timestamp"},actions:{name:"Actions",filterable:!1,sort:!1}},uploadProgress:0,uploadProgressPerFile:[],uploadErrored:!1,uploadFadeOut:1,showUploadDropHint:0}},watch:{uploadProgressPerFile:{deep:!0,handler(){this.uploadProgress=this.uploadProgressPerFile.reduce((e,t)=>e+t,0)/this.uploadProgressPerFile.length,this.uploadProgress>99.9999&&this.finishAllUploads()}}},methods:{allowDrop(e){this.supportsCreate&&(e.preventDefault(),e.stopPropagation())},dropZoneInfo(e){this.showUploadDropHint+=e?1:-1},uploadFiles(e){this.showUploadDropHint=0;var t=[];if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length?(t=e.dataTransfer.files,e.preventDefault(),e.stopPropagation()):e.target&&e.target.files&&e.target.files.length&&(t=e.target.files),this.supportsCreate)if(0!==t.length){this.uploadProgressPerFile=[],this.uploadProgress=0,this.uploadErrored=!1;for(let e=0;e<t.length;e++)this.uploadFile(t[e],e)}else n["a"].info(this,"Please select files to upload.");else n["a"].error(this,"Uploading files is not supported.")},uploadFile(e,t){this.uploadProgressPerFile.push(0),"string"===typeof e.name&&this.create({parameters:[e,null,e=>this.$set(this.uploadProgressPerFile,t,e)]}).then(s=>{this.$set(this.uploadProgressPerFile,t,100),n["a"].ok(this,"File upload completed.",e.name)}).catch(t=>{console.error(t),n["a"].exception(this,t,"Upload File Error: "+e.name)})},finishAllUploads(){this.$refs.uploadUserFile.value="";var e=setInterval(()=>{this.uploadFadeOut-=.05,this.uploadFadeOut<0&&(this.uploadProgress=0,this.uploadFadeOut=1,clearInterval(e))},100)},downloadFile(e){n["a"].info(this,"File requested. Please wait..."),e.downloadFile(e.path)},deleteFile(e){this.delete({data:e}).catch(t=>n["a"].exception(this,t,"Delete File Error: "+e.path))}}},P=k,x=(s("9961"),Object(d["a"])(P,y,w,!1,null,null,null)),E=x.exports,_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DataTable",{ref:"table",staticClass:"JobPanel",attrs:{data:e.data,columns:e.columns},scopedSlots:e._u([{key:"actions",fn:function(t){return[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Details"},on:{click:function(s){return e.showJobInfo(t.row)}}},[s("i",{staticClass:"fas fa-info"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("estimateJob"),expression:"supports('estimateJob')"}],attrs:{title:"Estimate"},on:{click:function(s){return e.estimateJob(t.row)}}},[s("i",{staticClass:"fas fa-file-invoice-dollar"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsUpdate&&e.isJobInactive(t.row),expression:"supportsUpdate && isJobInactive(p.row)"}],attrs:{title:"Edit metadata"},on:{click:function(s){return e.editMetadata(t.row)}}},[s("i",{staticClass:"fas fa-edit"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead&&e.isJobInactive(t.row),expression:"supportsRead && isJobInactive(p.row)"}],attrs:{title:"Edit process"},on:{click:function(s){return e.showInEditor(t.row)}}},[s("i",{staticClass:"fas fa-project-diagram"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsDelete,expression:"supportsDelete"}],attrs:{title:"Delete"},on:{click:function(s){return e.deleteJob(t.row)}}},[s("i",{staticClass:"fas fa-trash"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("startJob")&&e.isJobInactive(t.row),expression:"supports('startJob') && isJobInactive(p.row)"}],attrs:{title:"Start processing"},on:{click:function(s){return e.queueJob(t.row)}}},[s("i",{staticClass:"fas fa-play-circle"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("stopJob")&&e.isJobActive(t.row),expression:"supports('stopJob') && isJobActive(p.row)"}],attrs:{title:"Cancel processing"},on:{click:function(s){return e.cancelJob(t.row)}}},[s("i",{staticClass:"fas fa-stop-circle"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("downloadResults")&&e.hasResults(t.row),expression:"supports('downloadResults') && hasResults(p.row)"}],attrs:{title:"Download"},on:{click:function(s){return e.downloadResults(t.row)}}},[s("i",{staticClass:"fas fa-download"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("downloadResults")&&e.hasResults(t.row),expression:"supports('downloadResults') && hasResults(p.row)"}],attrs:{title:"View results"},on:{click:function(s){return e.viewResults(t.row,!0)}}},[s("i",{staticClass:"fas fa-eye"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("debugJob"),expression:"supports('debugJob')"}],attrs:{title:"View logs"},on:{click:function(s){return e.showLogs(t.row)}}},[s("i",{staticClass:"fas fa-bug"})])]}}])},[s("template",{slot:"toolbar"},[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsCreate,expression:"supportsCreate"}],attrs:{title:"Add new job for batch processing"},on:{click:function(t){return e.createJobFromScript()}}},[s("i",{staticClass:"fas fa-plus"}),e._v(" Create")]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("computeResult"),expression:"supports('computeResult')"}],attrs:{title:"Run process and view results synchronously"},on:{click:e.executeProcess}},[s("i",{staticClass:"fas fa-play"}),e._v(" Run now")])])],2)},T=[],D=s("2b70");const F=S("jobs","batch job","batch jobs");var I={name:"JobPanel",mixins:[F,o["a"]],data(){return{columns:{id:{name:"ID",primaryKey:!0,hide:!0},title:{name:"Title",computedValue:e=>n["a"].getResourceTitle(e),edit:this.updateTitle},status:{name:"Status",stylable:!0},created:{name:"Submitted",format:"Timestamp",sort:"desc"},updated:{name:"Last update",format:"Timestamp"},actions:{name:"Actions",filterable:!1,sort:!1}},watchers:{},jobUpdater:null}},mounted(){this.listen("replaceProcess",this.replaceProcess)},computed:{...n["a"].mapGetters(["supports","supportsBilling","supportsBillingPlans"]),...n["a"].mapState("editor",["process"])},watch:{data:{handler:function(e){this.watchers={};for(let t of e)switch(t.status.toLowerCase()){case"running":case"queued":this.watchers[t.id]=t;break}},deep:!0}},methods:{...n["a"].mapActions("jobs",["queue","cancel"]),startSyncTimer(){F.methods.startSyncTimer.call(this),this.jobUpdater=setInterval(this.executeWatchers,1e4)},stopSyncTimer(){F.methods.stopSyncTimer.call(this),null!==this.jobUpdater&&clearInterval(this.jobUpdater)},showInEditor(e){this.refreshElement(e,e=>this.emit("editProcess",e))},executeProcess(){n["a"].info(this,"Data requested. Please wait..."),this.emit("viewSyncResult",this.process)},jobCreated(e){var t=[];this.supports("estimateJob")&&t.push({text:"Estimate",action:()=>this.estimateJob(e)}),this.supports("startJob")&&t.push({text:"Start processing",action:()=>this.queueJob(e)}),this.supports("deleteJob")&&t.push({text:"Delete",action:()=>this.deleteJob(e)}),n["a"].confirm(this,'Job "'+n["a"].getResourceTitle(e)+'" created!',t)},getTitleField(e=null){return{name:"title",label:"Title",schema:{type:"string"},default:null,value:e,optional:!0}},getDescriptionField(e=null){return{name:"description",label:"Description",schema:{type:"string",subtype:"commonmark"},default:null,value:e,description:"CommonMark (Markdown) is allowed.",optional:!0}},getBillingPlanField(e){return{name:"plan",label:"Billing plan",schema:{type:"string",subtype:"billing-plan"},value:e,optional:!0}},getBudgetField(e=null){return{name:"budget",label:"Budget",schema:{type:"number",subtype:"budget"},default:null,value:e,optional:!0}},normalizeToDefaultData(e){return"undefined"===typeof e.title||"string"===typeof e.title&&0!==e.title.length||(e.title=null),"undefined"===typeof e.description||"string"===typeof e.description&&0!==e.description.length||(e.description=null),"undefined"===typeof e.plan||"string"===typeof e.plan&&0!==e.plan.length||(e.plan=null),"undefined"!==typeof e.budget&&("number"!==typeof e.budget||e.budget<0)&&(e.budget=null),e},createJob(e,t){t=this.normalizeToDefaultData(t),this.create({parameters:[e,t.title,t.description,t.plan,t.budget]}).then(e=>this.jobCreated(e)).catch(e=>n["a"].exception(this,e,"Create Job Error: "+(t.title||"")))},createJobFromScript(){var e=[this.getTitleField(),this.getDescriptionField(),this.supportsBillingPlans?this.getBillingPlanField():null,this.supportsBilling?this.getBudgetField():null];this.emit("showDataForm","Create new batch job",e,e=>this.createJob(this.process,e))},deleteJob(e){this.delete({data:e}).catch(t=>n["a"].exception(this,t,"Delete Job Error: "+n["a"].getResourceTitle(e)))},executeWatchers(){for(var e in this.watchers)this.refreshElement(this.watchers[e],(e,t)=>{if("finished"!==t.status&&"finished"===e.status){var s=[];this.supports("downloadResults")&&(s.push({text:"Download",action:()=>this.downloadResults(e)}),s.push({text:"View",action:()=>this.viewResults(e)})),n["a"].confirm(this,'Job "'+n["a"].getResourceTitle(e)+'" has finished!',s)}else"error"!==t.status&&"error"===e.status&&n["a"].error(this,'Job "'+n["a"].getResourceTitle(e)+'" has stopped due to an error or timeout.');t.status!==e.status&&this.emit("jobStatusUpdated",e,t)})},showJobInfo(e){this.refreshElement(e,async e=>{let t=null;if("finished"===e.status)try{t=await e.getResultsAsStac()}catch(s){n["a"].exception(this,s,"Load Results Error: "+n["a"].getResourceTitle(e))}this.emit("showJobInfo",e.getAll(),t)})},estimateJob(e){e.estimateJob().then(t=>this.emit("showJobEstimate",e.getAll(),t)).catch(t=>n["a"].exception(this,t,"Job Estimate Error: "+n["a"].getResourceTitle(e)))},showLogs(e){this.emit("viewLogs",e)},replaceProcess(e,t){e instanceof D["Job"]&&(this.isJobActive(e)?n["a"].error(this,"Can't change process while batch job is running."):this.updateJob(e,{process:t}))},editMetadata(e){this.refreshElement(e,e=>{var t=[this.getTitleField(e.title),this.getDescriptionField(e.description),this.supportsBillingPlans?this.getBillingPlanField(e.plan):null,this.supportsBilling?this.getBudgetField(e.budget):null];this.emit("showDataForm","Edit batch job",t,t=>this.updateJob(e,t))})},updateTitle(e,t){this.updateJob(e,{title:t})},updateJob(e,t){this.update({data:e,parameters:this.normalizeToDefaultData(t)}).catch(t=>n["a"].exception(this,t,"Update Job Error: "+n["a"].getResourceTitle(e)))},queueJob(e){this.queue({data:e}).then(e=>n["a"].ok(this,'Job "'+n["a"].getResourceTitle(e)+'" successfully queued.')).catch(t=>n["a"].exception(this,t,"Queue Job Error: "+n["a"].getResourceTitle(e)))},cancelJob(e){this.cancel({data:e}).then(e=>n["a"].ok(this,'Job "'+n["a"].getResourceTitle(e)+'" successfully canceled.')).catch(t=>n["a"].exception(this,t,"Cancel Job Error: "+n["a"].getResourceTitle(e)))},viewResults(e){n["a"].info(this,"Data requested. Please wait..."),e.getResultsAsStac().then(t=>{0!=n["a"].size(t.assets)?this.emit("viewJobResults",t,e):n["a"].error(this,'No results available for job "'+n["a"].getResourceTitle(e)+'".')})},downloadResults(e){e.getResultsAsStac().then(t=>{0!=n["a"].size(t.assets)?this.emit("showListModal","Download results",Object.values(t.assets).map(e=>e.href),[{callback:e=>(window.open(e,"_blank"),!1)}]):n["a"].error(this,'No results available for job "'+n["a"].getResourceTitle(e)+'".')})},hasResults(e){return"string"!==typeof e.status||"finished"==e.status.toLowerCase()},isJobInactive(e){return"string"!==typeof e.status||!this.isActiveStatusCode(e.status)},isJobActive(e){return"string"!==typeof e.status||this.isActiveStatusCode(e.status)},isActiveStatusCode(e){switch(e.toLowerCase()){case"running":case"queued":return!0;default:return!1}}}},M=I,$=(s("0791"),Object(d["a"])(M,_,T,!1,null,null,null)),O=$.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DataTable",{ref:"table",staticClass:"CustomProcessPanel",attrs:{data:e.data,columns:e.columns},scopedSlots:e._u([{key:"actions",fn:function(t){return[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Details"},on:{click:function(s){return e.processInfo(t.row)}}},[s("i",{staticClass:"fas fa-info"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsUpdate,expression:"supportsUpdate"}],attrs:{title:"Edit metadata"},on:{click:function(s){return e.editMetadata(t.row)}}},[s("i",{staticClass:"fas fa-edit"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Edit process"},on:{click:function(s){return e.showInEditor(t.row)}}},[s("i",{staticClass:"fas fa-project-diagram"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsDelete,expression:"supportsDelete"}],attrs:{title:"Delete"},on:{click:function(s){return e.deleteProcess(t.row)}}},[s("i",{staticClass:"fas fa-trash"})])]}}])},[s("template",{slot:"toolbar"},[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsCreate,expression:"supportsCreate"}],attrs:{title:"Add new custom process"},on:{click:e.addProcessFromScript}},[s("i",{staticClass:"fas fa-plus"}),e._v(" Add")])])],2)},j=[],R={name:"CustomProcessPanel",mixins:[S("userProcesses","custom process","custom processes"),o["a"]],data(){return{columns:{id:{name:"ID",primaryKey:!0,sort:"asc"},summary:{name:"Summary"},actions:{name:"Actions",filterable:!1,sort:!1}}}},computed:{...n["a"].mapState("editor",["process"])},mounted(){this.listen("replaceProcess",this.replaceProcess)},methods:{showInEditor(e){this.refreshElement(e,e=>this.emit("editProcess",e))},getIdField(e){return{name:"id",label:"Name",schema:{type:"string"},default:null,value:e}},getSummaryField(e){return{name:"summary",label:"Summary",schema:{type:"string"},default:null,value:e,optional:!0}},getDescriptionField(e){return{name:"description",label:"Description",schema:{type:"string",subtype:"commonmark"},default:null,value:e,description:"CommonMark (Markdown) is allowed.",optional:!0}},getCategoriesField(e){return{name:"categories",label:"Categories",schema:{type:"array",items:{type:"string"}},default:[],value:e,optional:!0}},getDeprecatedField(e=!1){return{name:"deprecated",label:"Deprecated",schema:{type:"boolean"},default:!1,value:e,optional:!0}},getExperimentalField(e=!1){return{name:"experimental",label:"Experimental",schema:{type:"boolean"},default:!1,value:e,optional:!0}},getFields(e){return[this.getIdField(e.id),this.getSummaryField(e.summary),this.getDescriptionField(e.description),this.getCategoriesField(e.categories),this.getDeprecatedField(e.deprecated),this.getExperimentalField(e.experimental)]},addProcessFromScript(){let e=this.getFields(this.process);this.emit("showDataForm","Store a new custom process",e,e=>this.addProcess(this.normalize(this.process,e)))},normalize(e,t){return Object.assign({},"function"===typeof e.toJSON?e.toJSON():e,t)},addProcess(e){this.create({parameters:[e.id,e]}).catch(t=>n["a"].exception(this,t,"Store Process Error: "+e.id))},processInfo(e){this.emit("showProcessInfo",e)},editMetadata(e){this.refreshElement(e,e=>{let t=this.getFields(e);this.emit("showDataForm","Edit metadata for a process graph",t,t=>this.updateMetadata(e,t))})},replaceProcess(e,t){e instanceof D["UserProcess"]&&this.updateMetadata(e,t)},updateMetadata(e,t){this.update({data:e,parameters:this.normalize(e,t)}).catch(t=>n["a"].exception(this,t,"Update Process Error: "+e.id))},deleteProcess(e){this.delete({data:e}).catch(t=>n["a"].exception(this,t,"Delete Process Error: "+e.id))}}},L=R,N=(s("1b7a"),Object(d["a"])(L,B,j,!1,null,null,null)),V=N.exports,J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DataTable",{ref:"table",staticClass:"ServicePanel",attrs:{data:e.data,columns:e.columns},scopedSlots:e._u([{key:"actions",fn:function(t){return[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Details"},on:{click:function(s){return e.serviceInfo(t.row)}}},[s("i",{staticClass:"fas fa-info"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsUpdate,expression:"supportsUpdate"}],attrs:{title:"Edit metadata"},on:{click:function(s){return e.editMetadata(t.row)}}},[s("i",{staticClass:"fas fa-edit"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsRead,expression:"supportsRead"}],attrs:{title:"Edit process"},on:{click:function(s){return e.showInEditor(t.row)}}},[s("i",{staticClass:"fas fa-project-diagram"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsDelete,expression:"supportsDelete"}],attrs:{title:"Delete"},on:{click:function(s){return e.deleteService(t.row)}}},[s("i",{staticClass:"fas fa-trash"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:t.row.enabled&&e.isMapServiceSupported(t.row.type),expression:"p.row.enabled && isMapServiceSupported(p.row.type)"}],attrs:{title:"View on map"},on:{click:function(s){return e.viewService(t.row)}}},[s("i",{staticClass:"fas fa-map"})]),s("button",{directives:[{name:"show",rawName:"v-show",value:e.supports("debugService"),expression:"supports('debugService')"}],attrs:{title:"View logs"},on:{click:function(s){return e.showLogs(t.row)}}},[s("i",{staticClass:"fas fa-bug"})])]}}])},[s("template",{slot:"toolbar"},[s("button",{directives:[{name:"show",rawName:"v-show",value:e.supportsCreate,expression:"supportsCreate"}],attrs:{title:"Add new service"},on:{click:function(t){return e.createServiceFromScript()}}},[s("i",{staticClass:"fas fa-plus"}),e._v(" Create")])])],2)},A=[],U={name:"ServicePanel",mixins:[S("services","web service","web services"),o["a"]],data(){return{columns:{id:{name:"ID",primaryKey:!0,hide:!0},title:{name:"Title",computedValue:e=>n["a"].getResourceTitle(e),edit:this.updateTitle},type:{name:"Type",format:e=>"string"===typeof e?e.toUpperCase():e},enabled:{name:"Enabled",edit:this.toggleEnabled},created:{name:"Submitted",format:"Timestamp",sort:"desc"},actions:{name:"Actions",filterable:!1,sort:!1}}}},computed:{...n["a"].mapState("editor",["process"]),...n["a"].mapState(["serviceTypes"]),...n["a"].mapGetters(["supports","supportsBilling","supportsBillingPlans"])},mounted(){this.listen("replaceProcess",this.replaceProcess)},methods:{isMapServiceSupported(e){return"string"===typeof e&&this.$config.supportedMapServices.includes(e.toLowerCase())},showInEditor(e){this.refreshElement(e,e=>this.emit("editProcess",e))},showLogs(e){this.emit("viewLogs",e)},serviceCreated(e){var t=[];this.isMapServiceSupported(e.type)&&t.push({text:"View on map",action:()=>this.viewService(e)}),this.supportsRead&&t.push({text:"Details",action:()=>this.serviceInfo(e)}),this.supportsDelete&&t.push({text:"Delete",action:()=>this.deleteService(e)}),n["a"].confirm(this,"Web Service created!",t)},getTitleField(e=null){return{name:"title",label:"Title",schema:{type:"string"},default:null,value:e,optional:!0}},getDescriptionField(e=null){return{name:"description",label:"Description",schema:{type:"string",subtype:"commonmark"},default:null,value:e,description:"CommonMark (Markdown) is allowed.",optional:!0}},getServiceTypeField(e){return{name:"type",label:"Type",schema:{type:"string",subtype:"service-type"},value:e}},getBillingPlanField(e){return{name:"plan",label:"Billing plan",schema:{type:"string",subtype:"billing-plan"},value:e,optional:!0}},getBudgetField(e=null){return{name:"budget",label:"Budget",schema:{type:"number",subtype:"budget"},default:null,value:e,optional:!0}},getEnabledField(e=!0){return{name:"enabled",label:"Enabled",schema:{type:"boolean"},default:!0,value:e,optional:!0}},getConfigField(e){return{name:"configuration",label:"Service Configuration",schema:{type:"object",subtype:"service-config"},value:e,optional:!0}},normalizeToDefaultData(e){return"undefined"===typeof e.title||"string"===typeof e.title&&0!==e.title.length||(e.title=null),"undefined"===typeof e.description||"string"===typeof e.description&&0!==e.description.length||(e.description=null),"undefined"!==typeof e.enabled&&"boolean"!==typeof e.enabled&&(e.enabled=!0),"undefined"===typeof e.configuration||n["a"].isObject(e.configuration)||(e.configuration={}),"undefined"===typeof e.plan||"string"===typeof e.plan&&0!==e.plan.length||(e.plan=null),"undefined"!==typeof e.budget&&("number"!==typeof e.budget||e.budget<0)&&(e.budget=null),e},createService(e,t){t=this.normalizeToDefaultData(t),this.create({parameters:[e,t.type,t.title,t.description,t.enabled,t.configuration,t.plan,t.budget]}).then(e=>this.serviceCreated(e)).catch(e=>n["a"].exception(this,e,"Create Service Error: "+(t.title||"")))},createServiceFromScript(){var e=[this.getTitleField(),this.getDescriptionField(),this.getServiceTypeField(),this.getEnabledField(),this.supportsBillingPlans?this.getBillingPlanField():null,this.supportsBilling?this.getBudgetField():null,this.getConfigField()];this.emit("showDataForm","Create new web service",e,e=>this.createService(this.process,e))},editMetadata(e){this.refreshElement(e,e=>{var t=[this.getTitleField(e.title),this.getDescriptionField(e.description),this.getEnabledField(e.enabled),this.supportsBillingPlans?this.getBillingPlanField(e.plan):null,this.supportsBilling?this.getBudgetField(e.budget):null,this.getConfigField(e.configuration)];this.emit("showDataForm","Edit web service",t,t=>this.updateService(e,t))})},serviceInfo(e){this.refreshElement(e,e=>{this.emit("showServiceInfo",e.getAll())})},replaceProcess(e,t){e instanceof D["Service"]&&this.updateService(e,{process:t})},updateTitle(e,t){this.updateService(e,{title:t})},toggleEnabled(e){this.updateService(e,{enabled:!e.enabled})},updateService(e,t){this.update({data:e,parameters:this.normalizeToDefaultData(t)}).catch(t=>n["a"].exception(this,t,"Update Service Error: "+n["a"].getResourceTitle(e)))},deleteService(e){this.delete({data:e}).then(()=>this.emit("removeWebService",e.id)).catch(t=>n["a"].exception(this,t,"Delete Service Error: "+n["a"].getResourceTitle(e)))},viewService(e){n["a"].info(this,"Requesting tiles from server. Please wait..."),this.emit("viewWebService",e)}}},z=U,H=(s("916f"),Object(d["a"])(z,J,A,!1,null,null,null)),G=H.exports,q={name:"UserWorkspace",components:{FilePanel:E,JobPanel:O,CustomProcessPanel:V,ServicePanel:G,Tabs:v["default"],Tab:b["default"]},computed:{...n["a"].mapGetters(["supports"]),showJobs(){return this.supports("listJobs")||this.supports("createJob")},showServices(){return this.supports("listServices")||this.supports("createService")},showCustomProcesses(){return this.supports("listUserProcesses")||this.supports("setUserProcess")},showFiles(){return this.supports("listFiles")||this.supports("uploadFile")}},methods:{onShow(e){e.$children.length&&"function"===typeof e.$children[0].onShow&&e.$children[0].onShow()},onHide(e){e.$children.length&&"function"===typeof e.$children[0].onHide&&e.$children[0].onHide()}}},W=q,Y=(s("b5d7"),Object(d["a"])(W,f,g,!1,null,null,null)),X=Y.exports,Z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Tabs",{ref:"tabs",attrs:{id:"viewerContent"},scopedSlots:e._u([{key:"default",fn:function(){return[s("Tab",{attrs:{id:"mapView",name:"Map",icon:"fa-map",selected:!0},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.tab;return[s("MapViewer",{ref:"mapViewer",attrs:{id:"mapCanvas",show:t.active,center:[50.1725,9.15],zoom:6}})]}}])})]},proxy:!0},{key:"dynamic",fn:function(e){var t=e.tab;return["fa-bug"===t.icon||"fa-bomb"===t.icon?s("LogViewer",{attrs:{data:t.data}}):"fa-image"===t.icon?s("ImageViewer",{attrs:{data:t.data}}):s("DataViewer",{attrs:{data:t.data}})]}}])})},K=[],Q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dataViewer"},[e.isError?s("div",{staticClass:"noDataMessage"},[e._v(e._s(e.content.message))]):"string"===typeof e.content?s("pre",{staticClass:"text"},[e._v(e._s(e.content))]):null!==e.content?s("ObjectTree",{staticClass:"tree",attrs:{data:e.content}}):s("div",{staticClass:"noDataMessage"},[s("i",{staticClass:"fas fa-spinner fa-spin"}),e._v(" Loading data...")])],1)},ee=[],te=s("0a37"),se={name:"DataViewer",mixins:[o["a"]],props:{data:{type:Object,required:!0}},components:{ObjectTree:te["default"]},computed:{...n["a"].mapState(["connection"]),isError(){return this.content instanceof Error}},data(){return{content:null}},watch:{data(){this.processData(this.data)}},created(){this.processData(this.data)},methods:{processData(e){if(console.log(e),"undefined"!==typeof e.blob)switch(e.type){case"application/json":n["a"].blobToText(e,e=>{var t=JSON.parse(e.target.result);this.content=t});break;case"text/plain":case"text/csv":n["a"].blobToText(e,e=>{this.content=e.target.result});break;default:OpenEO.Environment.saveToFile(e,n["a"].makeFileName("result",e.type)),this.error("Sorry, content type not supported. Trying to download the file...")}else e.url?this.connection.download(e.url,!1).then(e=>this.processData(e.data)).catch(e=>n["a"].exception(this,e,"Download File Error")):this.content=e},error(e){this.content=new Error(e)}}},ae=se,ie=(s("8f78"),Object(d["a"])(ae,Q,ee,!1,null,"6680fd10",null)),re=ie.exports,oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"imageContainer",staticClass:"imageViewer"},[s("div",{ref:"loading",staticClass:"noDataMessage"},[s("i",{staticClass:"fas fa-spinner fa-spin"}),e._v(" Loading image...")]),s("img",{ref:"image",attrs:{alt:""},on:{click:e.resize}})])},ne=[],le={name:"ImageViewer",props:{data:{type:Object,required:!0}},mounted(){this.data.blob?this.showImageBlob(this.data.blob):this.data.url&&this.showImage(this.data.url),this.resize()},methods:{showImage(e){this.$refs.image.src=e,this.$refs.image.onload=()=>{this.$refs.loading.style.display="none"}},showImageBlob(e){this.showImage(URL.createObjectURL(e))},resize(){this.$refs.image&&(this.$refs.image.style.maxWidth?(this.$refs.image.style.maxWidth=null,this.$refs.image.style.cursor="zoom-out",this.$refs.image.title="Click to shrink (fit to screen)"):(this.$refs.image.style.maxWidth="100%",this.$refs.image.style.cursor="zoom-in",this.$refs.image.title="Click to enlarge"))}}},ce=le,ue=(s("aab4"),Object(d["a"])(ce,oe,ne,!1,null,"8fe7759e",null)),he=ue.exports,de=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Logs",{staticClass:"log-viewer",attrs:{logs:e.logs}})},pe=[],me=s("b60c"),fe={name:"LogViewer",mixins:[o["a"]],components:{Logs:me["a"]},props:{data:{type:[Object,Array],required:!0}},data(){return{logs:null,syncTimer:null}},computed:{...n["a"].mapState(["connection"]),isJob(){return n["a"].isObject(this.data)&&"function"===typeof this.data.debugJob},isService(){return n["a"].isObject(this.data)&&"function"===typeof this.data.debugService},logIterator(){return this.isJob?this.data.debugJob():this.isService?this.data.debugService():null}},created(){this.isJob&&this.listen("jobStatusUpdated",this.onJobStatusUpdated)},beforeDestroy(){this.onHide()},methods:{onShow(){this.loadNext(),this.isJob?this.onJobStatusUpdated(this.data):this.isService&&this.startWatcher()},onHide(){this.stopWatcher()},onJobStatusUpdated(e){if(e===this.data&&"string"===typeof this.data.status)switch(this.data.status.toLowerCase()){case"running":case"queued":this.startWatcher();break;default:this.stopWatcher()}},startWatcher(){null===this.syncTimer&&(this.syncTimer=setInterval(this.loadNext.bind(this),1e4))},stopWatcher(){null!==this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)},async loadNext(){if(this.logIterator){let e=await this.logIterator.nextLogs();Array.isArray(this.logs)||(this.logs=[]);for(let t of e)this.logs.push(t)}else Array.isArray(this.data)&&!this.logs&&(this.logs=this.data)}}},ge=fe,ve=(s("c46c"),Object(d["a"])(ge,de,pe,!1,null,null,null)),be=ve.exports,ye=s("a5c1"),we=s("b40f"),Ce=s.n(we),Se={name:"Viewer",mixins:[o["a"]],components:{Tab:b["default"],Tabs:v["default"],DataViewer:re,ImageViewer:he,LogViewer:be,MapViewer:ye["a"]},mounted(){this.listen("viewBlob",this.showViewer),this.listen("viewLink",this.showViewer),this.listen("viewSyncResult",this.showSyncResults),this.listen("viewJobResults",this.showJobResults),this.listen("viewWebService",this.showWebService),this.listen("viewLogs",this.showLogs),this.listen("removeWebService",this.removeWebService)},data(){return{tabCounter:{}}},computed:{...n["a"].mapState(["connection"])},methods:{showWebService(e){this.showMapViewer(),this.$refs.mapViewer.showWebService(e)},removeWebService(e){this.$refs.mapViewer.removeLayerFromMap(e)},showMapViewer(){this.$refs.tabs.selectTab("mapView")},showSyncResults(e){this.connection.computeResult(e).then(e=>{Array.isArray(e.logs)&&e.logs.length>0&&this.showLogs(e.logs),this.showViewer(e.data)}).catch(e=>{let t="Processing Error";"string"===typeof e.message&&e.message.length>this.$config.snotifyDefaults.bodyMaxLength?(this.showLogs([{id:e.id||"unknown",code:e.code||void 0,level:"error",message:e.message,links:e.links||[]}]),n["a"].error(this,"Synchronous processing failed. Please see the logs for details.",t)):n["a"].exception(this,e,t)})},showJobResults(e,t){for(var s in e.assets){var a=e.assets[s];this.showViewer(a,this.makeTitle(s,t.id,!0))}},showLogs(e,t="Logs",s="fa-bug"){let a=Array.isArray(e)?t:n["a"].getResourceTitle(e,!0);this.$refs.tabs.addTab(a,s,e,null,!0,!0,e=>this.onShow(e),e=>this.onHide(e))},onShow(e){e.$children.length&&"function"===typeof e.$children[0].onShow&&e.$children[0].onShow()},onHide(e){e.$children.length&&"function"===typeof e.$children[0].onHide&&e.$children[0].onHide()},uniqueTitle(e){return this.tabCounter[e]?(this.tabCounter[e]++,e+" ("+this.tabCounter[e]+")"):(this.tabCounter[e]=1,e)},makeTitle(e,t,s=!1){return e?s?this.uniqueTitle(e):e:this.uniqueTitle(t)},async showViewer(e,t=null){var s={};n["a"].isObject(e)&&"string"===typeof e.href&&"string"===typeof e.type?(s.type=e.type,s.url=e.href):e instanceof Blob?(s.type=e.type,s.blob=e):n["a"].error(this,"Sorry, invalid data received."),"string"===typeof s.type&&-1!==s.type.indexOf("/")&&-1===s.type.indexOf("*")||n["a"].error(this,"Sorry, can't detect content type.");try{let e=Ce.a.parse(s.type);s.type=e.type,s.parameters=e.parameters}catch(a){}switch(s.type){case"image/png":case"image/jpg":case"image/jpeg":case"image/gif":this.$refs.tabs.addTab(this.makeTitle(t,"Image"),"fa-image",s,null,!0,!0);break;case"application/json":case"text/plain":case"text/csv":this.$refs.tabs.addTab(this.makeTitle(t,"Data"),"fa-database",s,null,!0,!0);break;case"image/tiff":if(s.url&&"geotiff"===s.parameters.application){this.showMapViewer(),this.$refs.mapViewer.updateGeoTiffLayer(s.url,this.makeTitle(t,"GeoTiff"));break}default:if(s.blob instanceof Blob){D["OpenEO"].Environment.saveToFile(s.blob,n["a"].makeFileName("result",s.type));break}if(s.url)try{let e=await this.connection._get(s.url,"","blob"),t=n["a"].getFileNameFromURL(s.url);if(e.data instanceof Blob){D["OpenEO"].Environment.saveToFile(e.data,n["a"].makeFileName(t,s.type));break}}catch(a){console.error(a)}n["a"].error(this,"Sorry, content type not supported by the viewer and can't be downloaded.")}}}},ke=Se,Pe=(s("15dd"),Object(d["a"])(ke,Z,K,!1,null,null,null)),xe=Pe.exports,Ee=s("ceb0"),_e=s("cbd9"),Te=s("79e5"),De={name:"IDE",mixins:[o["a"]],components:{DiscoveryToolbar:_e["a"],Editor:Ee["default"],Viewer:xe,UserMenu:m,UserWorkspace:X,CollectionModal:()=>s.e("chunk-6edaaddb").then(s.bind(null,"8295")),ProcessModal:()=>s.e("chunk-7878eb47").then(s.bind(null,"732b")),ServerInfoModal:()=>s.e("chunk-582c7420").then(s.bind(null,"2406")),JobInfoModal:()=>s.e("chunk-56e22092").then(s.bind(null,"fd61")),JobEstimateModal:()=>s.e("chunk-58bb75ac").then(s.bind(null,"0639")),ServiceInfoModal:()=>s.e("chunk-4bf4bf0b").then(s.bind(null,"0af1")),ParameterModal:()=>Promise.resolve().then(s.bind(null,"c2dc")),SchemaModal:()=>s.e("chunk-0f35fb0a").then(s.bind(null,"ea2d")),FileFormatModal:()=>s.e("chunk-397960de").then(s.bind(null,"3642")),UdfRuntimeModal:()=>s.e("chunk-6ccc47a8").then(s.bind(null,"8a57"))},data(){return{moving:!1,movingOffset:0,separators:[{left:"discovery",right:"workspace",anchor:"left",width:"20%"},{left:"workspace",right:"viewer",anchor:"right",width:"30%"}],version:r.version,resizeListener:null,userInfoUpdater:null}},computed:{...n["a"].mapState(["connection"]),...n["a"].mapState("editor",["context","process"]),...n["a"].mapGetters(["title","isAuthenticated","apiVersion"]),...n["a"].mapGetters("jobs",{supportsJobUpdate:"supportsUpdate"}),...n["a"].mapGetters("services",{supportsServiceUpdate:"supportsUpdate"}),...n["a"].mapGetters("userProcesses",{getProcessById:"getAllById",supportsUserProcessUpdate:"supportsUpdate"}),contextTitle(){return null!==this.context?n["a"].getResourceTitle(this.context,!0):""},saveSupported(){return null!==this.context&&(this.context instanceof D["Job"]&&this.supportsJobUpdate||this.context instanceof D["Service"]&&this.supportsServiceUpdate||this.context instanceof D["UserProcess"]&&this.supportsUserProcessUpdate)}},async created(){try{await this.loadInitialProcess()}catch(e){n["a"].exception(this,e,"Loading process failed")}},mounted(){this.listen("showCollection",this.showCollectionInfo),this.listen("showProcess",this.showProcessInfoById),this.listen("showJobInfo",this.showJobInfo),this.listen("showJobEstimate",this.showJobEstimate),this.listen("showProcessInfo",this.showProcessInfo),this.listen("showServiceInfo",this.showServiceInfo),this.listen("showUdfRuntimeInfo",this.showUdfRuntimeInfo),this.listen("showFileFormatInfo",this.showFileFormatInfo),this.listen("showSchema",this.showSchemaInfo),this.listen("showDataForm",this.showDataForm),this.listen("editProcess",this.editProcess),this.resizeListener=e=>this.emit("windowResized",e),window.addEventListener("resize",this.resizeListener),this.isAuthenticated&&(this.userInfoUpdater=setInterval(this.describeAccount,60*this.$config.dataRefreshInterval*1e3)),this.emit("title",this.title)},beforeDestroy(){null!==this.resizeListener&&window.removeEventListener("resize",this.resizeListener),null!==this.userInfoUpdater&&clearInterval(this.userInfoUpdater)},methods:{...n["a"].mapActions(["describeAccount","describeCollection"]),...n["a"].mapActions("userProcesses",{readUserProcess:"read"}),...n["a"].mapActions("editor",["loadInitialProcess"]),...n["a"].mapMutations("editor",["setContext","setProcess"]),saveProcess(){this.emit("replaceProcess",this.context,this.process)},updateEditor(e){this.setProcess(e),null===e&&this.setContext(null)},editProcess(e){this.setContext(e)},insertProcess(e){this.$refs.editor.insertProcess(e)},startMovingSeparator(e,t){this.moving=!1,1===e.which&&(this.moving=t)},stopMovingSeparator(e){this.moving=!1},moveSeparator(e){if(!1!==this.moving&&this.separators[this.moving]&&0!==e.movementX){var t,s=this.separators[this.moving],a=this.$refs[s[s.anchor]];t="right"===s.anchor?Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)-e.x:e.x,a.style.width=t+"px",this.emit("windowResized",e),e.preventDefault(),e.stopPropagation()}},centerSeparator(e,t){this.moving=!1;var s=this.separators[t];if(s){var a=this.$refs[s[s.anchor]];a.getBoundingClientRect().width<220?a.style.width=s.width:a.style.width=0,this.emit("windowResized",e)}},showCollectionInfo(e){this.describeCollection(e).then(e=>this.$refs.collectionModal.show(e)).catch(t=>n["a"].error(this,"Sorry, can't load collection details for "+e+"."))},showProcessInfoById(e){this._showProcessInfo(this.getProcessById(e))},showProcessInfo(e){this._showProcessInfo(e)},showUdfRuntimeInfo(e,t,s=null){this.$refs.udfRuntimeModal.show(e,t,s)},showFileFormatInfo(e,t,s){this.$refs.fileFormatModal.show(e,t,s)},showSchemaInfo(e,t,s=null){null===s&&(s="This is a parameter for a user-defined process.\nIt is a value made available by the parent entity (usually another process or a secondary web service) that is executing this processes for further use.\nThe value will comply to the following data type(s):"),this.$refs.schemaModal.show(e,t,s)},_showProcessInfo(e){e.native?this._showProcessInfoModal(e):this.readUserProcess({data:e}).then(e=>this._showProcessInfoModal(e.toJSON())).catch(t=>n["a"].exception(this,t,"Load Process Error: "+e.id))},_showProcessInfoModal(e){this.$refs.processModal.show(e)},showServiceInfo(e){this.$refs.serviceModal.show(e)},showJobInfo(e,t=null){this.$refs.jobModal.show(e,t)},showJobEstimate(e,t){this.$refs.jobEstimateModal.show(e,t)},showServerInfo(){this.$refs.serverInfoModal.show()},showWebEditorInfo(){this.emit("showWebEditorInfo")},showDataForm(e,t,s=null,a=null){var i="function"===typeof s,r={},o=[];for(let n of t)null!==n&&(o.push(new Te["c"](n)),r[n.name]=n.value);this.$refs.parameterModal.show(e,o,r,i,s,a)}}},Fe=De,Ie=(s("352f"),Object(d["a"])(Fe,a,i,!1,null,null,null));t["default"]=Ie.exports}}]);
//# sourceMappingURL=chunk-234e56f8.9d72d773.js.map